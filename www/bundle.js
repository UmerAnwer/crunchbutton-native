(function(win,doc){'use strict';var Snap=Snap||function(userOpts){var settings={element:null,menu:null,menuDragDistance:0,dragger:null,disable:'none',addBodyClasses:true,hyperextensible:true,resistance:0.5,flickThreshold:50,transitionSpeed:0.3,easing:'ease',maxPosition:266,minPosition:-266,tapToClose:true,touchToDrag:true,slideIntent:40,minDragDistance:5,useTransform:true},cache={simpleStates:{opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}}},eventList={},utils={hasTouch:(doc.ontouchstart===null),eventType:function(action){var eventTypes={down:(utils.hasTouch?'touchstart':'mousedown'),move:(utils.hasTouch?'touchmove':'mousemove'),up:(utils.hasTouch?'touchend':'mouseup'),out:(utils.hasTouch?'touchcancel':'mouseout')};return eventTypes[action];},page:function(t,e){return(utils.hasTouch&&e.touches.length&&e.touches[0])?e.touches[0]['page'+t]:e['page'+t];},klass:{has:function(el,name){return(el.className).indexOf(name)!==-1;},add:function(el,name){if(!utils.klass.has(el,name)&&settings.addBodyClasses){el.className+=" "+name;}},remove:function(el,name){if(settings.addBodyClasses){el.className=(el.className).replace(" "+name,"");}}},dispatchEvent:function(type){if(typeof eventList[type]==='function'){return eventList[type].call();}},vendor:function(){var tmp=doc.createElement("div"),prefixes='webkit Moz O ms'.split(' '),i;for(i in prefixes){if(typeof tmp.style[prefixes[i]+'Transition']!=='undefined'){return prefixes[i];}}},transitionCallback:function(){return(cache.vendor==='Moz'||cache.vendor==='ms')?'transitionend':cache.vendor+'TransitionEnd';},canTransform:function(){return settings.useTransform&&typeof settings.element.style[cache.vendor+'Transform']!=='undefined';},deepExtend:function(destination,source){var property;for(property in source){if(source[property]&&source[property].constructor&&source[property].constructor===Object){destination[property]=destination[property]||{};utils.deepExtend(destination[property],source[property]);}else{destination[property]=source[property];}}
return destination;},angleOfDrag:function(x,y){var degrees,theta;theta=Math.atan2(-(cache.startDragY-y),(cache.startDragX-x));if(theta<0){theta+=2*Math.PI;}
degrees=Math.floor(theta*(180/Math.PI)-180);if(degrees<0&&degrees>-180){degrees=360-Math.abs(degrees);}
return Math.abs(degrees);},events:{addEvent:function addEvent(element,eventName,func){if(element.addEventListener){return element.addEventListener(eventName,func,false);}else if(element.attachEvent){return element.attachEvent("on"+eventName,func);}},removeEvent:function addEvent(element,eventName,func){if(element.addEventListener){return element.removeEventListener(eventName,func,false);}else if(element.attachEvent){return element.detachEvent("on"+eventName,func);}},prevent:function(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}}},parentUntil:function(el,attr){var isStr=typeof attr==='string';while(el.parentNode){if(isStr&&el.getAttribute&&el.getAttribute(attr)){return el;}else if(!isStr&&el===attr){return el;}
el=el.parentNode;}
return null;}},action={translate:{get:{matrix:function(index){if(!utils.canTransform()){return parseInt(settings.element.style.left,10);}else{var matrix=win.getComputedStyle(settings.element)[cache.vendor+'Transform'].match(/\((.*)\)/),ieOffset=8;if(matrix){matrix=matrix[1].split(',');if(matrix.length===16){index+=ieOffset;}
return parseInt(matrix[index],10);}
return 0;}}},easeCallback:function(){settings.element.style[cache.vendor+'Transition']='';if(settings.menu){settings.menu.each(function(){this.style[cache.vendor+'Transition']='';});}
cache.translation=action.translate.get.matrix(4);cache.easing=false;clearInterval(cache.animatingInterval);if(cache.easingTo===0){utils.klass.remove(doc.body,'snapjs-right');utils.klass.remove(doc.body,'snapjs-left');}
utils.dispatchEvent('animated');utils.events.removeEvent(settings.element,utils.transitionCallback(),action.translate.easeCallback);},easeTo:function(n){if(!utils.canTransform()){cache.translation=n;action.translate.x(n);}else{cache.easing=true;cache.easingTo=n;settings.element.style[cache.vendor+'Transition']='all '+settings.transitionSpeed+'s '+settings.easing;if(settings.menu){settings.menu.each(function(){this.style[cache.vendor+'Transition']='all '+settings.transitionSpeed+'s '+settings.easing;});}
cache.animatingInterval=setInterval(function(){utils.dispatchEvent('animating');},1);clearInterval(cache.animatingInterval);utils.events.addEvent(settings.element,utils.transitionCallback(),action.translate.easeCallback);action.translate.x(n);}
if(n===0){setTimeout(function(){$(settings.element).removeClass('snap-opened');},100);settings.element.style[cache.vendor+'Transform']='';}else{$(settings.element).addClass('snap-opened');}},x:function(n){if((settings.disable==='left'&&n>0)||(settings.disable==='right'&&n<0)){return;}
if(!settings.hyperextensible){if(n===settings.maxPosition||n>settings.maxPosition){n=settings.maxPosition;}else if(n===settings.minPosition||n<settings.minPosition){n=settings.minPosition;}}
n=parseInt(n,10);if(isNaN(n)){n=0;}
if(utils.canTransform()){var theTranslate='translate3d('+n+'px, 0,0)';settings.element.style[cache.vendor+'Transform']=theTranslate;if(settings.menu){var getTranslate=function(dir){var hideDistance=settings.menuDragDistance;if(dir=='left'){var dirDistance=-hideDistance;}else{var dirDistance=hideDistance;}
var nn=((n/settings.maxPosition)*hideDistance)+dirDistance;var theSideTranslate='translate3d('+nn+'px, 0,0)';return theSideTranslate;};if(settings.menu.get(0)){settings.menu.get(0).style[cache.vendor+'Transform']=getTranslate('left');}
if(settings.menu.get(1)){settings.menu.get(1).style[cache.vendor+'Transform']=getTranslate('right');}}}else{settings.element.style.width=(win.innerWidth||doc.documentElement.clientWidth)+'px';settings.element.style.left=n+'px';settings.element.style.right='';}}},drag:{listen:function(){cache.translation=0;cache.easing=false;utils.events.addEvent(settings.element,utils.eventType('down'),action.drag.startDrag);utils.events.addEvent(settings.element,utils.eventType('move'),action.drag.dragging);utils.events.addEvent(settings.element,utils.eventType('up'),action.drag.endDrag);},stopListening:function(){utils.events.removeEvent(settings.element,utils.eventType('down'),action.drag.startDrag);utils.events.removeEvent(settings.element,utils.eventType('move'),action.drag.dragging);utils.events.removeEvent(settings.element,utils.eventType('up'),action.drag.endDrag);},startDrag:function(e){if(e&&e.button&&e.button==2){return;}
var target=e.target?e.target:e.srcElement,ignoreParent=utils.parentUntil(target,'data-snap-ignore');if(ignoreParent){utils.dispatchEvent('ignore');return;}
if(settings.dragger){var dragParent=utils.parentUntil(target,settings.dragger);if(!dragParent&&(cache.translation!==settings.minPosition&&cache.translation!==settings.maxPosition)){return;}}
utils.dispatchEvent('start');settings.element.style[cache.vendor+'Transition']='';if(settings.menu){settings.menu.each(function(){this.style[cache.vendor+'Transition']='';});}
cache.isDragging=true;cache.hasIntent=null;cache.intentChecked=false;cache.startDragX=utils.page('X',e);cache.startDragY=utils.page('Y',e);cache.dragWatchers={current:0,last:0,hold:0,state:''};cache.simpleStates={opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}};},dragging:function(e){if(cache.isDragging&&settings.touchToDrag){var thePageX=utils.page('X',e),thePageY=utils.page('Y',e),translated=cache.translation,absoluteTranslation=action.translate.get.matrix(4),whileDragX=thePageX-cache.startDragX,openingLeft=absoluteTranslation>0,translateTo=whileDragX,diff;if((cache.intentChecked&&!cache.hasIntent)){return;}
if(settings.addBodyClasses){if((absoluteTranslation)>0){utils.klass.add(doc.body,'snapjs-left');utils.klass.remove(doc.body,'snapjs-right');}else if((absoluteTranslation)<0){utils.klass.add(doc.body,'snapjs-right');utils.klass.remove(doc.body,'snapjs-left');}}
if(cache.hasIntent===false||cache.hasIntent===null){var deg=utils.angleOfDrag(thePageX,thePageY),inRightRange=(deg>=0&&deg<=settings.slideIntent)||(deg<=360&&deg>(360-settings.slideIntent)),inLeftRange=(deg>=180&&deg<=(180+settings.slideIntent))||(deg<=180&&deg>=(180-settings.slideIntent));if(!inLeftRange&&!inRightRange){cache.hasIntent=false;}else{cache.hasIntent=true;}
cache.intentChecked=true;}
if((settings.minDragDistance>=Math.abs(thePageX-cache.startDragX))||(cache.hasIntent===false)){return;}
utils.events.prevent(e);utils.dispatchEvent('drag');cache.dragWatchers.current=thePageX;if(cache.dragWatchers.last>thePageX){if(cache.dragWatchers.state!=='left'){cache.dragWatchers.state='left';cache.dragWatchers.hold=thePageX;}
cache.dragWatchers.last=thePageX;}else if(cache.dragWatchers.last<thePageX){if(cache.dragWatchers.state!=='right'){cache.dragWatchers.state='right';cache.dragWatchers.hold=thePageX;}
cache.dragWatchers.last=thePageX;}
if(openingLeft){if(settings.maxPosition<absoluteTranslation){diff=(absoluteTranslation-settings.maxPosition)*settings.resistance;translateTo=whileDragX-diff;}
cache.simpleStates={opening:'left',towards:cache.dragWatchers.state,hyperExtending:settings.maxPosition<absoluteTranslation,halfway:absoluteTranslation>(settings.maxPosition/2),flick:Math.abs(cache.dragWatchers.current-cache.dragWatchers.hold)>settings.flickThreshold,translation:{absolute:absoluteTranslation,relative:whileDragX,sinceDirectionChange:(cache.dragWatchers.current-cache.dragWatchers.hold),percentage:(absoluteTranslation/settings.maxPosition)*100}};}else{if(settings.minPosition>absoluteTranslation){diff=(absoluteTranslation-settings.minPosition)*settings.resistance;translateTo=whileDragX-diff;}
cache.simpleStates={opening:'right',towards:cache.dragWatchers.state,hyperExtending:settings.minPosition>absoluteTranslation,halfway:absoluteTranslation<(settings.minPosition/2),flick:Math.abs(cache.dragWatchers.current-cache.dragWatchers.hold)>settings.flickThreshold,translation:{absolute:absoluteTranslation,relative:whileDragX,sinceDirectionChange:(cache.dragWatchers.current-cache.dragWatchers.hold),percentage:(absoluteTranslation/settings.minPosition)*100}};}
action.translate.x(translateTo+translated);}},endDrag:function(e){if(cache.isDragging){utils.dispatchEvent('end');var translated=action.translate.get.matrix(4);if(cache.dragWatchers.current===0&&translated!==0&&settings.tapToClose){utils.events.prevent(e);action.translate.easeTo(0);cache.isDragging=false;cache.startDragX=0;return;}
if(cache.simpleStates.opening==='left'){if((cache.simpleStates.halfway||cache.simpleStates.hyperExtending||cache.simpleStates.flick)){if(cache.simpleStates.flick&&cache.simpleStates.towards==='left'){action.translate.easeTo(0);}else if((cache.simpleStates.flick&&cache.simpleStates.towards==='right')||(cache.simpleStates.halfway||cache.simpleStates.hyperExtending)){action.translate.easeTo(settings.maxPosition);}}else{action.translate.easeTo(0);}}else if(cache.simpleStates.opening==='right'){if((cache.simpleStates.halfway||cache.simpleStates.hyperExtending||cache.simpleStates.flick)){if(cache.simpleStates.flick&&cache.simpleStates.towards==='right'){action.translate.easeTo(0);}else if((cache.simpleStates.flick&&cache.simpleStates.towards==='left')||(cache.simpleStates.halfway||cache.simpleStates.hyperExtending)){action.translate.easeTo(settings.minPosition);}}else{action.translate.easeTo(0);}}
cache.isDragging=false;cache.startDragX=utils.page('X',e);}}}},init=function(opts){if(opts.element){utils.deepExtend(settings,opts);cache.vendor=utils.vendor();action.drag.listen();}};this.open=function(side){utils.klass.remove(doc.body,'snapjs-expand-left');utils.klass.remove(doc.body,'snapjs-expand-right');if(side==='left'){cache.simpleStates.opening='left';cache.simpleStates.towards='right';utils.klass.add(doc.body,'snapjs-left');utils.klass.remove(doc.body,'snapjs-right');action.translate.easeTo(settings.maxPosition);}else if(side==='right'){cache.simpleStates.opening='right';cache.simpleStates.towards='left';utils.klass.remove(doc.body,'snapjs-left');utils.klass.add(doc.body,'snapjs-right');action.translate.easeTo(settings.minPosition);}};this.close=function(){action.translate.easeTo(0);};this.expand=function(side){var to=win.innerWidth||doc.documentElement.clientWidth;if(side==='left'){utils.klass.add(doc.body,'snapjs-expand-left');utils.klass.remove(doc.body,'snapjs-expand-right');}else{utils.klass.add(doc.body,'snapjs-expand-right');utils.klass.remove(doc.body,'snapjs-expand-left');to*=-1;}
action.translate.easeTo(to);};this.on=function(evt,fn){eventList[evt]=fn;return this;};this.off=function(evt){if(eventList[evt]){eventList[evt]=false;}};this.enable=function(){action.drag.listen();};this.disable=function(){action.drag.stopListening();};this.settings=function(opts){utils.deepExtend(settings,opts);};this.state=function(){var state,fromLeft=action.translate.get.matrix(4);if(fromLeft===settings.maxPosition){state='left';}else if(fromLeft===settings.minPosition){state='right';}else{state='closed';}
return{state:state,info:cache.simpleStates};};init(userOpts);};if((typeof module!=='undefined')&&module.exports){module.exports=Snap;}
if(typeof ender==='undefined'){this.Snap=Snap;}
if((typeof define==="function")&&define.amd){define("snap",[],function(){return Snap;});}}).call(this,window,document);;Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);}else if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;}else{throw new TypeError(date1+" - "+date2);}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);};$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;}}
return-1;};$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];};$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}
return null;};$D.getTimezoneOffset=function(name){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;}}
return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);};$P.isToday=function(){return this.isSameDay(new Date());};$P.isSameDay=function(date){return this.clone().clearTime().equals(date.clone().clearTime());};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);};$P.addDays=function(value){this.setDate(this.getDate()+value);return this;};$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;return this;}
var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);}
if(x.seconds){this.addSeconds(x.seconds);}
if(x.minutes){this.addMinutes(x.minutes);}
if(x.hours){this.addHours(x.hours);}
if(x.weeks){this.addWeeks(x.weeks);}
if(x.months){this.addMonths(x.months);}
if(x.years){this.addYears(x.years);}
if(x.days){this.addDays(x.days);}
return this;};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;f=$d+((153*($m-3)+2)/5)+58+s;}
g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);}else if(n>364+s){w=1;}else{w=(n/7|0)+1;}
$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());};$D._validate=function(n,min,max,name){if(typeof n=="undefined"){return false;}else if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");}
return true;};$D.validateMillisecond=function(value){return $D._validate(value,0,999,"millisecond");};$D.validateSecond=function(value){return $D._validate(value,0,59,"second");};$D.validateMinute=function(value){return $D._validate(value,0,59,"minute");};$D.validateHour=function(value){return $D._validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return $D._validate(value,1,$D.getDaysInMonth(year,month),"day");};$D.validateMonth=function(value){return $D._validate(value,0,11,"month");};$D.validateYear=function(value){return $D._validate(value,0,9999,"year");};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());}
if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());}
if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());}
if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}
if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());}
if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());}
if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());}
if(config.timezone){this.setTimezone(config.timezone);}
if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);}
if(config.week&&$D._validate(config.week,0,53,"week")){this.setWeek(config.week);}
return this;};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;}
else if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);}
return this;}
return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);}};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?'0'+n:n;}
return'"'+this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z"';};}
$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$C.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);}}
var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");}
x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());default:return m;}}):this._toString();};}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,$N=Number.prototype;$P._orient=+1;$P._nth=null;$P._is=false;$P._same=false;$P._isSecond=false;$N._dateElement="day";$P.next=function(){this._orient=+1;return this;};$D.next=function(){return $D.today().next();};$P.last=$P.prev=$P.previous=function(){this._orient=-1;return this;};$D.last=$D.prev=$D.previous=function(){return $D.today().last();};$P.is=function(){this._is=true;return this;};$P.same=function(){this._same=true;this._isSecond=false;return this;};$P.today=function(){return this.same().day();};$P.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}
return false;};$P.at=function(time){return(typeof time==="string")?$D.parse(this.toString("d")+" "+time):this.set(time);};$N.fromNow=$N.after=function(date){var c={};c[this._dateElement]=this;return((!date)?new Date():date.clone()).add(c);};$N.ago=$N.before=function(date){var c={};c[this._dateElement]=this*-1;return((!date)?new Date():date.clone()).add(c);};var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),pxf=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),nth=("final first second third fourth fifth").split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++){o[px[i].toLowerCase()]=this["get"+pxf[i]]();}
return o;};$D.fromObject=function(config){config.week=null;return Date.today().set(config);};var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n;}
if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}
this._isSecond=false;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp){throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");}
return this;}
return this.moveToDayOfWeek(n,this._orient);};};var sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();if(n===0&&$C.firstDayOfWeek===1&&t.getDay()!==0){shift=shift+7;}
return t.addDays(shift);};};for(var i=0;i<dx.length;i++){$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i;$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i);$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);}
var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n;}
return this.moveToMonth(n,this._orient);};};var smf=function(n){return function(){return $D.today().set({month:n,day:1});};};for(var j=0;j<mx.length;j++){$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j;$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j);$P[mx[j]]=$P[mx[j].substring(0,3)]=mf(j);}
var ef=function(j){return function(){if(this._isSecond){this._isSecond=false;return this;}
if(this._same){this._same=this._is=false;var o1=this.toObject(),o2=(arguments[0]||new Date()).toObject(),v="",k=j.toLowerCase();for(var m=(px.length-1);m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v]){return false;}
if(k==v){break;}}
return true;}
if(j.substring(j.length-1)!="s"){j+="s";}
return this["add"+j](this._orient);};};var nf=function(n){return function(){this._dateElement=n;return this;};};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$P[de]=$P[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de);}
$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){if(this._same){return this._ss(arguments[0]);}
if(dayOfWeek||dayOfWeek===0){return this.moveToNthOccurrence(dayOfWeek,n);}
this._nth=n;if(n===2&&(dayOfWeek===undefined||dayOfWeek===null)){this._isSecond=true;return this.addSeconds(this._orient);}
return this;};};for(var l=0;l<nth.length;l++){$P[nth[l]]=(l===0)?nthfn(-1):nthfn(l);}}());(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'";}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)]);}else{throw new $P.Exception(s);}};},token:function(s){return function(s){return _.rtoken(new RegExp("^\s*"+s+"\s*"))(s);};},stoken:function(s){return _.rtoken(new RegExp("^"+s));},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s);}catch(e){qx.push(rx[0]);s=rx[1];continue;}
break;}
return[qx,s];};},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s);}catch(e){return[rx,s];}
rx.push(r[0]);s=r[1];}
return[rx,s];};},optional:function(p){return function(s){var r=null;try{r=p.call(this,s);}catch(e){return[null,s];}
return[r[0],r[1]];};},not:function(p){return function(s){try{p.call(this,s);}catch(e){return[null,s];}
throw new $P.Exception(s);};},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]];}:null;},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx));}
return rx;},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s));}catch(e){r=cache[s]=e;}
if(r instanceof $P.Exception){throw r;}else{return r;}};},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){r=null;}
if(r){return r;}}
throw new $P.Exception(s);};},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){throw new $P.Exception(s);}
rx.push(r[0]);s=r[1];}
return[rx,s];};},all:function(){var px=arguments,_=_;return _.each(_.optional(px));},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0];}
return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s);}catch(e){break;}
rx.push(r[0]);try{q=d.call(this,r[1]);}catch(ex){q=null;break;}
s=q[1];}
if(!r){throw new $P.Exception(s);}
if(q){throw new $P.Exception(q[1]);}
if(c){try{r=c.call(this,r[1]);}catch(ey){throw new $P.Exception(r[1]);}}
return[rx,(r?r[1]:s)];};},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]];};},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)));},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s);}catch(e){continue;}
rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1]);}catch(ex){last=true;}}else{last=true;}
if(!last&&q[1].length===0){last=true;}
if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j]);}}
p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1];}}
if(rx[1].length<best[1].length){best=rx;}
if(best[1].length===0){break;}}
if(best[0].length===0){return best;}
if(c){try{q=c.call(this,best[1]);}catch(ey){throw new $P.Exception(best[1]);}
best[1]=q[1];}
return best;};},forward:function(gr,fname){return function(s){return gr[fname].call(this,s);};},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]];};},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]];};},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s);}
return rx;};}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments);}else if(arguments[0]instanceof Array){args=arguments[0];}
if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx;}}else{return op.apply(null,arguments);}};};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]]);}
var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0]);}else{return op.apply(null,arguments);}};};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]]);}}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo;var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]));}else{if(ax[i]){rx.push(ax[i]);}}}
return rx;};$D.Grammar={};$D.Translator={hour:function(s){return function(){this.hour=Number(s);};},minute:function(s){return function(){this.minute=Number(s);};},second:function(s){return function(){this.second=Number(s);};},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase();};},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n);}else{this.timezone=s.toLowerCase();}};},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0]);};},month:function(s){return function(){this.month=(s.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1;};},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<$C.twoDigitYearMax)?2000:1900)));};},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(x){x=(x instanceof Array)?x:[x];for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this);}}
var now=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=now.getDate();}
if(!this.year){this.year=now.getFullYear();}
if(!this.month&&this.month!==0){this.month=now.getMonth();}
if(!this.day){this.day=1;}
if(!this.hour){this.hour=0;}
if(!this.minute){this.minute=0;}
if(!this.second){this.second=0;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.day>$D.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}
var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone});}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset});}
return r;},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null;}
for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this);}}
var today=$D.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else if(this.now){today=new Date();}
var expression=!!(this.days&&this.days!==null||this.orient||this.operator);var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){today.setTimeToNow();}
if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;expression=true;}}
if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(!this.month){this.month=temp.getMonth();}
this.year=temp.getFullYear();}
if(expression&&this.weekday&&this.unit!="month"){this.unit="day";gap=($D.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod);}
if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}
if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}
if(this.month&&!this.day&&this.value){today.set({day:this.value*1});if(!expression){this.day=this.value*1;}}
if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;expression=true;}
if(expression&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null;}
if(!this.unit){this.unit="day";}
if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*orient;}else if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}
this[this.unit+"s"]=this.value*orient;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(temp.getMonth()!==today.getMonth()){this.month=temp.getMonth();}}
if((this.month||this.month===0)&&!this.day){this.day=1;}
if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}
if(expression&&this.timezone&&this.day&&this.days){this.day=this.days;}
return(expression)?today.add(this):today.set(this);}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$C.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));}
fn=_C[keys]=_.any.apply(null,px);}
return fn;};g.ctoken2=function(key){return _.rtoken($C.regexPatterns[key]);};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s;};}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")));};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s;};});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s;};});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s;};});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"");};});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter);};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[$C.dateElementOrder]||g.mdy).call(this,s));};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt];}else{throw $D.Parsing.Exception(fmt);}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s));}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact);});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0]);};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]));}
return _.any.apply(null,rx);}else{return _get(fx);}};g._formats=g.formats(["\"yyyy-MM-ddTHH:mm:ssZ\"","yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r;}}catch(e){}
return g._start.call({},s);};$D._parse=$D.parse;$D.parse=function(s){var r=null;if(!s){return null;}
if(s instanceof Date){return s;}
try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};};$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s);};}());;;(function($,undefined){var supported,ls;if('localStorage'in window){try{ls=(typeof window.localStorage==='undefined')?undefined:window.localStorage;if(typeof ls=='undefined'||typeof window.JSON=='undefined'){supported=false;}else{supported=true;}}
catch(err){supported=false;}}
$.totalStorage=function(key,value,options){return $.totalStorage.impl.init(key,value);};$.totalStorage.setItem=function(key,value){return $.totalStorage.impl.setItem(key,value);};$.totalStorage.getItem=function(key){return $.totalStorage.impl.getItem(key);};$.totalStorage.getAll=function(){return $.totalStorage.impl.getAll();};$.totalStorage.deleteItem=function(key){return $.totalStorage.impl.deleteItem(key);};$.totalStorage.ls=function(value){supported=value?true:false;};$.totalStorage.impl={init:function(key,value){if(typeof value!='undefined'){return this.setItem(key,value);}else{return this.getItem(key);}},setItem:function(key,value){if(!supported){try{$.cookie(key,JSON.stringify(value));return value;}catch(e){console.log('Local Storage not supported by this browser. Install the cookie plugin on your site to take advantage of the same functionality. You can get it at https://github.com/carhartl/jquery-cookie');}}
var saver=JSON.stringify(value);ls.setItem(key,saver);return this.parseResult(saver);},getItem:function(key){if(!supported){try{return this.parseResult($.cookie(key));}catch(e){return null;}}
var item=ls.getItem(key);return this.parseResult(item);},deleteItem:function(key){if(!supported){try{$.cookie(key,null);return true;}catch(e){return false;}}
ls.removeItem(key);return true;},getAll:function(){var items=[];if(!supported){try{var pairs=document.cookie.split(";");for(var i=0;i<pairs.length;i++){var pair=pairs[i].split('=');var key=pair[0];items.push({key:key,value:this.parseResult($.cookie(key))});}}catch(e){return null;}}else{for(var j in ls){if(j.length){items.push({key:j,value:this.parseResult(ls.getItem(j))});}}}
return items;},parseResult:function(res){var ret;try{ret=JSON.parse(res);if(typeof ret=='undefined'){ret=res;}
if(ret=='true'){ret=true;}
if(ret=='false'){ret=false;}
if(parseFloat(ret)==ret&&typeof ret!="object"){ret=parseFloat(ret);}}catch(e){ret=res;}
return ret;}};})(jQuery);;
/*
 * jQuery Cookie Plugin v1.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($,document){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
$.cookie=function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value==null)){options=$.extend({},$.cookie.defaults,options);if(value==null){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=String(value);return(document.cookie=[encodeURIComponent(key),'=',options.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
options=value||$.cookie.defaults||{};var decode=options.raw?raw:decoded;var cookies=document.cookie.split('; ');for(var i=0,parts;(parts=cookies[i]&&cookies[i].split('='));i++){if(decode(parts.shift())===key){return decode(parts.join('='));}}
return null;};$.cookie.defaults={path:'/',expires:(new Date(3000,01,01))};})(jQuery,document);;(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);;
/* Magnific Popup - v0.9.3 - 2013-07-16
* http://dimsemenov.com/plugins/magnific-popup/
* Copyright (c) 2013 Dmitry Semenov; */
;(function($){var CLOSE_EVENT='Close',BEFORE_CLOSE_EVENT='BeforeClose',AFTER_CLOSE_EVENT='AfterClose',BEFORE_APPEND_EVENT='BeforeAppend',MARKUP_PARSE_EVENT='MarkupParse',OPEN_EVENT='Open',CHANGE_EVENT='Change',NS='mfp',EVENT_NS='.'+NS,READY_CLASS='mfp-ready',REMOVING_CLASS='mfp-removing',PREVENT_CLOSE_CLASS='mfp-prevent-close';var mfp,MagnificPopup=function(){},_isJQ=!!(window.jQuery),_prevStatus,_window=$(window),_body,_document,_prevContentType,_wrapClasses,_currPopupType;var _mfpOn=function(name,f){mfp.ev.on(NS+name+EVENT_NS,f);},_getEl=function(className,appendTo,html,raw){var el=document.createElement('div');el.className='mfp-'+className;if(html){el.innerHTML=html;}
if(!raw){el=$(el);if(appendTo){el.appendTo(appendTo);}}else if(appendTo){appendTo.appendChild(el);}
return el;},_mfpTrigger=function(e,data){mfp.ev.triggerHandler(NS+e,data);if(mfp.st.callbacks){e=e.charAt(0).toLowerCase()+e.slice(1);if(mfp.st.callbacks[e]){mfp.st.callbacks[e].apply(mfp,$.isArray(data)?data:[data]);}}},_setFocus=function(){(mfp.st.focus?mfp.content.find(mfp.st.focus).eq(0):mfp.wrap).trigger('focus');},_getCloseBtn=function(type){if(type!==_currPopupType||!mfp.currTemplate.closeBtn){mfp.currTemplate.closeBtn=$(mfp.st.closeMarkup.replace('%title%',mfp.st.tClose));_currPopupType=type;}
return mfp.currTemplate.closeBtn;},_checkInstance=function(){if(!$.magnificPopup.instance){mfp=new MagnificPopup();mfp.init();$.magnificPopup.instance=mfp;}},_checkIfClose=function(target){if($(target).hasClass(PREVENT_CLOSE_CLASS)){return;}
var closeOnContent=mfp.st.closeOnContentClick;var closeOnBg=mfp.st.closeOnBgClick;if(closeOnContent&&closeOnBg){return true;}else{if(!mfp.content||$(target).hasClass('mfp-close')||(mfp.preloader&&target===mfp.preloader[0])){return true;}
if((target!==mfp.content[0]&&!$.contains(mfp.content[0],target))){if(closeOnBg){if($.contains(document,target)){return true;}}}else if(closeOnContent){return true;}}
return false;},supportsTransitions=function(){var s=document.createElement('p').style,v=['ms','O','Moz','Webkit'];if(s['transition']!==undefined){return true;}
while(v.length){if(v.pop()+'Transition'in s){return true;}}
return false;};MagnificPopup.prototype={constructor:MagnificPopup,init:function(){var appVersion=navigator.appVersion;mfp.isIE7=appVersion.indexOf("MSIE 7.")!==-1;mfp.isIE8=appVersion.indexOf("MSIE 8.")!==-1;mfp.isLowIE=mfp.isIE7||mfp.isIE8;mfp.isAndroid=(/android/gi).test(appVersion);mfp.isIOS=(/iphone|ipad|ipod/gi).test(appVersion);mfp.supportsTransition=supportsTransitions();mfp.probablyMobile=(mfp.isAndroid||mfp.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent));_body=$(document.body);_document=$(document);mfp.popupsCache={};},open:function(data){var i;if(data.isObj===false){mfp.items=data.items.toArray();mfp.index=0;var items=data.items,item;for(i=0;i<items.length;i++){item=items[i];if(item.parsed){item=item.el[0];}
if(item===data.el[0]){mfp.index=i;break;}}}else{mfp.items=$.isArray(data.items)?data.items:[data.items];mfp.index=data.index||0;}
if(mfp.isOpen){mfp.updateItemHTML();return;}
mfp.types=[];_wrapClasses='';if(data.mainEl&&data.mainEl.length){mfp.ev=data.mainEl.eq(0);}else{mfp.ev=_document;}
if(data.key){if(!mfp.popupsCache[data.key]){mfp.popupsCache[data.key]={};}
mfp.currTemplate=mfp.popupsCache[data.key];}else{mfp.currTemplate={};}
mfp.st=$.extend(true,{},$.magnificPopup.defaults,data);mfp.fixedContentPos=mfp.st.fixedContentPos==='auto'?!mfp.probablyMobile:mfp.st.fixedContentPos;if(mfp.st.modal){mfp.st.closeOnContentClick=false;mfp.st.closeOnBgClick=false;mfp.st.showCloseBtn=false;mfp.st.enableEscapeKey=false;}
if(!mfp.bgOverlay){mfp.bgOverlay=_getEl('bg').on('click'+EVENT_NS,function(e){mfp.close();});mfp.wrap=_getEl('wrap').attr('tabindex',-1).on('click'+EVENT_NS,function(e){if(_checkIfClose(e.target)){mfp.close();}});mfp.container=_getEl('container',mfp.wrap);}
mfp.contentContainer=_getEl('content');if(mfp.st.preloader){mfp.preloader=_getEl('preloader',mfp.container,mfp.st.tLoading);}
var modules=$.magnificPopup.modules;for(i=0;i<modules.length;i++){var n=modules[i];n=n.charAt(0).toUpperCase()+n.slice(1);mfp['init'+n].call(mfp);}
_mfpTrigger('BeforeOpen');if(mfp.st.showCloseBtn){if(!mfp.st.closeBtnInside){mfp.wrap.append(_getCloseBtn());}else{_mfpOn(MARKUP_PARSE_EVENT,function(e,template,values,item){values.close_replaceWith=_getCloseBtn(item.type);});_wrapClasses+=' mfp-close-btn-in';}}
if(mfp.st.alignTop){_wrapClasses+=' mfp-align-top';}
if(mfp.fixedContentPos){mfp.wrap.css({overflow:mfp.st.overflowY,overflowX:'hidden',overflowY:mfp.st.overflowY});}else{mfp.wrap.css({top:_window.scrollTop(),position:'absolute'});}
if(mfp.st.fixedBgPos===false||(mfp.st.fixedBgPos==='auto'&&!mfp.fixedContentPos)){mfp.bgOverlay.css({height:_document.height(),position:'absolute'});}
if(mfp.st.enableEscapeKey){_document.on('keyup'+EVENT_NS,function(e){if(e.keyCode===27){mfp.close();}});}
_window.on('resize'+EVENT_NS,function(){mfp.updateSize();});if(!mfp.st.closeOnContentClick){_wrapClasses+=' mfp-auto-cursor';}
if(_wrapClasses)
mfp.wrap.addClass(_wrapClasses);var windowHeight=mfp.wH=_window.height();var windowStyles={};if(mfp.fixedContentPos){if(mfp._hasScrollBar(windowHeight)){var s=mfp._getScrollbarSize();if(s){windowStyles.paddingRight=s;}}}
if(mfp.fixedContentPos){if(!mfp.isIE7){windowStyles.overflow='hidden';}else{$('body, html').css('overflow','hidden');}}
var classesToadd=mfp.st.mainClass;if(mfp.isIE7){classesToadd+=' mfp-ie7';}
if(classesToadd){mfp._addClassToMFP(classesToadd);}
mfp.updateItemHTML();_mfpTrigger('BuildControls');$('html').css(windowStyles);mfp.bgOverlay.add(mfp.wrap).prependTo(document.body);mfp._lastFocusedEl=document.activeElement;setTimeout(function(){if(mfp.content){mfp._addClassToMFP(READY_CLASS);_setFocus();}else{mfp.bgOverlay.addClass(READY_CLASS);}
_document.on('focusin'+EVENT_NS,function(e){if(e.target!==mfp.wrap[0]&&!$.contains(mfp.wrap[0],e.target)){_setFocus();return false;}});},16);mfp.isOpen=true;mfp.updateSize(windowHeight);_mfpTrigger(OPEN_EVENT);},close:function(){if(!mfp.isOpen)return;_mfpTrigger(BEFORE_CLOSE_EVENT);mfp.isOpen=false;if(mfp.st.removalDelay&&!mfp.isLowIE&&mfp.supportsTransition){mfp._addClassToMFP(REMOVING_CLASS);setTimeout(function(){mfp._close();},mfp.st.removalDelay);}else{mfp._close();}},_close:function(){_mfpTrigger(CLOSE_EVENT);var classesToRemove=REMOVING_CLASS+' '+READY_CLASS+' ';mfp.bgOverlay.detach();mfp.wrap.detach();mfp.container.empty();if(mfp.st.mainClass){classesToRemove+=mfp.st.mainClass+' ';}
mfp._removeClassFromMFP(classesToRemove);if(mfp.fixedContentPos){var windowStyles={paddingRight:''};if(mfp.isIE7){$('body, html').css('overflow','');}else{windowStyles.overflow='';}
$('html').css(windowStyles);}
_document.off('keyup'+EVENT_NS+' focusin'+EVENT_NS);mfp.ev.off(EVENT_NS);mfp.wrap.attr('class','mfp-wrap').removeAttr('style');mfp.bgOverlay.attr('class','mfp-bg');mfp.container.attr('class','mfp-container');if(mfp.st.showCloseBtn&&(!mfp.st.closeBtnInside||mfp.currTemplate[mfp.currItem.type]===true)){if(mfp.currTemplate.closeBtn)
mfp.currTemplate.closeBtn.detach();}
if(mfp._lastFocusedEl){$(mfp._lastFocusedEl).trigger('focus');}
mfp.currItem=null;mfp.content=null;mfp.currTemplate=null;mfp.prevHeight=0;_mfpTrigger(AFTER_CLOSE_EVENT);},updateSize:function(winHeight){if(mfp.isIOS){var zoomLevel=document.documentElement.clientWidth/window.innerWidth;var height=window.innerHeight*zoomLevel;mfp.wrap.css('height',height);mfp.wH=height;}else{mfp.wH=winHeight||_window.height();}
if(!mfp.fixedContentPos){mfp.wrap.css('height',mfp.wH);}
_mfpTrigger('Resize');},updateItemHTML:function(){var item=mfp.items[mfp.index];mfp.contentContainer.detach();if(mfp.content)
mfp.content.detach();if(!item.parsed){item=mfp.parseEl(mfp.index);}
var type=item.type;_mfpTrigger('BeforeChange',[mfp.currItem?mfp.currItem.type:'',type]);mfp.currItem=item;if(!mfp.currTemplate[type]){var markup=mfp.st[type]?mfp.st[type].markup:false;_mfpTrigger('FirstMarkupParse',markup);if(markup){mfp.currTemplate[type]=$(markup);}else{mfp.currTemplate[type]=true;}}
if(_prevContentType&&_prevContentType!==item.type){mfp.container.removeClass('mfp-'+_prevContentType+'-holder');}
var newContent=mfp['get'+type.charAt(0).toUpperCase()+type.slice(1)](item,mfp.currTemplate[type]);mfp.appendContent(newContent,type);item.preloaded=true;_mfpTrigger(CHANGE_EVENT,item);_prevContentType=item.type;mfp.container.prepend(mfp.contentContainer);_mfpTrigger('AfterChange');},appendContent:function(newContent,type){mfp.content=newContent;if(newContent){if(mfp.st.showCloseBtn&&mfp.st.closeBtnInside&&mfp.currTemplate[type]===true){if(!mfp.content.find('.mfp-close').length){mfp.content.append(_getCloseBtn());}}else{mfp.content=newContent;}}else{mfp.content='';}
_mfpTrigger(BEFORE_APPEND_EVENT);mfp.container.addClass('mfp-'+type+'-holder');mfp.contentContainer.append(mfp.content);},parseEl:function(index){var item=mfp.items[index],type=item.type;if(item.tagName){item={el:$(item)};}else{item={data:item,src:item.src};}
if(item.el){var types=mfp.types;for(var i=0;i<types.length;i++){if(item.el.hasClass('mfp-'+types[i])){type=types[i];break;}}
item.src=item.el.attr('data-mfp-src');if(!item.src){item.src=item.el.attr('href');}}
item.type=type||mfp.st.type||'inline';item.index=index;item.parsed=true;mfp.items[index]=item;_mfpTrigger('ElementParse',item);return mfp.items[index];},addGroup:function(el,options){var eHandler=function(e){e.mfpEl=this;mfp._openClick(e,el,options);};if(!options){options={};}
var eName='click.magnificPopup';options.mainEl=el;if(options.items){options.isObj=true;el.off(eName).on(eName,eHandler);}else{options.isObj=false;if(options.delegate){el.off(eName).on(eName,options.delegate,eHandler);}else{options.items=el;el.off(eName).on(eName,eHandler);}}},_openClick:function(e,el,options){var midClick=options.midClick!==undefined?options.midClick:$.magnificPopup.defaults.midClick;if(!midClick&&(e.which===2||e.ctrlKey||e.metaKey)){return;}
var disableOn=options.disableOn!==undefined?options.disableOn:$.magnificPopup.defaults.disableOn;if(disableOn){if($.isFunction(disableOn)){if(!disableOn.call(mfp)){return true;}}else{if(_window.width()<disableOn){return true;}}}
if(e.type){e.preventDefault();if(mfp.isOpen){e.stopPropagation();}}
options.el=$(e.mfpEl);if(options.delegate){options.items=el.find(options.delegate);}
mfp.open(options);},updateStatus:function(status,text){if(mfp.preloader){if(_prevStatus!==status){mfp.container.removeClass('mfp-s-'+_prevStatus);}
if(!text&&status==='loading'){text=mfp.st.tLoading;}
var data={status:status,text:text};_mfpTrigger('UpdateStatus',data);status=data.status;text=data.text;mfp.preloader.html(text);mfp.preloader.find('a').on('click',function(e){e.stopImmediatePropagation();});mfp.container.addClass('mfp-s-'+status);_prevStatus=status;}},_addClassToMFP:function(cName){mfp.bgOverlay.addClass(cName);mfp.wrap.addClass(cName);},_removeClassFromMFP:function(cName){this.bgOverlay.removeClass(cName);mfp.wrap.removeClass(cName);},_hasScrollBar:function(winHeight){return((mfp.isIE7?_document.height():document.body.scrollHeight)>(winHeight||_window.height()));},_parseMarkup:function(template,values,item){var arr;if(item.data){values=$.extend(item.data,values);}
_mfpTrigger(MARKUP_PARSE_EVENT,[template,values,item]);$.each(values,function(key,value){if(value===undefined||value===false){return true;}
arr=key.split('_');if(arr.length>1){var el=template.find(EVENT_NS+'-'+arr[0]);if(el.length>0){var attr=arr[1];if(attr==='replaceWith'){if(el[0]!==value[0]){el.replaceWith(value);}}else if(attr==='img'){if(el.is('img')){el.attr('src',value);}else{el.replaceWith('<img src="'+value+'" class="'+el.attr('class')+'" />');}}else{el.attr(arr[1],value);}}}else{template.find(EVENT_NS+'-'+key).html(value);}});},_getScrollbarSize:function(){if(mfp.scrollbarSize===undefined){var scrollDiv=document.createElement("div");scrollDiv.id="mfp-sbm";scrollDiv.style.cssText='width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';document.body.appendChild(scrollDiv);mfp.scrollbarSize=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv);}
return mfp.scrollbarSize;}};$.magnificPopup={instance:null,proto:MagnificPopup.prototype,modules:[],open:function(options,index){_checkInstance();if(!options)
options={};options.isObj=true;options.index=index||0;return this.instance.open(options);},close:function(){return $.magnificPopup.instance.close();},registerModule:function(name,module){if(module.options){$.magnificPopup.defaults[name]=module.options;}
$.extend(this.proto,module.proto);this.modules.push(name);},defaults:{disableOn:0,key:null,midClick:false,mainClass:'',preloader:true,focus:'',closeOnContentClick:false,closeOnBgClick:true,closeBtnInside:true,showCloseBtn:true,enableEscapeKey:true,modal:false,alignTop:false,removalDelay:0,fixedContentPos:'auto',fixedBgPos:'auto',overflowY:'auto',closeMarkup:'<button title="%title%" type="button" class="mfp-close">&times;</button>',tClose:'Close (Esc)',tLoading:'Loading...'}};$.fn.magnificPopup=function(options){_checkInstance();var jqEl=$(this);if(typeof options==="string"){if(options==='open'){var items,itemOpts=_isJQ?jqEl.data('magnificPopup'):jqEl[0].magnificPopup,index=parseInt(arguments[1],10)||0;if(itemOpts.items){items=itemOpts.items[index];}else{items=jqEl;if(itemOpts.delegate){items=items.find(itemOpts.delegate);}
items=items.eq(index);}
mfp._openClick({mfpEl:items},jqEl,itemOpts);}else{if(mfp.isOpen)
mfp[options].apply(mfp,Array.prototype.slice.call(arguments,1));}}else{if(_isJQ){jqEl.data('magnificPopup',options);}else{jqEl[0].magnificPopup=options;}
mfp.addGroup(jqEl,options);}
return jqEl;};var INLINE_NS='inline',_hiddenClass,_inlinePlaceholder,_lastInlineElement,_putInlineElementsBack=function(){if(_lastInlineElement){_inlinePlaceholder.after(_lastInlineElement.addClass(_hiddenClass)).detach();_lastInlineElement=null;}};$.magnificPopup.registerModule(INLINE_NS,{options:{hiddenClass:'hide',markup:'',tNotFound:'Content not found'},proto:{initInline:function(){mfp.types.push(INLINE_NS);_mfpOn(CLOSE_EVENT+'.'+INLINE_NS,function(){_putInlineElementsBack();});},getInline:function(item,template){_putInlineElementsBack();if(item.src){var inlineSt=mfp.st.inline,el=$(item.src);if(el.length){var parent=el[0].parentNode;if(parent&&parent.tagName){if(!_inlinePlaceholder){_hiddenClass=inlineSt.hiddenClass;_inlinePlaceholder=_getEl(_hiddenClass);_hiddenClass='mfp-'+_hiddenClass;}
_lastInlineElement=el.after(_inlinePlaceholder).detach().removeClass(_hiddenClass);}
mfp.updateStatus('ready');}else{mfp.updateStatus('error',inlineSt.tNotFound);el=$('<div>');}
item.inlineElement=el;return el;}
mfp.updateStatus('ready');mfp._parseMarkup(template,{},item);return template;}}});})(window.jQuery||window.Zepto);;jQuery.easing['jswing']=jQuery.easing['swing'];jQuery.extend(jQuery.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return jQuery.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});;
/*
 * jQuery Scrollspy Plugin
 * Author: @sxalexander
 * Licensed under the MIT license
 */
;(function($,window,document,undefined){$.fn.extend({scrollspy:function(options){var defaults={min:0,max:0,mode:'vertical',buffer:0,container:window,onEnter:options.onEnter?options.onEnter:[],onLeave:options.onLeave?options.onLeave:[],onTick:options.onTick?options.onTick:[]}
var options=$.extend({},defaults,options);return this.each(function(i){var element=this;var o=options;var $container=$(o.container);var mode=o.mode;var buffer=o.buffer;var enters=leaves=0;var inside=false;$container.bind('scroll',function(e){var position={top:$(this).scrollTop(),left:$(this).scrollLeft()};var xy=(mode=='vertical')?position.top+buffer:position.left+buffer;var max=o.max;var min=o.min;if($.isFunction(o.max)){max=o.max();}
if($.isFunction(o.min)){min=o.min();}
if(max==0){max=(mode=='vertical')?$container.height():$container.outerWidth()+$(element).outerWidth();}
if(xy>=min&&xy<=max){if(!inside){inside=true;enters++;$(element).trigger('scrollEnter',{position:position})
if($.isFunction(o.onEnter)){o.onEnter(element,position);}}
$(element).trigger('scrollTick',{position:position,inside:inside,enters:enters,leaves:leaves})
if($.isFunction(o.onTick)){o.onTick(element,position,inside,enters,leaves);}}else{if(inside){inside=false;leaves++;$(element).trigger('scrollLeave',{position:position,leaves:leaves})
if($.isFunction(o.onLeave)){o.onLeave(element,position);}}}});});}})})(jQuery,window);;function FastClick(layer){'use strict';var oldOnClick,self=this;this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=layer;if(!layer||!layer.nodeType){throw new TypeError('Layer must be a document node');}
this.onClick=function(){return FastClick.prototype.onClick.apply(self,arguments);};this.onMouse=function(){return FastClick.prototype.onMouse.apply(self,arguments);};this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(self,arguments);};this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(self,arguments);};this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(self,arguments);};if(FastClick.notNeeded(layer)){return;}
if(this.deviceIsAndroid){layer.addEventListener('mouseover',this.onMouse,true);layer.addEventListener('mousedown',this.onMouse,true);layer.addEventListener('mouseup',this.onMouse,true);}
layer.addEventListener('click',this.onClick,true);layer.addEventListener('touchstart',this.onTouchStart,false);layer.addEventListener('touchend',this.onTouchEnd,false);layer.addEventListener('touchcancel',this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==='click'){rmv.call(layer,type,callback.hijacked||callback,capture);}else{rmv.call(layer,type,callback,capture);}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==='click'){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event);}}),capture);}else{adv.call(layer,type,callback,capture);}};}
if(typeof layer.onclick==='function'){oldOnClick=layer.onclick;layer.addEventListener('click',function(event){oldOnClick(event);},false);layer.onclick=null;}}
FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf('Android')>0;FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&(/OS ([6-9]|\d{2})_\d/).test(navigator.userAgent);FastClick.prototype.needsClick=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'button':case'select':case'textarea':if(target.disabled){return true;}
break;case'input':if((this.deviceIsIOS&&target.type==='file')||target.disabled){return true;}
break;case'label':case'video':return true;}
return(/\bneedsclick\b/).test(target.className);};FastClick.prototype.needsFocus=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'textarea':case'select':return true;case'input':switch(target.type){case'button':case'checkbox':case'file':case'image':case'radio':case'submit':return false;}
return!target.disabled&&!target.readOnly;default:return(/\bneedsfocus\b/).test(target.className);}};FastClick.prototype.sendClick=function(targetElement,event){'use strict';var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur();}
touch=event.changedTouches[0];clickEvent=document.createEvent('MouseEvents');clickEvent.initMouseEvent('click',true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent);};FastClick.prototype.focus=function(targetElement){'use strict';var length;if(this.deviceIsIOS&&targetElement.setSelectionRange){length=targetElement.value.length;targetElement.setSelectionRange(length,length);}else{targetElement.focus();}};FastClick.prototype.updateScrollParent=function(targetElement){'use strict';var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break;}
parentElement=parentElement.parentElement;}while(parentElement);}
if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop;}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){'use strict';if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode;}
return eventTarget;};FastClick.prototype.onTouchStart=function(event){'use strict';var targetElement,touch,selection;if(event.targetTouches.length>1){return true;}
targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(this.deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true;}
if(!this.deviceIsIOS4){if(touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false;}
this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement);}}
this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if((event.timeStamp-this.lastClickTime)<200){event.preventDefault();}
return true;};FastClick.prototype.touchHasMoved=function(event){'use strict';var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true;}
return false;};FastClick.prototype.findControl=function(labelElement){'use strict';if(labelElement.control!==undefined){return labelElement.control;}
if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor);}
return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');};FastClick.prototype.onTouchEnd=function(event){'use strict';var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null;}
if(!this.trackingClick){return true;}
if((event.timeStamp-this.lastClickTime)<200){this.cancelNextClick=true;return true;}
this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(this.deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent;}
targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==='label'){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(this.deviceIsAndroid){return false;}
targetElement=forElement;}}else if(this.needsFocus(targetElement)){if((event.timeStamp-trackingClickStart)>100||(this.deviceIsIOS&&window.top!==window&&targetTagName==='input')){this.targetElement=null;return false;}
this.focus(targetElement);if(!this.deviceIsIOS4||targetTagName!=='select'){this.targetElement=null;event.preventDefault();}
return false;}
if(this.deviceIsIOS&&!this.deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true;}}
if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event);}
return false;};FastClick.prototype.onTouchCancel=function(){'use strict';this.trackingClick=false;this.targetElement=null;};FastClick.prototype.onMouse=function(event){'use strict';if(!this.targetElement){return true;}
if(event.forwardedTouchEvent){return true;}
if(!event.cancelable){return true;}
if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation();}else{event.propagationStopped=true;}
event.stopPropagation();event.preventDefault();return false;}
return true;};FastClick.prototype.onClick=function(event){'use strict';var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true;}
if(event.target.type==='submit'&&event.detail===0){return true;}
permitted=this.onMouse(event);if(!permitted){this.targetElement=null;}
return permitted;};FastClick.prototype.destroy=function(){'use strict';var layer=this.layer;if(this.deviceIsAndroid){layer.removeEventListener('mouseover',this.onMouse,true);layer.removeEventListener('mousedown',this.onMouse,true);layer.removeEventListener('mouseup',this.onMouse,true);}
layer.removeEventListener('click',this.onClick,true);layer.removeEventListener('touchstart',this.onTouchStart,false);layer.removeEventListener('touchend',this.onTouchEnd,false);layer.removeEventListener('touchcancel',this.onTouchCancel,false);};FastClick.notNeeded=function(layer){'use strict';var metaViewport;if(typeof window.ontouchstart==='undefined'){return true;}
if((/Chrome\/[0-9]+/).test(navigator.userAgent)){if(FastClick.prototype.deviceIsAndroid){metaViewport=document.querySelector('meta[name=viewport]');if(metaViewport&&metaViewport.content.indexOf('user-scalable=no')!==-1){return true;}}else{return true;}}
if(layer.style.msTouchAction==='none'){return true;}
return false;};FastClick.attach=function(layer){'use strict';return new FastClick(layer);};if(typeof define!=='undefined'&&define.amd){define(function(){'use strict';return FastClick;});}else if(typeof module!=='undefined'&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick;}else{window.FastClick=FastClick;};
/*
 * Copyright (c) 2011-2013 Felix Gnass
 * Licensed under the MIT license
 */
(function(root,factory){if(typeof exports=='object')module.exports=factory()
else if(typeof define=='function'&&define.amd)define(factory)
else root.Spinner=factory()}
(this,function(){"use strict";var prefixes=['webkit','Moz','ms','O'],animations={},useCssAnimations
function createEl(tag,prop){var el=document.createElement(tag||'div'),n
for(n in prop)el[n]=prop[n]
return el}
function ins(parent){for(var i=1,n=arguments.length;i<n;i++)
parent.appendChild(arguments[i])
return parent}
var sheet=(function(){var el=createEl('style',{type:'text/css'})
ins(document.getElementsByTagName('head')[0],el)
return el.sheet||el.styleSheet}())
function addAnimation(alpha,trail,i,lines){var name=['opacity',trail,~~(alpha*100),i,lines].join('-'),start=0.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf('Animation')).toLowerCase(),pre=prefix&&'-'+prefix+'-'||''
if(!animations[name]){sheet.insertRule('@'+pre+'keyframes '+name+'{'+'0%{opacity:'+z+'}'+
start+'%{opacity:'+alpha+'}'+
(start+0.01)+'%{opacity:1}'+
(start+trail)%100+'%{opacity:'+alpha+'}'+'100%{opacity:'+z+'}'+'}',sheet.cssRules.length)
animations[name]=1}
return name}
function vendor(el,prop){var s=el.style,pp,i
if(s[prop]!==undefined)return prop
prop=prop.charAt(0).toUpperCase()+prop.slice(1)
for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop
if(s[pp]!==undefined)return pp}}
function css(el,prop){for(var n in prop)
el.style[vendor(el,n)||n]=prop[n]
return el}
function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i]
for(var n in def)
if(obj[n]===undefined)obj[n]=def[n]}
return obj}
function pos(el){var o={x:el.offsetLeft,y:el.offsetTop}
while((el=el.offsetParent))
o.x+=el.offsetLeft,o.y+=el.offsetTop
return o}
var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:'#000',direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:'spinner',top:'auto',left:'auto',position:'relative'}
function Spinner(o){if(typeof this=='undefined')return new Spinner(o)
this.opts=merge(o||{},Spinner.defaults,defaults)}
Spinner.defaults={}
merge(Spinner.prototype,{spin:function(target){this.stop()
var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp
if(target){target.insertBefore(el,target.firstChild||null)
tp=pos(target)
ep=pos(el)
css(el,{left:(o.left=='auto'?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+'px',top:(o.top=='auto'?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+'px'})}
el.setAttribute('role','progressbar')
self.lines(el,self.opts)
if(!useCssAnimations){var i=0,start=(o.lines-1)*(1-o.direction)/2,alpha,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var j=0;j<o.lines;j++){alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity)
self.opacity(el,j*o.direction+start,alpha,o)}
self.timeout=self.el&&setTimeout(anim,~~(1000/fps))})()}
return self},stop:function(){var el=this.el
if(el){clearTimeout(this.timeout)
if(el.parentNode)el.parentNode.removeChild(el)
this.el=undefined}
return this},lines:function(el,o){var i=0,start=(o.lines-1)*(1-o.direction)/2,seg
function fill(color,shadow){return css(createEl(),{position:'absolute',width:(o.length+o.width)+'px',height:o.width+'px',background:color,boxShadow:shadow,transformOrigin:'left',transform:'rotate('+~~(360/o.lines*i+o.rotate)+'deg) translate('+o.radius+'px'+',0)',borderRadius:(o.corners*o.width>>1)+'px'})}
for(;i<o.lines;i++){seg=css(createEl(),{position:'absolute',top:1+~(o.width/2)+'px',transform:o.hwaccel?'translate3d(0,0,0)':'',opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+' '+1/o.speed+'s linear infinite'})
if(o.shadow)ins(seg,css(fill('#000','0 0 4px '+'#000'),{top:2+'px'}))
ins(el,ins(seg,fill(o.color,'0 0 1px rgba(0,0,0,.1)')))}
return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}})
function initVML(){function vml(tag,attr){return createEl('<'+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}
sheet.addRule('.spin-vml','behavior:url(#default#VML)')
Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r
function grp(){return css(vml('group',{coordsize:s+' '+s,coordorigin:-r+' '+-r}),{width:s,height:s})}
var margin=-(o.width+o.length)*2+'px',g=css(grp(),{position:'absolute',top:margin,left:margin}),i
function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+'deg',left:~~dx}),ins(css(vml('roundrect',{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml('fill',{color:o.color,opacity:o.opacity}),vml('stroke',{opacity:0}))))}
if(o.shadow)
for(i=1;i<=o.lines;i++)
seg(i,-2,'progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)')
for(i=1;i<=o.lines;i++)seg(i)
return ins(el,g)}
Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild
o=o.shadow&&o.lines||0
if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild
if(c)c.opacity=val}}}
var probe=css(createEl('group'),{behavior:'url(#default#VML)'})
if(!vendor(probe,'transform')&&probe.adj)initVML()
else useCssAnimations=vendor(probe,'animation')
return Spinner}));;
/*
 * Ladda
 * http://lab.hakim.se/ladda
 * MIT licensed
 *
 * Copyright (C) 2014 Hakim El Hattab, http://hakim.se
 */
(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('spin.js'));}
else if(typeof define==='function'&&define.amd){define(['spin'],factory);}
else{root.Ladda=factory(root.Spinner);}}
(this,function(Spinner){'use strict';var ALL_INSTANCES=[];function create(button){if(typeof button==='undefined'){console.warn("Ladda button target must be defined.");return;}
if(!button.querySelector('.ladda-label')){button.innerHTML='<span class="ladda-label">'+button.innerHTML+'</span>';}
var spinner;var spinnerWrapper=document.createElement('span');spinnerWrapper.className='ladda-spinner';button.appendChild(spinnerWrapper);var timer;var instance={start:function(){if(!spinner)spinner=createSpinner(button);button.setAttribute('disabled','');button.setAttribute('data-loading','');clearTimeout(timer);spinner.spin(spinnerWrapper);this.setProgress(0);return this;},startAfter:function(delay){clearTimeout(timer);timer=setTimeout(function(){instance.start();},delay);return this;},stop:function(){button.removeAttribute('disabled');button.removeAttribute('data-loading');clearTimeout(timer);if(spinner){timer=setTimeout(function(){spinner.stop();},1000);}
return this;},toggle:function(){if(this.isLoading()){this.stop();}
else{this.start();}
return this;},setProgress:function(progress){progress=Math.max(Math.min(progress,1),0);var progressElement=button.querySelector('.ladda-progress');if(progress===0&&progressElement&&progressElement.parentNode){progressElement.parentNode.removeChild(progressElement);}
else{if(!progressElement){progressElement=document.createElement('div');progressElement.className='ladda-progress';button.appendChild(progressElement);}
progressElement.style.width=((progress||0)*button.offsetWidth)+'px';}},enable:function(){this.stop();return this;},disable:function(){this.stop();button.setAttribute('disabled','');return this;},isLoading:function(){return button.hasAttribute('data-loading');}};ALL_INSTANCES.push(instance);return instance;}
function getAncestorOfTagType(elem,type){while(elem.parentNode&&elem.tagName!==type){elem=elem.parentNode;}
return(type===elem.tagName)?elem:undefined;}
function getRequiredFields(form){var requirables=['input','textarea'];var inputs=[];for(var i=0;i<requirables.length;i++){var candidates=form.getElementsByTagName(requirables[i]);for(var j=0;j<candidates.length;j++){if(candidates[j].hasAttribute('required')){inputs.push(candidates[j]);}}}
return inputs;}
function bind(target,options){options=options||{};var targets=[];if(typeof target==='string'){targets=toArray(document.querySelectorAll(target));}
else if(typeof target==='object'&&typeof target.nodeName==='string'){targets=[target];}
for(var i=0,len=targets.length;i<len;i++){(function(){var element=targets[i];if(typeof element.addEventListener==='function'){var instance=create(element);var timeout=-1;element.addEventListener('click',function(event){var valid=true;var form=getAncestorOfTagType(element,'FORM');if(typeof form!=='undefined'){var requireds=getRequiredFields(form);for(var i=0;i<requireds.length;i++){if(requireds[i].value.replace(/^\s+|\s+$/g,'')===''){valid=false;}}}
if(valid){instance.startAfter(1);if(typeof options.timeout==='number'){clearTimeout(timeout);timeout=setTimeout(instance.stop,options.timeout);}
if(typeof options.callback==='function'){options.callback.apply(null,[instance]);}}},false);}})();}}
function stopAll(){for(var i=0,len=ALL_INSTANCES.length;i<len;i++){ALL_INSTANCES[i].stop();}}
function createSpinner(button){var height=button.offsetHeight,spinnerColor;if(height===0){height=parseFloat(window.getComputedStyle(button).height);}
if(height>32){height*=0.8;}
if(button.hasAttribute('data-spinner-size')){height=parseInt(button.getAttribute('data-spinner-size'),10);}
if(button.hasAttribute('data-spinner-color')){spinnerColor=button.getAttribute('data-spinner-color');}
var lines=12,radius=height*0.2,length=radius*0.6,width=radius<7?2:3;return new Spinner({color:spinnerColor||'#fff',lines:lines,radius:radius,length:length,width:width,zIndex:'auto',top:'auto',left:'auto',className:''});}
function toArray(nodes){var a=[];for(var i=0;i<nodes.length;i++){a.push(nodes[i]);}
return a;}
return{bind:bind,create:create,stopAll:stopAll};}));;
/*
 Autosize v1.18.1 - 2013-11-05
 Automatically adjust textarea height based on user input.
 (c) 2013 Jack Moore - http://www.jacklmoore.com/autosize
 license: http://www.opensource.org/licenses/mit-license.php
*/
(function($){var
defaults={className:'autosizejs',append:'',callback:false,resizeDelay:10},copy='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',typographyStyles=['fontFamily','fontSize','fontWeight','fontStyle','letterSpacing','textTransform','wordSpacing','textIndent'],mirrored,mirror=$(copy).data('autosize',true)[0];mirror.style.lineHeight='99px';if($(mirror).css('lineHeight')==='99px'){typographyStyles.push('lineHeight');}
mirror.style.lineHeight='';$.fn.autosize=function(options){if(!this.length){return this;}
options=$.extend({},defaults,options||{});if(mirror.parentNode!==document.body){$(document.body).append(mirror);}
return this.each(function(){var
ta=this,$ta=$(ta),maxHeight,minHeight,boxOffset=0,callback=$.isFunction(options.callback),originalStyles={height:ta.style.height,overflow:ta.style.overflow,overflowY:ta.style.overflowY,wordWrap:ta.style.wordWrap,resize:ta.style.resize},timeout,width=$ta.width();if($ta.data('autosize')){return;}
$ta.data('autosize',true);if($ta.css('box-sizing')==='border-box'||$ta.css('-moz-box-sizing')==='border-box'||$ta.css('-webkit-box-sizing')==='border-box'){boxOffset=$ta.outerHeight()-$ta.height();}
minHeight=Math.max(parseInt($ta.css('minHeight'),10)-boxOffset||0,$ta.height());$ta.css({overflow:'hidden',overflowY:'hidden',wordWrap:'break-word',resize:($ta.css('resize')==='none'||$ta.css('resize')==='vertical')?'none':'horizontal'});function setWidth(){var style,width;if('getComputedStyle'in window){style=window.getComputedStyle(ta,null);width=ta.getBoundingClientRect().width;$.each(['paddingLeft','paddingRight','borderLeftWidth','borderRightWidth'],function(i,val){width-=parseInt(style[val],10);});mirror.style.width=width+'px';}
else{mirror.style.width=Math.max($ta.width(),0)+'px';}}
function initMirror(){var styles={};mirrored=ta;mirror.className=options.className;maxHeight=parseInt($ta.css('maxHeight'),10);$.each(typographyStyles,function(i,val){styles[val]=$ta.css(val);});$(mirror).css(styles);setWidth();if(window.chrome){var width=ta.style.width;ta.style.width='0px';var ignore=ta.offsetWidth;ta.style.width=width;}}
function adjust(){var height,original;if(mirrored!==ta){initMirror();}else{setWidth();}
mirror.value=ta.value+options.append;mirror.style.overflowY=ta.style.overflowY;original=parseInt(ta.style.height,10);mirror.scrollTop=0;mirror.scrollTop=9e4;height=mirror.scrollTop;if(maxHeight&&height>maxHeight){ta.style.overflowY='scroll';height=maxHeight;}else{ta.style.overflowY='hidden';if(height<minHeight){height=minHeight;}}
height+=boxOffset;if(original!==height){ta.style.height=height+'px';if(callback){options.callback.call(ta,ta);}}}
function resize(){clearTimeout(timeout);timeout=setTimeout(function(){var newWidth=$ta.width();if(newWidth!==width){width=newWidth;adjust();}},parseInt(options.resizeDelay,10));}
if('onpropertychange'in ta){if('oninput'in ta){$ta.on('input.autosize keyup.autosize',adjust);}else{$ta.on('propertychange.autosize',function(){if(event.propertyName==='value'){adjust();}});}}else{$ta.on('input.autosize',adjust);}
if(options.resizeDelay!==false){$(window).on('resize.autosize',resize);}
$ta.on('autosize.resize',adjust);$ta.on('autosize.resizeIncludeStyle',function(){mirrored=null;adjust();});$ta.on('autosize.destroy',function(){mirrored=null;clearTimeout(timeout);$(window).off('resize',resize);$ta.off('autosize').off('.autosize').css(originalStyles).removeData('autosize');});adjust();});};}(window.jQuery||window.$));;
/*
 *  howler.js v1.1.14
 *  howlerjs.com
 *
 *  (c) 2013, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){var e={},t=null,n=!0,r=!1;if("undefined"!=typeof AudioContext)t=new AudioContext;else if("undefined"!=typeof webkitAudioContext)t=new webkitAudioContext;else if("undefined"!=typeof Audio){n=!1;try{new Audio}catch(i){r=!0}}else n=!1,r=!0;if(n){var s=void 0===t.createGain?t.createGainNode():t.createGain();s.gain.value=1,s.connect(t.destination)}var o=function(){this._volume=1,this._muted=!1,this.usingWebAudio=n,this._howls=[]};o.prototype={volume:function(e){var t=this;if(e=parseFloat(e),e&&e>=0&&1>=e){t._volume=e,n&&(s.gain.value=e);for(var r in t._howls)if(t._howls.hasOwnProperty(r)&&t._howls[r]._webAudio===!1)for(var i=0;i<t._howls[r]._audioNode.length;i++)t._howls[r]._audioNode[i].volume=t._howls[r]._volume*t._volume;return t}return n?s.gain.value:t._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(e){var t=this;t._muted=e,n&&(s.gain.value=e?0:t._volume);for(var r in t._howls)if(t._howls.hasOwnProperty(r)&&t._howls[r]._webAudio===!1)for(var i=0;i<t._howls[r]._audioNode.length;i++)t._howls[r]._audioNode[i].muted=e}};var u=new o,a=null;if(!r){a=new Audio;var f={mp3:!!a.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var l=function(e){var t=this;t._autoplay=e.autoplay||!1,t._buffer=e.buffer||!1,t._duration=e.duration||0,t._format=e.format||null,t._loop=e.loop||!1,t._loaded=!1,t._sprite=e.sprite||{},t._src=e.src||"",t._pos3d=e.pos3d||[0,0,-.5],t._volume=e.volume||1,t._urls=e.urls||[],t._rate=e.rate||1,t._onload=[e.onload||function(){}],t._onloaderror=[e.onloaderror||function(){}],t._onend=[e.onend||function(){}],t._onpause=[e.onpause||function(){}],t._onplay=[e.onplay||function(){}],t._onendTimer=[],t._webAudio=n&&!t._buffer,t._audioNode=[],t._webAudio&&t._setupAudioNode(),u._howls.push(t),t.load()};if(l.prototype={load:function(){var t=this,n=null;if(r)return t.on("loaderror"),void 0;for(var i=0;i<t._urls.length;i++){var s,o;if(t._format)s=t._format;else{if(o=t._urls[i].toLowerCase().split("?")[0],s=o.match(/.+\.([^?]+)(\?|$)/),s=s&&s.length>=2?s:o.match(/data\:audio\/([^?]+);/),!s)return t.on("loaderror"),void 0;s=s[1]}if(f[s]){n=t._urls[i];break}}if(!n)return t.on("loaderror"),void 0;if(t._src=n,t._webAudio)c(t,n);else{var a=new Audio;t._audioNode.push(a),a.src=n,a._pos=0,a.preload="auto",a.volume=u._muted?0:t._volume*u.volume(),e[n]=t;var l=function(){t._duration=a.duration,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play(),a.removeEventListener("canplaythrough",l,!1)};a.addEventListener("canplaythrough",l,!1),a.load()}return t},urls:function(e){var t=this;return e?(t.stop(),t._urls="string"==typeof e?[e]:e,t._loaded=!1,t.load(),t):t._urls},play:function(e,n){var r=this;return"function"==typeof e&&(n=e),e&&"function"!=typeof e||(e="_default"),r._loaded?r._sprite[e]?(r._inactiveNode(function(i){i._sprite=e;var s,o=i._pos>0?i._pos:r._sprite[e][0]/1e3,a=r._sprite[e][1]/1e3-i._pos,f=!(!r._loop&&!r._sprite[e][2]),l="string"==typeof n?n:Math.round(Date.now()*Math.random())+"";if(function(){var t={id:l,sprite:e,loop:f};s=setTimeout(function(){!r._webAudio&&f&&r.stop(t.id,t.timer).play(e,t.id),r._webAudio&&!f&&(r._nodeById(t.id).paused=!0),r._webAudio||f||r.stop(t.id,t.timer),r.on("end",l)},1e3*a),r._onendTimer.push(s),t.timer=r._onendTimer[r._onendTimer.length-1]}(),r._webAudio){var c=r._sprite[e][0]/1e3,h=r._sprite[e][1]/1e3;i.id=l,i.paused=!1,p(r,[f,c,h],l),r._playStart=t.currentTime,i.gain.value=r._volume,void 0===i.bufferSource.start?i.bufferSource.noteGrainOn(0,o,a):i.bufferSource.start(0,o,a)}else{if(4!==i.readyState)return r._clearEndTimer(s),function(){var t=r,s=e,o=n,u=i,a=function(){t.play(s,o),u.removeEventListener("canplaythrough",a,!1)};u.addEventListener("canplaythrough",a,!1)}(),r;i.id=l,i.currentTime=o,i.muted=u._muted,i.volume=r._volume*u.volume(),setTimeout(function(){i.play()},0)}return r.on("play"),"function"==typeof n&&n(l),r}),r):("function"==typeof n&&n(),r):(r.on("load",function(){r.play(e,n)}),r)},pause:function(e,t){var n=this;if(!n._loaded)return n.on("play",function(){n.pause(e)}),n;n._clearEndTimer(t||0);var r=e?n._nodeById(e):n._activeNode();if(r)if(r._pos=n.pos(null,e),n._webAudio){if(!r.bufferSource)return n;r.paused=!0,void 0===r.bufferSource.stop?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r.pause();return n.on("pause"),n},stop:function(e,t){var n=this;if(!n._loaded)return n.on("play",function(){n.stop(e)}),n;n._clearEndTimer(t||0);var r=e?n._nodeById(e):n._activeNode();if(r)if(r._pos=0,n._webAudio){if(!r.bufferSource)return n;r.paused=!0,void 0===r.bufferSource.stop?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r.pause(),r.currentTime=0;return n},mute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.mute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=0:n.volume=0),t},unmute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.unmute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=t._volume:n.volume=t._volume),t},volume:function(e,t){var n=this;if(e=parseFloat(e),e>=0&&1>=e){if(n._volume=e,!n._loaded)return n.on("play",function(){n.volume(e,t)}),n;var r=t?n._nodeById(t):n._activeNode();return r&&(n._webAudio?r.gain.value=e:r.volume=e*u.volume()),n}return n._volume},loop:function(e){var t=this;return"boolean"==typeof e?(t._loop=e,t):t._loop},sprite:function(e){var t=this;return"object"==typeof e?(t._sprite=e,t):t._sprite},pos:function(e,n){var r=this;if(!r._loaded)return r.on("load",function(){r.pos(e)}),"number"==typeof e?r:r._pos||0;e=parseFloat(e);var i=n?r._nodeById(n):r._activeNode();if(i)return r._webAudio?e>=0?(i._pos=e,r.pause(n).play(i._sprite,n),r):i._pos+(t.currentTime-r._playStart):e>=0?(i.currentTime=e,r):i.currentTime;if(e>=0)return r;for(var s=0;s<r._audioNode.length;s++)if(r._audioNode[s].paused&&4===r._audioNode[s].readyState)return r._webAudio?r._audioNode[s]._pos:r._audioNode[s].currentTime},pos3d:function(e,t,n,r){var i=this;if(t=void 0!==t&&t?t:0,n=void 0!==n&&n?n:-.5,!i._loaded)return i.on("play",function(){i.pos3d(e,t,n,r)}),i;if(!(e>=0||0>e))return i._pos3d;if(i._webAudio){var s=r?i._nodeById(r):i._activeNode();s&&(i._pos3d=[e,t,n],s.panner.setPosition(e,t,n))}return i},fade:function(e,t,n,r,i){var s=this,o=Math.abs(e-t),u=e>t?"down":"up",a=o/.01,f=n/a;if(!s._loaded)return s.on("load",function(){s.fade(e,t,n,r,i)}),s;s.volume(e,i);for(var l=1;a>=l;l++)!function(){var e=s._volume+("up"===u?.01:-.01)*l,n=Math.round(1e3*e)/1e3,o=t;setTimeout(function(){s.volume(n,i),n===o&&r&&r()},f*l)}()},fadeIn:function(e,t,n){return this.volume(0).play().fade(0,e,t,n)},fadeOut:function(e,t,n,r){var i=this;return i.fade(i._volume,e,t,function(){n&&n(),i.pause(r),i.on("end")},r)},_nodeById:function(e){for(var t=this,n=t._audioNode[0],r=0;r<t._audioNode.length;r++)if(t._audioNode[r].id===e){n=t._audioNode[r];break}return n},_activeNode:function(){for(var e=this,t=null,n=0;n<e._audioNode.length;n++)if(!e._audioNode[n].paused){t=e._audioNode[n];break}return e._drainPool(),t},_inactiveNode:function(e){for(var t=this,n=null,r=0;r<t._audioNode.length;r++)if(t._audioNode[r].paused&&4===t._audioNode[r].readyState){e(t._audioNode[r]),n=!0;break}if(t._drainPool(),!n){var i;t._webAudio?(i=t._setupAudioNode(),e(i)):(t.load(),i=t._audioNode[t._audioNode.length-1],i.addEventListener("loadedmetadata",function(){e(i)}))}},_drainPool:function(){var e,t=this,n=0;for(e=0;e<t._audioNode.length;e++)t._audioNode[e].paused&&n++;for(e=t._audioNode.length-1;e>=0&&!(5>=n);e--)t._audioNode[e].paused&&(t._webAudio&&t._audioNode[e].disconnect(0),n--,t._audioNode.splice(e,1))},_clearEndTimer:function(e){var t=this,n=t._onendTimer.indexOf(e);n=n>=0?n:0,t._onendTimer[n]&&(clearTimeout(t._onendTimer[n]),t._onendTimer.splice(n,1))},_setupAudioNode:function(){var e=this,n=e._audioNode,r=e._audioNode.length;return n[r]=void 0===t.createGain?t.createGainNode():t.createGain(),n[r].gain.value=e._volume,n[r].paused=!0,n[r]._pos=0,n[r].readyState=4,n[r].connect(s),n[r].panner=t.createPanner(),n[r].panner.setPosition(e._pos3d[0],e._pos3d[1],e._pos3d[2]),n[r].panner.connect(n[r]),n[r]},on:function(e,t){var n=this,r=n["_on"+e];if("function"==typeof t)r.push(t);else for(var i=0;i<r.length;i++)t?r[i].call(n,t):r[i].call(n);return n},off:function(e,t){for(var n=this,r=n["_on"+e],i=""+t,s=0;s<r.length;s++)if(i===""+r[s]){r.splice(s,1);break}return n},unload:function(){for(var t=this,n=t._audioNode,r=0;r<t._audioNode.length;r++)t.stop(n[r].id),t._webAudio?n[r].disconnect(0):n[r].src="";var i=u._howls.indexOf(t);i&&u._howls.splice(i,1),delete e[t._src],t=null}},n)var c=function(n,r){if(r in e)n._duration=e[r].duration,h(n);else{var i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="arraybuffer",i.onload=function(){t.decodeAudioData(i.response,function(t){t&&(e[r]=t,h(n,t))})},i.onerror=function(){n._webAudio&&(n._buffer=!0,n._webAudio=!1,n._audioNode=[],delete n._gainNode,n.load())};try{i.send()}catch(s){i.onerror()}}},h=function(e,t){e._duration=t?t.duration:e._duration,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play()},p=function(n,r,i){var s=n._nodeById(i);s.bufferSource=t.createBufferSource(),s.bufferSource.buffer=e[n._src],s.bufferSource.connect(s.panner),s.bufferSource.loop=r[0],r[0]&&(s.bufferSource.loopStart=r[1],s.bufferSource.loopEnd=r[1]+r[2]),s.bufferSource.playbackRate.value=n._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:u,Howl:l}}),window.Howler=u,window.Howl=l}();var REDIRECT=false;if(top.frames.length!=0||window!=top||top.location!=location){top.location.href=location.href;top.location=self.document.location;REDIRECT=true;}
var App={tagline:'',service:'/api/',logService:'http://log.crunchbutton.com/api/',server:'/',imgServer:'/',cached:{},community:null,config:null,_init:false,_pageInit:false,_identified:false,touchX:null,touchY:null,touchOffset:null,localStorage:false,isPhoneGap:document.location.protocol=='file:',useNativeAlert:false,useNativeConfirm:true,ajaxTimeout:5000,splashHidden:false,parallax:{bg:null,x:0,y:0,enabled:true},restaurantsPaging:{enabled:true,desktop:9,mobile:6},transitionAnimationEnabled:true,transitionForDesktop:false,cachedObjectsExpiresIn:86400,enableSplash:true,useTransform:true};App.localStorage=App.isPhoneGap;App.setLoggedIn=function(loggedIn){if($('.is-ui2').get(0)&&!loggedIn&&App.isPhoneGap&&App.enableSplash){var goToSplash=true;if(localStorage&&localStorage.locsv3){var locsv3=JSON.parse(localStorage.locsv3);if(locsv3&&locsv3.length>0){goToSplash=false;}}
if(goToSplash){setTimeout(function(){App.go('/splash');},10);}}};App.NGinit=function(){$('body').attr('ng-controller','AppController');angular.bootstrap(document,['NGApp']);if(App.config.env=='live'){$('.footer').addClass('footer-hide');}};var NGApp=angular.module('NGApp',['ngRoute','ngAnimate']);NGApp.config(function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/.*/);});NGApp.run(function(){FastClick.attach(document.body);});NGApp.config(function($provide,$httpProvider){$provide.factory('httpInterceptor',function($q){var onError=function(rejection){var status=rejection.status;if(!window.navigator.onLine||status==0){var showError=false;var url=rejection.config.url;if(url){console.log('AJAX ERROR: ',rejection);if(url.indexOf(App.service)>=0){var api=url.split(App.service);if(api.length>0){api=api[1];var showErrorFor=['order','restaurant','user'];for(var i=0;i<showErrorFor.length;i++){if(api.indexOf(showErrorFor[i])>=0){showError=true;break;}}}}}else{showError=true;}
if(showError&&!$('.connection-error').is(':visible')){App.connectionError();if(App.busy.isBusy()){App.busy.unBusy();}}}}
return{request:function(config){return config||$q.when(config);},response:function(response){if(typeof response.data=='object'){var headers=response.headers();}
return response||$q.when(response);},requestError:function(rejection){onError(rejection);return $q.reject(rejection);},responseError:function(rejection){onError(rejection);return $q.reject(rejection);}};});$httpProvider.interceptors.push('httpInterceptor');});NGApp.config(['$routeProvider','$locationProvider',function($routeProvider,$locationProvider,RestaurantsService){$routeProvider.when('/location',{action:'location',controller:'LocationCtrl',templateUrl:'assets/view/location.html'}).when('/splash',{action:'splash',controller:'SplashCtrl',templateUrl:'assets/view/splash.html'}).when('/download',{action:'download',controller:'DownloadCtrl',templateUrl:'assets/view/download.html'}).when('/food-delivery',{action:'restaurants',controller:'RestaurantsCtrl',templateUrl:'assets/view/restaurants.html'}).when('/food-delivery/:id',{action:'restaurant',controller:'RestaurantCtrl',templateUrl:'assets/view/restaurant.html'}).when('/legal',{action:'legal',controller:'LegalCtrl',templateUrl:'assets/view/legal.html'}).when('/help',{action:'help',controller:'HelpCtrl',templateUrl:'assets/view/help.html'}).when('/about',{action:'about',controller:'AboutCtrl',templateUrl:'assets/view/about.html'}).when('/jobs',{action:'jobs',controller:'JobsCtrl',templateUrl:'assets/view/jobs.html'}).when('/owners',{action:'owners',controller:'OwnersCtrl',templateUrl:'assets/view/owners.html'}).when('/orders',{action:'orders',controller:'OrdersCtrl',templateUrl:'assets/view/orders.html'}).when('/order/:id',{action:'order',controller:'OrderCtrl',templateUrl:'assets/view/order.html'}).when('/cities',{action:'cities',controller:'CitiesCtrl',templateUrl:'assets/view/cities.html'}).when('/giftcard',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/giftcard/:id',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/gift',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/gift/:id',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/invite',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/invite/:id',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/reset',{action:'reset',controller:'AccountResetCtrl',templateUrl:'assets/view/home.html'}).when('/reset/:id',{action:'reset',controller:'AccountResetCtrl',templateUrl:'assets/view/home.html'}).when('/',{action:'home',controller:'HomeCtrl',templateUrl:'assets/view/home.html'}).when('/cafe',{action:'cafe',controller:'CafeCtrl',templateUrl:'assets/view/cafe.html'}).otherwise({action:'home',controller:'DefaultCtrl',templateUrl:'assets/view/home.html'});$locationProvider.html5Mode(!App.isPhoneGap);}]);NGApp.controller('AppController',function($scope,$route,$http,$routeParams,$rootScope,$location,$window,AccountService,MainNavigationService,AccountSignOut,CartService,ReferralService,LocationService,PhoneGapService){App.rootScope=$rootScope;App.location=$location;App.http=$http;$rootScope.softKeyboard=function(e){if(App.isPhoneGap&&App.isAndroid()){var el=$(e.currentTarget);var walkTo=($('.snap-content-inner').scrollTop()+el.offset().top-($(window).height()/2)+(el.height()+55));$('html, body, .snap-content-inner').animate({scrollTop:walkTo},'500');}}
$rootScope.softKeyboardModal=function(e){if(App.isPhoneGap&&App.isAndroid()){var el=$('.mfp-content');if(el.css('marginTop')=='0px'){var walkTo=el.offset().top+20;el.animate({marginTop:-walkTo},'500');}}}
$rootScope.account=AccountService;$rootScope.navigation=MainNavigationService;$rootScope.signout=AccountSignOut;$rootScope.isPhoneGap=App.isPhoneGap;$rootScope.server=App.server;$rootScope.animationClass='';$rootScope.debug=function(){return(App.config&&App.config.user&&App.config.user.debug);};$rootScope.test=App.test;$rootScope.cartScroll=function(permalink){var top=130-$('.navs').height()-10;var scroll=function(){$('html, body, .snap-content-inner').animate({scrollTop:top},100,$.easing.easeInOutQuart?'easeInOutQuart':null);};if($rootScope.navigation.page!='restaurant'){$rootScope.scrollTop=top;App.go('/food-delivery/'+permalink);}else{scroll();}};$rootScope.scrollHalf=function(permalink){$('html, body, .snap-content-inner').animate({scrollTop:530-$('.navs').height()-10},100,$.easing.easeInOutQuart?'easeInOutQuart':null);};$rootScope.cancelDownload=function(){$.cookie('_viewmobile2',true,{expires:1});App.go('/location');};$rootScope.$on('userAuth',function(e,data){$rootScope.$safeApply(function($scope){if(data){$rootScope.account.user=data;App.config.user=data;}
if(!App.config.user.id_user){CartService.clean();}
LocationService.init(true);if(App.config.user.id_user&&App.config.user.location_lat&&($rootScope.navigation.page=='location'||$rootScope.navigation.page=='splash')){$location.path('/food-delivery');}
App.snap.close();if(!AccountService.forceDontReloadAfterAuth){$rootScope.reload();}
AccountService.forceDontReloadAfterAuth=false;});});$rootScope.focus=function(selector){setTimeout(function(){angular.element(selector).focus();},100);}
$rootScope.blur=function(selector){setTimeout(function(){angular.element(selector).blur();},100);}
$rootScope.reload=function(){$route.reload();};$rootScope.link=function(link){App.go.apply(arguments);};$rootScope.back=function(){App.snap.close();var backwards=false;switch($route.current.action){case'order':backwards='/orders';break;case'restaurant':backwards='/food-delivery';break;case'restaurants':backwards='/location';break;}
if(backwards){App.go(backwards,'pop');}else{history.back();}};$rootScope.closePopup=function(){try{$.magnificPopup.close();}catch(e){}};$rootScope.$safeApply=function(fn){var phase=this.$root.$$phase;if(phase=='$apply'||phase=='$digest'){if(fn&&(typeof(fn)==='function')){this.$eval(fn);}}else{this.$apply(fn);}};$scope.$on('$routeChangeSuccess',function($currentRoute,$previousRoute){MainNavigationService.page=$route.current.action;App.rootScope.current=MainNavigationService.page;App.track('page',$route.current.action);$('body').removeClass(function(index,css){return(css.match(/\bpage-\S+/g)||[]).join(' ');}).addClass('page-'+MainNavigationService.page);$('.nav-top').addClass('at-top');App.parallax.bg=null;App.scrollTop($rootScope.scrollTop);$rootScope.scrollTop=0;});$rootScope.windowWidth=$('body').width();$rootScope.windowHeight=$('body').height();angular.element($window).bind('resize',function(){$rootScope.windowWidth=$window.outerWidth;$rootScope.windowHeight=$window.outerHeight;$rootScope.$apply('windowWidth');$rootScope.$apply('windowHeight');});$scope.hasLocations=function(){return(LocationService.position.hasValidLocation());}
AccountService.checkUser();LocationService.init();ReferralService.check();});App.alert=function(txt,title,useNativeAlert,fn){setTimeout(function(){if(useNativeAlert&&App.isPhoneGap){navigator.notification.alert(txt,null,title||'Crunchbutton');}else if(useNativeAlert){alert(txt);}else{App.rootScope.$broadcast('notificationAlert',title||'Woops!',txt,fn);}});};App.confirm=function(txt,title,fn,buttons){if(App.useNativeConfirm&&App.isPhoneGap){return navigator.notification.confirm(txt,fn,title||'Crunchbutton',buttons||'Ok,Cancel');}else{return confirm(txt);}};App.connectionError=function(){App.rootScope.$broadcast('connectionError');App.rootScope.$broadcast('notificationAlert','Connection Error','Sorry! We could not reach the server right now. Try again when your internet is back!');};App.go=function(url,transition){App.rootScope.animationClass='';if(!App.transitionAnimationEnabled){App.location.path(url||'/');App.rootScope.$safeApply();return;}
if(App.isNarrowScreen()||App.transitionForDesktop){setTimeout(function(){App.rootScope.animationClass=transition?'animation-'+transition:'';App.rootScope.$safeApply();App.location.path(url||'/');App.rootScope.$safeApply();},1);}else{App.location.path(url||'/');App.rootScope.$safeApply();}};App.toggleMenu=function(){if(App.snap.state().state=='left'){App.snap.close();}else{App.snap.open('left');}};App.scrollTop=function(top){setTimeout(function(){if(!top){setTimeout(function(){$('html, body, .snap-content-inner').scrollTop(0);},10);}
$('html, body, .snap-content-inner').animate({scrollTop:top||0},10,$.easing.easeInOutQuart?'easeInOutQuart':null);},3);};App.track=function(){if(App.config.env!='live'){return;}
if(arguments[0]=='Ordered'){if(typeof(ga)=='function'){var trans={id:arguments[1].id,affiliation:'Crunchbutton',revenue:arguments[1].total,subtotal:arguments[1].subtotal,tax:arguments[1].tax,tip:arguments[1].tip};ga('ecommerce:addTransaction',trans);for(var x in arguments[1].cart){var ii={id:arguments[1].id,name:arguments[1].cart[x].details.name,sku:arguments[1].cart[x].id,category:arguments[1].restaurant,restaurant:arguments[1].id_restaurant,price:App.cached['Dish'][arguments[1].cart[x].id].price,quantity:'1'};ga('ecommerce:addItem',ii);}
ga('ecommerce:send');}
$('img.conversion').remove();var i=$('<img class="conversion" src="https://www.googleadservices.com/pagead/conversion/996753959/?value='+Math.floor(arguments[1].total)+'&amp;label=-oawCPHy2gMQp4Sl2wM&amp;guid=ON&amp;script=0&url='+location.href+'">').appendTo($('body'));}
if(typeof(ga)=='function'){ga('send','event','app',arguments[0],arguments[1]);}};App.busy={_busy:false,_timer:null,_maxExec:25000,stage:function(){$('#Stage').height('100%').width('100%');return AdobeEdge.getComposition('EDGE-977700350').getStage();},isBusy:function(){return $('.app-busy').length?true:false;return App.busy._busy;},makeBusy:function(gid){if(App.busy._timer){clearTimeout(App.busy._timer);}
App.busy._timer=setTimeout(function(){var errorMessage=function(){App.alert('The app timed out processing your order. We can not determine if the order was placed or not. Please check your previous orders. Sorry!');App.busy.unBusy();};if(gid){App.request(App.service+'order/gid/'+gid,function(json){if(json.error){errorMessage();}},function(){errorMessage();});}},App.busy._maxExec);return $('body').append($('<div class="app-busy"></div>').append($('<div class="app-busy-loader"><div class="app-busy-loader-icon"></div></div>')));App.busy._busy=true;$('.order-sky-loader').addClass('play');App.busy.stage().play(0);},unBusy:function(){clearTimeout(App.busy._timer);return $('.app-busy').remove();App.busy._busy=false;$('.order-sky-loader').removeClass('play');App.busy.stage().stop();}};App.test={card:function(){angular.element('html').injector().get('OrderService')._test();},logout:function(){$.getJSON(App.service+'logout',function(){location.reload()});},cart:function(){App.alert(JSON.stringify(App.cart.items));},clearloc:function(){$.totalStorage('community',null);$.totalStorage('location_lat',null);$.totalStorage('location_lon',null);location.href='/';},reload:function(){location.reload();},location:function(){var position=angular.element('html').injector().get('PositionsService');var locs=position.locs;for(x in locs){var values=[];$.each(locs[x]._properties,function(key,value){values.push(key);values.push(': ');values.push((value||'-'));values.push(' | ');if(key=='results'){$.each(value,function(position,result){console.log('result: '+position,result);});}});console.log('Position: '+x,values.join(''));}}};App.processConfig=function(json,user){if(user&&!json){App.config.user=user;}else{App.config=json;}
App.setLoggedIn(App.config&&App.config.user&&App.config.user.uuid?true:false);App.AB.init();};App.init=function(config){if(App._init||REDIRECT){return;}
App._init=true;App.verifyConnection.init();App.phoneGapListener.init();$(document).on('touchmove',($('.is-ui2').get(0)?'.mfp-wrap':'.snap-drawers, .mfp-wrap, .support-container'),function(e){e.preventDefault();e.stopPropagation();});$(document).on({'DOMNodeInserted':function(){$('.pac-item, .pac-item span',this).addClass('needsclick');}},'.pac-container');$(document).on('mousedown','.pac-item',function(){$('body').scrollTop(0);$('html').css('height','3000px');setTimeout(function(){$('html').css('height','');});});if(App.isPhoneGap&&!App.iOS7()){$('body').removeClass('ios7');}
$('body').removeClass('no-init');if(typeof Snap!=='undefined'){App.snap=new Snap({element:document.getElementById('snap-content'),menu:$('#side-menu'),useTransform:App.useTransform,menuDragDistance:95,disable:'right'});App.snap.on('end',function(){App.applyIOSPositionFix();});App.snap.on('start',function(){App.applyIOSPositionFix();});var snapperCheck=function(){if($(window).width()<=768){App.snap.enable();}else{App.snap.close();App.snap.disable();}};snapperCheck();$(window).resize(function(){snapperCheck();});}
$.totalStorage.ls(App.localStorage);if(typeof CB!=='undefined'&&CB.config){App.config=CB.config;CB.config=null;}
$(document).on('click','.button-deliver-payment, .dp-display-item a, .dp-display-item .clickable',function(){$('.payment-form').show();$('.delivery-payment-info, .content-padder-before').hide();});$(document).on({mousedown:function(){$(this).addClass('button-bottom-click');},touchstart:function(){$(this).addClass('button-bottom-click');},mouseup:function(){$(this).removeClass('button-bottom-click');},touchend:function(){$(this).removeClass('button-bottom-click');}},'.button-bottom');App.processConfig(config||App.config);App.AB.init();App.NGinit();$.cookie('loc','',{expires:(new Date(1970,01,01))});$.cookie('locv2','',{expires:(new Date(1970,01,01))});if(App.iOS()&&!$('.is-ui2').get(0)){$(':input').focus(function(){$(window).scrollTop($(window).scrollTop()+1);});}
if(App.iOS()&&!App.isPhoneGap&&!$.totalStorage('_viewmobile2')&&$('.is-ui2').get(0)){setTimeout(function(){App.go('/download');},10);}
var processor=(App.config.processor&&App.config.processor.type)?App.config.processor.type:false;switch(processor){case'stripe':Stripe.setPublishableKey(App.config.processor.stripe);break;case'balanced':break;default:console.log('Processor error::',App.config.processor);break;}
window.addEventListener('pageshow',function(){if(App._firstPageShowHasHappened){dateTime.reload();}
App._firstPageShowHasHappened=true;},false);$(window).trigger('nginit');};App.handleUrl=function(url){var handler='crunchbutton://';if(!App.isPhoneGap||url.indexOf(handler)<0){return;}
url=url.replace(handler,'');url=url.replace(/^\//,'');url='/'+url;url=url.split('?');url=url[0];if(App._init){App.go(url);}else{$(window).on('nginit',function(){App.go(url);});}}
App.dialog={show:function(){if(arguments[1]){var src='<div class="zoom-anim-dialog small-container">'+'<h1>'+arguments[0]+'</h1>'+'<div class="small-container-content">'+arguments[1]+'</div>'+'</div>';}else if($(arguments[0]).length){var src=$(arguments[0]);if(src.length>1){for(var x=0;x<src.length-1;x++){src.get(x).remove();}
var src=$(arguments[0]);}}else{console.log('ERROR WITH DIALOG',arguments);return;}
$.magnificPopup.open({items:{src:src,type:'inline'},fixedContentPos:true,fixedBgPos:true,closeBtnInside:true,preloader:false,midClick:true,removalDelay:300,overflowY:'auto',mainClass:'my-mfp-zoom-in',callbacks:{open:function(){setTimeout(function(){if(App.iOS()){var width=angular.element('.mfp-bg').width();angular.element('.mfp-bg').width(width+10);}},1);},close:function(){$('.wrapper').removeClass('dialog-open-effect-a dialog-open-effect-b dialog-open-effect-c dialog-open-effect-d');App.applyIOSPositionFix();App.rootScope.$broadcast('modalClosed');}}});},isOpen:function(){return $.magnificPopup&&$.magnificPopup.instance&&$.magnificPopup.instance.isOpen;}};App.playAudio=function(audio){var path=(App.isPhoneGap?'':'/')+'assets/audio/';var sound=new Howl({urls:[path+audio+'.mp3',path+audio+'.ogg']}).play();}
App.vibrate=function(){if(App.isPhoneGap){try{navigator.notification.vibrate(100);}catch(e){}}}
App.applyIOSPositionFix=function(){if($('.is-ui2').get(0)){return;}
if(App.iOS()){setTimeout(function(){angular.element('body').css('width','+=1').css('width','-=1');$('.navs').css('width','+=1').css('width','-=1');$('.navs').css('left','+=1').css('left','-=1');setTimeout(function(){angular.element('body').css('width','+=1').css('width','-=1');$('.navs').css('width','+=1').css('width','-=1');$('.navs').css('left','+=1').css('left','-=1');},300);},200);}}
App.verifyConnection={isOffLine:false,forceReload:false,init:function(){if(App.isPhoneGap){App.verifyConnection.check(function(online){var timer=(online)?3000:(3500);});}},check:function(callback){var networkState=navigator.connection.type;var online=true;if(networkState==Connection.NONE){App.verifyConnection.forceReload=true;App.verifyConnection.goOffline();online=false;}
if(callback){callback(online);}},goOffline:function(){if(App._remoteConfig){return;}
$('.connection-error').show();App.verifyConnection.isOffLine=true;},goOnline:function(){if(App.verifyConnection.isOffLine){if(App.verifyConnection.forceReload){window.location.reload(true);App.verifyConnection.forceReload=false;}else{App.rootScope.reload();}}
App.verifyConnection.isOffLine=false;$('.connection-error').hide();}}
App.setNotificationBarStatus=function(status){App.rootScope.notificationBarStatus=status;App.rootScope.$safeApply();}
App.phoneGapListener={init:function(){if(App.isPhoneGap){document.addEventListener('deviceready',App.phoneGapListener.deviceready,false);document.addEventListener('pause',App.phoneGapListener.pause,false);document.addEventListener('resume',App.phoneGapListener.resume,false);document.addEventListener('online',App.phoneGapListener.online,false);document.addEventListener('offline',App.phoneGapListener.offline,false);if(!navigator.onLine){App.phoneGapListener.offline();}}},deviceready:function(){},resume:function(){dateTime.restart();App.rootScope.$broadcast('appResume',false);},pause:function(){},online:function(){App.verifyConnection.goOnline();},offline:function(){App.verifyConnection.goOffline();}};App.profile={_timer:false,log:function(n){return;var now=new Date();if(App.profile._timer){console.debug('>> PROFILE',now.getTime()-App.profile._timer.getTime(),n);}else{console.debug('>> PROFILE',0,n);}
App.profile._timer=now;}}
App.share=function(params){var pic=params.picture||'http://crunchbutton.com/assets/images/facebook-like.png';if(App.isPhoneGap&&App.iOS()){var description=params.caption+".\r\n"+params.description.replace(/(<br \/>)|(\n)/g,'');CDV.FB.share([params.url,params.name,'',description,pic],params.success,params.fail);}else{FB.ui({method:'feed',user_message_prompt:'Crunchbutton',link:params.url,href:params.url,picture:pic,name:params.name,caption:params.caption,description:params.description,attachment:{name:'Crunchbutton',caption:' ',description:params.url,href:params.url,media:[{type:'image',src:pic,href:params.url}],},action_links:[{text:'Crunchbutton',href:'https://crunchbutton.com'}],description:params.description},function(response){console.log(response);if(response&&response.post_id){if(typeof params.success==='function'){params.success(response);}}else{if(typeof params.fail==='function'){params.fail(response);}}});}}
App.isUI2=function(){if(App._UI2IS){return true;}
if(App._UI2ISNT){return false;}
if($('.is-ui2').get(0)){return App._UI2IS=true;}else{return App._UI2ISNT=false;}};var dateTime={timer:0,now:false,gears:null};dateTime.update=function(){var time=_gmtServer.split('/');dateTime.now=new Date(Number(time[0]),Number(time[1]-1),Number(time[2]),Number(time[3]),Number(time[4]),(Number(time[5])+dateTime.timer));dateTime.timer++;dateTime.gears=setTimeout(function(){dateTime.update();},1000);}
dateTime.restart=function(){dateTime.timer=0;dateTime.now=false;var now=new Date();_gmtServer=now.getUTCFullYear()+'/'+(now.getUTCMonth()+1)+'/'+now.getUTCDate()+'/'+now.getUTCHours()+'/'+now.getUTCMinutes()+'/'+now.getUTCSeconds();}
dateTime.reload=function(){var url=App.service+'gmt';App.http.get(url,{cache:false}).success(function(json){_gmtServer=json.gmt;dateTime.timer=0;if(dateTime.gears){clearTimeout(dateTime.gears);}
dateTime.update();App.rootScope.$broadcast('appResume',false);}).error(function(){window.location.reload();});}
dateTime.toString=function(){return dateTime.now.toString('dd MMMM yyyy HH:mm:ss');}
dateTime.getNow=function(){return Date.parse(dateTime.toString());}
dateTime.update();;if(typeof(console)=='undefined'){console={log:function(){return null;},debug:function(){return null;},error:function(){return null;}};}
if(typeof(Number.prototype.toRad)==='undefined'){Number.prototype.toRad=function(){return this*Math.PI/180;}}
var _toRad=function(){var Value=arguments.shift();return Number.prototype.toRad.call(Value,args);};if(!typeof(App)=='undefined'){App={};}
App.guid=function(){function s4(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}
return(new Date()).getTime()+s4()+s4();}
App.capitalize=function(word){return word.charAt(0).toUpperCase()+word.slice(1);};App.request=function(url,complete,error){if(angular&&angular.element&&angular.element('html')&&angular.element('html').injector()&&angular.element('html').injector().get('$http')){var http=angular.element('html').injector().get('$http');http({url:url,method:'GET'}).success(function(data){if(complete){complete(data);}}).error(function(data){if(error){error(data)}});}else{$.getJSON(url).done(complete).fail(error);}};App.cache=function(type,id){var finalid,args=arguments,complete,partComplete,partError;complete=args[2]?args[2]:function(){};error=args[3]?args[3]:function(){};partComplete=function(){if(this.uuid){App.cached[type][id.uuid]=this;App.cached[type][id]=this;}
if(this.permalink){App.cached[type][id.permalink]=this;App.cached[type][id]=this;}
complete.call(this);}
partError=function(){App.cached[type][id]=null;error.call(arguments);}
if(typeof(id)=='object'){eval('App.cached[type][id.id] = new '+type+'(id,partComplete, partError)');finalid=id.id;}else if(!App.cached[type][id]){eval('App.cached[type][id] = new '+type+'(id,partComplete, partError)');}else{var element=App.cached[type][id];var removedFromCache=false;if(element.cachedAt){var now=(Math.floor(new Date().getTime()/1000));var age=Math.floor(now-element.cachedAt);if(age>=App.cachedObjectsExpiresIn){removedFromCache=true;App.cached[type][id]=null;if(typeof(id)=='object'){eval('App.cached[type][id.id] = new '+type+'(id,partComplete, partError)');finalid=id.id;}else{eval('App.cached[type][id] = new '+type+'(id,partComplete, partError)');}}}
if(!removedFromCache){complete.call(App.cached[type][id]);}}
return App.cached[type][finalid||id];};App.ceil=function(num){num=num*100;num=Math.ceil(num);return num/100;};App.phone={format:function(num){if(num!=null){num=num.replace(/^0|^1/,'');num=num.replace(/[^\d]*/gi,'');num=num.substr(0,10);if(num.length>=7){num=num.replace(/(\d{3})(\d{3})(.*)/,"$1-$2-$3");}else if(num.length>=4){num=num.replace(/(\d{3})(.*)/,"$1-$2");}}
return num;},validate:function(num){if(!num){return false;}
num=num.replace(new RegExp('-','g'),'');if(!num||num.length!=10){return false;}
var
nums=num.split(''),prev;for(x in nums){if(!prev){prev=nums[x];continue;}
if(nums[x]!=prev){return true;}}
return false;}};App.pad=function(number,length){var str=''+number;while(str.length<length){str='0'+str;}
return str;};App.formatTime=function(time){if(!time){return'';}
var vals=time.split(':');var pm=false;vals[0]=new String(vals[0]);vals[1]=vals[1]?new String(vals[1]):0;if(vals[0].match(/^[0-9]{3,4}$/i)){vals[1]=vals[0].substr(-2,2);vals[0]=vals[0].substr(0,vals[0].length-2);}
if(vals[0]=='12'){pm=true;}
if(vals[0]=='24'){vals[0]='00';}
if(vals[0]>12){vals[0]-=12;pm=true;}else{if(!pm&&time.match(/p/i)){pm=true;}
if(pm&&time.match(/a/i)){pm=false;}}
if(!vals[1]){vals[1]='00';}
vals[1]=vals[1].replace(/[^0-9]+/,'');vals[0]=new String(vals[0]).replace(/[^0-9]+/,'');vals[0]=App.pad(vals[0],2);vals[1]=App.pad(vals[1],2);if(vals[0]=='00'){vals[0]=12;}
return vals.join(':')+(pm?' PM':' AM');};App.unFormatTime=function(time){var part=time.split(' ');part[0]=part[0].split(':');part[0][0]=parseInt(part[0][0],10);if(part[1]=='PM'){if(part[0][0]!=12){part[0][0]=App.pad(part[0][0]+12,2);}}else{if(part[0][0]==12){part[0][0]='00';}}
return part[0][0]+':'+part[0][1];};App.cleanInput=function(text){text=App.cleanBad(text);var type=arguments[1];switch(type){case'float':text=text.replace(/[^0-9\.]+/i,'');break;case'text':default:text=text.replace(/[^a-z0-9\-_ \(\)\+\.\@\%\&\!\;\:\"\'\,\\\/]+/i,'');break;}
return text};App.isVersionCompatible=function(required,installed){required=required.toString().split('.')
installed=installed.toString().split('.');var length=Math.max(required.length,installed.length);var comparator=0;for(var i=0;i<length&&!comparator;i++){var part1=parseInt(required[i],10)||0;var part2=parseInt(installed[i],10)||0;if(part1<part2){comparator=1;}
if(part1>part2){comparator=-1;}}
return(comparator>=0);}
App.cleanBad=function(s){s=s.replace(/\u2018|\u2019|\u201A|\uFFFD/g,"'");s=s.replace(/\u201c|\u201d|\u201e/g,'"');s=s.replace(/\u02C6/g,'^');s=s.replace(/\u2039/g,'<');s=s.replace(/\u203A/g,'>');s=s.replace(/\u2013/g,'-');s=s.replace(/\u2014/g,'--');s=s.replace(/\u2026/g,'...');s=s.replace(/\u00A9/g,'(c)');s=s.replace(/\u00AE/g,'(r)');s=s.replace(/\u2122/g,'TM');s=s.replace(/\u00BC/g,'1/4');s=s.replace(/\u00BD/g,'1/2');s=s.replace(/\u00BE/g,'3/4');s=s.replace(/[\u02DC|\u00A0]/g," ");return s;};App.isMobile=function(){return App.isAndroid()||$.browser.mobile;}
App.isNarrowScreen=function(){return $(window).width()<=769;}
App.iOS=function(){return /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());}
App.iOS7=function(){return /iphone os 7_/i.test(navigator.userAgent.toLowerCase());}
App.isAndroid=function(){return /android/i.test(navigator.userAgent.toLowerCase());}
App.isChrome=function(){return /chrom(e|ium)/.test(navigator.userAgent.toLowerCase())||/crios/.test(navigator.userAgent.toLowerCase())||(typeof window.chrome==='object');}
var sort_by;(function(){var default_cmp=function(a,b){if(a==b)return 0;return a<b?-1:1;},getCmpFunc=function(primer,reverse){var cmp=default_cmp;if(primer){cmp=function(a,b){return default_cmp(primer(a),primer(b));};}
if(reverse){return function(a,b){return-1*cmp(a,b);};}
return cmp;};sort_by=function(){var fields=[],n_fields=arguments.length,field,name,reverse,cmp;for(var i=0;i<n_fields;i++){field=arguments[i];if(typeof field==='string'){name=field;cmp=default_cmp;}
else{name=field.name;cmp=getCmpFunc(field.primer,field.reverse);}
fields.push({name:name,cmp:cmp});}
return function(A,B){var a,b,name,cmp,result;for(var i=0,l=n_fields;i<l;i++){result=0;field=fields[i];name=field.name;cmp=field.cmp;result=cmp(A[name],B[name]);if(result!==0)break;}
return result;}}}());var startCoords={},endCoords={},cordsThresh=3;if(window.jQuery){(function($){$.fn.checkToggle=function(params){var checks=$(this).filter('input[type="checkbox"]');$(this).filter('input[type="checkbox"]').each(function(){$(this).prop('checked',!$(this).is(':checked'));});return this;};})(jQuery);}
Date.prototype.getMonthName=function(lang){lang=lang&&(lang in Date.locale)?lang:'en';return Date.locale[lang].month_names[this.getMonth()];};Date.prototype.getMonthNameShort=function(lang){lang=lang&&(lang in Date.locale)?lang:'en';return Date.locale[lang].month_names_short[this.getMonth()];};Date.locale={en:{month_names:['January','February','March','April','May','June','July','August','September','October','November','December'],month_names_short:['Jan','Feb','Mar','Apr','May','June','July','Aug','Sept','Oct','Nov','Dec']}};Date.prototype.formatted=function(){return(this.getMonth()+1)+'/'+this.getDate()+'/'+this.getFullYear();};Number.prototype.pad=String.prototype.pad=function(width,z){var z=z||'0';var n=this+'';return n.length>=width?n:new Array(width-n.length+1).join(z)+n;}
function timestampDiff(time1,time2){return Math.floor((time1-time2)/1000);}
function formatTime(seconds,message){if(seconds<=60){return'in less than a minute';}
var time=Math.floor(seconds/60);if(time&&time>0){var hours=Math.floor(time/60);var minutes=time-(hours*60);if(hours>0){if(hours<=24){return'in '+(hours+((hours>1)?' hours':' hour'));}
if(hours>24){if(message){return(message.tomorrow?message.tomorrow:message.day)+' at '+message.hour+(parseInt(message.min)>0?':'+message.min:'')+' '+message.ampm;}else{return'in '+(hours+((hours>1)?' hours':' hour'));}}}else{return'in '+((minutes>1)?minutes+' minutes':minutes+' minute');}}
return'';}
$.pluck=function(ar,len){for(var i=ar.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=ar[i];ar[i]=ar[j];ar[j]=temp;}
return ar.slice(0,len||len.length);};function getCardType(number){var re=new RegExp("^4");if(number.match(re)!=null){return"visa";}
re=new RegExp("^(34|37)");if(number.match(re)!=null){return"amex";}
re=new RegExp("^5[1-5]");if(number.match(re)!=null){return"mastercard";}
re=new RegExp("^6011");if(number.match(re)!=null){return"discover";}
return"";};var Orm={properties:function(){var properties={};for(var name in this){if(name.indexOf('_')!==0&&!$.isFunction(this[name])){if(this[name]===true){properties[name]=1;}else if(this[name]===false){properties[name]=0;}else{properties[name]=this[name];}}}
return properties;},loadType:function(cls,data){var self=this;if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];},save:function(complete){if(!this.type)return;$.post(App.service+this.resource+(this.id?('/'+this.id):''),this.properties(),function(result){if(complete){complete(result);}});},load:function(id){var self=this;this.cachedAt=(Math.floor(new Date().getTime()/1000));if(typeof(id)=='object'){this.finished(id);}else{App.request(App.service+self.resource+'/'+id,function(json){if(json.error){throw'ORM load error: '+json.error+"\nType: "+self.type+"\nResource: "+self.resource+"\nID: "+id;}else{self.finished(json);}},function(){if(typeof self.loadError=='function'){self.loadError.apply(self,arguments);}});}}};var Location=function(params){var self=this;this._properties={verified:true,city:null,region:null,lat:null,lon:null,type:null,subtype:null,address:null,prep:null,removeFromCookie:false,permalink:null,image:false};self.setCityFromResult=function(results){if(!results){return;}
var result=results[0]||results;if(typeof result.types==='string'){var type=result.types;}else{for(x in result.types){var type=result.types[x];}}
switch(type){case'locality':self._properties.city=result.address_components[0].long_name;self._properties.region=result.address_components[2].short_name;self._properties.detail=2;break;case'street_address':case'premise':self._properties.city=result.address_components[2].long_name;self._properties.region=result.address_components[4].short_name;self._properties.detail=5;break;case'postal_code':self._properties.city=result.address_components[1].long_name;self._properties.region=result.address_components[3].short_name;self._properties.detail=3;break;case'route':self._properties.city=result.address_components[0].long_name;if(result.address_components[1]){self._properties.region=result.address_components[1].short_name;}else{self._properties.region=result.address_components[0].short_name;}
self._properties.detail=4;break;default:case'administrative_area_level_1':self._properties.city=result.address_components[0].long_name;self._properties.detail=1;break;}
for(var i=0;i<result.address_components.length;i++){for(var j=0;j<result.address_components[i].types.length;j++){if(result.address_components[i].types[j]=='locality'){self._properties.city=result.address_components[i].long_name;}}}};self.setAddressFromResult=function(results){if(!results){return;}
var result=results[0]||results;self._properties.address=result.formatted_address;};self.setZipFromResult=function(results){if(!results){return;}
var result=results[0]||results;for(var x in result.address_components){if(result.address_components[x].types[0]=='postal_code'){self._properties.zip=result.address_components[x].short_name;return;}}};self.distance=function(from){return App.loc.distance({to:{lat:self.lat(),lon:self.lon()},from:from});};self.city=function(){return self._properties.city||'';};self.prep=function(){return self._properties.prep||'in';};self.address=function(){return self._properties.address||'';};self.formatted=function(location){return self.address().replace(', USA','');};self.formattedWithDiff=function(){var address=self.formatted();if(self.entered()&&self.entered()!=''){var diff=self.getDiff();if(diff){return address+' ('+diff+')';}}
return address;}
self.zip=function(){return self._properties.zip||'';};self.lat=function(){return self._properties.lat||0;};self.lon=function(){return self._properties.lon||0;};self.valid=function(){switch(arguments[0]){case'restaurants':return(self.lat()||self.lon())?true:false;break;case'order':return(self.lat()||self.lon())&&self.verified()&&self.detail()>=5?true:false;break;default:return false;break;}};self.getDiff=function(){if(!self.entered()){return;}
var _formatted=self.formatted();var _entered=self.entered();_formatted=_formatted.replace(/,/g,'');_entered=_entered.replace(/,/g,'');a_formatted=_formatted.split(" ");a_entered=_entered.split(" ");var diff=new Array();if(a_formatted.length>a_entered.length){var long=a_formatted;var short=a_entered;}else{var long=a_entered;var short=a_formatted;}
for(x=0;x<long.length;x++){var has=false;for(y=0;y<short.length;y++){if(short[y]==long[x]){has=true;}}
if(!has){diff.push(long[x]);}}
return diff.join(" ");};self.verified=function(){return self._properties.verified;};self.type=function(){return self._properties.type;};self.detail=function(){return self._properties.detail;};self.region=function(){return self._properties.region;}
self.entered=function(){return self._properties.entered;}
self.markToRemove=function(){return self._properties.removeFromCookie=true;}
self.storeAtCookie=function(){return!self._properties.removeFromCookie;}
self.setEntered=function(entered){self._properties.entered=entered;}
self.image=function(){return(parseInt(self._properties.image)>0||self._properties.image!='0');}
self.permalink=function(){return self._properties.permalink;}
self.getImage=function(){if(self.image()){return self.permalink()+'.png';}
return false;}
self.toCookie=function(){var properties={};for(var x in this._properties){if(x!='results'){properties[x]=this._properties[x];}}
return new Location(properties);}
self.getKey=function(){return(self.lat()+self.lon()+'').replace('-','');}
for(var x in params){this._properties[x]=params[x];}
if(params&&params.results){self.setCityFromResult(params.results);self.setAddressFromResult(params.results);self.setZipFromResult(params.results);}};App.AB={options:{tagline:[{name:'tagline-for-free',tagline:'Order the best delivery food %s. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'},{name:'tagline-no-free',tagline:'Order the top food %s. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'}],slogan:[{name:'slogan-push-food',slogan:'Push a button. Get Delivery.'}],nothingInTheCartMobile:[{name:'empty-cart-mobile-begin',line:'Begin by tapping on anything from our curated menu below!'},{name:'empty-cart-mobile-food',line:'Choose food below!',disabled:true}],nothingInTheCartDesktop:[{name:'empty-cart-desktop-begin',line:'Begin by clicking on anything from our curated menu on the left!'},{name:'empty-cart-desktop-food',line:'Choose Food!'}],restaurantPage:[{name:'restaurant-page-noimage'},{name:'restaurant-page-image',disabled:true}],dollarSign:[{name:'hide'},{name:'hide'}]},init:function(){App.AB.create(true);App.AB.load();},create:function(clear){if(clear){App.config.ab={};}
if(App.config&&!App.config.ab){App.config.ab={};}
for(var key in App.AB.options){if(App.config.ab[key]){return;}
var optionType=App.AB.options[key];var opts=[];for(var x in optionType){if(!optionType[x].disabled||optionType[x].disabled==false){opts[opts.length]=optionType[x];}}
var opt=opts[Math.floor(Math.random()*opts.length)];App.config.ab[key]=opt.name}
App.AB.save();},load:function(){App.slogan=App.AB.pluck('slogan',App.config.ab.slogan);App.tagline=App.AB.pluck('tagline',App.config.ab.tagline);if(!App.slogan||!App.tagline){App.AB.create(true);App.AB.load(true);}},pluck:function(option,name){for(var x in App.AB.options[option]){if(App.AB.options[option][x].name==name){return App.AB.options[option][x];}}
return null;},save:function(){$.ajax({url:App.service+'config',data:{ab:App.config.ab},dataType:'json',type:'POST',complete:function(json){}});}};;function restaurantSort(a,b){var bubble;if((a.open()&&b.open())||(!a.open()&&!b.open())){bubble=parseInt(a.sort)-parseInt(b.sort);}else if(a.open()&&!b.open()){bubble=-1;}else if(!a.open()&&b.open()){bubble=1;}else{console.log('Should not be here',a,b);}
return bubble;}
var Community=function(id){this.type='Community';this.id_var='id_community';this.resource='community';var self=this;$.extend(self,Orm);var complete=arguments[1]||null;self.loadError=arguments[2]||null;self.restaurants=function(){if(!self.__restaurants){var openRestaurants=[];var closedRestaurants=[];for(x in self._restaurants){var restaurant=App.cache('Restaurant',self._restaurants[x]);if(restaurant.open()){openRestaurants[openRestaurants.length]=restaurant;}else{closedRestaurants[closedRestaurants.length]=restaurant;}}
openRestaurants.sort(restaurantSort);closedRestaurants.sort(restaurantSort);self.__restaurants=[];self._restaurants=null;for(x in openRestaurants){self.__restaurants[self.__restaurants.length]=openRestaurants[x];}
for(x in closedRestaurants){self.__restaurants[self.__restaurants.length]=closedRestaurants[x];}}
return self.__restaurants;}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.restaurants();if(typeof complete=='function'){complete.call(self);}}
self.load(id);}
App.cached.Community={};;var Restaurant=function(id){this.type='Restaurant';this.id_var='id_restaurant';this.resource='restaurant';var
self=this,complete;$.extend(self,Orm);var complete=arguments[1]||null;self.loadError=arguments[2]||null;self.categories=function(){return self.loadType('Category','categories');}
self.notifications=function(){return self.loadType('Notification','notifications');}
self.top=function(){var categories=self.categories();for(var x in categories){var dishes=categories[x].dishes();for(var xx in dishes){if(dishes[xx].top==1){return dishes[xx];}}}}
self.deliveryDiff=function(total){var diff=parseFloat(self.delivery_min-total).toFixed(2);return diff;}
self.meetDeliveryMin=function(total){return total<parseFloat(self.delivery_min)?true:false;}
self.dateFromItem=function(item,offset){var
theTime=item.split(':'),theDate=new Date();theDate.setHours(theTime[0]);theDate.setMinutes(theTime[1]+offset);return theDate;}
self.deliveryHere=function(distance){return(distance<=this.delivery_radius)}
self.closedMessage=function(){if(self.closed_message!=''){return self.closed_message;}else{if(self._closedDueTo!=''){return self._closedDueTo;}
return'Temporarily closed';}}
self.preset=function(){return self['_preset'];}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.categories();if(App.isPhoneGap){if(self.image){var img=self.image.replace(/^.*\/|\.[^.]*$/g,'');self.img=App.imgServer+'596x596/'+img+'.jpg';self.img64=App.imgServer+'596x596/'+img+'.jpg';}}
if(typeof complete=='function'){complete.call(self);}}
self.tagfy=function(tag){if(tag){self._tag=tag;if(tag=='opening'){if(self._opensIn&&self._opensIn_formatted!=''){self._tag=tag;}else{self._tag='closed';}}else{self._tag=tag;}
return;}
self._tag='';if(!self._open){self._tag='closed';if(self._closedDueTo){self._tag='force_close';}}
if(self._open&&self._closesIn!=='false'&&self._closesIn<=15){self._tag='closing';}
if(self.closed_message==''){self._tag='force_close';}
if(self._tag==''){if(self.takeout=='1'&&self.delivery!='1'){self._tag='takeout';}}}
self.getNow=function(now){if(now&&now.getTime){return now;}
return dateTime.getNow();}
self.openRestaurantPage=function(now){now=self.getNow(now);if(self.open(now,true)){return true;}
self.opensIn(now);if(self._opensIn&&self._opensIn<(3600)){return true;}
return false;}
self.open=function(now,ignoreOpensClosesInCalc){if(!ignoreOpensClosesInCalc){self.tagfy('opening');}
self._hasHours=false;now=self.getNow(now);self.processHours();var now_time=now.getTime();self._open=false;if(self.hours){for(x in self.hours){self._hasHours=true;if(now_time>=self.hours[x]._from_time&&now_time<=self.hours[x]._to_time){if(self.hours[x].status=='open'){self._open=true;if(ignoreOpensClosesInCalc){return self._open;}
self.closesIn(now);self.tagfy();return self._open;}else if(self.hours[x].status=='close'){self._closedDueTo=(self.hours[x].notes)?self.hours[x].notes:false;if(ignoreOpensClosesInCalc){return self._open;}
self.opensIn(now);self.tagfy();return self._open;}}}
self.opensIn(now);self.tagfy();if(!self._hasHours){self._closedDueTo=(self._community_closed?self._community_closed:' ');}
return self._open;}else{self._tag='force_close';self._closedDueTo=(self._community_closed?self._community_closed:' ');}}
self.closesIn=function(now){now=self.getNow(now);self._closesIn=false;self._closesIn_formatted='';self.processHours();var now_time=now.getTime();if(self.hours){for(x in self.hours){if(self.hours[x].status=='close'){if(now_time<=self.hours[x]._from_time){self._closesIn=timestampDiff(self.hours[x]._from_time,now_time);self._closesIn_formatted=formatTime(self._closesIn);return;}}}}
if(self._closesIn==0||self._closesIn===false){self._open=false;}}
self.opensIn=function(now){now=self.getNow(now);self._opensIn=false;self._opensIn_formatted='';self.processHours();var now_time=now.getTime();for(x in self.hours){if(self.hours[x].status=='open'){if(now_time<=self.hours[x]._from_time){self._opensIn=timestampDiff(self.hours[x]._from_time,now_time);self._opensIn_formatted=formatTime(self._opensIn);return;}}}
if(self.next_open_time){self._opensIn=timestampDiff(Date.parse(self.next_open_time),now_time);self._opensIn_formatted=formatTime(self._opensIn,self.next_open_time_message);}}
self.processHours=function(){if(!self._hours_processed){for(x in self.hours){self.hours[x]._from=Date.parse(self.hours[x].from);self.hours[x]._from_time=self.hours[x]._from.getTime();self.hours[x]._to=Date.parse(self.hours[x].to);self.hours[x]._to_time=self.hours[x]._to.getTime();}
self._hours_processed=true;}}
self.isActive=function(callback){var url=App.service+'restaurant/active/'+self.id_restaurant;App.http.get(url,{cache:false}).success(function(status){if(callback){callback(status.active);};}).error(function(){callback(false);});}
self.reloadHours=function(forceLoad){var load=false;var now=(Math.floor(new Date().getTime()/1000));if(forceLoad){load=true;}else{var age=Math.floor(now-self.cachedAt);load=(age>=((60*60)*23));}
if(load){var url=App.service+'restaurant/hours/'+self.id_restaurant;App.http.get(url,{cache:false}).success(function(hours){self.cachedAt=now;self.hours=hours;self._hours_processed=false;self.processHours();});}}
self.load(id);}
App.cached.Restaurant={};;var Dish=function(id){this.type='Dish';this.id_var='id_dish';this.resource='dish';var self=this;$.extend(self,Orm);self.options=function(){return self.loadType('Option','options');}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.options();}
self.load(id);}
App.cached.Dish={};;var Option=function(id){this.type='Option';var self=this;self.optionPriceWithoutMarkup=function(options){var price=parseFloat(self.price);if(self.markup){price-=parseFloat(self.markup);}
for(var x in self.prices){if(options.indexOf(self.prices[x].id_option_parent)!==-1){price+=parseFloat(self.prices[x].price);if(self.prices[x].markup){price-=self.prices[x].markup;}}}
return price;}
self.optionPrice=function(options){var price=parseFloat(self.price);for(var x in self.prices){if(options.indexOf(self.prices[x].id_option_parent)!==-1){price+=parseFloat(self.prices[x].price);}}
return price;}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/option/'+id,function(json){for(x in json){self[x]=json[x];}});}}
App.cached.Option={};;var Category=function(id){this.type='Dish';var self=this;$.extend(self,Orm);self.dishes=function(){return self.loadType('Dish','dishes');}
self.locName=function(community){return(self.loc=='1'&&community&&community.name)?(' at '+community.name):'';}
self.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}
self.dishes();}else{App.request(App.service+'/category/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Category={};;var Notification=function(id){var self=this;$.extend(this,Orm);this.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/notification/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Notification={};;var Order=function(id){this.type='Order';this.id_var='id_order';this.resource='order';var self=this;$.extend(self,Orm);var complete=arguments[1]||null;self.loadError=arguments[2]||null;self.finished=function(data){for(x in data){self[x]=data[x];}
if(typeof complete==='function'){complete.call(self);}}
self.load(id);}
App.cached.Order={};;App.log={api:{url:'log'},type:{order:'order-js',account:'account-js',location:'location-js',game:'game-score'}}
App.log.doLog=function(data,callback){var url=App.logService+App.log.api.url;var info={data:data};info.type=(data.type)?data.type:'log-js';console.debug(data.type,info);$.ajax({type:'POST',url:url,dataType:'json',data:info,success:function(json){if(callback){callback(json);}}});}
App.log.game=function(score){App.log.doLog({'type':App.log.type.game,'info':score,'action':null});}
App.log.order=function(info,action){App.log.doLog({'type':App.log.type.order,'info':info,'action':action});}
App.log.account=function(info,action){App.log.doLog({'type':App.log.type.account,'info':info,'action':action});}
App.log.location=function(info,action){App.log.doLog({'type':App.log.type.location,'info':info,'action':action});};App.tokenizeCard=function(card,complete){console.log('App.tokenizeCard');var processor=(App.config.processor&&App.config.processor.type)?App.config.processor.type:false;console.log('processor',processor);var legacy_card={card_number:card.number,expiration_month:card.expiration_month,expiration_year:card.expiration_year,security_code:null};if(App.isPhoneGap){card=legacy_card;}
switch(processor){case'stripe':App.tokenizeCard_stripe(legacy_card,complete);break;case'balanced':App.tokenizeCard_balanced(card,complete);break;default:console.log('Processor error::',App.config.processor);break;}};App.tokenizeCard_stripe=function(card,complete){var res={status:false};var card={number:card.card_number,exp_month:card.expiration_month,exp_year:card.expiration_year};Stripe.card.createToken(card,function(status,response){if(response.error){switch(response.error.code){case'incorrect_number':res.error='This card number looks invalid';break;case'invalid_number':res.error='The card number is not a valid credit card number.';break;case'invalid_expiry_month':res.error='The card\'s expiration month is invalid.';break;case'invalid_expiry_year':res.error='The card\'s expiration year is invalid.';break;case'invalid_cvc':res.error='The card\'s security code is invalid.';break;case'expired_card':res.error='The card has expired.';break;case'incorrect_cvc':res.error='The card\'s security code is incorrect.';break;case'card_declined':res.error='The card was declined.';break;case'processing_error':res.error='An error occurred while processing the card.';break;default:console.debug('STRIPE ERROR',card,response);res.error='Unable to validate your card at this time';break;}}else{res={id:response.card.id,uri:response.id,lastfour:response.card.last4,card_type:response.card.type,month:response.card.exp_month,year:response.card.exp_year,status:true}}
complete(res);});};App.tokenizeCard_balanced=function(card,completed){var handleResponse=function(response){var res={status:false};if(response.status_code){var version='1.1';response.status=response.status_code;}else{var version='1';}
switch(response.status){case 201:res.status=true;if(version=='1.1'){res.id=response.cards[0].id;res.uri=response.cards[0].href;if(response.card_type){res.card_type=response.card_type;}else{res.card_type=getCardType(card.number);}
if(response.last_four){res.lastfour=response.last_four;}else{res.lastfour=card.number.substr(-4);}}else{res.id=response.data.id;res.uri=response.data.uri;res.card_type=response.data.card_type;res.lastfour=response.data.last_four;}
res.month=card.expiration_month;res.year=card.expiration_year;break;case 400:var description='Missing card information';if(response.errors&&response.errors[0]&&response.errors[0].description){if(response.errors[0].description.indexOf('[number]')){description='Not a valid credit card number';}}
res.error=description;break;case 402:res.error='Unable to authorize card';break;case 404:res.error='Unexpected payment error';break;case 409:res.error='Unable to validate credit card';break;case 500:res.error='Error processing payment';break;case 999:res.error='Unable to reach payment server';break;case 666:res.error='Unable to validate your card';break;default:console.debug('BALANCED ERROR',card,response);res.error='Unable to validate your card at this time';break;}
completed(res);};balanced.card.create(card,handleResponse);};;NGApp.controller('DownloadCtrl',function($scope,$http){$scope.text={number:'',sent:false,send:function(){$http.post(App.service+'download?num='+$scope.text.number.replace(/-/g,''));$scope.text.sent=true;}};});NGApp.controller('SplashCtrl',function($scope,AccountFacebookService){$scope.facebook=AccountFacebookService;if(App.parallax.setupBackgroundImage){App.parallax.setupBackgroundImage($('.home-top').get(0));if(App.isPhoneGap&&App.isAndroid()){angular.element('.fixed-599').css('position','static').css('marginTop',10);}}});NGApp.controller('JobsCtrl',function($scope){var reps='moc.nottubhcnurc@spersupmac'.split('').reverse().join('');var devs='moc.nottubhcnurc@ylnosratskcor'.split('').reverse().join('');$scope.reps=reps;$scope.devs=devs;});NGApp.controller('OwnersCtrl',function($scope){var join='moc.nottubhcnurc@nioj'.split('').reverse().join('');$scope.join=join;});NGApp.controller('AboutCtrl',function($scope){});NGApp.controller('LegalCtrl',function($scope){var join='moc.nottubhcnurc@nioj'.split('').reverse().join('');var goodbye='moc.nottubhcnurc@eybdoog'.split('').reverse().join('');$scope.join=join;$scope.goodbye=goodbye;});NGApp.controller('HelpCtrl',function($scope){var customers='moc.nottubhcnurc@sremotsucyppah'.split('').reverse().join('');var join='moc.nottubhcnurc@nioj'.split('').reverse().join('');$scope.customers=customers;$scope.join=join;});NGApp.controller('HomeCtrl',function($scope,$http,$location,RestaurantsService,LocationService){if(!App.isPhoneGap){if(LocationService.position.pos().valid('restaurants')){$location.path('/'+RestaurantsService.permalink);}else{$location.path('/location');}}
$location.replace();});NGApp.controller('DefaultCtrl',function($scope,$http,$location,CommunityAliasService,RestaurantsService){var community=CommunityAliasService;community.route($location.path(),function(results,restaurant){if(results.alias){community.position.addLocation(new Location({address:results.alias.address(),entered:results.address,type:'alias',lat:results.alias.lat(),lon:results.alias.lon(),city:results.alias.city(),prep:results.alias.prep(),image:results.alias.image(),permalink:results.alias.permalink()}));var url='/'+RestaurantsService.permalink+(restaurant?'/'+restaurant:'')
$location.path(url);}},function(){$location.path('/location');});});NGApp.controller('RestaurantsCtrl',function($scope,$rootScope,$http,$location,$timeout,RestaurantsService,LocationService,RestaurantService,CommunityAliasService){$scope.restaurants=false;$scope.loadingRestaurant=false;var showMoreStage=1;$scope.showMoreRestaurants=function(){showMoreStage++;if(showMoreStage==2){var restaurantsToShow=0;for(var x in $scope.restaurants){if($scope.restaurants[x]._maximized){restaurantsToShow++;}}
$scope.restaurantsToShow=restaurantsToShow;return;}
if(showMoreStage==3){$scope.restaurantsToShow=$scope.restaurants.length;return;}};var location=LocationService;if(!location.initied){location.init();$location.path('/');return;}
var motivationText=['You are awesome','You are loved','You are beautiful','You\'re at the top of your game','You are rad'];$scope.motivationText=motivationText[Math.floor(Math.random()*motivationText.length)];var restaurants=RestaurantsService;$scope.mealItemClass=App.isAndroid()?'meal-food-android':'';var checkOpen=function(){var allClosed=true;for(var x in $scope.restaurants){if($scope.restaurants[x]._open){allClosed=false;break;}}
$scope.allClosed=allClosed;$scope.community_closed=restaurants.community_closed;};var updateRestaurantsStatus=null;var updateStatus=function(){updateRestaurantsStatus=$timeout(function(){$scope.restaurants=restaurants.getStatus();$rootScope.$safeApply();updateStatus();checkOpen();},1000*35);}
$scope.$on('$destroy',function(){RestaurantsService.forceGetStatus=true;if(typeof(updateRestaurantsStatus)!=='undefined'&&updateRestaurantsStatus){try{$timeout.cancel(updateRestaurantsStatus);}catch(e){}}});if(RestaurantsService.forceGetStatus){setTimeout(function(){$scope.restaurants=restaurants.getStatus();updateStatus();$rootScope.$safeApply();},1);}
var status;$rootScope.$on('appResume',function(e,data){var checkDateTime=function(){if(dateTime&&dateTime.getNow&&dateTime.getNow()){if($location.path()=='/'+RestaurantsService.permalink){$scope.restaurants=restaurants.getStatus();$rootScope.$safeApply();updateStatus();}}else{setTimeout(function(){checkDateTime();},50);}}
checkDateTime();});$scope.activeCssStyle=App.activeButtonsEnable;$scope.display=function($event){if($scope.loadingRestaurant){return;}
$scope.loadingRestaurant=true;var restaurant=this.restaurant;var checkHours=function(){if(restaurant.openRestaurantPage(dateTime.getNow())){RestaurantService.basicInfo=restaurant;App.go('/'+restaurants.permalink+'/'+restaurant.permalink,'push');}else{$rootScope.$broadcast('restaurantClosedClick',restaurant);$scope.restaurants=restaurants.getStatus();}}
restaurant.isActive(function(active){if(active){$scope.loadingRestaurant=false;checkHours();}else{$scope.loadingRestaurant=false;restaurant.inactive=true;$rootScope.$broadcast('restaurantClosedClick',restaurant);$rootScope.$safeApply(function(){restaurants.removeInactive(restaurant.id_restaurant);$scope.restaurants=restaurants.getStatus();});}});};var prep=restaurants.position.pos().prep();var city=restaurants.position.pos().city();var image=restaurants.position.pos().getImage();if(restaurants.position.pos().type()=='alias'){CommunityAliasService.communityStyle(restaurants.position.pos().permalink());}else{CommunityAliasService.removeCommunityStyle();}
restaurants.list(function(){try{var slogan=App.slogan.slogan;var sloganReplace=(prep||'in')+' '+(city||'your area');sloganReplace=$.trim(sloganReplace);var tagline=App.tagline.tagline.replace('%s',sloganReplace);slogan=slogan.replace('%s',sloganReplace);}catch(e){console.log('Failed to load dynamic text',App.slogan,App.tagline,e);var slogan='';var tagline='';}
document.title=(city||'')+' Food Delivery | Order Food from '+(city||'Local')+' Restaurants | Crunchbutton';$scope.restaurants=restaurants.sort();checkOpen();var restaurantsToShow=0;for(var x in $scope.restaurants){if($scope.restaurants[x]._maximized){restaurantsToShow++;}}
if(restaurantsToShow>6){restaurantsToShow=6;}else if(restaurantsToShow<6){showMoreStage=2;}
$scope.restaurantsToShow=restaurantsToShow;setTimeout(function(){updateStatus();},1000*60);$scope.slogan=slogan;$scope.tagline=tagline;$scope.image=image;if($scope.restaurants.length==4){$('.content').addClass('short-meal-list');}else{$('.content').removeClass('short-meal-list');}
$('.content').removeClass('smaller-width');},function(){App.go('/location');});});NGApp.controller('CitiesCtrl',function($scope){$scope.topCommunities=App.topCommunities;});NGApp.controller('LocationCtrl',function($scope,$http,$location,$rootScope,RestaurantsService,LocationService,AccountService,PositionsService,RecommendRestaurantService){var reps='moc.nottubhcnurc@spersupmac'.split('').reverse().join('');$scope.reps=reps;var account=AccountService;var restaurants=RestaurantsService;if(App.parallax.setupBackgroundImage){App.parallax.setupBackgroundImage($('.home-top').get(0));}
$scope.warningPlaceholder=false;$scope.isProcessing=false;$scope.isUser=account.user.has_auth;$scope.notUser=!account.user.has_auth;$scope.topCommunities=App.topCommunities;$scope.recommend=RecommendRestaurantService;$scope.location=LocationService;if(!App.isPhoneGap){$scope.location.init();}
document.title='Food Delivery | Crunchbutton';$scope.yourArea=$scope.location.position.pos().city()||'your area';$scope.locationError=false;$scope.openCity=function(city){App.go('/'+city,'push');}
$scope.resetFormLocation=function(){$scope.location.form.address='';$scope.locationError=false;$scope.warningPlaceholder=false;setTimeout(function(){$scope.focus('.location-address');},250);}
$scope.$watch('location.position.pos().city()',function(newValue,oldValue,scope){$scope.yourArea=$scope.location.position.pos().city()||'your area';});$rootScope.$on('connectionError',function(e,data){$scope.isProcessing=false;spin.stop();});$scope.$on('locationError',function(e,data){spin.stop();var entered=$scope.location.position.pos().entered();var isStreet=$scope.location.position.pos().valid('order');if(isStreet&&entered&&!App.isUI2()&&!entered.match(new RegExp(/\d{5}(?:[-\s]\d{4})?/))){$('.location-address').val('').attr('placeholder','Please include a zip code');$scope.$broadcast('locationNotServed',true);}else{$scope.locationError=true;}
PositionsService.removeNotServedLocation();});$rootScope.$on('NewLocationAdded',function(e,data){$scope.recommend.greetings=false;});$scope.$on('locationNotServed',function(e,data){spin.stop();var pos=PositionsService.pos();if(pos.type()=='user'){var entered=$scope.location.position.pos().entered();var isStreet=$scope.location.position.pos().valid('order');if(isStreet&&!entered.match(new RegExp(/\d{5}(?:[-\s]\d{4})?/))){$('.location-address').val('').attr('placeholder','Please include a zip code');}else{$('.location-address').val('').attr('placeholder','Please include a zip code or city name');}}else{$('.location-address').val('').attr('placeholder','Please enter an address or zip');}
if(typeof(pos)!='undefined'&&pos.type()=='geolocation'){$scope.locationError=true;}
PositionsService.removeNotServedLocation();$rootScope.locationPlaceholder=$('.location-address').attr('placeholder');$rootScope.warningPlaceholder=true;$scope.warningPlaceholder=true;if(!App.dialog.isOpen()){$scope.focus('.location-address');}});if($rootScope.locationPlaceholder){$('.location-address').val('').attr('placeholder',$rootScope.locationPlaceholder);}
if($rootScope.locationPlaceholder){$scope.warningPlaceholder=$rootScope.warningPlaceholder;}
$scope.$on('$destroy',function(){$rootScope.locationPlaceholder=false;$rootScope.warningPlaceholder=false;AccountService.forceDontReloadAfterAuth=false;});var proceed=function(){App.go('/'+restaurants.permalink,'push');$scope.location.form.address='';$scope.warningPlaceholder=false;$scope.isProcessing=false;if(!$scope.$$phase){$scope.$apply();}};$scope.letsEat=function(){$scope.blur('.location-address');$scope.location.form.address=$.trim($scope.location.form.address);if($scope.location.form.address==''){var locSpin=$('.location-detect').data('spinner');locSpin.start();$scope.location.getLocationByBrowser(function(loc){$scope.location.position.removeNotServedLocation();$scope.location.position.addLocation(loc);restaurants.list(proceed,function(){var error=function(){locSpin.stop();$scope.$broadcast('locationNotServed');}});},function(){locSpin.stop();$('.location-address').val('').attr('placeholder',$('<div>').html('&#10148; Please enter your address here').text());$scope.warningPlaceholder=true;if(!App.dialog.isOpen()){$scope.focus('.location-address');}});}else{spin.start();if($scope.isProcessing){setTimeout(function(){$scope.isProcessing=false;},2000);return;}
$scope.isProcessing=true;$scope.location.addVerify($scope.location.form.address,function(){restaurants.list(proceed,function(){$scope.$broadcast('locationError');$scope.isProcessing=false;});},function(){spin.stop();var oopsText=App.isPhoneGap?'Oops! Please enter an address':'&#9785; Oops! Please enter a street name, number, and city';$('.location-address').val('').attr('placeholder',$('<div>').html(oopsText).text());$scope.warningPlaceholder=true;$scope.focus('.location-address');$scope.isProcessing=false;if(!$scope.$$phase){$scope.$apply();}});}}
$scope.locEat=function(){var locSpin=$('.location-detect').data('spinner');var error=function(){$scope.$broadcast('locationNotServed');locSpin.stop();}
locSpin.start();$scope.location.getLocationByBrowser(function(loc){$scope.location.position.removeNotServedLocation();$scope.location.position.addLocation(loc);restaurants.list(proceed,error);},error);};var spin={start:function(){if(spin.obj){spin.obj.start();}},stop:function(){if(spin.obj){spin.obj.stop();}}};setTimeout(function(){spin.obj=$('.button-letseat-form').data('spinner');},500);});NGApp.controller('RestaurantCtrl',function($scope,$http,$routeParams,$rootScope,$timeout,RestaurantService,OrderService,CreditService,GiftCardService,PositionsService,MainNavigationService,CreditCardService){var order=OrderService;order.loaded=false;$scope.order={};$scope.open=false;$scope.isIOs=App.iOS();$scope.restaurantLoaded=RestaurantService.alreadyLoaded();$scope.restaurant=false;if(RestaurantService.basicInfo){$timeout(function(){$scope.restaurant=RestaurantService.basicInfo;$scope.open=$scope.restaurant._open;},50);}
order.startStoreEntederInfo=false;$scope.order.form=order.form;$scope.order.info=order.info;$scope.Math=window.Math;$scope.nothingInTheCartDesktop=App.AB.pluck('nothingInTheCartDesktop',App.config.ab.nothingInTheCartDesktop).line;$scope.nothingInTheCartMobile=App.AB.pluck('nothingInTheCartMobile',App.config.ab.nothingInTheCartMobile).line;$scope.order.creditCardChanged=function(){order._cardInfoHasChanged=true;};var creditCard=CreditCardService;var updateStatus=function(){updateRestaurantStatus=$timeout(function(){$scope.restaurant.open();$scope.restaurant.reloadHours();var open=$scope.restaurant._open;if($scope.open!=open){$scope.open=open;}
if(!$scope.$$phase){$scope.$apply();}
updateStatus();},1000*35);}
$scope.$on('$destroy',function(){if(typeof(updateRestaurantStatus)!=='undefined'&&updateRestaurantStatus){try{$timeout.cancel(updateRestaurantStatus);}catch(e){}}
if(typeof(forceReloadTimer)!=='undefined'&&forceReloadTimer){try{$timeout.cancel(forceReloadTimer);}catch(e){}}});$rootScope.$on('appResume',function(e,data){var checkDateTime=function(){if(dateTime&&dateTime.getNow&&dateTime.getNow()){updateStatus();}else{setTimeout(function(){checkDateTime();},50);}}
checkDateTime();});order.cart.setRestaurant($routeParams.id);MainNavigationService.order=$scope.order;$scope.getFoodButton=function(){MainNavigationService.getFood(order.cart.hasItems());}
$scope.order.updateTotal=function(){return order.updateTotal();}
$scope.order.subtotal=function(){return order.subtotal();}
$scope.order.total=function(){return order.total();}
$scope.order.submit=function(){return order.submit();}
$scope.order.checkout=function(){return order.checkout();}
$scope.order.cardInfoChanged=function(){return order.cardInfoChanged();}
$scope.order.toogleDelivery=function(type){return order.toogleDelivery(type);}
$scope.order.tooglePayment=function(type){return order.tooglePayment(type);}
$scope.order._years=function(){return order._years();}
$scope.order._months=function(){return order._months();}
$scope.order._tips=function(){return order._tips();}
$scope.showCreditPayment=function(){$scope.order.tooglePayment('card');$scope.order.showForm=true;$rootScope.closePopup();}
$scope.addressLetMeChangeIt=function(){$rootScope.closePopup();$scope.order.showForm=true;setTimeout(function(){$scope.focus('#pay-address');},450);}
$scope.addressPlaceAnyway=function(){$rootScope.closePopup();setTimeout(function(){order.submit(true);;},300);}
$scope.addressOutOfRangePlaceAnyway=function(){$rootScope.closePopup();setTimeout(function(){order.submit(true);;},300);}
$scope.giftCardCreditPayment=function(){$rootScope.closePopup();$scope.order.tooglePayment('card');$scope.order.showForm=true;}
$scope.order.tipChanged=function(){return order.tipChanged();}
$rootScope.$on('orderProcessingError',function(e,data){if(App.busy.isBusy()){App.busy.unBusy();}
order.showForm=true;$scope.order.showForm=order.showForm;});$scope.$on('orderLoaded',function(e,data){$scope.order.loaded=order.loaded;$scope.order.showForm=order.showForm;$scope.$watch('order.form',function(newValue,oldValue,scope){if(order.startStoreEntederInfo&&!order.account.user.id_user){var userEntered=angular.copy(order.form);userEntered.cardNumber='';$.totalStorage('userEntered',userEntered);}},true);GiftCardService.notes_field.lastValidation=false;$scope.checkGiftCard();$rootScope.$safeApply();});$scope.order.cart={};$scope.order.cart.add=function(item){order.cart.add(item);$scope.getFoodButton();$rootScope.$broadcast('itemAdded',true);return;}
$scope.order.cart.remove=function(item){order.cart.remove(item);$scope.getFoodButton();return;}
$scope.order.cart.customizeItem=function(option,item){return order.cart.customizeItem(option,item);}
$scope.order.cart.hasItems=function(){return order.cart.hasItems();}
$scope.$watch('order.cart.items',function(newValue,oldValue,scope){$scope.order.updateTotal();},true);$scope.user=order.account.user;$scope.AB={dollar:(App.config.ab&&App.config.ab.dollarSign=='show')?'$':'',restaurantPage:(App.config.ab&&App.config.ab.restaurantPage=='restaurant-page-noimage')?' restaurant-pic-wrapper-hidden':''};var giftcard=GiftCardService;$scope.giftcard={giftcards:{}};$scope.$on('giftCardUpdate',function(e,data){$scope.giftcard.giftcards.success=giftcard.notes_field.giftcards.success;$scope.giftcard.giftcards.error=giftcard.notes_field.giftcards.error;$scope.giftcard.value=giftcard.notes_field.value;$scope.giftcard.removed=giftcard.notes_field.removed;$scope.giftcard.hasGiftCards=giftcard.notes_field.hasGiftCards;$scope.giftcard.justOneGiftCardError=giftcard.notes_field.justOneGiftCardError;$scope.giftcard.hasValue=(parseFloat(giftcard.notes_field.value)>0);$scope.$safeApply();});$scope.$watch('order.form.phone',function(newValue,oldValue,scope){if(!$scope.user.id_user){giftcard.notes_field.lastValidation='';$scope.checkGiftCard();}
console.log('$scope.user.id_user',$scope.user.id_user);});$scope.checkGiftCard=function(){if(validateGiftCard){giftcard.notes_field.content=$scope.order.form.notes;giftcard.notes_field.start($scope.order.form.phone);}}
var credit=CreditService;$scope.credit={hasValue:false};$rootScope.$on('creditChanged',function(e,data){$scope.$safeApply(function($scope){$scope.credit.value=credit.value;$scope.credit.number=parseFloat(credit.value);$scope.credit.redeemed=credit.redeemed;$scope.order.updateTotal();if(parseFloat($scope.credit.value)>0){$scope.credit.hasValue=true;}else{$scope.credit.hasValue=false;}});});$scope.$on('creditCardInfoChanged',function(e,data){$scope.order.creditCardChanged();});var validateGiftCard=false;var restaurantService=RestaurantService;$scope.$on('restaurantLoaded',function(e,data){$scope.restaurantLoaded=RestaurantService.alreadyLoaded();var community=data.community;$scope.restaurant=data.restaurant;order.restaurant=$scope.restaurant;MainNavigationService.restaurant=$scope.restaurant;$scope.open=$scope.restaurant.open();document.title=$scope.restaurant.name+' | Food Delivery | Order from '+(community.name?community.name:'Local')+' Restaurants | Crunchbutton';var process=function(){order.init();giftcard.notes_field.id_restaurant=$scope.restaurant.id_restaurant;giftcard.notes_field.restaurant_accepts=($scope.restaurant.giftcard>0);var position=PositionsService;var address=position.pos();if(!order.account.user||order.account.user.address==''){if(address.type()=='user'&&address.valid('order')){if(order._useCompleteAddress){$scope.order.form.address=address.formatted();}else{$scope.order.form.address=address.entered();}}}
$scope.order.cart.items=order.cart.getItems();$rootScope.$safeApply(function($scope){});$scope.ignoreGiftCardWithCashOrder=false;$scope.getFoodButton();}
setTimeout(function(){$('body').addClass('page-restaurant-loaded');process();$scope.$on('UserRestaurantInfoLoaded',function(e,data){UserRestaurantInfoLoaded=true;validateGiftCard=true;credit.processCredit(parseFloat(data.credit));giftcard.notes_field.processJson(data.giftcard);var id_preset=data.id_preset;OrderService.account.checkPresetUpdate(id_preset,$scope.restaurant.id_restaurant,function(){order.resetCart();process();});});var UserRestaurantInfoLoaded=false;order.loadUserRestaurantInfo(function(json){$rootScope.$broadcast('UserRestaurantInfoLoaded',json);});});});$('.config-icon').addClass('config-icon-mobile-hide');$('.nav-back').addClass('nav-back-show');$('.content').removeClass('smaller-width');$('.content').removeClass('short-meal-list');if(RestaurantService.basicInfo){$scope.$on('$routeChangeSuccess',function(event){setTimeout(function(){restaurantService.init();updateStatus();},200);});}else{restaurantService.init();updateStatus();}
var forceReload=function(){forceReloadTimer=$timeout(function(){if(!order.loaded){restaurantService.init();updateStatus();forceReload();$rootScope.$safeApply();}else{$rootScope.$safeApply();}},1000*10);};forceReload();});NGApp.controller('OrderCtrl',function($scope,$http,$location,$routeParams,$filter,AccountService,AccountModalService,OrderViewService,ReferralService){App.busy.unBusy();if(!AccountService.isLogged()){$location.path('/');return;}
$scope.account={user:AccountService.user,has_auth:AccountService.user.has_auth};$scope.modal={signupOpen:AccountModalService.signupOpen};$scope.order={};$scope.restaurant={};$scope.width=$(window).width();$scope.Math=window.Math;OrderViewService.load();$scope.isMobile=App.isMobile();$scope.facebook=function(){OrderViewService.facebook.postOrder();}
$scope.referral={invite_url:ReferralService.invite_url,value:ReferralService.value,enabled:ReferralService.enabled}
if(!ReferralService.invite_url){ReferralService.getStatus();}
$scope.$on('orderShared',function(e,data){$scope.order.reward.shared=true;$scope.$safeApply();});$scope.$on('referralStatusLoaded',function(e,data){$scope.referral.invite_url=ReferralService.invite_url;$scope.referral.invite_url_cleared=ReferralService.value;$scope.referral.value=ReferralService.value;$scope.referral.enabled=ReferralService.enabled;});$scope.$on('OrderViewLoadedOrder',function(e,order){$scope.$safeApply(function(){$scope.order=order;});});$scope.referral.cleaned_url=function(){return ReferralService.cleaned_url();}
$scope.print=function(){window.open('http://google.com','_blank');$('.order-print').get(0).contentWindow.document.body.innerHTML=$('.order-print-content').html();$('.order-print').get(0).contentWindow.print();};if(App.busy.isBusy()){setTimeout(function(){App.busy.unBusy();},500);}});NGApp.controller('OrdersCtrl',function($scope,$http,$location,AccountService,AccountSignOut,OrdersService,AccountModalService,ReferralService,FacebookService){if(!AccountService.isLogged()){$location.path('/');return;}
$scope.account=AccountService;$scope.signout=AccountSignOut.signout;$scope.facebook=AccountModalService.facebookOpen;$scope.modal=AccountModalService;$scope.orders=[];$scope.orders.restaurant=OrdersService.restaurant;$scope.orders.receipt=OrdersService.receipt;if(OrdersService.reload){OrdersService.load();}else{$scope.orders.list=OrdersService.list;OrdersService.checkUpdate();}
$scope.$on('OrdersLoaded',function(e,data){$scope.orders.list=OrdersService.list;});$scope.referral={invite_url:ReferralService.invite_url,value:ReferralService.value,limit:ReferralService.limit,invites:ReferralService.invites,enabled:ReferralService.enabled}
$scope.referral.cleaned_url=function(){return ReferralService.cleaned_url();}
if(!ReferralService.invite_url){ReferralService.getStatus();}
$scope.$on('referralStatusLoaded',function(e,data){$scope.referral.invites=ReferralService.invites;$scope.referral.limit=ReferralService.limit;$scope.referral.invite_url=ReferralService.invite_url;$scope.referral.value=ReferralService.value;$scope.referral.enabled=ReferralService.enabled;});$scope.referral.facebook=function(){FacebookService.postInvite($scope.referral.invite_url);}
$scope.referral.twitter=function(){window.open('https://twitter.com/intent/tweet?url='+$scope.referral.invite_url+'&text=#nom','_system');}});NGApp.controller('GiftcardCtrl',function($scope,$location,GiftCardService){setTimeout(function(){GiftCardService.open();},300);});NGApp.controller('AccountModalHeaderCtrl',function($scope,$http,AccountModalService,AccountService,AccountHelpService){$scope.modal=AccountModalService;$scope.account=AccountService;$scope.help=AccountHelpService;$scope.resetModal=function(){$scope.modal.toggleSignForm('signin');$scope.help.show(false);}});NGApp.controller('AccountSevenCtrl',function($scope,$http,AccountModalService,AccountService,AccountHelpService,AccountFacebookService){$scope.tab='facebook'
$scope.account=AccountService;$scope.help=AccountHelpService;$scope.facebook=AccountFacebookService;$scope.changeTab=function(tab){$scope.account.errorReset();$scope.help.reset();$scope.tab=tab;}
$scope.resetModal=function(){$scope.changeTab('facebook');}
$scope.$on('facebookIdAlreadyUsed',function(e,data){$scope.facebook.facebook.wait=false;$scope.account.errors.push('Sorry, It seems the facebook user is already related with other user.');});});NGApp.controller('AccountFacebookCtrl',function($scope,$http,AccountModalService,AccountService,AccountHelpService){$scope.modal=AccountModalService;});NGApp.controller('AccountSignInCtrl',function($scope,$http,AccountModalService,AccountService,AccountHelpService,AccountFacebookService){$scope.modal=AccountModalService;$scope.account=AccountService;$scope.help=AccountHelpService;$scope.facebook=AccountFacebookService;});NGApp.controller('AccountSignUpCtrl',function($scope,$http,AccountModalService,AccountService){$scope.modal=AccountModalService;$scope.account=AccountService;$scope.$watch('account.user',function(newValue,oldValue,scope){$scope.account.user=newValue;if(newValue){$scope.modal.header=false;}});});NGApp.controller('AccountResetCtrl',function($scope,$http,$location,AccountResetService,AccountModalService){if($location.path().indexOf('reset')>=0){$scope.reset=AccountResetService;AccountModalService.resetOpen();$location.path('/');}});NGApp.controller('GiftCardCtrl',function($scope,$http,$rootScope,GiftCardService){$scope.giftcard={};$scope.user=GiftCardService.account.user;$scope.modal=GiftCardService.modal;$scope.giftcard.value=GiftCardService.value;$scope.giftcard.message=GiftCardService.message;$rootScope.$on('GiftCardProcessed',function(e,data){$scope.user=GiftCardService.account.user;$scope.giftcard.value=GiftCardService.value;$scope.giftcard.message=GiftCardService.message;$scope.modal=GiftCardService.modal;});});NGApp.controller('MainHeaderCtrl',function($scope,$rootScope,$timeout,MainNavigationService,OrderService){$scope.navigation=MainNavigationService;$scope.order=OrderService;$scope.cart={blink:false};$scope.$watch('navigation.page',function(newValue,oldValue,scope){$scope.navigation.control();$scope.navigation.getFood(false);});$scope.$on('itemAdded',function(e,data){$scope.cart.blink=true;$timeout(function(){$scope.cart.blink=false;},1000);});});NGApp.controller('BottomCtrl',function($scope,MainNavigationService,OrderService){$scope.navigation=MainNavigationService;});NGApp.controller('RecommendRestaurantCtrl',function($scope,$http,$rootScope,RecommendRestaurantService,AccountService,AccountModalService){$scope.recommend=RecommendRestaurantService;$scope.account=AccountService;$scope.modal=AccountModalService;$scope.signupOpen=function(){AccountService.forceDontReloadAfterAuth=true;AccountModalService.signupOpen();}
$rootScope.$on('userCreated',function(e,data){RecommendRestaurantService.relateUser();});});NGApp.controller('RestaurantClosedCtrl',function($scope,$rootScope){$rootScope.$on('restaurantClosedClick',function(e,r){if($scope.$$phase){$scope.restaurant=r;$scope.closedMessage=r.closedMessage();$scope.active=(r.inactive?false:true);$scope.acceptingOrders=(parseInt(r.open_for_business)>0);App.dialog.show('.restaurant-closed-container');}else{$rootScope.$apply(function(scope){scope.restaurant=r;scope.closedMessage=r.closedMessage();$scope.active=(r.inactive?false:true);$scope.acceptingOrders=(parseInt(r.open_for_business)>0);App.dialog.show('.restaurant-closed-container');});}});});NGApp.controller('RecommendFoodCtrl',function($scope,$http,RecommendFoodService){$scope.recommend=RecommendFoodService;});NGApp.controller('SupportCtrl',function($scope,$http,SupportService){$scope.support=SupportService;});NGApp.controller('SideMenuCtrl',function(){});NGApp.controller('NotificationAlertCtrl',function($scope,$rootScope){$rootScope.$on('notificationAlert',function(e,title,message,fn){var complete=function(){$rootScope.closePopup();if(typeof fn==='function'){fn();}};$rootScope.$safeApply(function(scope){scope.title=title;scope.message=message;scope.complete=complete;App.dialog.show('.notification-alert-container');});});});NGApp.controller('InviteCtrl',function($scope,$routeParams,$location,ReferralService){$.cookie('referral',$routeParams.id);$location.path('/');});NGApp.controller('NoInternetCtrl',function($scope){$.cookie('referral',$routeParams.id);$location.path('/');});;;NGApp.filter('formatPhone',function(){return function(input){if(input!=null){input=input.replace(/^0|^1/,'');input=input.replace(/[^\d]*/gi,'');input=input.substr(0,10);if(input.length>=7){input=input.replace(/(\d{3})(\d{3})(.*)/,"$1-$2-$3");}else if(input.length>=4){input=input.replace(/(\d{3})(.*)/,"$1-$2");}}
return input;};});NGApp.filter('formatPrice',function(){return function(input){if(input!=null){input=parseFloat(input).toFixed(2)}
return input;};});NGApp.filter('nl2br',function(){return function(input){if(input!=null){return input.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,'$1<br/>$2');}
return input;};});NGApp.filter('clearAddress',function(){return function(input){if(input!=null){return input.replace(/#/g,'');}
return input;};});NGApp.filter('nl2cm',function(){return function(input){if(input!=null){return input.replace(/\r/g,'').replace(/\n/g,', ');}
return input;};});NGApp.filter('callPhone',function(){return function(input){if(input!=null){if(App.isMobile()){return'<a href="tel:'+App.phone.format(phone).replace(/\-/g,'')+'">'+phone+'</a>';}}
return input;};});NGApp.filter('iif',function(){return function(input,trueValue,falseValue){return input?trueValue:falseValue;};});;NGApp.directive('ngResizeText',[function(){return{restrict:'A',link:function(scope,element,attrs){elements=$(element);var resize=function(){var el,_len;if(elements.length<0){return;}
elements.css('font-size','').removeClass('resized');var _results=[];for(var _i=0,_len=elements.length;_i<_len;_i++){el=elements[_i];_results.push((function(el){var resizeText=function(){var elNewFontSize;elNewFontSize=(parseInt($(el).css('font-size').slice(0,-2))-1)+'px';return $(el).css('font-size',elNewFontSize);};var _results1=[];while(el.scrollHeight>el.offsetHeight){_results1.push(resizeText());}
return _results1;})(el));}
elements.addClass('resized');return _results;};setTimeout(resize,1);$(window).bind('resize',resize);scope.$on('$destroy',function(){$(window).unbind('resize',resize);});}};}]);NGApp.directive('ngBindHtmlUnsafe',[function(){return function(scope,element,attr){element.addClass('ng-binding').data('$binding',attr.ngBindHtmlUnsafe);scope.$watch(attr.ngBindHtmlUnsafe,function ngBindHtmlUnsafeWatchAction(value){element.html(value||'');});}}]);NGApp.directive('addToCart',function(OrderService){return{restrict:'A',link:function(scope,element,attrs){element.bind('click',function(e){if(!OrderService.restaurant._open){return;}
if(App.isUI2()){setTimeout(function(){var el=$(element.get(0));var animate=$('<div class="animate-cart-add">').css({top:el.position().top+20});animate.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd',function(){$(this).remove();});animate.appendTo('body');animate.css({top:15,left:$(document).width()-50,width:44,height:28,opacity:.3});},0);}
setTimeout(function(){scope.order.cart.add(attrs.idDish);scope.$apply();},0);});}};});NGApp.directive('spinnerLoading',function(){return{restrict:'AE',replace:true,template:'<div class="content-padding"><div class="divider"><div ng-show="!ready"><span><i class="fa fa-circle-o-notch fa-spin"></i> Loading</span></div></div></div>'}});NGApp.directive('hackExpandContent',function(){return{restrict:'AE',replace:true,template:'<div class="divider"><table class="tb-hack"><tr><td class="td-large"></td><td></td></tr></table></div>'}});NGApp.directive('facebookSigninButton',function(AccountFacebookService){return{restrict:'A',templateUrl:'assets/view/account.facebook.html',scope:{title:'@'},controller:function($scope){$scope.facebook=AccountFacebookService;}};;});NGApp.directive('restaurantIsClosed',function(){return{restrict:'A',templateUrl:'assets/view/restaurant.closed.inline.html'};});NGApp.directive('preLoadImage',function(){return function(scope,element,attrs){if(attrs.preLoad){var image=new Image();image.src=attrs.preLoad;}};});NGApp.directive('suggestionToolTip',function(){return{restrict:'A',templateUrl:'assets/view/restaurant.suggestion.tooltip.html',scope:{type:'@'},controller:function($scope){$scope.show=false;}};;});NGApp.directive('ngEnter',function(){return function(scope,element,attrs){element.bind('keydown keypress',function(event){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.ngEnter);});event.preventDefault();}});};});NGApp.directive('ngClickSelectAll',function(){return{restrict:'A',link:function(scope,element,attrs){element.bind('click',function(){element.select();});}};});NGApp.directive('customCheckbox',function(){return{restrict:'A',require:'ngModel',replace:true,template:'<span class="custom-checkbox fa fa-square"></span>',link:function(scope,elem,attrs,ctrl){var label=angular.element('label[for="'+attrs.id+'"]');label.bind('click',function(){scope.$apply(function(){elem.toggleClass('checked');ctrl.$setViewValue(elem.hasClass('checked'));if(elem.hasClass('checked')){elem.removeClass('fa-square');elem.addClass('fa-check-square');}else{elem.addClass('fa-square');elem.removeClass('fa-check-square');}});});elem.bind('click',function(){scope.$apply(function(){elem.toggleClass('checked');ctrl.$setViewValue(elem.hasClass('checked'));if(elem.hasClass('checked')){elem.removeClass('fa-square');elem.addClass('fa-check-square');}else{elem.addClass('fa-square');elem.removeClass('fa-check-square');}});});ctrl.$render=function(){if(!elem.hasClass('checked')&&ctrl.$viewValue){elem.addClass('checked');elem.removeClass('fa-square');elem.addClass('fa-check-square');}else if(elem.hasClass('checked')&&!ctrl.$viewValue){elem.removeClass('checked');elem.addClass('fa-square');elem.removeClass('fa-check-square');}};}}});NGApp.directive('ngBlur',function(){return{restrict:'A',link:function(scope,element,attrs){element.bind('blur',function(){scope.$apply(attrs.ngBlur);});}};});NGApp.directive('ngInstant',function(){return function(scope,element,attrs){element.bind(App.isMobile()?'touchstart':'click',function(e){scope.$apply(attrs['ngInstant'],element);if(typeof attrs.instantPassThru==='undefined'){e.preventDefault();e.stopPropagation();}});};});NGApp.directive('ngKeyDown',function(){return{restrict:'A',link:function(scope,elem,attr){angular.element(elem).bind('keydown',function(evt){scope.$eval(attr.ngKeyDown);});}};});NGApp.directive('ngKeyUp',function(){return{restrict:'A',link:function(scope,elem,attr){angular.element(elem).bind('keyup',function(evt){scope.$eval(attr.ngKeyUp);});}};});NGApp.directive('ngScrollSpy',function(){return{restrict:'A',link:function(scope,elem,attr){var sp={min:-300,max:50,onEnter:function(element,position){$('.nav-top').addClass('at-top');},onLeave:function(element,position){$('.nav-top').removeClass('at-top');}};$(elem).scrollspy(sp);sp.container=$('.snap-content-inner');$(elem).scrollspy(sp);if(App.isPhoneGap){var sp={min:-300,max:-40,onEnter:function(element,position){$('body').addClass('hidden-logo');},onLeave:function(element,position){$('body').removeClass('hidden-logo');},container:$('.snap-content-inner')};$(elem).scrollspy(sp);var sp={min:-135,max:-90,onEnter:function(element,position){$('.snap-content-inner.bg').addClass('step-two');},onLeave:function(element,position){$('.snap-content-inner.bg').removeClass('step-two');},container:$('.snap-content-inner')};$(elem).scrollspy(sp);var sp={min:-300,max:-130,onEnter:function(element,position){$('.snap-content-inner.bg').addClass('step-three');},onLeave:function(element,position){$('.snap-content-inner.bg').removeClass('step-three');},container:$('.snap-content-inner')};$(elem).scrollspy(sp);}}};});NGApp.directive('ngBindOnce',function($timeout){return{scope:true,link:function($scope,$element){$timeout(function(){$scope.$destroy();},0);}}});NGApp.directive('ngSpinner',function(){return{restrict:'A',link:function(scope,elem,attr){setTimeout(function(){var spinner=Ladda.create(elem.get(0));elem.data('spinner',spinner);if(attr.spinnerAutostart&&attr.spinnerAutostart!='false'){$(elem).click(function(){spinner.start();});}},1);}};});NGApp.directive('ngAutosize',function(){return{restrict:'A',link:function(scope,elem,attr){setTimeout(function(){elem.addClass('autosize');elem.data('autosize',elem.autosize());},800);}};});NGApp.directive('ngSimulateReadOnly',function(){return{restrict:'A',link:function(scope,elem,attr){if(App.isMobile()||App.isPhoneGap){angular.element(elem).bind('click keyup keydown change focus',function(evt){elem.val(attr.ngSimulateReadOnly);elem.select();});}else{elem.attr('readonly','readonly');angular.element(elem).bind('click',function(evt){elem.select();});}}};});NGApp.directive('ngFormatPhone',function($filter){return function(scope,element,attrs){element.bind('keyup',function(event){element.val($filter('formatPhone')(element.val()));});};});NGApp.directive('ngToggle',function(){return{restrict:'A',link:function(scope,elem,attr){elem.bind('click',function(event){setTimeout(function(){$(document).one('click',function(e){if(e.target==event.target){return;}
scope.$apply(function(){scope[attr.ngToggle]=false;});});},0);scope.$apply(function(){scope[attr.ngToggle]=true;});});}};});NGApp.directive('modalReset',function($rootScope){return{restrict:'A',link:function(scope,element,attrs){scope.$on('modalClosed',function(e,data){if(attrs.modalReset){scope.$eval(attrs.modalReset);}});}}});NGApp.directive('geoComplete',function(){return{restrict:'A',scope:{ngModel:'=',geoCompleteEnter:'&'},link:function(scope,element,attrs){var el=document.getElementById(attrs.id);if(typeof google=='object'&&google.maps&&google.maps.places&&google.maps.places.Autocomplete){var autoComplete=new google.maps.places.Autocomplete(el,{types:['establishment','geocode']});google.maps.event.addListener(autoComplete,'place_changed',function(){$('body').scrollTop(0);var place=autoComplete.getPlace();scope.$apply(function(){scope.ngModel=el.value;setTimeout(function(){scope.geoCompleteEnter();},5);});});}}};});NGApp.directive('phoneValidate',function(){return{restrict:'A',require:'ngModel',link:function(scope,elem,attrs,ctrl){elem.on('blur',function(evt){scope.$apply(function(){var val=elem.val();var isValid=false;var phoneVal=val.replace(/[^0-9]/g,'');if(phoneVal&&phoneVal.length==10){var phoneVal=phoneVal.split(''),prev;for(x in phoneVal){if(!prev){prev=phoneVal[x];continue;}
if(phoneVal[x]!=prev){isValid=true;}}}
ctrl.$setValidity('phoneValidate',isValid);});});}};});NGApp.directive('socialSecurityNumberValidate',function(){return{restrict:'A',require:'ngModel',link:function(scope,elem,attrs,ctrl){elem.on('blur',function(evt){scope.$apply(function(){var val=elem.val().replace(/[^0-9]/g,'');var regex=new RegExp("^(?!(219)(09)(9999)|(078)(05)(1120))(?!666|000|9\\d{2})\\d{3}(?!00)\\d{2}(?!0{4})\\d{4}$");var isValid=regex.test(val);ctrl.$setValidity('socialSecurityNumberValidate',isValid);});});}};});NGApp.directive('isBiggerThanZero',function(){return{restrict:'A',require:'ngModel',link:function(scope,elem,attrs,ngModel){attrs.$observe('isBiggerThanZero',function(){validate();});scope.$watch(attrs.ngModel,function(){validate();});var validate=function(){var isValid=false;if(attrs.isBiggerThanZero==='true'||attrs.isBiggerThanZero===true){if(parseInt(ngModel.$viewValue)>0){isValid=true;}}else{isValid=true;}
ngModel.$setValidity('isBiggerThanZero',isValid);};}}});NGApp.directive('equals',function(){return{restrict:'A',require:'?ngModel',link:function(scope,elem,attrs,ngModel){if(!ngModel)return;elem.bind('blur',function(evt){scope.$apply(function(){validate();});});elem.bind('change',function(evt){scope.$apply(function(){validate();});});scope.$watch(attrs.ngModel,function(){validate();});attrs.$observe('equals',function(val){validate();});attrs.$observe(ngModel,function(val){validate();});var validate=function(){var val1=ngModel.$viewValue;var val2=attrs.equals;if(val1&&val2){ngModel.$setValidity('equals',val1===val2);}else{ngModel.$setValidity('equals',true);}};}}});NGApp.directive('isUnique',function($resource,$timeout){return{restrict:'A',require:'ngModel',link:function(scope,elem,attrs,ctrl){elem.on('blur',function(evt){scope.$apply(function(){var val=elem.val();var verify=false;switch(attrs.isUnique){case'email':case'phone':case'login':verify=true;break;}
if(!verify){ctrl.$setValidity('isUnique',false);return;}
if(val==''){return;}
if(scope.driver&&scope.driver.name){var name=scope.driver.name;}else{var name=null;}
if(scope.driver&&scope.driver.id_admin){var id_admin=scope.driver.id_admin;}else{var id_admin=null;}
var unique=$resource(App.service+'unique/:property/:value',{property:'@property',value:'@value'},{'check':{'method':'POST',params:{}}});unique.check({property:attrs.isUnique,value:val,name:name,id_admin:id_admin},function(json){if(json&&json.canIUse){ctrl.$setValidity('isUnique',true);}else{ctrl.$setValidity('isUnique',false);}});});});}};});NGApp.directive('splashPositionFix',function(){return{restrict:'A',link:function($scope,elem,attrs,ctrl){$scope.$watch('windowHeight',function(newValue,oldValue,scope){if(newValue!=oldValue){setTimeout(function(){App.rootScope.reload();},100);}});var bottomText=false;var greenOrange=false;var fixPosition=function(){var element=function(selector){var element=angular.element(selector);return{top:function(){var marginTop=parseInt(element.css('marginTop'));return parseInt(element.offset().top+marginTop);},reset:function(){element.css({'marginTop':0});element.css({'top':element.offset().top});},height:function(){if(!element.attr('fixed-height')){element.attr('fixed-height',element.height());element._height=element.height();}
return parseInt(element.attr('fixed-height'));},bottom:function(){return parseInt(this.top())+parseInt(this.height());},setTop:function(top){element.css({'marginTop':top});}}};if(!bottomText&&!greenOrange){bottomText=element('.splash-bottom');greenOrange=element('.about-green-orange-scene');}
bottomText.reset();greenOrange.reset();var distance=bottomText.top()-greenOrange.bottom();var maxDistance=70;var minDistance=15;var step=5;var windowHeight=$scope.windowHeight-maxDistance;var calcPosition=function(){var ok=false;var top=maxDistance;var watchDog=100;while(!ok){var test_top=bottomText.bottom()+top+minDistance;if(test_top<=windowHeight){bottomText.setTop(top);ok=true;}
top-=step;watchDog--;if(watchDog<=0){ok=true;continue;}}}
var distance=bottomText.top()-greenOrange.bottom();if(distance<maxDistance){calcPosition();}
var distance=bottomText.top()-greenOrange.bottom();if(distance<minDistance){greenOrange.setTop(-minDistance);}
return;}
setTimeout(function(){fixPosition();},10);}}});NGApp.directive('ignoreMouseWheel',function($rootScope){return{restrict:'A',link:function(scope,element,attrs){element.bind('mousewheel',function(event){element.blur();});}}});NGApp.directive('positiveOrNegativeColor',function($rootScope){return{restrict:'A',link:function(scope,element,attrs){attrs.$observe('positiveOrNegativeColor',function(value){element.removeClass('positive negative neutral');var value=parseFloat(attrs.positiveOrNegativeColor);if(value>0){element.addClass('positive');}else if(value<0){element.addClass('negative');}else{element.addClass('neutral');}});}}});NGApp.directive('navigationBack',function(){return{restrict:'AE',replace:true,template:'<div ng-click="navigation.back();" class="back-button orange link"><i class="fa fa-chevron-left"></i> Back</div>',link:function(scope,elem,attrs,ctrl){var navigation=scope.navigation;}}});;NGApp.factory('AccountService',function($http,$rootScope,PositionsService){var service={callback:false,user:false,form:{email:'',password:''}};service.errors=[];service.errorReset=function(){service.errors=[];}
service.errorsList={'enter-email-phone':'Please enter a valid email or phone.','enter-password':'Please enter your password.','login-incorrect':'Your log in information was incorrect.','already-registred':'It seems that the email is already registered!','not-registred':'Sorry, that email/phone is not registered with us.','enter-code':'Please enter the reset code.','code-invalid':'Sorry, this code is invalid.','code-expired':'Sorry, this code is expired.'};service.reset=function(){service.form.email='';service.form.password='';}
service.checkUser=function(){if(service.isLogged()){service.user=App.config.user;$rootScope.$safeApply();}else{service.updateInfo();}}
service.isLogged=function(){if(App.config.user&&App.config.user.id_user!=''){service.user=App.config.user;}
if(service.user){if(service.user.id_user!=''){return true;}}
return false;}
service.enter=function(){service.errorReset();if(!service.isValidEmailPhone()){service.errors.push(service.errorsList['enter-email-phone']);$rootScope.focus('.signin-email');return;}
if(!service.isValidPassword()){service.errors.push(service.errorsList['enter-password']);$rootScope.focus('.signin-password');return;}
service.purify();var url=App.service+'user/enter';$http({method:'POST',url:url,data:$.param({'email':service.form.email,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){service.errors.push(service.errorsList['login-incorrect']);App.rootScope.$safeApply();}else{service.user=data;service.updateInfo();if(service.callback){service.callback();service.callback=false;}else{$.magnificPopup.close();$rootScope.$broadcast('userAuth',service.user);}}});}
service.signin=function(){service.errorReset();if(!service.isValidEmailPhone()){service.errors.push(service.errorsList['enter-email-phone']);$rootScope.focus('.signin-email');return;}
if(!service.isValidPassword()){service.errors.push(service.errorsList['enter-password']);$rootScope.focus('.signin-password');return;}
service.purify();var url=App.service+'user/auth';$http({method:'POST',url:url,data:$.param({'email':service.form.email,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){service.errors.push(service.errorsList['login-incorrect']);App.rootScope.$safeApply();App.log.account({'error':data.error},'sign in error');}else{service.user=data;service.updateInfo();if(service.callback){service.callback();service.callback=false;}else{$.magnificPopup.close();$rootScope.$broadcast('userAuth',service.user);}}});}
service.signup=function(){service.errorReset();if(!service.isValidEmailPhone()){service.errors.push(service.errorsList['enter-email-phone']);$rootScope.focus('.signup-email');return;}
if(!service.isValidPassword()){service.errors.push(service.errorsList['enter-password']);$rootScope.focus('.signup-password');return;}
service.purify();var url=App.service+'user/create/local';$http({method:'POST',url:url,data:$.param({'email':service.form.email,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='user exists'){service.errors.push(service.errorsList['already-registred']);}
App.log.account({'error':data.error,'login':service.form.email},'sign up error');}else{service.updateInfo();service.user=data;if(service.callback){service.callback();service.callback=false;}else{$.magnificPopup.close();$rootScope.$broadcast('userCreated',service.user);$rootScope.$broadcast('userAuth',service.user);}}});}
service.updateInfo=function(data,callback){var url=App.service+'user';$http({method:'GET',url:url}).success(function(data){if(data.id_user!=''){service.user=data;App.config.user=data;$rootScope.$safeApply();}
if(callback){callback();}});}
service.checkPresetUpdate=function(id_preset,id_restaurant,callbackReload){var reload=false;if(id_preset&&id_preset>0){if(service.user.presets&&service.user.presets[id_restaurant]){if(service.user.presets[id_restaurant].id_preset!=id_preset){reload=true;}}else{reload=true;}}
if(reload){service.updateInfo(null,callbackReload);}}
service.purify=function(){service.form.email=$.trim(service.form.email);service.form.password=$.trim(service.form.password);}
service.isValidEmailPhone=function(){if(!App.phone.validate(service.form.email)){if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(service.form.email)){return false}}
return true;}
service.isValidPassword=function(){if(service.form.password){return service.form.password!='';}
return false;}
return service;});NGApp.factory('AccountHelpService',function($http,$rootScope,AccountService,AccountModalService){var service={visible:false,success:{visible:false,facebook:{visible:false}}};service.errors=[];service.errorReset=function(){service.errors=[];}
var account=AccountService;var modal=AccountModalService;service.show=function(show){service.success.visible=false;account.errorReset();service.errorReset();service.visible=show;modal.header=!show;if(show){service.reset();$rootScope.focus('.help-email');}else{$rootScope.focus('.signin-email');}}
service.reset=function(){service.errorReset();service.success.visible=false;service.success.facebook.visible=false;}
service.sendForm=function(){service.errorReset();if(!account.isValidEmailPhone()){service.errors.push(AccountService.errorsList['enter-email-phone']);$rootScope.focus('.help-email');return;}
var url=App.service+'user/reset';$http({method:'POST',url:url,data:$.param({'email':account.form.email}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='user is not registred'){service.errors.push(AccountService.errorsList['not-registred']);$rootScope.focus('.help-email');}}else{if(data.success='success'){service.success.visible=true;service.error=false;if(data.userHasFacebookAuth){help.success.facebook.visible=true;}}}});}
return service;});NGApp.factory('AccountModalService',function($http,$rootScope,FacebookService){var service={header:true,signin:true,signup:false,facebookLogin:false};service.facebook=FacebookService;service.signinOpen=function(){service.header=true;App.dialog.show('.account-container');service.toggleSignForm('signin');}
service.signupOpen=function(){service.header=true;App.dialog.show('.account-container');service.toggleSignForm('signup');}
service.facebookOpen=function(){service.header=false;App.dialog.show('.account-container');service.toggleSignForm('facebook');}
service.resetOpen=function(){App.dialog.show('.account-reset-container');}
service.toggleSignForm=function(form){service.facebook.account.errorReset();service.facebook.wait=false;service.signin=(form=='signin');service.signup=(form=='signup');service.facebookLogin=(form=='facebook');if(service.signin){if(!App.iOS()){$rootScope.focus('.signin-email');}}
if(service.signup){if(!App.iOS()){$rootScope.focus('.signup-email');}}}
service.headerIsVisible=function(){return service.header.visible;}
return service;});NGApp.factory('AccountFacebookService',function($http,FacebookService){var service={};service.facebook=FacebookService;service.account=service.facebook.account;service.auth=function(){service.facebook.wait=true;FB.login(service.facebook.processStatus,{scope:App.facebookScope});}
service.signout=function(callback){service.facebook.signout(callback);}
return service;});NGApp.factory('AccountSignOut',function($http,$rootScope,$location,AccountFacebookService,AccountService,MainNavigationService){var service={};service.facebook=AccountFacebookService;service.signoutConfirmed=function(button){if(button!=1){return;}
$.each(['token','location','locsv3','PHPSESSID','fbtoken','userEntered'],function(index,value){$.totalStorage(value,null);});var signout=function(){$http.get(App.service+'logout').success(function(data){$http.get(App.service+'config').success(function(data){$rootScope.$broadcast('userAuth',data.user);App.processConfig(data);});if(App.isPhoneGap){MainNavigationService.link('/splash');}else{MainNavigationService.link('/location');}}).error(function(){console.debug('couldnt log out',arguments)});AccountService.reset();};if(service.facebook.facebook.logged||service.facebook.facebook.account.user.facebook){try{service.facebook.signout();}catch(e){console.log('e',e);}
signout();}else{signout();}}
service.signout=function(){if(App.confirm('Confirm sign out?','Crunchbutton',service.signoutConfirmed)){service.signoutConfirmed(1);}}
return service;});NGApp.factory('AccountResetService',function($http,$location,AccountService){var service={step:1,form:{code:'',password:''},success:false,error:false};service.errors=[];service.errorReset=function(){service.errors=[];}
service.form.code=$location.path().replace('/reset','');service.form.code=service.form.code.replace('/','');service.validateCode=function(){service.errorReset();service.form.code=$.trim(service.form.code);if(service.form.code==''){service.errors.push(AccountService.errorsList['enter-code']);$('#account-reset-code').focus();return;}
var url=App.service+'user/code-validate';$http({method:'POST',url:url,data:$.param({'code':service.form.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='invalid code'){service.errors.push(AccountService.errorsList['code-invalid']);}
if(data.error=='expired code'){service.errors.push(AccountService.errorsList['code-expired']);}
$('#account-reset-code').focus();return;}else{if(data.success='valid code'){service.step=2;}}});}
service.changePassword=function(){service.errorReset();service.form.password=$.trim(service.form.password);if(service.form.password==''){service.errors.push(AccountService.errorsList['enter-password']);$('#account-reset-password').focus();return;}
var url=App.service+'user/change-password';$http({method:'POST',url:url,data:$.param({'code':service.form.code,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){service.errors.push(AccountService.errorsList['code-invalid']);service.step=1;return;}else{if(data.success='password changed'){service.success=true;}}});}
return service;});;NGApp.factory('MainNavigationService',function($http,$location,$rootScope,$route,AccountModalService,RestaurantsService,OrderViewService){$rootScope.animationClass='';var service={page:'',buttons:{location:false,menu:true}};service.menu=App.toggleMenu;service.modal=AccountModalService;service.getFood=function(cartItems){if(service.page=='restaurant'&&cartItems&&service.restaurant&&service.restaurant&&service.restaurant._open&&!App.rootScope.notificationBarStatus){angular.element('.button-bottom-wrapper').addClass('button-bottom-show');}else{angular.element('.button-bottom-wrapper').removeClass('button-bottom-show');}}
service.home=function(){if(App.isPhoneGap&&cordova){$('html, body, .snap-content-inner').animate({scrollTop:0},200,$.easing.easeInOutQuart?'easeInOutQuart':null);}else if(App.isMobile()){service.menu();}else{service.link();}}
service.goToRestaurants=function(){return service.link(RestaurantsService.permalink);}
service.link=function(path,transition){if(App.isNarrowScreen()||App.transitionForDesktop){App.rootScope.animationClass=transition?'animation-'+transition:'';}
$location.path(path||'/');App.snap.close();}
service.signin=function(){service.modal.signinOpen();}
service.control=function(){switch(service.page){case'restaurant':case'order':service.buttons.location=true;service.buttons.back=true;service.buttons.menu=false;if(OrderViewService.newOrder){service.buttons.back=false;service.buttons.menu=true;}
break;default:service.buttons.back=false;service.buttons.location=(service.page!='location');service.buttons.menu=true;break;}}
return service;});;NGApp.factory('RestaurantsService',function($http,$rootScope,PositionsService){var service={permalink:'food-delivery',forceLoad:true,forceGetStatus:false,cachedAt:false};var restaurants=false;service.reset=function(){restaurants=false;}
service.getRestaurants=function(){return restaurants;}
service.position=PositionsService;service.sort=function(){var list=restaurants;var areAllTheRestaurantsMinimized=true;var now=dateTime.getNow();var totalMaximized=0;for(var x in list){list[x]._divider=false;list[x].open(now);}
for(var x in list){if(list[x].openRestaurantPage(now,true)){list[x]._maximized=true;areAllTheRestaurantsMinimized=false;if(!list[x]._open){list[x].tagfy('opening');}else{list[x].tagfy();}
totalMaximized++;}else{list[x]._maximized=false;list[x].tagfy();}}
if(areAllTheRestaurantsMinimized){if(list&&list.sort){list.sort(sort_by({name:'_hasHours',reverse:true},{name:'_opensIn',primer:function(n){if(!isNaN(parseInt(n))){return parseInt(n);}else{return(16800*60);}},reverse:false},{name:'distance',primer:parseFloat,reverse:false},{name:'_weight',primer:parseFloat,reverse:true},{name:'name',reverse:false}));}}else{list.sort(sort_by({name:'_maximized',reverse:true},{name:'_open',reverse:true},{name:'_opensIn',primer:function(n){if(!isNaN(parseInt(n))){return parseInt(n);}else{return(16800*60);}},reverse:false},{name:'delivery',reverse:true},{name:'_weight',primer:parseFloat,reverse:true},{name:'distance',primer:parseFloat,reverse:false}));}
if(areAllTheRestaurantsMinimized){var tagRestaurantsAsClosing=3;var divider=false;for(var x in list){if(divider){list[x]._divider=true;divider=false;}
if(tagRestaurantsAsClosing<=0){continue;break;}
list[x].tagfy('opening');list[x]._maximized=true;tagRestaurantsAsClosing--;if(tagRestaurantsAsClosing===0){divider=true;}}}else{for(var x in list){if(!list[x]._maximized){var prev=x-1;if(list[prev]&&list[prev]._maximized){list[x]._divider=true;break;}}}}
restaurants=list;return restaurants;}
service.getStatus=function(){var now=dateTime.getNow();var list=restaurants;var areAllTheRestaurantsMinimized=true;var totalClosedRestaurantsAfter=0;var totalClosedRestaurantsBefore=0;for(var x in list){if(!list[x]._open){totalClosedRestaurantsBefore++;}else{areAllTheRestaurantsMinimized=false;}}
for(var x in list){if(list[x].openRestaurantPage(now,true)){areAllTheRestaurantsMinimized=false;totalClosedRestaurantsBefore++;if(!list[x]._open){list[x].tagfy('opening');}else{list[x].tagfy();}}else{list[x]._maximized=false;list[x].tagfy();}}
restaurants=list;if(areAllTheRestaurantsMinimized||(totalClosedRestaurantsAfter!=totalClosedRestaurantsBefore)){service.sort();}
service.reloadHours();return restaurants;}
service.reloadHours=function(){var now=(Math.floor(new Date().getTime()/1000));var age=Math.floor(now-service.cachedAt);if(age>=((60*60)*23)){service.cachedAt=now;for(var x in restaurants){restaurants[x].reloadHours(true);}}}
service.removeInactive=function(id_restaurant){var list=[];for(var x in restaurants){if(restaurants[x].id_restaurant!=id_restaurant){list.push(restaurants[x]);}}
restaurants=list;}
service.list=function(success,error){if(!service.position.pos().valid('restaurants')){if(error){error();}
return false;}
if(restaurants===false||service.forceLoad){var url=App.service+'restaurants?lat='+service.position.pos().lat()+'&lon='+service.position.pos().lon()+'&range='+(service.position.range||2);service.forceGetStatus=false;$http.get(url,{cache:false}).success(function(data){service.cachedAt=(Math.floor(new Date().getTime()/1000));service.community_closed=data.community_closed;var list=[];if(typeof data.restaurants=='undefined'||data.restaurants.length==0){if(error){error();return false;}}else{for(var x in data.restaurants){list[list.length]=new Restaurant(data.restaurants[x]);}
restaurants=list;if(success){success(list);}
return list;}});service.forceLoad=false;}else{if(success){success(restaurants);}
return restaurants;}}
$rootScope.$on('NewLocationAdded',function(e,data){service.forceLoad=true;restaurants=false;});return service;});NGApp.factory('CommunityService',function($http){var service={};service.getById=function(id){for(x in App.communities){if(App.communities[x].id_community==id){return App.communities[x];}}
return false;}
return service;});NGApp.factory('RestaurantService',function($http,$routeParams,$rootScope,CommunityService){var service={basicInfo:null,loadedList:{},initied:{}};service.alreadyLoaded=function(){return(service.loadedList[$routeParams.id]?true:false);}
service.init=function(){if(service.initied[$routeParams.id]){return;}
service.initied[$routeParams.id]=true;App.cache('Restaurant',$routeParams.id,function(){service.initied[$routeParams.id]=false;var restaurant=this;service.loadedList[$routeParams.id]=true;var community=CommunityService.getById(restaurant.id_community);$rootScope.$broadcast('restaurantLoaded',{restaurant:restaurant,community:community});});}
return service;});;NGApp.factory('CommunityAliasService',function(PositionsService){var service={};service.position=PositionsService;service.removeCommunityStyle=function(){if(service.style){angular.element('html').removeClass(service.style);}}
service.communityStyle=function(permalink){service.removeCommunityStyle();service.style='community-'+permalink;angular.element('html').addClass(service.style);}
service.route=function(id,success,error){var parts=id.toLowerCase().split('/');var alias=false;var restaurant=false;if(App&&App.aliases){for(x in parts){if(parts[x]!=''){if(App.aliases[parts[x]]){alias=App.aliases[parts[x]];}else{restaurant=parts[x];}}}}
success=success||function(){};error=error||function(){};if(alias){var loc=App.locations[alias.id_community];if(loc.loc_lat&&loc.loc_lon){var res=new Location({lat:loc.loc_lat,lon:loc.loc_lon,type:'alias',verified:true,prep:alias.prep,city:alias.name_alt,address:alias.name_alt,permalink:alias.permalink,image:alias.image,});service.communityStyle(alias.permalink);success({alias:res},restaurant);return;}}
service.removeCommunityStyle();error();};return service;});;NGApp.factory('RecommendRestaurantService',function($http,PositionsService,AccountService){var service={form:{restaurant:''},greetings:false};service.position=PositionsService;service.account=AccountService;var recommendations=[];service.addRecommendation=function(id){recommendations.push(id);}
service.send=function(){if(service.form.restaurant==''){App.alert("Please enter the restaurant\'s name.");$('.recommend-restaurant').focus();return;}
var pos=service.position.pos();var content='Address entered: '+pos.entered()+'\n'+'Address reverse: '+pos.address()+'\n'+'City: '+pos.city()+'\n'+'Region: '+pos.region()+'\n'+'Lat: '+pos.lat()+'\n'+'Lon: '+pos.lon();var url=App.service+'suggestion/restaurant';$http({method:'POST',url:url,data:$.param({name:service.form.restaurant,content:content}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.greetings=true;if(!service.account.user.id_user){service.addRecommendation(data.id_suggestion);}
service.form.restaurant='';});}
service.getRecommendations=function(){if(recommendations.length>0){return recommendations;}
return false;}
service.relateUser=function(){if(service.getRecommendations()&&service.account.user.id_user){var url=App.service+'suggestion/relateuser';$.each(recommendations,function(index,value){var id_suggestion=value;$http({method:'POST',url:url,data:$.param({id_suggestion:id_suggestion,id_user:service.account.user.id_user}),headers:{'Content-Type':'application/x-www-form-urlencoded'}});});recommendations=false;}}
return service;});NGApp.factory('RecommendFoodService',function($http,$routeParams){var service={thanks:false,isSending:false,modal:{},form:{name:''}};service.reset=function(){service.thanks=false;service.isSending=false;service.form.name='';}
service.modal.open=function(){service.reset();App.dialog.show('.suggest-food-container');};service.send=function(){service.form.name=$.trim(service.form.name);if(service.form.name==''){App.alert('Please enter a suggestion.');$('#suggestion-name').focus();return;}
service.isSending=true;var url=App.service+'suggestion/new';$http({method:'POST',url:url,data:$.param({restaurant:$routeParams.id,name:service.form.name}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.thanks=true;service.isSending=false;});}
return service;});;NGApp.factory('SupportService',function($http,AccountService){var service={minimized:true,maximized:false,thanks:false,form:{}};service.account=AccountService;service.form.name=angular.copy(service.account.user.name);service.form.phone=angular.copy(service.account.user.phone);service.form.message='';service.dialog=function(){service.thanks=false;service.form.message='';App.dialog.show('.support-container');}
service.toggle=function(){service.minimized=!service.minimized;service.maximized=!service.maximized;if(service.maximized){$('.support-container').addClass('support-container-maximized');service.reset();}else{$('.support-container').removeClass('support-container-maximized');}}
service.reset=function(){service.form.message='';service.thanks=false;}
service.send=function(){service.purify();var error='';var errors=[];if(!service.form.name||!service.form.phone||!App.phone.validate(service.form.phone)||!service.form.message){error+='Please enter ';if(!service.form.name){errors[errors.length]='your name';}
if(!App.phone.validate(service.form.phone)){errors[errors.length]='a valid phone number';}
if(!service.form.message){errors[errors.length]='a message';}
for(var x in errors){error+=(x!=0?', ':'')+(errors.length>1&&x==errors.length-1?'and ':'')+errors[x]+(x==errors.length-1?'.':'');}}
if(error){service.error=error;if(!service.form.message){$('textarea[name=support-message]').focus();}
if(!App.phone.validate(service.form.phone)){$('input[name=support-phone]').focus();}
if(!service.form.name){$('input[name=support-name]').focus();}
return;}else{service.error='';}
if(!service.isSending){service.isSending=true;var url=App.service+'support/sms';$http({method:'POST',url:url,data:$.param({name:service.form.name,phone:service.form.phone,message:service.form.message}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.thanks=true;service.isSending=false;});}}
service.purify=function(){service.form.name=$.trim(service.form.name);service.form.phone=$.trim(service.form.phone);service.form.message=$.trim(service.form.message);}
return service;});;NGApp.factory('OrderService',function($http,$location,$rootScope,$filter,AccountService,CartService,LocationService,CreditService,GiftCardService,OrderViewService){var service={};service.location=LocationService;service.account=AccountService;service.cart=CartService;service.giftcard=GiftCardService;service.credit=CreditService;service.restaurant={};service.startStoreEntederInfo=false;$rootScope.$on('userAuth',function(e,data){service.account=AccountService;service.showForm=true;});service._previousTip=0;service.form={delivery_type:'delivery',pay_type:'card',make_default:true};service.showForm=true;service.loaded=false;service.info={dollarSign:'',breakdownDescription:'',extraCharges:'',deliveryMinDiff:'',cartSummary:'',totalText:'',creditLeft:''}
service.toogleDelivery=function(type){if(type!=service.form.delivery_type){service.form.delivery_type=type;if(service.form.delivery_type=='takeout'){service.form.tip=0;}
service.updateTotal();}}
service.tooglePayment=function(type){if(type!=service.form.pay_type){service.form.pay_type=type;service.updateTotal();}}
service.init=function(){if(service.account.user&&service.account.user.last_tip){var tip=service.account.user.last_tip;}else{var tip='autotip';}
service._deliveryAddressOk=false;service._tipHasChanged=false;service._cardInfoHasChanged=false;service._crunchSoundPlayded=false;service._useRestaurantBoundingBox=false;service._useCompleteAddress=false;service._completeAddressWithZipCode=true;service.form.pay_type=(service.account.user&&service.account.user.pay_type)?service.account.user.pay_type:'card';if(service.restaurant.credit!=1&&service.form.pay_type=='card'){service.form.pay_type='cash';}
if(service.restaurant.cash!=1&&service.form.pay_type=='cash'){service.form.pay_type='card';}
service.form.delivery_type=(service.account.user&&service.account.user.presets&&service.account.user.presets[service.restaurant.id_restaurant])?service.account.user.presets[service.restaurant.id_restaurant].delivery_type:'delivery';if(service.restaurant.delivery!=1){service.form.delivery_type='takeout';}
if(parseInt(service.restaurant.takeout)!=1&&service.form.delivery_type=='takeout'){service.form.delivery_type='delivery';}
if(parseInt(service.restaurant.takeout)!=1){service.form.delivery_type='delivery';}
service.form.autotip=0;service.form.tip=service._lastTipNormalize(tip);service.form.name=service.account.user.name;service.form.email=service.account.user.email;service.form.phone=$filter('formatPhone')(service.account.user.phone);service.form.address=service.account.user.address;service.form.notes=(service.account.user&&service.account.user.last_notes)?service.account.user.last_notes:'';if(service.form.delivery_type=='takeout'){service.form.tip=0;}
if(service.giftcard.code){service.form.notes+=' '+service.giftcard.code;}
service.form.cardNumber=service.account.user.card;service.form.cardMonth=(service.account.user.card_exp_month)?service.account.user.card_exp_month:'';service.form.cardYear=(service.account.user.card_exp_year)?service.account.user.card_exp_year:'';service.updateTotal();if(!service.account.user.id_user){var userEntered=$.totalStorage('userEntered');if(userEntered){service.form.name=(userEntered.name&&userEntered.name!=''?userEntered.name:service.form.name);service.form.phone=$filter('formatPhone')((userEntered.phone&&userEntered.phone!=''?userEntered.phone:service.form.phone));service.form.address=(userEntered.address&&userEntered.address!=''?userEntered.address:service.form.address);service.form.notes=(userEntered.notes&&userEntered.notes!=''?userEntered.notes:service.form.notes);service.form.delivery_type=(userEntered.delivery_type&&userEntered.delivery_type!=''?userEntered.delivery_type:service.form.delivery_type);service.form.pay_type=(userEntered.pay_type&&userEntered.pay_type!=''?userEntered.pay_type:service.form.pay_type);service.form.cardMonth=(userEntered.cardMonth&&userEntered.cardMonth!=''?userEntered.cardMonth:service.form.cardMonth);service.form.cardYear=(userEntered.cardYear&&userEntered.cardYear!=''?userEntered.cardYear:service.form.cardYear);if(userEntered.tip&&userEntered.tip!=''){var _tip=userEntered.tip;setTimeout(function(){service.form.tip=_tip;service.tipChanged();service.updateTotal();},10);}else{service.updateTotal();}}
service.startStoreEntederInfo=true;}
if(service.restaurant.delivery!=1){service.form.delivery_type='takeout';}
if(parseInt(service.restaurant.takeout)!=1&&service.form.delivery_type=='takeout'){service.form.delivery_type='delivery';}
if(parseInt(service.restaurant.takeout)!=1){service.form.delivery_type='delivery';}
if(service.account.user&&(service.form.delivery_type=='takeout'||(service.form.delivery_type=='delivery'&&service.account.user.address))){service.showForm=false;}else{service.showForm=true;}
if(service.cart.hasItems()){service.reloadOrder();}else if(service.account.user&&service.account.user.presets&&service.account.user.presets[service.restaurant.id_restaurant]){try{service.loadOrder(service.account.user.presets[service.restaurant.id_restaurant]);}catch(e){if(service.restaurant.preset){service.loadOrder(service.restaurant.preset());}}}else{if(service.restaurant.preset){service.loadOrder(service.restaurant.preset());}}
service.loaded=true;$rootScope.$broadcast('orderLoaded',true);}
service.resetCart=function(){service.cart.reset()}
service.reloadOrder=function(){var cart=service.cart.getCart();service.resetCart();service.loadFlatOrder(cart);}
service.loadFlatOrder=function(cart){for(var x in cart){service.cart.add(cart[x].id,{options:cart[x].options?cart[x].options:[]});}}
service.loadOrder=function(order){try{if(order){var dishes=order['_dishes'];for(var x in dishes){var options=[];for(var xx in dishes[x]['_options']){options[options.length]=dishes[x]['_options'][xx].id_option;}
if(App.cached.Dish[dishes[x].id_dish]!=undefined){service.cart.add(dishes[x].id_dish,{options:options});}}}}catch(e){console.log(e.stack);}}
service.extraChargesText=function(breakdown){var elements=[];var text='';if(breakdown.delivery){elements.push(service.info.dollarSign+breakdown.delivery.toFixed(2)+' delivery');}
if(breakdown.fee){elements.push(service.info.dollarSign+breakdown.fee.toFixed(2)+' fee');}
if(breakdown.taxes){elements.push(service.info.dollarSign+breakdown.taxes.toFixed(2)+' taxes');}
if(breakdown.tip&&breakdown.tip>0){elements.push(service.info.dollarSign+breakdown.tip.toFixed(2)+' tip');}
if(elements.length){if(elements.length>2){var lastOne=elements.pop();var elements=[elements.join(', ')];elements.push(lastOne);}
var text=elements.join(' & ');}
return text;}
service.subtotal=function(){return service.cart.subtotal();}
service.subtotalWithoutMarkup=function(){return service.cart.subtotalWithoutMarkup();}
service._breackDownDelivery=function(){var delivery=0;if(service.restaurant.delivery_fee&&service.form.delivery_type=='delivery'){delivery=parseFloat(service.restaurant.delivery_fee);}
delivery=App.ceil(delivery);return delivery;}
service._breackDownFee=function(feeTotal){var fee=0;if(service.restaurant.fee_customer){fee=(feeTotal*(parseFloat(service.restaurant.fee_customer)/100));}
fee=App.ceil(fee);return fee;}
service._breackDownTaxes=function(feeTotal){var taxes=(feeTotal*(service.restaurant.tax/100));return taxes;}
service._breakdownTip=function(total){var tip=0;if(service.form.pay_type=='card'){if(service.form.tip==='autotip'){return parseFloat(service.form.autotip);}
tip=(total*(service.form.tip/100));}
tip=App.ceil(tip);return tip;}
service.total=function(){var
total=0,dish,options,feeTotal=0,totalItems=0,finalAmount=0;var breakdown=this.totalbreakdown();total=breakdown.subtotal;feeTotal=total;feeTotal+=breakdown.delivery;feeTotal+=breakdown.fee;finalAmount=feeTotal+breakdown.taxes;finalAmount+=this._breakdownTip(total);return App.ceil(finalAmount).toFixed(2);}
service.charged=function(){var finalAmount=this.total();var credit=parseFloat(service.credit.value);if(service.form.pay_type=='card'&&credit){finalAmount=finalAmount-credit;if(finalAmount<0){finalAmount=0;}}
return App.ceil(finalAmount).toFixed(2);}
service.totalbreakdown=function(){var elements={};var total=this.subtotal();var totalWithoutMarkup=this.subtotalWithoutMarkup();var feeTotal=total;elements['subtotal']=this.subtotal();elements['subtotalWithoutMarkup']=this.subtotalWithoutMarkup();elements['delivery']=this._breackDownDelivery();feeTotal+=elements['delivery'];elements['fee']=this._breackDownFee(feeTotal);feeTotal+=elements['fee'];if(parseInt(service.restaurant.delivery_service)==0){totalWithoutMarkup+=elements['delivery'];}
elements['taxes']=this._breackDownTaxes(totalWithoutMarkup);elements['tip']=this._breakdownTip(total);return elements;}
service.submit=function(forceAddressOk){if(forceAddressOk){service._deliveryAddressOk=true;}else{service._deliveryAddressOk=false;}
service.processOrder();}
service.checkout=function(){service.scrollToForm();}
service.scrollToForm=function(){var walkTo=$('.snap-content-inner').scrollTop()+$('.payment-form').offset().top-60;$('html, body, .snap-content-inner').animate({scrollTop:walkTo},100,$.easing.easeInOutQuart?'easeInOutQuart':null);}
service.errors=function(errors){var error='';for(var x in errors){if(x!='debug'){error+='<li><i class="icon-li icon-warning-sign"></i>'+errors[x]+'</li>';}}
App.alert('<ul class="icons-ul">'+error+'</ul>');}
service.processOrder=function(){if(App.busy.isBusy()){return;}
service.local_gid=App.guid();App.busy.makeBusy(service.local_gid);if(service.form.address&&service.form.address!=''){service.form.address=service.location.ordinalReplace(service.form.address);}
var order={address:service.form.address,email:service.form.email,phone:service.form.phone,name:service.form.name,cart:service.cart.getCart(),pay_type:service.form.pay_type,delivery_type:service.form.delivery_type,restaurant:service.restaurant.id,make_default:service.form.make_default,notes:service.form.notes,lat:service.location.position.pos().lat(),lon:service.location.position.pos().lon(),local_gid:service.local_gid};if(order.pay_type=='card'){order.tip=service.form.tip;order.autotip_value=service.form.autotip;}
var displayErrors=function(errors){if(!$.isEmptyObject(errors)){service.scrollToForm();service.errors(errors);App.busy.unBusy();App.track('OrderError',errors);App.log.order({'errors':errors},'validation error');return true;}
return false;}
var errors={};if(!order.name){errors['name']='Please enter your name.';}
if(!App.phone.validate(order.phone)){errors['phone']='Please enter a valid phone #.';}
if(order.email&&!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(order.email)){errors['email']='Please enter a valid email.';}
if(order.delivery_type=='delivery'&&!order.address){errors['address']='Please enter an address.';}
if(order.pay_type=='card'&&((service._cardInfoHasChanged&&!service.form.cardNumber)||(!service.account.user.id_user&&!service.form.cardNumber)||(!service.form.cardNumber))){errors['card']='Please enter a valid card #.';}
if(order.pay_type=='card'&&((service._cardInfoHasChanged&&!service.form.cardMonth)||(!service.account.user.id_user&&!service.form.cardMonth)||(!service.form.cardMonth))){errors['card_month']='Please enter the card expiration month.';}
if(order.pay_type=='card'&&((service._cardInfoHasChanged&&!service.form.cardYear)||(!service.account.user.id_user&&!service.form.cardYear)||(!service.form.cardYear))){errors['card_year']='Please enter the card expiration year.';}
if(!service.cart.hasItems()){errors['noorder']='Please add something to your order.';}
var _total=service.restaurant.delivery_min_amt=='subtotal'?service.subtotal():service.total();if(service.restaurant.meetDeliveryMin(_total)&&service.form.delivery_type=='delivery'){errors['delivery_min']='Please meet the delivery minimum of $'+service.restaurant.delivery_min+'.';}
var er=displayErrors(errors);if(er){return;}
if(order.delivery_type=='delivery'){if(service.account&&service.account.user&&service.account.user.last_order){if(service.account.user.last_order.communities.indexOf(service.restaurant.id_community)>-1){var lastAddress=service.account.user.last_order.address;var currentAdress=service.form.address;if($.trim(lastAddress)!=''&&$.trim(lastAddress)==$.trim(currentAdress)){service._deliveryAddressOk=true;App.log.order({'address':lastAddress,'restaurant':service.restaurant.name},'legacy address');}}}
if(!service._deliveryAddressOk){if(service.location.bounding&&google&&google.maps&&google.maps.LatLng){var latLong=new google.maps.LatLng(service.location.bounding.lat,service.location.bounding.lon);}
if(service._useRestaurantBoundingBox){var latLong=new google.maps.LatLng(service.restaurant.loc_lat,service.restaurant.loc_long);}
if(!latLong){App.busy.unBusy();App.dialog.show('.address-not-found-warning');return;}
var success=function(results){var theClosestAddress=service.location.theClosestAddress(results,latLong);var isTheAddressOk=service.restaurant.id_restaurant==26?true:service.location.validateAddressType(theClosestAddress.result);if(isTheAddressOk){theClosestAddress=theClosestAddress.location;if(service.form.address!=theClosestAddress.formatted()){theClosestAddress.setEntered(service.form.address);}
var lat=theClosestAddress.lat();var lon=theClosestAddress.lon();if(service._useCompleteAddress){service.form.address=theClosestAddress.formatted();order.address=service.form.address;}
var distance=service.location.distance({from:{lat:lat,lon:lon},to:{lat:service.restaurant.loc_lat,lon:service.restaurant.loc_long}});distance=service.location.km2Miles(distance);if(!service.restaurant.deliveryHere(distance)){App.busy.unBusy();App.dialog.show('.address-out-of-range-warning');App.busy.unBusy();$rootScope.$safeApply(function(){service.showForm=true;if(!App.isPhoneGap){$('[name="pay-address"]').focus();}
service.form.address=theClosestAddress.formatted();});App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address out of delivery range');return;}else{if(service._completeAddressWithZipCode){var zipCode=theClosestAddress.zip();var typed_address=service.form.address;if(typed_address.indexOf(zipCode)<0){var addressWithZip=typed_address+' - '+zipCode;service.form.address=addressWithZip;}}
App.busy.unBusy();service._deliveryAddressOk=true;service.processOrder();}}else{App.dialog.show('.address-incomplete-warning');App.busy.unBusy();$rootScope.$safeApply(function(){service.showForm=true;$('[name="pay-address"]').focus();});App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address not found or invalid');}}
var error=function(){App.dialog.show('.address-incomplete-warning');App.busy.unBusy();App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address not found');};service.location.doGeocodeWithBound(order.address,latLong,success,error);return;}}
if(order.delivery_type=='takeout'){service._deliveryAddressOk=true;}
if(!service._deliveryAddressOk){return;}
var processOrder=function(card){if(card===false){}else if(!card.status){var er=displayErrors({process:card.error});return;}else{order.card={id:card.id,uri:card.uri,lastfour:card.lastfour,card_type:card.card_type,month:card.month,year:card.year};}
if(!service._crunchSoundPlayded){App.playAudio('crunch');service._crunchSoundPlayded=true;}
order.phone=order.phone.replace(/-/g,'');var url=App.service+'order';console.log('order',order);$http({method:'POST',url:url,data:$.param(order),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(json){try{if(json.uuid){var uuid=json.uuid;}else{console.error('Error',json);App.log.order(json,'processing error');if(!json.errors){json={status:'false',errors:['Sorry! An error has occurred trying to place your order! <br/> Please make sure your credit card info is correct!']};}
$rootScope.$broadcast('orderProcessingError',true);}}catch(e){console.error('Exception',e,json);App.log.order(json,'processing error');json={status:'false',errors:['Sorry! An error has occurred trying to place your order! <br/> Please make sure your credit card info is correct!']};$rootScope.$broadcast('orderProcessingError',true);}
if(json.status=='false'){service.errors(json.errors);App.track('OrderError',json.errors);App.log.order({'errors':json.errors},'validation error - php');}else{App.vibrate();if(json.token){$.cookie('token',json.token);}
$.totalStorage('userEntered',null);service.startStoreEntederInfo=false;service.account.updateInfo();var orderCached=false;var cacheOrder=function(){App.cache('Order',json.uuid,function(){orderCached=true;App.track('Ordered',{'id':json.uuid,'total':this.final_price,'subtotal':this.price,'tip':this.tip,'tax':service.info.taxes,'restaurant':service.restaurant.name,'id_restaurant':service.restaurant.id_restaurant,'paytype':this.pay_type,'ordertype':this.order_type,'user':this.user,'items':service.cart.totalItems(),'cart':service.cart.getItems()});service.cart.clean();service.updateTotal();service.giftcard.notes_field.reset();$rootScope.$safeApply(function(){$rootScope.$broadcast('newOrder');OrderViewService.newOrder=true;App.go('/order/'+uuid,'push');});});}
var laps=0;var watchDog=function(){if(laps>=30){return;}
if(!orderCached){cacheOrder();setTimeout(function(){watchDog();},500);}
laps++;}
watchDog();}});}
if(service._cardInfoHasChanged&&order.pay_type=='card'){App.tokenizeCard({name:service.form.name,number:service.form.cardNumber,expiration_month:service.form.cardMonth,expiration_year:service.form.cardYear,security_code:null},processOrder);}else{order.card={};processOrder(false);}}
service.tipChanged=function(){service._tipHasChanged=true;service._previousTip=service.form.tip;service.updateTotal();}
service.cardInfoChanged=function(){service._cardInfoHasChanged=true;}
service.updateTotal=function(){if(!service.restaurant.id_restaurant){return;}
service.info.totalText=service.info.dollarSign+service.charged();var tipText='',feesText='',totalItems=0,credit=parseFloat(service.credit.value),hasFees=((service.restaurant.delivery_fee&&service.form.delivery_type=='delivery')||service.restaurant.fee_customer)?true:false;for(var x in service.items){totalItems++;}
service._autotip();var wasTipChanged=false;if(service.form.delivery_type=='takeout'&&service.form.pay_type=='card'){wasTipChanged=true;}else if(service.form.delivery_type=='delivery'&&service.form.pay_type=='card'){if(!service._tipHasChanged){service.form.tip=(service.account.user.last_tip)?service.account.user.last_tip:'autotip';service.form.tip=service._lastTipNormalize(service.form.tip);wasTipChanged=true;}else{service.form.tip=service._previousTip;wasTipChanged=true;}}
if(wasTipChanged){service.info.totalText=service.info.dollarSign+this.charged();}
var total=service.total();var _total=service.restaurant.delivery_min_amt=='subtotal'?service.subtotal():total;if(service.restaurant.meetDeliveryMin(_total)&&service.form.delivery_type=='delivery'){service.info.deliveryMinDiff=service.restaurant.deliveryDiff(_total);}else{service.info.deliveryMinDiff='';}
var breakdown=service.totalbreakdown();service.info.totalItems=service.cart.totalItems();service.info.extraCharges=service.extraChargesText(breakdown);service.info.breakdownDescription=service.info.dollarSign+this.subtotal().toFixed(2);service.info.cartSummary=service.cart.summary();service.info.taxes=breakdown.taxes.toFixed(2);service.info.tip=breakdown.tip.toFixed(2);service.info.subtotal=breakdown.subtotal.toFixed(2);service.info.fee=breakdown.fee.toFixed(2);service.info.delivery=breakdown.delivery.toFixed(2);service.info.total=total;if(service.form.pay_type=='card'&&credit>0){service.info.creditLeft='';if(total<credit){service.info.creditLeft=App.ceil((credit-total)).toFixed(2);credit=total;}}}
service._autotip=function(){var subtotal=service.totalbreakdown().subtotal;if(subtotal===0){autotipValue=0;}else{autotipValue=Math.ceil(2*(subtotal*0.11+0.95))/2;if(!isNaN(autotipValue)){autotipValue=autotipValue.toFixed(2);}}
service.form.autotip=autotipValue;}
service._autotipText=function(){var autotipText=service.form.autotip?' ('+service.info.dollarSign+service.form.autotip+')':'';return'Autotip'+autotipText;}
service._years=function(){var years=[];years.push({value:'',label:'Year'});var date=new Date().getFullYear();for(var x=date;x<=date+20;x++){years.push({value:x.toString(),label:x.toString()});}
return years;}
service._months=function(){var months=[];months.push({value:'',label:'Month'});for(var x=1;x<=12;x++){months.push({value:x.toString(),label:x.toString()});}
return months;}
service._tips=function(){var tips=[];tips.push({value:'autotip',label:service._autotipText()});tips.push({value:0,label:'Tip with cash'});var _tips=[10,15,18,20,25,30,35,40,45,50];for(var x in _tips){tips.push({value:_tips[x],label:'tip '+_tips[x]+' %'});}
return tips;}
service._lastTipNormalize=function(lastTip){if(lastTip==='autotip'){return lastTip;}
if(service.account.user&&service.account.user.last_tip_type&&service.account.user.last_tip_type=='number'){return'autotip';}
lastTip=parseInt(lastTip);var tips=service._tips();for(x in tips){if(lastTip==parseInt(tips[x].value)){return lastTip;}}
return'autotip';}
service.loadUserRestaurantInfo=function(success,error){var url=App.service+'user/restaurant/'+service.restaurant.id_restaurant;$http({method:'POST',url:url,cache:false,data:$.param({'words':service.form.notes,phone:service.form.phone}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(success){success(data);}}).error(function(data,status){error(data,status);});}
service._test=function(){$rootScope.$safeApply(function(){service._useRestaurantBoundingBox=true;service.form.name='MR TEST';service.form.phone='405-279-9645';service.form.address=service.restaurant.address;service.form.cardNumber='4242424242424242';service.form.cardMonth='2';service.form.cardYear='2016';service.form.tip='autotip';service.tooglePayment('card');$rootScope.$broadcast('creditCardInfoChanged',true);});}
return service;});NGApp.factory('OrdersService',function($http,$location,$rootScope,RestaurantsService,OrderViewService){var service={list:false,reload:true};var restaurants=RestaurantsService;service.checkItWasLoaded=function(){if(!service.list){service.load();}}
service.checkUpdate=function(){var url=App.service+'user/orders/total';$http.get(url,{cache:false}).success(function(data){if(data.total!=service.list.length){service.reload=true;service.load();}});}
service.load=function(){if(service.list&&!service.reload){return service.list;}
OrderViewService.newOrder=false;list=false;service.list=list;var url=App.service+'user/orders';$http.get(url,{cache:false}).success(function(json){service.reload=false;if(json){for(var x in json){var arr=json[x].date.split(/[- :]/);json[x]._date=new Date(arr[0],arr[1]-1,arr[2],arr[3],arr[4],arr[5]);json[x].timeFormat=json[x]._date_tz.replace(/^[0-9]+-([0-9]+)-([0-9]+) ([0-9]+:[0-9]+):[0-9]+$/i,'$1/$2 $3');}
list=json;}else{list=true;}
service.list=list;$rootScope.$broadcast('OrdersLoaded',service.list);}).error(function(data,status,headers,config){setTimeout(function(){service.checkItWasLoaded();},500);}).then(function(){setTimeout(function(){service.checkItWasLoaded();},1500);});}
service.restaurant=function(permalink){App.go('/'+restaurants.permalink+'/'+permalink,'push');};service.receipt=function(id_order){App.go('/order/'+id_order,'push');};$rootScope.$on('userAuth',function(e,data){service.reload=true;});$rootScope.$on('newOrder',function(e,data){service.reload=true;});return service;});NGApp.factory('OrderViewService',function($routeParams,$location,$rootScope,$http,FacebookService){var service={order:false,reload:true,newOrder:false};service.facebook=FacebookService;service.load=function(){var url=App.service+'order/'+$routeParams.id;var error=function(){$location.path('/');}
$http({method:'GET',url:url,cache:true}).success(function(data){service.order=data;if(service.order.uuid){service.order._final_price=parseFloat(service.order.final_price).toFixed(2);if(service.order.credit){service.order._credit=parseFloat(service.order.credit).toFixed(2);}
if(service.newOrder){service.order._new=service.newOrder;}else{service.order._new=false;}
var arr=data.date.split(/[- :]/);service.order._date=new Date(arr[0],arr[1]-1,arr[2],arr[3],arr[4],arr[5]);var order_address=(service.order.address)?service.order.address.replace(/\r|\n/g,' '):'';var restaurant_address=(service.order._restaurant_address)?service.order._restaurant_address.replace(/\r|\n/g,' '):'';if(App.iOS()){service.order.mapLink='http://maps.apple.com/?'+(service.order.delivery_type=='delivery'?'s':'d')+'addr='+encodeURIComponent(order_address)+'&'+(service.order.delivery_type=='delivery'?'d':'s')+'addr='+encodeURIComponent(restaurant_address);}else{service.order.mapLink='http://maps.google.com/maps?'+(service.order.delivery_type=='delivery'?'s':'d')+'addr='+encodeURIComponent(order_address)+'&'+(service.order.delivery_type=='delivery'?'d':'s')+'addr='+encodeURIComponent(restaurant_address)+'"';}
service.facebook._order_uuid=service.order.uuid;service.facebook.preLoadOrderStatus();$rootScope.$broadcast('OrderViewLoadedOrder',service.order);}else{error();}}).error(function(data){error();});}
return service;});;NGApp.factory('FacebookService',function($http,$location,$rootScope,AccountService,ReferralService){var service={token:false,_order_uuid:false,orderStatus:false,logged:false,doAuth:true,wait:false,running:false,error:{unknown:false,userExists:false,login:false}}
service.referral=ReferralService;service.account=AccountService;service.preLoadOrderStatus=function(uuid){$http.get(App.service+'facebook/status/order/'+service._order_uuid).success(function(data){if(data.success){service.orderStatus=data.success;}else{service.orderStatus=false;}});}
service.postOrder=function(){if(service.orderStatus){var status=service.orderStatus;status.link=service.referral.cleaned_url();App.share({url:'http://'+status.link,name:status.name,caption:status.caption,description:status.description,picture:status.picture,success:function(success){$http({method:'POST',url:App.service+'facebook/reward/',data:$.param({'post_id':success.post_id,'uuid':service._order_uuid}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(){$rootScope.$broadcast('orderShared');});}});}else{service.preLoadOrderStatus();App.alert('Oops, please try again!');return;}}
service.postInvite=function(url){App.share({url:url,name:'Noms',caption:' ',description:url});}
service.requestPermission=function(callback){callback=typeof callback==='function'?callback:function(){};FB.ui({method:'permissions.request',perms:serviceScope,display:'iframe'},callback);}
service.processStatus=function(status){if(status.status==='connected'&&status.authResponse){service.logged=true;service.error.unknown=false;service.error.userExists=false;service.error.login=false;service.token=status.authResponse.accessToken;$.totalStorage('fbtoken',service.token);if(App.config.user.id_user&&App.config.user.facebook){return;}
if(status.authResponse.userId){status.authResponse.userID=status.authResponse.userId;}
if(status.authResponse.userID){App.log.account({'userID':status.authResponse.userID},'facebook login');if(!service.running){service.running=true;App.log.account({'userID':status.authResponse.userID,'running':service.running},'facebook running');var data={};url=App.service+'user/facebook?fbrtoken='+service.token;$http({method:'GET',url:url,cache:false}).success(function(data){App.log.account({'userID':status.authResponse.userID,'running':service.running,'data':data},'facebook ajax');if(data.error){if(data.error=='facebook id already in use'){$rootScope.$broadcast('facebookIdAlreadyUsed',true);App.log.account({'error':data.error},'facebook error');service.error.userExists=true;}
service.running=false;return;}else{service.account.updateInfo();service.account.user=data;if(service.account.callback){service.account.callback();service.account.callback=false;}else{try{$.magnificPopup.close();}catch(e){}}}
App.log.account({'userID':status.authResponse.userID},'facebook currentPage');$rootScope.$broadcast('userAuth',service.account.user);service.running=false;service.wait=false;});}}}else{service.logged=false;service.error.unknown=false;service.error.userExists=false;service.error.login=false;service.token=null;$.totalStorage('fbtoken',null);}}
service.signout=function(callback){FB.logout(function(){service.logged=false;if(typeof callback==='function'){callback();}});}
return service;});;NGApp.factory('GiftCardService',function($http,$location,$rootScope,AccountModalService,CreditService,RestaurantsService){var service={redeemed:false,code:false,value:'',notes_field:{lastValidation:'',content:'',giftcards:{success:[],error:[]},value:'0.00',removed:false,id_restaurant:null,hasGiftCards:false,restaurant_accepts:false},modal:{intro:true,error:false,success:false,restaurant:false,}};credit=CreditService;service.accountModal=AccountModalService;service.account=service.accountModal.facebook.account;service.open=function(){App.dialog.show('.giftcard-container');service.parseURLCode();if(service.modal.intro){setTimeout(function(){service.processModal();$location.path('/location');},100);}}
service.openRestaurant=function(){$location.path('/'+RestaurantsService.permalink+'/'+service.modal.restaurant.permalink);service.modal.close();}
service.parseURLCode=function(){var url=$location.path();if(url.indexOf('giftcard')>0){service.code=$location.path().replace('/giftcard','');}else{service.code=$location.path().replace('/gift','');service.code=$location.path().replace('/invite','');}
service.code=service.code.replace('/','');}
service.viewed=function(){var url=App.service+'giftcard/viewed';$http({method:'POST',url:url,data:$.param({'code':service.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}});}
service.processModal=function(){if(!service.code||service.code==''){return;}
if(!(/^\w+$/.test($.trim(service.code)))){service.code='';return;}
service.modal.reset();setTimeout(function(){service.redeemed=false;service.validate(function(data){service.modal.intro=false;if(data.error){service.modal.error=true;switch(data.error){case'gift card already used':service.viewed();service.modal.error='used';break;case'invalid gift card':service.modal.error='invalid';break;default:service.modal.error='unknow';break;}
service.code=false;}else if(data.success){service.viewed();service.modal.success=true;service.value=data.success['value'];service.message=data.success['message'];if(data.success['id_restaurant']){service.modal.restaurant={id_restaurant:data.success['id_restaurant'],name:data.success['restaurant'],permalink:data.success['permalink']};}else{service.modal.restaurant=false;}
$rootScope.$broadcast('GiftCardProcessed',true);if(service.redeemed){service.code='';}}});},500);}
service.modal.reset=function(){service.modal.intro=true;service.modal.error=false;service.modal.success=false;service.modal.restaurant=false;}
service.modal.signIn=function(){service.account.callback=function(){service.open();service.processModal();}
service.modal.close();setTimeout(function(){service.accountModal.signinOpen();},500);}
service.modal.close=function(){$.magnificPopup.close();}
service.validate=function(callback){service.code=$.trim(service.code);if(service.code==''){callback({error:true});return;}
if(service.redeemed){var url=App.service+'giftcard/code';}else{var url=App.service+'giftcard/validate';}
$http({method:'POST',url:url,data:$.param({'code':service.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){callback(data);}).error(function(data,status){callback({error:true});});}
service.notes_field.reset=function(){service.notes_field.content='';service.notes_field.giftcards={success:[],error:[]};service.notes_field.value='0.00';service.notes_field.removed=false;service.notes_field.id_restaurant=null;service.notes_field.hasGiftCards=false;service.notes_field.restaurant_accepts=false;service.code=false;}
service.notes_field.processJson=function(json){service.notes_field.giftcards.success=[];if(json&&json.success){service.notes_field.hasGiftCards=true;var giftcard=json.success;if(giftcard.id_restaurant&&giftcard.id_restaurant!=service.notes_field.id_restaurant){giftcard.error='other restaurant';}
service.notes_field.giftcards.success.push(json.success);}else{service.notes_field.giftcards.success=[];}
service.notes_field.compareValues();$rootScope.$broadcast('giftCardUpdate');}
service.notes_field.start=function(phone){service.notes_field.hasGiftCards=false;service.notes_field.giftcards.success=[];if(service.notes_field.content==''){service.notes_field.lastValidation='';service.notes_field.checkAllValidated();}
if(service.notes_field.content&&service.notes_field.content!=''){var words=service.notes_field.content;if(words==service.notes_field.lastValidation){return;}
service.notes_field.lastValidation=words;if(!service.notes_field.running){service.notes_field.running=true;var url=App.service+'giftcard/validate-words';var data={'words':words};if(phone){data.phone=phone;}
$http({method:'POST',url:url,data:$.param(data),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.success){service.notes_field.hasGiftCards=true;var giftcard=data.success;if(giftcard.id_restaurant&&giftcard.id_restaurant!=service.notes_field.id_restaurant){giftcard.error='other restaurant';}
service.notes_field.giftcards.success.push(data.success);}else if(data.error){service.notes_field.giftcards.success=[];}
service.notes_field.total--;service.notes_field.checkAllValidated();service.notes_field.running=false;}).error(function(data,status){service.notes_field.total--;service.notes_field.checkAllValidated();service.notes_field.running=false;});}}}
service.notes_field.checkAllValidated=function(){service.notes_field.compareValues();$rootScope.$broadcast('giftCardUpdate');}
service.notes_field.compareValues=function(){service.notes_field.removed=false;var values=0;if(service.notes_field.giftcards.success.length>0){$.each(service.notes_field.giftcards.success,function(key,giftcard){if(giftcard&&!giftcard.error){values+=parseFloat(giftcard.value);}});}
if(service.notes_field.value>values){service.notes_field.removed=true;}
if(service.notes_field.restaurant_accepts){service.notes_field.value=App.ceil(values).toFixed(2);credit.setValue(App.ceil(credit.redeemed+values).toFixed(2));}
$rootScope.$broadcast('creditChanged',{value:service.value});}
return service;});NGApp.factory('CreditService',function($http,$rootScope){var service={value:'0.00',tooltip:false,redeemed:0};service.setValue=function(value){service.value=value;$rootScope.$broadcast('creditChanged',{value:service.value});}
service.processCredit=function(value){if(value&&value>0){service.setValue(App.ceil(value).toFixed(2));service.redeemed=value;}else{service.setValue(App.ceil(0).toFixed(2));service.redeemed=0;}}
service.getCredit=function(restaurant_id){var url=App.service+'user/credit/'+restaurant_id;$http({url:url}).success(function(data){if(data.credit){service.setValue(App.ceil(data.credit).toFixed(2));service.redeemed=data.credit;}else{service.setValue(App.ceil(0).toFixed(2));service.redeemed=0;}}).error(function(){service.setValue(App.ceil(0).toFixed(2));service.redeemed=0;});}
return service;});;NGApp.factory('PositionsService',function($rootScope){var service={bounding:null,locs:[],storageLimit:4}
service.addLocation=function(loc){service.locs.push(loc);service.storeLocations();$rootScope.$broadcast('NewLocationAdded',true);}
service.storeLocations=function(){var keys={};service.locs.reverse();for(x in service.locs){var key=service.locs[x].getKey();if(keys[key]){service.locs[x].markToRemove();}
keys[key]=true;}
service.locs.reverse();var locs=[];for(x in service.locs){if(service.locs[x].storeAtCookie()){locs.push(service.locs[x].toCookie());}}
if(locs.length>service.storageLimit){locs=locs.slice(locs.length-service.storageLimit);}
$.totalStorage('locsv3',locs);}
service.hasValidLocation=function(){for(x in service.locs){if(service.locs[x].storeAtCookie()){return true;}}
return false;}
service.removeNotServedLocation=function(){if(service.locs.length>0){service.locs[service.locs.length-1].markToRemove();service.storeLocations();}}
service.pos=function(){return((service.locs.length)?service.locs[service.locs.length-1]:new Location);}
return service;});NGApp.factory('LocationService',function($location,$rootScope,RestaurantsService,PositionsService,AccountService,CommunityAliasService){var service={form:{address:''},range:2,boundingBoxMeters:8000,loaded:false,locationNotServed:false,initied:false,loadRestaurantsPage:true,initied:false}
var community=CommunityAliasService;service.account=AccountService;service.position=PositionsService;service.restaurantsService=RestaurantsService;service.distance=function(params){try{var R=6371;var dLat=service.toRad(params.to.lat-params.from.lat);var dLon=service.toRad(params.to.lon-params.from.lon);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(service.toRad(params.from.lat))*Math.cos(service.toRad(params.to.lat))*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d;}catch(e){var pos=service.position.pos();App.track('Location Error',{lat:pos.lat,lon:pos.lon,address:pos.address()});}}
service.getClosest=function(results,latLong){var from={lat:latLong.lat(),lon:latLong.lng()};var distances=[];var closest=-1;for(i=0;i<results.length;i++){var d=service.distance({to:{lat:results[i].geometry.location.lat(),lon:results[i].geometry.location.lng()},from:from});distances[i]=d;if(closest==-1||d<distances[closest]){closest=i;}}
return results[closest];}
service.getLocationByBrowser=function(success,error,timer){var success=success||function(){};var error=error||function(){};var timer=timer||(App.isPhoneGap?30000:8000);if(navigator.geolocation){service.timerId=setTimeout(function(){error();},timer);navigator.geolocation.getCurrentPosition(function(position){clearTimeout(service.timerId);service.position.addLocation(new Location({lat:position.coords.latitude,lon:position.coords.longitude,type:'geolocation'}));App.track('Locations Shared',{lat:position.coords.latitude,lon:position.coords.longitude});service.reverseGeocode(position.coords.latitude,position.coords.longitude,success,error,'geolocation');},function(e){if(e.code==2){App.alert('Where are you? Your GPS appears to be off. Turn it back on and lets do this!');}
clearTimeout(service.timerId);error();},{maximumAge:60000,timeout:timer,enableHighAccuracy:true});}else{error();}}
service.init=function(){var force=false;if(arguments[0]){force=true;}
if(service.initied&&!force){return;}
if(App.config&&App.config.loc&&App.config.loc.lat&&App.config.loc.lon){service.bounding=App.config.loc;service.bounding.type='geoip';}
var cookieLocs=$.totalStorage('locsv3');var cookieBounding=$.totalStorage('boundingv2');if(cookieLocs){for(var x in cookieLocs){service.position.addLocation(new Location(cookieLocs[x]._properties));}}
if(cookieBounding){service.bounding=cookieBounding;service.bounding.type='cookie';}
if(service.account&&service.account.user&&service.account.user.location_lat){service.bounding={lat:service.account.user.location_lat,lon:service.account.user.location_lon,type:'user'};if(!cookieLocs){service.position.addLocation(new Location({lat:service.account.user.location_lat,lon:service.account.user.location_lon,type:'user'}));}
service.loadRestaurantsPage=true;}
if(service.initied){return;}
service.initied=true;if(App.isPhoneGap){if(parseInt(service.position.locs.length)>0){service.restaurantsService.list(function(){App.go('/food-delivery');},function(){});}}else{try{if(google&&google.load&&!google.maps){google.load('maps','3',{callback:service.googleCallback,other_params:'sensor=false'});}}catch(e){}}}
service.googleCallback=function(){console.debug('PROCESSING LOCATION DATA FROM GOOGLE API');var error=function(){if(service.bounding&&service.bounding.lat&&service.bounding.lon&&!service.bounding.city){service.reverseGeocode(service.bounding.lat,service.bounding.lon,function(loc){service.bounding.city=loc.city();service.bounding.region='';service.position.addLocation(loc);service.restaurantsService.list(function(){service.loadRestaurantsPage=true;},function(){$rootScope.$broadcast('locationError',true);});},function(){});}}
service.loaded=true;if(google.loader.ClientLocation){if(google.loader.ClientLocation.latitude&&google.loader.ClientLocation.longitude){service.bounding={lat:google.loader.ClientLocation.latitude,lon:google.loader.ClientLocation.longitude,city:google.loader.ClientLocation.address.city,region:google.loader.ClientLocation.address.country_code=='US'&&google.loader.ClientLocation.address.region?google.loader.ClientLocation.address.region.toUpperCase():google.loader.ClientLocation.address.country_code,type:'googleip'};}}
if(service.position.locs.length){var loc=service.position.pos();service.reverseGeocode(loc.lat(),loc.lon(),function(loc){service.bounding={lat:loc.lat(),lon:loc.lon(),city:loc.city()};service.restaurantsService.list(function(){service.loadRestaurantsPage=true;},function(){$rootScope.$broadcast('locationNotServed',true);});},function(){});}else
if(!service.position.locs.length){service.getLocationByBrowser(function(loc){service.bounding={lat:loc.lat(),lon:loc.lon(),city:loc.city(),type:'geolocation'};service.position.addLocation(loc);service.restaurantsService.list(function(){service.loadRestaurantsPage=true;},function(){$rootScope.$broadcast('locationNotServed',true);});},error);}else{error();}}
service.geocode=function(address,success,error){service.doGeocode(address,function(results){if(results.alias){var loc=new Location({address:results.alias.address(),entered:address,type:'alias',lat:results.alias.lat(),lon:results.alias.lon(),city:results.alias.city(),prep:results.alias.prep(),image:results.alias.image(),permalink:results.alias.permalink()});}else{if(service.bounding){var latLong=new google.maps.LatLng(service.bounding.lat,service.bounding.lon);var closest=service.getClosest(results,latLong);}else{var closest=results[0];}
var loc=new Location({results:results,entered:address,type:'user',lat:closest.geometry.location.lat(),lon:closest.geometry.location.lng()});}
success(loc);},function(){error();});}
service.doGeocode=function(address,success,error,ignoreRoute){address=$.trim(address);App.track('Location Entered',{address:address});var rsuccess=function(results){success(results);};var rerror=function(){var params={address:address};if(service.bounding&&google&&google.maps&&google.maps.LatLng){var latLong=new google.maps.LatLng(service.bounding.lat,service.bounding.lon);var circle=new google.maps.Circle({center:latLong,radius:service.boundingBoxMeters});var bounds=circle.getBounds();params.bounds=bounds;}
var geocoder=new google.maps.Geocoder();geocoder.geocode(params,function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});};community.route(address,rsuccess,rerror);}
service.ordinalReplace=function(address){var ordinals={'first':'1st','second':'2nd','third':'3rd','fourth':'4th','fifth':'5th','sixth':'6th','seventh':'7th','eighth':'8th','ninth':'9th','tenth':'10th','eleventh':'11th','twelfth':'12th','thirteenth':'13th','fourteenth':'14th','fifteenth':'15th','sixteenth':'16th','seventeenth':'17th','eighteenth':'18th','nineteenth':'19th','twentieth':'20th'};for(ordinal in ordinals){var regex=new RegExp('('+ordinal+')','gi');address=address.replace(regex,ordinals[ordinal]);}
return address;}
service.doGeocodeWithBound=function(address,latLong,success,error){var circle=new google.maps.Circle({center:latLong,radius:service.boundingBoxMeters});var bounds=circle.getBounds();var geocoder=new google.maps.Geocoder();geocoder.geocode({address:address,bounds:bounds},function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});}
service.reverseGeocode=function(lat,lon,success,error,type){var type=type||null;App.track('Location Reverse Geocode',{lat:lat,lon:lon});var geocoder=new google.maps.Geocoder();var latlng=new google.maps.LatLng(lat,lon);geocoder.geocode({'latLng':latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(results[1]){success(new Location({results:results,lat:lat,lon:lon,type:type}));}else{error();}}else{error();}});}
service.theClosestAddress=function(results,latLong){var lat=latLong.lat();var lng=latLong.lng();var R=6371;var distances=[];var closest=-1;for(i=0;i<results.length;i++){var alat=results[i].geometry.location.lat();var alng=results[i].geometry.location.lng();var dLat=service.toRad(alat-lat);var dLong=service.toRad(alng-lng);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(service.toRad(lat))*Math.cos(service.toRad(lat))*Math.sin(dLong/2)*Math.sin(dLong/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;distances[i]=d;if(closest==-1||d<distances[closest]){closest=i;}}
address=results[closest];var loc=new Location({type:'closest',lat:address.geometry.location.lat(),lon:address.geometry.location.lng()});loc.setAddressFromResult(address);loc.setCityFromResult(address);loc.setZipFromResult(address);return{result:address,location:loc};}
service.validateAddressType=function(addressLocation){if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.ROOFTOP||addressLocation.geometry.location_type==google.maps.GeocoderLocationType.RANGE_INTERPOLATED)){return true;}
if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.APPROXIMATE)){for(var x in addressLocation.types){var addressType=addressLocation.types[x];if(addressType=='premise'||addressType=='subpremise'||addressType=='intersection'||addressType=='establishment'){return true;}}}
return false;}
service.km2Miles=function(km){return km*0.621371;}
service.Miles2Km=function(miles){return miles*1.60934;}
service.toRad=function(number){return number*Math.PI/180;}
service.addVerify=function(){if(arguments[0]&&typeof arguments[1]!='function'){var success=arguments[2];var error=arguments[3];}else{var address=arguments[0];var success=arguments[1];var error=arguments[2];for(var x in service.locs){if(service.locs[x].entered==address&&service.locs[x].verified){success(service.locs[x]);return;}}
service.geocode(address,function(loc){service.position.addLocation(loc);success();$.totalStorage.setItem('boundingv2',service.bounding);},error);}}
return service;});;NGApp.factory('CartService',function(){var service={restaurants:{},id_restaurant:null}
service.uuid=function(){var id='c-'+service.restaurants[service.id_restaurant].uuidInc;service.restaurants[service.id_restaurant].uuidInc++;return id;}
service.setRestaurant=function(id_restaurant){service.id_restaurant=id_restaurant;if(!service.restaurants[service.id_restaurant]){service.restaurants[service.id_restaurant]={uuidInc:0,items:{}}}}
service.collapseItems=function(){for(x in service.restaurants[service.id_restaurant].items){service.restaurants[service.id_restaurant].items[x].details.customization.expanded=false;}}
service.clean=function(){for(x in service.restaurants){service.restaurants[x]={uuidInc:0,items:{}};}}
service.add=function(item){service.collapseItems();var id=service.uuid(),dish=App.cache('Dish',item);dish_options=dish.options(),options=[];var expanded=true;if(arguments[1]){options=arguments[1].options;expanded=false;for(var i in dish_options){if(dish_options[i].type=='select'){var hasSelectedOption=false;var defaultValue=false;for(var j in dish_options){if(dish_options[j].id_option_parent==dish_options[i].id_option){if(dish_options[j]['default']==1){defaultValue=dish_options[j]['id_option'];}
for(var k in options){if(options[k]==dish_options[j].id_option){hasSelectedOption=true;}}}}
if(defaultValue&&!hasSelectedOption){options[options.length]=defaultValue;}}}}else{for(var x in dish_options){if(dish_options[x]['default']==1){options[options.length]=dish_options[x].id_option;}}}
service.restaurants[service.id_restaurant].items[id]={id:item,options:options,details:{id:id,name:dish.name,description:dish.description!=null?dish.description:'',customization:{customizable:(dish.options().length>0),expanded:(expanded&&(parseInt(dish.expand_view)>0)),options:service._parseCustomOptions(dish_options,options),rawOptions:dish_options}},};App.track('Dish added',{id_dish:dish.id_dish,name:dish.name});}
service.clone=function(item){var
cart=service.restaurants[service.id_restaurant].items[item],newoptions=[];for(var x in cart.options){newoptions[newoptions.length]=cart.options[x];}
service.add(cart.id,{options:newoptions});App.track('Dish cloned');}
service.getItems=function(){return service.restaurants[service.id_restaurant].items;}
service.reset=function(){service.restaurants[service.id_restaurant].uuidInc=0;service.restaurants[service.id_restaurant].items={};}
service.remove=function(item){App.track('Dish removed');delete service.restaurants[service.id_restaurant].items[item];}
service.customizeItem=function(option,item){var cartitem=service.restaurants[service.id_restaurant].items[item.details.id];if(option){if(option.type=='select'){var options=item.details.customization.rawOptions;for(var i in options){if(options[i].id_option_parent!=option.id_option){continue;}
for(var x in cartitem.options){if(cartitem.options[x]==options[i].id_option&&options[i].id_option_parent==option.id_option){cartitem.options.splice(x,1);break;}}}
cartitem.options[cartitem.options.length]=option.selected;}else if(option.type=='check'){if(option.checked){cartitem.options[cartitem.options.length]=option.id_option;}else{for(var x in cartitem.options){if(cartitem.options[x]==option.id_option){cartitem.options.splice(x,1);break;}}}}}
service.restaurants[service.id_restaurant].items[item.details.id]=cartitem;}
service.customizeItemPrice=function(price,force){if(price!='0.00'||force){return' ('+((price<0)?'minus $':'+ ')+parseFloat(Math.abs(price)).toFixed(2)+')';}
return'';}
service.getCart=function(){var cart=[];for(x in service.restaurants[service.id_restaurant].items){var index=cart.length;cart[index]={id:service.restaurants[service.id_restaurant].items[x].id,options:service.restaurants[service.id_restaurant].items[x].options};}
return cart;}
service.hasItems=function(){if(service.restaurants[service.id_restaurant]){if(!$.isEmptyObject(service.restaurants[service.id_restaurant].items)){return true;}
return false;}}
service.summary=function(){var items={};for(var x in service.restaurants[service.id_restaurant].items){if(items[service.restaurants[service.id_restaurant].items[x].details.name]){items[service.restaurants[service.id_restaurant].items[x].details.name]++;}else{items[service.restaurants[service.id_restaurant].items[x].details.name]=1;}}
var text='';for(x in items){text=',\u00A0\u00A0'+text;if(items[x]>1){text=x+'\u00A0('+items[x]+')'+text;}else{text=x+text;}}
return text.substr(0,text.length-3);}
service.subtotal=function(){var
total=0,options;for(var x in service.restaurants[service.id_restaurant].items){total+=parseFloat(App.cached['Dish'][service.restaurants[service.id_restaurant].items[x].id].price);options=service.restaurants[service.id_restaurant].items[x].options;for(var xx in options){var option=App.cached['Option'][options[xx]];if(option===undefined)continue;total+=parseFloat(option.optionPrice(options));}}
total=App.ceil(total);service.subtotalWithoutMarkup();return total;}
service.subtotalWithoutMarkup=function(){var
total=0,options;for(var x in service.restaurants[service.id_restaurant].items){total+=parseFloat(App.cached['Dish'][service.restaurants[service.id_restaurant].items[x].id].price);if(App.cached['Dish'][service.restaurants[service.id_restaurant].items[x].id].markup){total-=parseFloat(App.cached['Dish'][service.restaurants[service.id_restaurant].items[x].id].markup);}
options=service.restaurants[service.id_restaurant].items[x].options;for(var xx in options){var option=App.cached['Option'][options[xx]];if(option===undefined)continue;total+=parseFloat(option.optionPriceWithoutMarkup(options));}}
total=App.ceil(total);return total;}
service.totalItems=function(){var size=0;for(var x in service.restaurants[service.id_restaurant].items){if(service.restaurants[service.id_restaurant].items.hasOwnProperty(x)){size++;}}
return size;}
service._parseCustomOptions=function(options,selectedOptions){var parsedOptions=[];for(var x in options){var newOption={};var rawOption=options[x];if(rawOption.id_option_parent){continue;}
newOption.type=rawOption.type;newOption.id_option=rawOption.id_option;newOption.name=rawOption.name+(rawOption.description||'');if(rawOption.type=='check'){newOption.id_option=rawOption.id_option;newOption.price=rawOption.optionPrice(options);newOption.priceFormated=service.customizeItemPrice(newOption.price);newOption.checked=($.inArray(rawOption.id_option,selectedOptions)!==-1);}
if(rawOption.type=='select'){newOption.options=[];newOption.selected=false;for(var i in options){if(options[i].id_option_parent==rawOption.id_option){var newSubOption={};newSubOption.id_option=options[i].id_option;newSubOption.id_option_parent=options[i].id_option_parent;newSubOption.price=options[i].price;newSubOption.priceFormated=service.customizeItemPrice(newSubOption.price);newSubOption.selected=($.inArray(options[i].id_option,selectedOptions)!==-1);newSubOption.name=options[i].name+(options[i].description||'')+service.customizeItemPrice(newSubOption.price,(rawOption.price_linked=='1'));newOption.options.push(newSubOption);if(newSubOption.selected){newOption.selected=options[i].id_option;}}}}
parsedOptions.push(newOption);}
return parsedOptions;}
return service;});;NGApp.factory('CreditCardService',function($http){var service={};service.cards=[{'name':'master-card','pattern':/^5[1-5]/,'size':16},{'name':'visa','pattern':/^4/,'size':16},{'name':'amex','pattern':/^3[47]/,'size':15},{'name':'discover','pattern':/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,'size':16},];service.validate=function(cardValue){var card=service.detectType(cardValue);var isValid=false;if(card.size==cardValue.toString().length){isValid=service.luhn(cardValue);}
if(isValid){$('[name="pay-card-number"]').addClass('credit-card-ok');}else{$('[name="pay-card-number"]').removeClass('credit-card-ok');}}
service.luhn=function(cardValue){var sum=0;cardValueInverse=cardValue.toString().split('').reverse();for(n=i=0,size=cardValueInverse.length;i<size;n=++i){digit=cardValueInverse[n];digit=+digit;if(n%2){digit*=2;if(digit<10){sum+=digit;}else{sum+=digit-9;}}else{sum+=digit;}}
return sum%10===0;}
service.changeIcons=function(cardValue){var card=service.detectType(cardValue);if(card){$('.payment-card').addClass('grey');$('.card-'+card.name).removeClass('grey');}else{$('.payment-card').removeClass('grey');}
service.validate(cardValue);}
service.detectType=function(cardValue){var cardType=false;$(service.cards).each(function(index,card){if(card.pattern.test(cardValue)){cardType=card;}});return cardType;}
return service;});;NGApp.factory('ReferralService',function($http,$rootScope,$location){var service={invite_url:null,value:0,invites:0,limit:0};service.check=function(){var param=$location.search();if(param.invite){$.cookie('referral',param.invite);$location.url($location.path());}}
service.getInviteCode=function(){var url=App.service+'referral/code';$http({url:url,method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.invite_url=data.invite_url;$rootScope.$broadcast('referralCodeLoaded',true);}).error(function(data,status){console.log({error:data});});}
service.getValue=function(){var url=App.service+'referral/value';$http({url:url,method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.value=data.value;$rootScope.$broadcast('referralValueLoaded',true);}).error(function(data,status){console.log({error:data});});}
service.getStatus=function(){var url=App.service+'referral/status';$http({url:url,method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.enabled=data.enabled;service.invites=data.invites;service.value=data.value;service.limit=data.limit;service.invite_url=data.invite_url;$rootScope.$broadcast('referralStatusLoaded',true);}).error(function(data,status){console.log({error:data});});}
service.cleaned_url=function(){return service.invite_url&&service.invite_url.replace('http://','');}
$rootScope.$on('userAuth',function(e,data){service.invite_url=null;service.value=0;service.invites=0;service.limit=0;});return service;});;NGApp.factory('PhoneGapService',function($route,$rootScope){if(!App.isPhoneGap){return{};}
service={isPhoneGap:App.isPhoneGap,isAndroid:App.isAndroid()};$rootScope.$on('$routeChangeSuccess',function($currentRoute,$previousRoute){service.routeChanged($route.current.action);});service.routeChanged=function(route){if(App.isPhoneGap&&App.iOS()&&navigator&&navigator.keyboard){if(route=='location'){navigator.keyboard.hide();}else{navigator.keyboard.show();}}
if(App.isPhoneGap&&!App.splashHidden&&(!route||route=='home')){}else{setTimeout(function(){navigator.splashscreen.hide();App.splashHidden=true;},1000);}
switch(route){case'location':if(service.isAndroid){setTimeout(function(){$('.home-top').css('background-position','top right');},100);}
break;}}
return service;});;addEventListener('touchstart',function(){});addEventListener('load',function(event){setTimeout(scrollTo,80,0,1);},false);