(function(window,undefined){"use strict";var
console=window.console||undefined,document=window.document,navigator=window.navigator,sessionStorage=window.sessionStorage||false,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,setInterval=window.setInterval,clearInterval=window.clearInterval,JSON=window.JSON,alert=window.alert,History=window.History=window.History||{},history=window.history;JSON.stringify=JSON.stringify||JSON.encode;JSON.parse=JSON.parse||JSON.decode;if(typeof History.init!=='undefined'){throw new Error('History.js Core has already been loaded...');}
History.init=function(){if(typeof History.Adapter==='undefined'){return false;}
if(typeof History.initCore!=='undefined'){History.initCore();}
if(typeof History.initHtml4!=='undefined'){History.initHtml4();}
return true;};History.initCore=function(){if(typeof History.initCore.initialized!=='undefined'){return false;}
else{History.initCore.initialized=true;}
History.options=History.options||{};History.options.hashChangeInterval=History.options.hashChangeInterval||100;History.options.safariPollInterval=History.options.safariPollInterval||500;History.options.doubleCheckInterval=History.options.doubleCheckInterval||500;History.options.storeInterval=History.options.storeInterval||1000;History.options.busyDelay=History.options.busyDelay||250;History.options.debug=History.options.debug||false;History.options.initialTitle=History.options.initialTitle||document.title;History.intervalList=[];History.clearAllIntervals=function(){var i,il=History.intervalList;if(typeof il!=="undefined"&&il!==null){for(i=0;i<il.length;i++){clearInterval(il[i]);}
History.intervalList=null;}};History.debug=function(){if((History.options.debug||false)){History.log.apply(History,arguments);}};History.log=function(){var
consoleExists=!(typeof console==='undefined'||typeof console.log==='undefined'||typeof console.log.apply==='undefined'),textarea=document.getElementById('log'),message,i,n,args,arg;if(consoleExists){args=Array.prototype.slice.call(arguments);message=args.shift();if(typeof console.debug!=='undefined'){console.debug.apply(console,[message,args]);}
else{console.log.apply(console,[message,args]);}}
else{message=("\n"+arguments[0]+"\n");}
for(i=1,n=arguments.length;i<n;++i){arg=arguments[i];if(typeof arg==='object'&&typeof JSON!=='undefined'){try{arg=JSON.stringify(arg);}
catch(Exception){}}
message+="\n"+arg+"\n";}
if(textarea){textarea.value+=message+"\n-----\n";textarea.scrollTop=textarea.scrollHeight-textarea.clientHeight;}
else if(!consoleExists){alert(message);}
return true;};History.getInternetExplorerMajorVersion=function(){var result=History.getInternetExplorerMajorVersion.cached=(typeof History.getInternetExplorerMajorVersion.cached!=='undefined')?History.getInternetExplorerMajorVersion.cached:(function(){var v=3,div=document.createElement('div'),all=div.getElementsByTagName('i');while((div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->')&&all[0]){}
return(v>4)?v:false;})();return result;};History.isInternetExplorer=function(){var result=History.isInternetExplorer.cached=(typeof History.isInternetExplorer.cached!=='undefined')?History.isInternetExplorer.cached:Boolean(History.getInternetExplorerMajorVersion());return result;};History.emulated={pushState:!Boolean(window.history&&window.history.pushState&&window.history.replaceState&&!((/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent)||(/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent))),hashChange:Boolean(!(('onhashchange'in window)||('onhashchange'in document))||(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8))};History.enabled=!History.emulated.pushState;History.bugs={setHash:Boolean(!History.emulated.pushState&&navigator.vendor==='Apple Computer, Inc.'&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),safariPoll:Boolean(!History.emulated.pushState&&navigator.vendor==='Apple Computer, Inc.'&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),ieDoubleCheck:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<7)};History.isEmptyObject=function(obj){for(var name in obj){return false;}
return true;};History.cloneObject=function(obj){var hash,newObj;if(obj){hash=JSON.stringify(obj);newObj=JSON.parse(hash);}
else{newObj={};}
return newObj;};History.getRootUrl=function(){var rootUrl=document.location.protocol+'//'+(document.location.hostname||document.location.host);if(document.location.port||false){rootUrl+=':'+document.location.port;}
rootUrl+='/';return rootUrl;};History.getBaseHref=function(){var
baseElements=document.getElementsByTagName('base'),baseElement=null,baseHref='';if(baseElements.length===1){baseElement=baseElements[0];baseHref=baseElement.href.replace(/[^\/]+$/,'');}
baseHref=baseHref.replace(/\/+$/,'');if(baseHref)baseHref+='/';return baseHref;};History.getBaseUrl=function(){var baseUrl=History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();return baseUrl;};History.getPageUrl=function(){var
State=History.getState(false,false),stateUrl=(State||{}).url||document.location.href,pageUrl;pageUrl=stateUrl.replace(/\/+$/,'').replace(/[^\/]+$/,function(part,index,string){return(/\./).test(part)?part:part+'/';});return pageUrl;};History.getBasePageUrl=function(){var basePageUrl=document.location.href.replace(/[#\?].*/,'').replace(/[^\/]+$/,function(part,index,string){return(/[^\/]$/).test(part)?'':part;}).replace(/\/+$/,'')+'/';return basePageUrl;};History.getFullUrl=function(url,allowBaseHref){var fullUrl=url,firstChar=url.substring(0,1);allowBaseHref=(typeof allowBaseHref==='undefined')?true:allowBaseHref;if(/[a-z]+\:\/\//.test(url)){}
else if(firstChar==='/'){fullUrl=History.getRootUrl()+url.replace(/^\/+/,'');}
else if(firstChar==='#'){fullUrl=History.getPageUrl().replace(/#.*/,'')+url;}
else if(firstChar==='?'){fullUrl=History.getPageUrl().replace(/[\?#].*/,'')+url;}
else{if(allowBaseHref){fullUrl=History.getBaseUrl()+url.replace(/^(\.\/)+/,'');}else{fullUrl=History.getBasePageUrl()+url.replace(/^(\.\/)+/,'');}}
return fullUrl.replace(/\#$/,'');};History.getShortUrl=function(url){var shortUrl=url,baseUrl=History.getBaseUrl(),rootUrl=History.getRootUrl();if(History.emulated.pushState){shortUrl=shortUrl.replace(baseUrl,'');}
shortUrl=shortUrl.replace(rootUrl,'/');if(History.isTraditionalAnchor(shortUrl)){shortUrl='./'+shortUrl;}
shortUrl=shortUrl.replace(/^(\.\/)+/g,'./').replace(/\#$/,'');return shortUrl;};History.store={};History.idToState=History.idToState||{};History.stateToId=History.stateToId||{};History.urlToId=History.urlToId||{};History.storedStates=History.storedStates||[];History.savedStates=History.savedStates||[];History.normalizeStore=function(){History.store.idToState=History.store.idToState||{};History.store.urlToId=History.store.urlToId||{};History.store.stateToId=History.store.stateToId||{};};History.getState=function(friendly,create){if(typeof friendly==='undefined'){friendly=true;}
if(typeof create==='undefined'){create=true;}
var State=History.getLastSavedState();if(!State&&create){State=History.createStateObject();}
if(friendly){State=History.cloneObject(State);State.url=State.cleanUrl||State.url;}
return State;};History.getIdByState=function(newState){var id=History.extractId(newState.url),str;if(!id){str=History.getStateString(newState);if(typeof History.stateToId[str]!=='undefined'){id=History.stateToId[str];}
else if(typeof History.store.stateToId[str]!=='undefined'){id=History.store.stateToId[str];}
else{while(true){id=(new Date()).getTime()+String(Math.random()).replace(/\D/g,'');if(typeof History.idToState[id]==='undefined'&&typeof History.store.idToState[id]==='undefined'){break;}}
History.stateToId[str]=id;History.idToState[id]=newState;}}
return id;};History.normalizeState=function(oldState){var newState,dataNotEmpty;if(!oldState||(typeof oldState!=='object')){oldState={};}
if(typeof oldState.normalized!=='undefined'){return oldState;}
if(!oldState.data||(typeof oldState.data!=='object')){oldState.data={};}
newState={};newState.normalized=true;newState.title=oldState.title||'';newState.url=History.getFullUrl(History.unescapeString(oldState.url||document.location.href));newState.hash=History.getShortUrl(newState.url);newState.data=History.cloneObject(oldState.data);newState.id=History.getIdByState(newState);newState.cleanUrl=newState.url.replace(/\??\&_suid.*/,'');newState.url=newState.cleanUrl;dataNotEmpty=!History.isEmptyObject(newState.data);if(newState.title||dataNotEmpty){newState.hash=History.getShortUrl(newState.url).replace(/\??\&_suid.*/,'');if(!/\?/.test(newState.hash)){newState.hash+='?';}
newState.hash+='&_suid='+newState.id;}
newState.hashedUrl=History.getFullUrl(newState.hash);if((History.emulated.pushState||History.bugs.safariPoll)&&History.hasUrlDuplicate(newState)){newState.url=newState.hashedUrl;}
return newState;};History.createStateObject=function(data,title,url){var State={'data':data,'title':title,'url':url};State=History.normalizeState(State);return State;};History.getStateById=function(id){id=String(id);var State=History.idToState[id]||History.store.idToState[id]||undefined;return State;};History.getStateString=function(passedState){var State,cleanedState,str;State=History.normalizeState(passedState);cleanedState={data:State.data,title:passedState.title,url:passedState.url};str=JSON.stringify(cleanedState);return str;};History.getStateId=function(passedState){var State,id;State=History.normalizeState(passedState);id=State.id;return id;};History.getHashByState=function(passedState){var State,hash;State=History.normalizeState(passedState);hash=State.hash;return hash;};History.extractId=function(url_or_hash){var id,parts,url;parts=/(.*)\&_suid=([0-9]+)$/.exec(url_or_hash);url=parts?(parts[1]||url_or_hash):url_or_hash;id=parts?String(parts[2]||''):'';return id||false;};History.isTraditionalAnchor=function(url_or_hash){var isTraditional=!(/[\/\?\.]/.test(url_or_hash));return isTraditional;};History.extractState=function(url_or_hash,create){var State=null,id,url;create=create||false;id=History.extractId(url_or_hash);if(id){State=History.getStateById(id);}
if(!State){url=History.getFullUrl(url_or_hash);id=History.getIdByUrl(url)||false;if(id){State=History.getStateById(id);}
if(!State&&create&&!History.isTraditionalAnchor(url_or_hash)){State=History.createStateObject(null,null,url);}}
return State;};History.getIdByUrl=function(url){var id=History.urlToId[url]||History.store.urlToId[url]||undefined;return id;};History.getLastSavedState=function(){return History.savedStates[History.savedStates.length-1]||undefined;};History.getLastStoredState=function(){return History.storedStates[History.storedStates.length-1]||undefined;};History.hasUrlDuplicate=function(newState){var hasDuplicate=false,oldState;oldState=History.extractState(newState.url);hasDuplicate=oldState&&oldState.id!==newState.id;return hasDuplicate;};History.storeState=function(newState){History.urlToId[newState.url]=newState.id;History.storedStates.push(History.cloneObject(newState));return newState;};History.isLastSavedState=function(newState){var isLast=false,newId,oldState,oldId;if(History.savedStates.length){newId=newState.id;oldState=History.getLastSavedState();oldId=oldState.id;isLast=(newId===oldId);}
return isLast;};History.saveState=function(newState){if(History.isLastSavedState(newState)){return false;}
History.savedStates.push(History.cloneObject(newState));return true;};History.getStateByIndex=function(index){var State=null;if(typeof index==='undefined'){State=History.savedStates[History.savedStates.length-1];}
else if(index<0){State=History.savedStates[History.savedStates.length+index];}
else{State=History.savedStates[index];}
return State;};History.getHash=function(){var hash=History.unescapeHash(document.location.hash);return hash;};History.unescapeString=function(str){var result=str,tmp;while(true){tmp=window.unescape(result);if(tmp===result){break;}
result=tmp;}
return result;};History.unescapeHash=function(hash){var result=History.normalizeHash(hash);result=History.unescapeString(result);return result;};History.normalizeHash=function(hash){var result=hash.replace(/[^#]*#/,'').replace(/#.*/,'');return result;};History.setHash=function(hash,queue){var adjustedHash,State,pageUrl;if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.setHash,args:arguments,queue:queue});return false;}
adjustedHash=History.escapeHash(hash);History.busy(true);State=History.extractState(hash,true);if(State&&!History.emulated.pushState){History.pushState(State.data,State.title,State.url,false);}
else if(document.location.hash!==adjustedHash){if(History.bugs.setHash){pageUrl=History.getPageUrl();History.pushState(null,null,pageUrl+'#'+adjustedHash,false);}
else{document.location.hash=adjustedHash;}}
return History;};History.escapeHash=function(hash){var result=History.normalizeHash(hash);result=window.escape(result);if(!History.bugs.hashEscape){result=result.replace(/\%21/g,'!').replace(/\%26/g,'&').replace(/\%3D/g,'=').replace(/\%3F/g,'?');}
return result;};History.getHashByUrl=function(url){var hash=String(url).replace(/([^#]*)#?([^#]*)#?(.*)/,'$2');hash=History.unescapeHash(hash);return hash;};History.setTitle=function(newState){var title=newState.title,firstState;if(!title){firstState=History.getStateByIndex(0);if(firstState&&firstState.url===newState.url){title=firstState.title||History.options.initialTitle;}}
try{document.getElementsByTagName('title')[0].innerHTML=title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');}
catch(Exception){}
document.title=title;return History;};History.queues=[];History.busy=function(value){if(typeof value!=='undefined'){History.busy.flag=value;}
else if(typeof History.busy.flag==='undefined'){History.busy.flag=false;}
if(!History.busy.flag){clearTimeout(History.busy.timeout);var fireNext=function(){var i,queue,item;if(History.busy.flag)return;for(i=History.queues.length-1;i>=0;--i){queue=History.queues[i];if(queue.length===0)continue;item=queue.shift();History.fireQueueItem(item);History.busy.timeout=setTimeout(fireNext,History.options.busyDelay);}};History.busy.timeout=setTimeout(fireNext,History.options.busyDelay);}
return History.busy.flag;};History.busy.flag=false;History.fireQueueItem=function(item){return item.callback.apply(item.scope||History,item.args||[]);};History.pushQueue=function(item){History.queues[item.queue||0]=History.queues[item.queue||0]||[];History.queues[item.queue||0].push(item);return History;};History.queue=function(item,queue){if(typeof item==='function'){item={callback:item};}
if(typeof queue!=='undefined'){item.queue=queue;}
if(History.busy()){History.pushQueue(item);}else{History.fireQueueItem(item);}
return History;};History.clearQueue=function(){History.busy.flag=false;History.queues=[];return History;};History.stateChanged=false;History.doubleChecker=false;History.doubleCheckComplete=function(){History.stateChanged=true;History.doubleCheckClear();return History;};History.doubleCheckClear=function(){if(History.doubleChecker){clearTimeout(History.doubleChecker);History.doubleChecker=false;}
return History;};History.doubleCheck=function(tryAgain){History.stateChanged=false;History.doubleCheckClear();if(History.bugs.ieDoubleCheck){History.doubleChecker=setTimeout(function(){History.doubleCheckClear();if(!History.stateChanged){tryAgain();}
return true;},History.options.doubleCheckInterval);}
return History;};History.safariStatePoll=function(){var
urlState=History.extractState(document.location.href),newState;if(!History.isLastSavedState(urlState)){newState=urlState;}
else{return;}
if(!newState){newState=History.createStateObject();}
History.Adapter.trigger(window,'popstate');return History;};History.back=function(queue){if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.back,args:arguments,queue:queue});return false;}
History.busy(true);History.doubleCheck(function(){History.back(false);});history.go(-1);return true;};History.forward=function(queue){if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.forward,args:arguments,queue:queue});return false;}
History.busy(true);History.doubleCheck(function(){History.forward(false);});history.go(1);return true;};History.go=function(index,queue){var i;if(index>0){for(i=1;i<=index;++i){History.forward(queue);}}
else if(index<0){for(i=-1;i>=index;--i){History.back(queue);}}
else{throw new Error('History.go: History.go requires a positive or negative integer passed.');}
return History;};if(History.emulated.pushState){var emptyFunction=function(){};History.pushState=History.pushState||emptyFunction;History.replaceState=History.replaceState||emptyFunction;}
else{History.onPopState=function(event,extra){var stateId=false,newState=false,currentHash,currentState;History.doubleCheckComplete();currentHash=History.getHash();if(currentHash){currentState=History.extractState(currentHash||document.location.href,true);if(currentState){History.replaceState(currentState.data,currentState.title,currentState.url,false);}
else{History.Adapter.trigger(window,'anchorchange');History.busy(false);}
History.expectedStateId=false;return false;}
stateId=History.Adapter.extractEventData('state',event,extra)||false;if(stateId){newState=History.getStateById(stateId);}
else if(History.expectedStateId){newState=History.getStateById(History.expectedStateId);}
else{newState=History.extractState(document.location.href);}
if(!newState){newState=History.createStateObject(null,null,document.location.href);}
History.expectedStateId=false;if(History.isLastSavedState(newState)){History.busy(false);return false;}
History.storeState(newState);History.saveState(newState);History.setTitle(newState);History.Adapter.trigger(window,'statechange');History.busy(false);return true;};History.Adapter.bind(window,'popstate',History.onPopState);History.pushState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState){throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');}
if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.pushState,args:arguments,queue:queue});return false;}
History.busy(true);var newState=History.createStateObject(data,title,url);if(History.isLastSavedState(newState)){History.busy(false);}
else{History.storeState(newState);History.expectedStateId=newState.id;history.pushState(newState.id,newState.title,newState.url);History.Adapter.trigger(window,'popstate');}
return true;};History.replaceState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState){throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');}
if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.replaceState,args:arguments,queue:queue});return false;}
History.busy(true);var newState=History.createStateObject(data,title,url);if(History.isLastSavedState(newState)){History.busy(false);}
else{History.storeState(newState);History.expectedStateId=newState.id;history.replaceState(newState.id,newState.title,newState.url);History.Adapter.trigger(window,'popstate');}
return true;};}
if(sessionStorage){try{History.store=JSON.parse(sessionStorage.getItem('History.store'))||{};}
catch(err){History.store={};}
History.normalizeStore();}
else{History.store={};History.normalizeStore();}
History.Adapter.bind(window,"beforeunload",History.clearAllIntervals);History.Adapter.bind(window,"unload",History.clearAllIntervals);History.saveState(History.storeState(History.extractState(document.location.href,true)));if(sessionStorage){History.onUnload=function(){var currentStore,item;try{currentStore=JSON.parse(sessionStorage.getItem('History.store'))||{};}
catch(err){currentStore={};}
currentStore.idToState=currentStore.idToState||{};currentStore.urlToId=currentStore.urlToId||{};currentStore.stateToId=currentStore.stateToId||{};for(item in History.idToState){if(!History.idToState.hasOwnProperty(item)){continue;}
currentStore.idToState[item]=History.idToState[item];}
for(item in History.urlToId){if(!History.urlToId.hasOwnProperty(item)){continue;}
currentStore.urlToId[item]=History.urlToId[item];}
for(item in History.stateToId){if(!History.stateToId.hasOwnProperty(item)){continue;}
currentStore.stateToId[item]=History.stateToId[item];}
History.store=currentStore;History.normalizeStore();sessionStorage.setItem('History.store',JSON.stringify(currentStore));};History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));History.Adapter.bind(window,'beforeunload',History.onUnload);History.Adapter.bind(window,'unload',History.onUnload);}
if(!History.emulated.pushState){if(History.bugs.safariPoll){History.intervalList.push(setInterval(History.safariStatePoll,History.options.safariPollInterval));}
if(navigator.vendor==='Apple Computer, Inc.'||(navigator.appCodeName||'')==='Mozilla'){History.Adapter.bind(window,'hashchange',function(){History.Adapter.trigger(window,'popstate');});if(History.getHash()){History.Adapter.onDomLoad(function(){History.Adapter.trigger(window,'hashchange');});}}}};History.init();})(window);(function(window,undefined){"use strict";var
History=window.History=window.History||{},jQuery=window.jQuery;if(typeof History.Adapter!=='undefined'){throw new Error('History.js Adapter has already been loaded...');}
History.Adapter={bind:function(el,event,callback){jQuery(el).bind(event,callback);},trigger:function(el,event,extra){jQuery(el).trigger(event,extra);},extractEventData:function(key,event,extra){var result=(event&&event.originalEvent&&event.originalEvent[key])||(extra&&extra[key])||undefined;return result;},onDomLoad:function(callback){jQuery(callback);}};if(typeof History.init!=='undefined'){History.init();}})(window);;
/*
 * jQuery Cookie Plugin v1.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($,document){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
$.cookie=function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value==null)){options=$.extend({},$.cookie.defaults,options);if(value==null){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=String(value);return(document.cookie=[encodeURIComponent(key),'=',options.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
options=value||$.cookie.defaults||{};var decode=options.raw?raw:decoded;var cookies=document.cookie.split('; ');for(var i=0,parts;(parts=cookies[i]&&cookies[i].split('='));i++){if(decode(parts.shift())===key){return decode(parts.join('='));}}
return null;};$.cookie.defaults={};})(jQuery,document);;Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);}else if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;}else{throw new TypeError(date1+" - "+date2);}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);};$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;}}
return-1;};$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];};$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}
return null;};$D.getTimezoneOffset=function(name){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;}}
return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);};$P.isToday=function(){return this.isSameDay(new Date());};$P.isSameDay=function(date){return this.clone().clearTime().equals(date.clone().clearTime());};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);};$P.addDays=function(value){this.setDate(this.getDate()+value);return this;};$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;return this;}
var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);}
if(x.seconds){this.addSeconds(x.seconds);}
if(x.minutes){this.addMinutes(x.minutes);}
if(x.hours){this.addHours(x.hours);}
if(x.weeks){this.addWeeks(x.weeks);}
if(x.months){this.addMonths(x.months);}
if(x.years){this.addYears(x.years);}
if(x.days){this.addDays(x.days);}
return this;};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;f=$d+((153*($m-3)+2)/5)+58+s;}
g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);}else if(n>364+s){w=1;}else{w=(n/7|0)+1;}
$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());};$D._validate=function(n,min,max,name){if(typeof n=="undefined"){return false;}else if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");}
return true;};$D.validateMillisecond=function(value){return $D._validate(value,0,999,"millisecond");};$D.validateSecond=function(value){return $D._validate(value,0,59,"second");};$D.validateMinute=function(value){return $D._validate(value,0,59,"minute");};$D.validateHour=function(value){return $D._validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return $D._validate(value,1,$D.getDaysInMonth(year,month),"day");};$D.validateMonth=function(value){return $D._validate(value,0,11,"month");};$D.validateYear=function(value){return $D._validate(value,0,9999,"year");};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());}
if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());}
if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());}
if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}
if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());}
if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());}
if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());}
if(config.timezone){this.setTimezone(config.timezone);}
if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);}
if(config.week&&$D._validate(config.week,0,53,"week")){this.setWeek(config.week);}
return this;};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;}
else if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);}
return this;}
return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);}};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?'0'+n:n;}
return'"'+this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z"';};}
$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$C.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);}}
var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");}
x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());default:return m;}}):this._toString();};}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,$N=Number.prototype;$P._orient=+1;$P._nth=null;$P._is=false;$P._same=false;$P._isSecond=false;$N._dateElement="day";$P.next=function(){this._orient=+1;return this;};$D.next=function(){return $D.today().next();};$P.last=$P.prev=$P.previous=function(){this._orient=-1;return this;};$D.last=$D.prev=$D.previous=function(){return $D.today().last();};$P.is=function(){this._is=true;return this;};$P.same=function(){this._same=true;this._isSecond=false;return this;};$P.today=function(){return this.same().day();};$P.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}
return false;};$P.at=function(time){return(typeof time==="string")?$D.parse(this.toString("d")+" "+time):this.set(time);};$N.fromNow=$N.after=function(date){var c={};c[this._dateElement]=this;return((!date)?new Date():date.clone()).add(c);};$N.ago=$N.before=function(date){var c={};c[this._dateElement]=this*-1;return((!date)?new Date():date.clone()).add(c);};var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),pxf=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),nth=("final first second third fourth fifth").split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++){o[px[i].toLowerCase()]=this["get"+pxf[i]]();}
return o;};$D.fromObject=function(config){config.week=null;return Date.today().set(config);};var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n;}
if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}
this._isSecond=false;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp){throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");}
return this;}
return this.moveToDayOfWeek(n,this._orient);};};var sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();if(n===0&&$C.firstDayOfWeek===1&&t.getDay()!==0){shift=shift+7;}
return t.addDays(shift);};};for(var i=0;i<dx.length;i++){$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i;$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i);$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);}
var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n;}
return this.moveToMonth(n,this._orient);};};var smf=function(n){return function(){return $D.today().set({month:n,day:1});};};for(var j=0;j<mx.length;j++){$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j;$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j);$P[mx[j]]=$P[mx[j].substring(0,3)]=mf(j);}
var ef=function(j){return function(){if(this._isSecond){this._isSecond=false;return this;}
if(this._same){this._same=this._is=false;var o1=this.toObject(),o2=(arguments[0]||new Date()).toObject(),v="",k=j.toLowerCase();for(var m=(px.length-1);m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v]){return false;}
if(k==v){break;}}
return true;}
if(j.substring(j.length-1)!="s"){j+="s";}
return this["add"+j](this._orient);};};var nf=function(n){return function(){this._dateElement=n;return this;};};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$P[de]=$P[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de);}
$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){if(this._same){return this._ss(arguments[0]);}
if(dayOfWeek||dayOfWeek===0){return this.moveToNthOccurrence(dayOfWeek,n);}
this._nth=n;if(n===2&&(dayOfWeek===undefined||dayOfWeek===null)){this._isSecond=true;return this.addSeconds(this._orient);}
return this;};};for(var l=0;l<nth.length;l++){$P[nth[l]]=(l===0)?nthfn(-1):nthfn(l);}}());(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'";}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)]);}else{throw new $P.Exception(s);}};},token:function(s){return function(s){return _.rtoken(new RegExp("^\s*"+s+"\s*"))(s);};},stoken:function(s){return _.rtoken(new RegExp("^"+s));},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s);}catch(e){qx.push(rx[0]);s=rx[1];continue;}
break;}
return[qx,s];};},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s);}catch(e){return[rx,s];}
rx.push(r[0]);s=r[1];}
return[rx,s];};},optional:function(p){return function(s){var r=null;try{r=p.call(this,s);}catch(e){return[null,s];}
return[r[0],r[1]];};},not:function(p){return function(s){try{p.call(this,s);}catch(e){return[null,s];}
throw new $P.Exception(s);};},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]];}:null;},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx));}
return rx;},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s));}catch(e){r=cache[s]=e;}
if(r instanceof $P.Exception){throw r;}else{return r;}};},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){r=null;}
if(r){return r;}}
throw new $P.Exception(s);};},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){throw new $P.Exception(s);}
rx.push(r[0]);s=r[1];}
return[rx,s];};},all:function(){var px=arguments,_=_;return _.each(_.optional(px));},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0];}
return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s);}catch(e){break;}
rx.push(r[0]);try{q=d.call(this,r[1]);}catch(ex){q=null;break;}
s=q[1];}
if(!r){throw new $P.Exception(s);}
if(q){throw new $P.Exception(q[1]);}
if(c){try{r=c.call(this,r[1]);}catch(ey){throw new $P.Exception(r[1]);}}
return[rx,(r?r[1]:s)];};},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]];};},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)));},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s);}catch(e){continue;}
rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1]);}catch(ex){last=true;}}else{last=true;}
if(!last&&q[1].length===0){last=true;}
if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j]);}}
p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1];}}
if(rx[1].length<best[1].length){best=rx;}
if(best[1].length===0){break;}}
if(best[0].length===0){return best;}
if(c){try{q=c.call(this,best[1]);}catch(ey){throw new $P.Exception(best[1]);}
best[1]=q[1];}
return best;};},forward:function(gr,fname){return function(s){return gr[fname].call(this,s);};},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]];};},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]];};},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s);}
return rx;};}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments);}else if(arguments[0]instanceof Array){args=arguments[0];}
if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx;}}else{return op.apply(null,arguments);}};};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]]);}
var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0]);}else{return op.apply(null,arguments);}};};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]]);}}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo;var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]));}else{if(ax[i]){rx.push(ax[i]);}}}
return rx;};$D.Grammar={};$D.Translator={hour:function(s){return function(){this.hour=Number(s);};},minute:function(s){return function(){this.minute=Number(s);};},second:function(s){return function(){this.second=Number(s);};},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase();};},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n);}else{this.timezone=s.toLowerCase();}};},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0]);};},month:function(s){return function(){this.month=(s.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1;};},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<$C.twoDigitYearMax)?2000:1900)));};},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(x){x=(x instanceof Array)?x:[x];for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this);}}
var now=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=now.getDate();}
if(!this.year){this.year=now.getFullYear();}
if(!this.month&&this.month!==0){this.month=now.getMonth();}
if(!this.day){this.day=1;}
if(!this.hour){this.hour=0;}
if(!this.minute){this.minute=0;}
if(!this.second){this.second=0;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.day>$D.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}
var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone});}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset});}
return r;},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null;}
for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this);}}
var today=$D.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else if(this.now){today=new Date();}
var expression=!!(this.days&&this.days!==null||this.orient||this.operator);var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){today.setTimeToNow();}
if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;expression=true;}}
if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(!this.month){this.month=temp.getMonth();}
this.year=temp.getFullYear();}
if(expression&&this.weekday&&this.unit!="month"){this.unit="day";gap=($D.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod);}
if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}
if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}
if(this.month&&!this.day&&this.value){today.set({day:this.value*1});if(!expression){this.day=this.value*1;}}
if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;expression=true;}
if(expression&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null;}
if(!this.unit){this.unit="day";}
if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*orient;}else if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}
this[this.unit+"s"]=this.value*orient;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(temp.getMonth()!==today.getMonth()){this.month=temp.getMonth();}}
if((this.month||this.month===0)&&!this.day){this.day=1;}
if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}
if(expression&&this.timezone&&this.day&&this.days){this.day=this.days;}
return(expression)?today.add(this):today.set(this);}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$C.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));}
fn=_C[keys]=_.any.apply(null,px);}
return fn;};g.ctoken2=function(key){return _.rtoken($C.regexPatterns[key]);};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s;};}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")));};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s;};});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s;};});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s;};});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"");};});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter);};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[$C.dateElementOrder]||g.mdy).call(this,s));};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt];}else{throw $D.Parsing.Exception(fmt);}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s));}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact);});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0]);};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]));}
return _.any.apply(null,rx);}else{return _get(fx);}};g._formats=g.formats(["\"yyyy-MM-ddTHH:mm:ssZ\"","yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r;}}catch(e){}
return g._start.call({},s);};$D._parse=$D.parse;$D.parse=function(s){var r=null;if(!s){return null;}
if(s instanceof Date){return s;}
try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};};$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s);};}());;function TimeMachine(){'use strict';var _fixedTime=null;this.__construct=function()
{if($.cookie('TimeMachine')){_fixedTime=$.cookie('TimeMachine');}}
this.now=function()
{'use strict';return(_fixedTime)?_fixedTime:Date.now();}
this.returnToPresent=function()
{'use strict';_fixedTime=false;}
this.toBeContinued=function()
{$.cookie('TimeMachine',_fixedTime);}
this.travel=function(newTime)
{'use strict';_fixedTime=Date.parse(newTime);}
this.__construct();}
var DeLorean=new TimeMachine();;(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);;$(function(){$('.home-text').hide();App.aliases={"new haven":{"id_community":"1","prep":"at","name_alt":"New Haven"},"yale":{"id_community":"1","prep":"at","name_alt":"Yale"},"san-francisco":{"id_community":"2","prep":"in","name_alt":"San Francisco"},"los angeles":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"la":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"venice":{"id_community":"12","prep":"at","name_alt":"Venice Beach"},"playa":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"loyola":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"lmu":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"ucla":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"santa monica":{"id_community":"3","prep":"at","name_alt":"Santa Monica"},"sm":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"mdr":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"marina del rey":{"id_community":"3","prep":"at","name_alt":"Marina Del Rey"},"culver":{"id_community":"3","prep":"near","name_alt":"Los Angeles"},"santa-monica":{"id_community":"3","prep":"near","name_alt":"Santa Monica"},"brown":{"id_community":"4","prep":"at","name_alt":"Brown University"},"providence":{"id_community":"4","prep":"in","name_alt":"Providence"},"betaspring":{"id_community":"5","prep":"at","name_alt":"Betaspring"},"dc":{"id_community":"8","prep":"at","name_alt":"DC"},"gwu":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"george washington":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"george washington university":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"the district":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"district of columbia":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"foggy bottom":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"georgetown":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"gu":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"georgetown university":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"gw":{"id_community":"8","prep":"at","name_alt":"Washington DC"},"cambridge":{"id_community":"9","prep":"at","name_alt":"Cambridge"},"the game":{"id_community":"9","prep":null,"name_alt":null},"hahvahd":{"id_community":"9","prep":null,"name_alt":null},"boston":{"id_community":"9","prep":"at","name_alt":"Harvard University"},"somerville":{"id_community":"9","prep":null,"name_alt":null},"harvard":{"id_community":"9","prep":"at","name_alt":"Cambridge"},"boulder":{"id_community":"10","prep":"in","name_alt":"Boulder"},"cal tech":{"id_community":"11","prep":"in","name_alt":"Pasadena"},"caltech":{"id_community":"11","prep":"in","name_alt":"Pasadena"},"pasadena":{"id_community":"11","prep":"in","name_alt":"Pasadena"},"california institute of technology":{"id_community":"11","prep":"in","name_alt":"Pasadena"},"cal-tech":{"id_community":"11","prep":"in","name_alt":"Pasadena"}};App.locations={"1":{"loc_lat":"41.310598","loc_lon":"-72.927933","range":"2"},"2":{"loc_lat":"37.0625","loc_lon":"-95.677068","range":"2"},"3":{"loc_lat":"33.985092","loc_lon":"-118.446547","range":"2"},"4":{"loc_lat":"41.842071","loc_lon":"-71.405811","range":"2"},"5":{"loc_lat":"41.818712","loc_lon":"-71.411775","range":"2"},"6":{"loc_lat":"34.019301","loc_lon":"-118.490381","range":"2"},"8":{"loc_lat":"38.90466","loc_lon":"-77.056174","range":"2"},"9":{"loc_lat":"42.376173","loc_lon":"-71.115757","range":"2"},"10":{"loc_lat":"40.0149856","loc_lon":"-105.27054559999999 ","range":"2"},"11":{"loc_lat":"34.137898","loc_lon":"-118.125132","range":"2"},"12":{"loc_lat":"33.998098","loc_lon":"-118.465233","range":"2"}};App.facebookScope='email';App.communities={};App.communities['boulder']={'id_community':"10",'name':"Boulder",'permalink':"boulder",'loc_lat':"40.0149856",'loc_lon':"-105.27054559999999 ",'active':"1",'private':"0",'prep':"in",'name_alt':"",'range':"2",'id':"10",stored:true};App.communities['cal-tech']={'id_community':"11",'name':"Cal Tech",'permalink':"cal-tech",'loc_lat':"34.137898",'loc_lon':"-118.125132",'active':"1",'private':"0",'prep':"in",'name_alt':"Pasadena",'range':"2",'id':"11",stored:true};App.communities['gw']={'id_community':"8",'name':"GW",'permalink':"gw",'loc_lat':"38.90466",'loc_lon':"-77.056174",'active':"1",'private':"0",'prep':"at",'name_alt':"Washington DC",'range':"2",'id':"8",stored:true};App.communities['marina-del-rey']={'id_community':"3",'name':"Marina Del Rey",'permalink':"marina-del-rey",'loc_lat':"33.985092",'loc_lon':"-118.446547",'active':"1",'private':"0",'prep':"near",'name_alt':"Los Angeles",'range':"2",'id':"3",stored:true};App.communities['providence']={'id_community':"4",'name':"Providence",'permalink':"providence",'loc_lat':"41.842071",'loc_lon':"-71.405811",'active':"1",'private':"0",'prep':"in",'name_alt':"",'range':"2",'id':"4",stored:true};App.communities['venice']={'id_community':"12",'name':"Venice",'permalink':"venice",'loc_lat':"33.998098",'loc_lon':"-118.465233",'active':"1",'private':"0",'prep':"at",'name_alt':"Venice Beach",'range':"2",'id':"12",stored:true};App.communities['yale']={'id_community':"1",'name':"Yale",'permalink':"yale",'loc_lat':"41.310598",'loc_lon':"-72.927933",'active':"1",'private':"0",'prep':"at",'name_alt':"New Haven",'range':"2",'id':"1",stored:true};App.topCommunities=[];App.topCommunities[App.topCommunities.length]={alias:'new haven',name:'New Haven'};App.topCommunities[App.topCommunities.length]={alias:'providence',name:'Providence'};App.topCommunities[App.topCommunities.length]={alias:'dc',name:'DC'};App.topCommunities[App.topCommunities.length]={alias:'venice',name:'Venice Beach'};});;var App={cartHighlightEnabled:false,currentPage:null,tagline:'',service:'/api/',cached:{},community:null,page:{},config:null,forceHome:false,cookieExpire:new Date(3000,01,01),order:{cardChanged:false,pay_type:'card',delivery_type:'delivery',tip:'autotip'},signin:{},suggestion:{},restaurants:{permalink:'food-delivery',list:false},defaultTip:'autotip',defaultRange:2,modal:{},hasBack:false,_init:false,_pageInit:false,_identified:false,isDeliveryAddressOk:false,tips:[0,10,15,18,20,25,30],touchX:null,touchY:null,touchOffset:null,crunchSoundAlreadyPlayed:false,useCompleteAddress:true,boundingBoxMeters:8000,useRestaurantBoundingBox:false};App.loadRestaurant=function(id){App.cache('Restaurant',id,function(){if(!this.open()){alert("This restaurant is currently closed. It will be open during the following hours ("+this._tzabbr+"):\n\n"+this.closedMessage());App.busy.unBusy();}else{if(this.redirect){location.href=this.redirect;return;}
var loc='/'+App.restaurants.permalink+'/'+this.permalink;History.pushState({},'Crunchbutton - '+this.name,loc);}});};App.routeAlias=function(id,success,error){id=id.toLowerCase();alias=App.aliases[id]||false;success=success||function(){};error=error||function(){};if(alias){var loc=App.locations[alias.id_community];if(loc.loc_lat&&loc.loc_lon){var res={lat:loc.loc_lat,lon:loc.loc_lon,prep:alias.prep,city:alias.name_alt,address:alias.name_alt};App.loc.range=loc.range||App.defaultRange;success({alias:res});return;}}
error();};App.loadHome=function(force){$('input').blur();App.currentPage='home';History.pushState({},'Crunchbutton','/');App.page.home(force);};App.render=function(template,data){var compiled=_.template($('.template-'+template).html());return compiled(data);};App.showPage=function(params){App.credit.hide();App.currentPage=params.page;if(params.title){document.title=params.title;}
if(params.tracking){App.track(params.tracking.title,params.tracking.data);}
$('.main-content').html(App.render(params.page,params.data));};App.loadPage=function(){if(App.isChromeForIOS()){App.message.chrome();}
App.signin.checkUser();setTimeout(function(){App.signin.checkUser()},500);var url=History.getState().url.replace(/http(s)?:\/\/.*?\/(.*)/,'$2').replace('//','/');url=url.split('?')[0];var path=url.split('/');if(!path[path.length-1]){delete path[path.length-1];}
if(!App.config){return;}
if(App._pageInit){$('.main-content').css('visibility','0');}else{App._pageInit=true;}
if(!url&&App.hasBack){App.forceHome=false;App.page.home();return;}
if(!url){App.loadHome();return;}
var restaurantRegex=new RegExp('^\/(restaurant)|('+App.restaurants.permalink+')/','i');var cleaned_url=$.trim(url.replace('/',''));App.hasBack=true;switch(true){case /^legal/i.test(url):App.page.legal();break;case /^help/i.test(url):App.page.help();break;case /^orders/i.test(url):App.page.orders();break;case /^order/i.test(url):App.page.order(path[1]);break;case /^reset/i.test(url):App.page.resetPassword(path);break;case /^giftcard/i.test(url):App.page.giftCard(path);break;case new RegExp(App.restaurants.permalink+'$','i').test(cleaned_url):App.page.foodDelivery();break;case restaurantRegex.test(url):App.page.restaurant(path[1]);break;default:App.routeAlias(path[0],function(result){App.loc.realLoc={addressAlias:result.alias.address,lat:result.alias.lat,lon:result.alias.lon,prep:result.alias.prep,city:result.alias.city};App.loc.setFormattedLocFromResult();App.page.foodDelivery(true);});$('.footer').removeClass('footer-hide');setTimeout(scrollTo,80,0,1);setTimeout(function(){App.signin.checkUser();},100);break;}
if(App.config.env=='live'){$('.footer').addClass('footer-hide');}
App.refreshLayout();$('.main-content').css('visibility','1');setTimeout(scrollTo,80,0,1);setTimeout(function(){App.signin.checkUser();},300);};App.refreshLayout=function(){setTimeout(function(){scrollTo(0,1);},80);};App.track=function(){if(App.config.env!='live'){}
if(arguments[0]=='Ordered'){$('img.conversion').remove();mixpanel.people.track_charge(arguments[1].total);var i=$('<img class="conversion" src="https://www.googleadservices.com/pagead/conversion/996753959/?value='+Math.floor(arguments[1].total)+'&amp;label=-oawCPHy2gMQp4Sl2wM&amp;guid=ON&amp;script=0&url='+History.getState().url+'">').appendTo($('body'));}
if(arguments[1]){mixpanel.track(arguments[0],arguments[1]);}else{mixpanel.track(arguments[0]);}};App.trackProperty=function(prop,value){if(!App.config){return;}
var params={};params[prop]=value;mixpanel.register_once(params);};App.identify=function(){if(App.config.env!='live'){}
if(App.config.user.uuid){mixpanel.identify(App.config.user.uuid);mixpanel.people.set({$name:App.config.user.name,$ip:App.config.user.ip,$email:App.config.user.email});}};App.AB={options:{tagline:[{name:'tagline-for-free',tagline:'Order the top food %s. For free. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'},{name:'tagline-no-free',tagline:'Order the top food %s. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'}],slogan:[{name:'slogan-push-food',slogan:'Push a button. Get Food.'}],restaurantPage:[{name:'restaurant-page-noimage'},{name:'restaurant-page-image',disabled:true}],dollarSign:[{name:'show'},{name:'hide'}],},init:function(){if(!App.config.ab){App.AB.create(true);}
App.AB.load();},create:function(clear){if(clear){App.config.ab={};}
_.each(App.AB.options,function(option,key){if(App.config.ab[key]){return;}
var opts=_.filter(App.AB.options[key],function(o){return o.disabled?false:true;});var opt=opts[Math.floor(Math.random()*opts.length)];App.config.ab[key]=opt.name
App.trackProperty('AB-'+key,opt.name);});App.AB.save();console.log(App.config.ab);},load:function(){App.slogan=_.findWhere(App.AB.options.slogan,{name:App.config.ab.slogan});App.tagline=_.findWhere(App.AB.options.tagline,{name:App.config.ab.tagline});if(!App.slogan||!App.tagline){App.AB.create(true);App.AB.load(true);}},save:function(){$.ajax({url:App.service+'config',data:{ab:App.config.ab},dataType:'json',type:'POST',complete:function(json){}});}};App.cart={uuidInc:0,items:{},uuid:function(){var id='c-'+App.cart.uuidInc;App.cart.uuidInc++;return id;},add:function(item){var
id=App.cart.uuid(),opt=App.cached['Dish'][item].options(),options=[];if(arguments[1]){options=arguments[1].options;}else{for(var x in opt){if(opt[x]['default']==1){options[options.length]=opt[x].id_option;}}}
App.cart.items[id]={id:item,options:options};var el=$('<div class="cart-item cart-item-dish" data-cart_id="'+id+'"></div>');el.append('<div class="cart-button cart-button-remove"><span></span></div>');el.append('<div class="cart-item-name">'+App.cache('Dish',item).name+' <span class="cart-item-description">'+(App.cache('Dish',item).description!=null?App.cache('Dish',item).description:'')+'</span></div>');if(App.cached['Dish'][item].options().length){el.append('<div class="cart-item-config"><a href="javascript:;">Customize</a></div>');}
el.hide();if($(window).width()>769){$('.cart-items-content').append(el);}else{$('.cart-items-content').prepend(el);}
el.show();if(parseInt(App.cache('Dish',item).expand_view)>0){App.cart.customize(el);}
App.cart.updateTotal();App.track('Dish added',{id_dish:App.cache('Dish',item).id_dish,name:App.cache('Dish',item).name});},clone:function(item){var
cartid=item.attr('data-cart_id'),cart=App.cart.items[cartid],newoptions=[];for(var x in cart.options){newoptions[newoptions.length]=cart.options[x];}
App.cart.add(cart.id,{options:newoptions});App.track('Dish cloned');},remove:function(item){var
cart=item.attr('data-cart_id');App.track('Dish removed');delete App.cart.items[cart];item.remove();$('.cart-item-customize[data-id_cart_item="'+cart+'"]').remove();App.cart.updateTotal();},updateTotal:function(){var
totalText=(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.charged(),tipText='',feesText='',totalItems=0,credit=0,hasFees=((App.restaurant.delivery_fee&&App.order.delivery_type=='delivery')||App.restaurant.fee_customer)?true:false;if(App.credit.restaurant[App.restaurant.id]){credit=parseFloat(App.credit.restaurant[App.restaurant.id]);}
for(var x in App.cart.items){totalItems++;}
App.updateAutotipValue();var wasTipChanged=false;if(App.order.delivery_type=='takeout'&&App.order['pay_type']=='card'){if(typeof App.order.tipHasChanged=='undefined'){App.order.tip=0;wasTipChanged=true;}}else if(App.order.delivery_type=='delivery'&&App.order['pay_type']=='card'){if(typeof App.order.tipHasChanged=='undefined'){App.order.tip=(App.config.user.last_tip)?App.config.user.last_tip:'autotip';App.order.tip=App.lastTipNormalize(App.order.tip);wasTipChanged=true;}}
if(wasTipChanged){$('[name="pay-tip"]').val(App.order.tip);totalText=(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.charged();}
if(App.restaurant.meetDeliveryMin()&&App.order.delivery_type=='delivery'){$('.delivery-minimum-error').show();$('.delivery-min-diff').html(App.restaurant.deliveryDiff());}else{$('.delivery-minimum-error').hide();}
$('.cart-summary-item-count span').html(totalItems);if(!this.subtotal()){$('.payment-total, .dp-display-payment').hide();}else{$('.payment-total, .dp-display-payment').show();}
var breakdown=App.cart.totalbreakdown();var extraCharges=App.cart.extraChargesText(breakdown);if(extraCharges){$('.cart-breakdownDescription').html((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.subtotal().toFixed(2)+' (+'+extraCharges+')');}else{$('.cart-breakdownDescription').html((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.subtotal().toFixed(2));}
if(App.order.pay_type=='card'&&credit>0){var creditLeft='';if(this.total()<credit){var creditLeft='<span class="gift-left"> - You\'ll still have '+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+App.ceil((credit-this.total())).toFixed(2)+' gift card left </span>';credit=this.total();}
$('.cart-gift').html('&nbsp;(- '+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+App.ceil(credit).toFixed(2)+' credit '+creditLeft+') ');}else{$('.cart-gift').html('');}
if(App.order.pay_type=='cash'&&credit>0){totalText+='<span class="giftcard-message">Hey! Pay with a card to make use of your '+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+App.ceil(credit).toFixed(2)+' gift card!</span>';}
$('.cart-total').html(totalText);if(App.order['pay_type']=='card'){$('.cash-order-aprox').html('');$('.cart-paymentType').html('by card');}else{$('.cash-order-aprox').html('approximately');$('.cart-paymentType').html('');}
if(App.cartHighlightEnabled&&$('.cart-summary').css('display')!='none'){$('.cart-summary').removeClass('cart-summary-detail');$('.cart-summary').effect('highlight',{},500,function(){$('.cart-summary').addClass('cart-summary-detail');});}
if($('.cart-total').html()==totalText){}
if(!totalItems){$('.default-order-check').hide();}else{$('.default-order-check').show();}
var
totalItems={},name,text='';$('.cart-summary-items').html('');for(var x in App.cart.items){name=App.cached['Dish'][App.cart.items[x].id].name;if(totalItems[name]){totalItems[name]++;}else{totalItems[name]=1;}}
for(x in totalItems){text=',&nbsp;&nbsp;'+text;if(totalItems[x]>1){text=x+'&nbsp;('+totalItems[x]+')'+text;}else{text=x+text;}}
$('.cart-summary-items').html(text.substr(0,text.length-13));$('.cart-item-customize-price').each(function(){var dish=$(this).closest('.cart-item-customize').attr('data-id_cart_item'),option=$(this).closest('.cart-item-customize-item').attr('data-id_option'),cartitem=App.cart.items[dish],opt=App.cached['Option'][option],price=opt.optionPrice(cartitem.options);$(this).html(App.cart.customizeItemPrice(price));});},customizeItemPrice:function(price){return price!='0.00'?'&nbsp;('+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+price.toFixed(2)+')':'';},customize:function(item){var
cart=item.attr('data-cart_id'),old=$('.cart-item-customize[data-id_cart_item="'+cart+'"]');if(old.length){old.remove();}else{var
el=$('<div class="cart-item-customize" data-id_cart_item="'+cart+'"></div>').insertAfter(item),cartitem=App.cart.items[cart],obj=App.cached['Dish'][cartitem.id],opt=obj.options();for(var x in opt){if(opt[x].id_option_parent){continue;}
if(opt[x].type=='check'){var price=opt[x].optionPrice(cartitem.options);var check=$('<input type="checkbox" class="cart-customize-check">');if($.inArray(opt[x].id_option,cartitem.options)!==-1){check.attr('checked','checked');}
var option=$('<div class="cart-item-customize-item" data-id_option="'+opt[x].id_option+'"></div>').append(check).append('<label class="cart-item-customize-name">'+
opt[x].name+(opt[x].description||'')+'</label><label class="cart-item-customize-price">'+
App.cart.customizeItemPrice(price)+'</label>');el.append(option);}}
for(var x in opt){if(opt[x].id_option_parent){continue;}
if(opt[x].type=='select'){var select=$('<select class="cart-customize-select">');for(var i in opt){if(opt[i].id_option_parent==opt[x].id_option){var option=$('<option value="'+opt[i].id_option+'">'+opt[i].name+(opt[i].description||'')+(opt[i].price!='0.00'||opt[x].price_linked=='1'?(' ('+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+(parseFloat(opt[i].price)+parseFloat(obj.price)).toFixed(2)+')'):'')+'</option>');if($.inArray(opt[i].id_option,cartitem.options)!==-1){option.attr('selected','selected');}
select.append(option);}}
var option=$('<div class="cart-item-customize-item" data-id_option="'+opt[x].id_option+'"></div>').append('<label class="cart-item-customize-select-name">'+opt[x].name+(opt[x].description||'')+'</label>').append(select);el.append(option);}}}
App.track('Dish customized');},customizeItem:function(item){var
cart=item.closest('.cart-item-customize').attr('data-id_cart_item'),cartitem=App.cart.items[cart],customitem=item.closest('.cart-item-customize-item'),opt=customitem.attr('data-id_option');if(opt){if(item.hasClass('cart-customize-select')){var obj=App.cached['Dish'][cartitem.id],opts=obj.options();for(var i in opts){if(opts[i].id_option_parent!=opt){continue;}
for(var x in cartitem.options){if(cartitem.options[x]==opts[i].id){cartitem.options.splice(x,1);break;}}}
cartitem.options[cartitem.options.length]=item.val();}else if(item.hasClass('cart-customize-check')){if(item.is(':checked')){cartitem.options[cartitem.options.length]=opt;}else{for(var x in cartitem.options){if(cartitem.options[x]==opt){cartitem.options.splice(x,1);break;}}}}}
App.cart.updateTotal();},extraChargesText:function(breakdown){var elements=[];var text='';if(breakdown.delivery){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.delivery.toFixed(2)+' delivery');}
if(breakdown.fee){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.fee.toFixed(2)+' fee');}
if(breakdown.taxes){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.taxes.toFixed(2)+' taxes');}
if(breakdown.tip&&breakdown.tip>0){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.tip+' tip');}
if(elements.length){if(elements.length>2){var lastOne=elements.pop();var elements=[elements.join(', ')];elements.push(lastOne);}
var text=elements.join(' & ');}
return text;},getCart:function(){var cart=[];for(x in App.cart.items){cart[cart.length]=App.cart.items[x];}
return cart;},submit:function(){if(App.busy.isBusy()){return;}
App.busy.makeBusy();var read=$('.payment-form').length?true:false;if(read){App.config.user.name=$('[name="pay-name"]').val();App.config.user.phone=$('[name="pay-phone"]').val().replace(/[^\d]*/gi,'');if(App.order['delivery_type']=='delivery'){App.config.user.address=$('[name="pay-address"]').val();}
App.order.tip=$('[name="pay-tip"]').val();}
var order={cart:App.cart.getCart(),pay_type:App.order['pay_type'],delivery_type:App.order['delivery_type'],restaurant:App.restaurant.id,make_default:$('#default-order-check').is(':checked'),notes:$('[name="notes"]').val(),lat:(App.loc.pos())?App.loc.pos().lat:null,lon:(App.loc.pos())?App.loc.pos().lon:null};if(order.pay_type=='card'){order.tip=App.order.tip||'3';order.autotip_value=$('[name=pay-autotip-value]').val();}
if(read){order.address=App.config.user.address;order.phone=App.config.user.phone;order.name=App.config.user.name;if(App.order.cardChanged){order.card={number:$('[name="pay-card-number"]').val(),month:$('[name="pay-card-month"]').val(),year:$('[name="pay-card-year"]').val()};}else{order.card={};}}
console.log('ORDER:',order);var errors={};if(!order.name){errors['name']='Please enter your name.';}
if(!App.phone.validate(order.phone)){errors['phone']='Please enter a valid phone #.';}
if(order.delivery_type=='delivery'&&!order.address){errors['address']='Please enter an address.';}
if(order.pay_type=='card'&&((App.order.cardChanged&&!order.card.number)||(!App.config.user.id_user&&!order.card.number))){errors['card']='Please enter a valid card #.';}
if(!App.cart.hasItems()){errors['noorder']='Please add something to your order.';}
if(!$.isEmptyObject(errors)){var error='';for(var x in errors){error+=errors[x]+"\n";}
$('body').scrollTop($('.payment-form').position().top-80);alert(error);App.busy.unBusy();App.track('OrderError',errors);return;}
if(App.iOS()&&!App.crunchSoundAlreadyPlayed){App.playAudio('get-food-audio');App.crunchSoundAlreadyPlayed=true;}
if(order.delivery_type=='delivery'){if(!App.isDeliveryAddressOk){if(App.loc.aproxLoc){var latLong=new google.maps.LatLng(App.loc.aproxLoc.lat,App.loc.aproxLoc.lon);}
if(App.useRestaurantBoundingBox){var latLong=new google.maps.LatLng(App.restaurant.loc_lat,App.restaurant.loc_long);}
if(!latLong){alert('An error occurred');App.busy.unBusy();return;}
var success=function(results){var theClosestAddress=App.loc.theClosestAddress(results,latLong);var isTheAddressOk=App.loc.validateAddressType(theClosestAddress);if(isTheAddressOk){var lat=theClosestAddress.geometry.location.lat();var lon=theClosestAddress.geometry.location.lng();if(!App.restaurant.deliveryHere({lat:lat,lon:lon})){alert('Sorry, you are out of delivery range or have an invalid address. \nTry again, or order takeout.');App.busy.unBusy();}else{if(App.useCompleteAddress){$('[name=pay-address]').val(App.loc.formatedAddress(theClosestAddress));}
App.busy.unBusy();App.isDeliveryAddressOk=true;App.cart.submit();}}else{alert('Oops, it looks like your address is incomplete. \nPlease enter a street name, number and zip code.');App.busy.unBusy();$('.payment-form').show();$('.delivery-payment-info, .content-padder-before').hide();$('[name="pay-address"]').focus();}}
var error=function(){alert('Oops, it looks like your address is incomplete. \nPlease enter a street name, number and zip code.');App.busy.unBusy();};App.loc.doGeocodeWithBound(order.address,latLong,success,error);return;}}
if(order.delivery_type=='takeout'){App.isDeliveryAddressOk=true;}
if(!App.isDeliveryAddressOk){return;}
$.ajax({url:App.service+'order',data:order,dataType:'json',type:'POST',complete:function(json){json=$.parseJSON(json.responseText);if(json.status=='false'){var error='';for(x in json.errors){error+=json.errors[x]+"\n";}
App.track('OrderError',json.errors);alert(error);}else{if(!App.crunchSoundAlreadyPlayed){App.playAudio('get-food-audio');App.crunchSoundAlreadyPlayed=true;}
if(json.token){$.cookie('token',json.token,{expires:new Date(3000,01,01),path:'/'});}
$('.link-orders').show();order.cardChanged=false;App.justCompleted=true;var totalItems=0;for(var x in App.cart.items){totalItems++;}
$.getJSON('/api/config',App.processConfig);App.cache('Order',json.uuid,function(){App.track('Ordered',{'total':this.final_price,'subtotal':this.price,'tip':this.tip,'restaurant':App.restaurant.name,'paytype':this.pay_type,'ordertype':this.order_type,'user':this.user,'items':totalItems});App.order.cardChanged=false;delete App.order.tipHasChanged;var loc='/order/'+this.uuid;History.pushState({},loc,loc);});}
App.busy.unBusy();}});},subtotal:function(){var
total=0,options;for(var x in App.cart.items){total+=parseFloat(App.cached['Dish'][App.cart.items[x].id].price);options=App.cart.items[x].options;for(var xx in options){var option=App.cached['Option'][options[xx]];if(option===undefined)continue;total+=parseFloat(option.optionPrice(options));}}
total=App.ceil(total);return total;},_breackDownDelivery:function(){var delivery=0;if(App.restaurant.delivery_fee&&App.order.delivery_type=='delivery'){delivery=parseFloat(App.restaurant.delivery_fee);}
delivery=App.ceil(delivery);return delivery;},_breackDownFee:function(feeTotal){var fee=0;if(App.restaurant.fee_customer){fee=(feeTotal*(parseFloat(App.restaurant.fee_customer)/100));}
fee=App.ceil(fee);return fee;},_breackDownTaxes:function(feeTotal){var taxes=(feeTotal*(App.restaurant.tax/100));taxes=App.ceil(taxes);return taxes;},_breakdownTip:function(total){var tip=0;if(App.order['pay_type']=='card'){if(App.order.tip==='autotip'){return parseFloat($('[name=pay-autotip-value]').val());}
tip=(total*(App.order.tip/100));}
tip=App.ceil(tip);return tip;},total:function(){var
total=0,dish,options,feeTotal=0,totalItems=0,finalAmount=0;var breakdown=this.totalbreakdown();total=breakdown.subtotal;feeTotal=total;feeTotal+=breakdown.delivery;feeTotal+=breakdown.fee;finalAmount=feeTotal+breakdown.taxes;finalAmount+=this._breakdownTip(total);return App.ceil(finalAmount).toFixed(2);},charged:function(){var finalAmount=this.total();if(App.order.pay_type=='card'&&App.credit.restaurant[App.restaurant.id]){finalAmount=finalAmount-App.ceil(App.credit.restaurant[App.restaurant.id]).toFixed(2);if(finalAmount<0){finalAmount=0;}}
return App.ceil(finalAmount).toFixed(2);},totalbreakdown:function(){var elements={};var total=this.subtotal();var feeTotal=total;elements['subtotal']=this.subtotal();elements['delivery']=this._breackDownDelivery();feeTotal+=elements['delivery'];elements['fee']=this._breackDownFee(feeTotal);feeTotal+=elements['fee'];elements['taxes']=this._breackDownTaxes(feeTotal);elements['tip']=this._breakdownTip(total);return elements;},resetOrder:function(){App.cart.items={};$('.cart-items-content, .cart-total').html('');},reloadOrder:function(){var cart=App.cart.items;App.cart.resetOrder();App.cart.loadFlatOrder(cart);},loadFlatOrder:function(cart){for(var x in cart){App.cart.add(cart[x].id,{options:cart[x].options?cart[x].options:[]});}},loadOrder:function(order){try{if(order){var dishes=order['_dishes'];for(var x in dishes){var options=[];for(var xx in dishes[x]['_options']){options[options.length]=dishes[x]['_options'][xx].id_option;}
if(App.cached.Dish[dishes[x].id_dish]!=undefined){App.cart.add(dishes[x].id_dish,{options:options});}}}}catch(e){console.log(e.stack);}
App.cart.updateTotal();},hasItems:function(){if(!$.isEmptyObject(App.cart.items)){return true;}
return false;}};App.busy={isBusy:function(){return $('.app-busy').length?true:false;},makeBusy:function(){var busy=$('<div class="app-busy"></div>').append($('<div class="app-busy-loader"><div class="app-busy-loader-icon"></div></div>'))
$('body').append(busy);},unBusy:function(){$('.app-busy').remove();}};App.test={card:function(){$('[name="pay-card-number"]').val('4242424242424242');$('[name="pay-card-month"]').val('1');$('[name="pay-card-year"]').val('2020');$('[name="pay-name"]').val('MR TEST');$('[name="pay-phone"]').val('405-279-9645');$('[name="pay-address"]').val(App.restaurant.address||"123 main\nsanta monica ca");App.order.cardChanged=true;App.creditCard.changeIcons($('[name="pay-card-number"]').val());},logout:function(){$.getJSON('/api/logout',function(){location.reload()});},cart:function(){alert(JSON.stringify(App.cart.items));},clearloc:function(){$.cookie('community','',{expires:new Date(3000,01,01),path:'/'});$.cookie('location_lat','',{expires:new Date(3000,01,01),path:'/'});$.cookie('location_lon','',{expires:new Date(3000,01,01),path:'/'});location.href='/';},init:function(){$$('.test-card').tap(function(){App.test.card();});$$('.test-logout').tap(function(){App.test.logout();});$$('.test-cart').tap(function(){App.test.cart();});$$('.test-clearloc').tap(function(){App.test.clearloc();});}};App.processConfig=function(json,user){if(user&&!json){App.config.user=user;}else{App.config=json;}
App.AB.init();if(App.config.user){App.identify();App.order['pay_type']=App.config.user['pay_type'];App.order['delivery_type']=App.config.user['delivery_type'];var lastTip=App.config.user['last_tip']||'autotip';lastTip=App.lastTipNormalize(lastTip);App.order['tip']=lastTip;}};App.updateAutotipValue=function(){var subtotal=App.cart.totalbreakdown().subtotal;var autotipValue
if(subtotal===0){autotipValue=0;}
else{autotipValue=Math.ceil(4*(subtotal*0.107+0.85))/4;}
$('[name="pay-autotip-value"]').val(autotipValue);var autotipText=autotipValue?' ('+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+autotipValue+')':'';$('[name=pay-tip] [value=autotip]').html('Autotip'+autotipText);};App.lastTipNormalize=function(lastTip){if(lastTip==='autotip'){return lastTip;}
lastTip=parseInt(lastTip);if(App.config.user&&App.config.user.last_tip_type&&App.config.user.last_tip_type=='number'){return App.defaultTip;}
if(App.tips.indexOf(lastTip)>0){lastTip=lastTip;}else{lastTip=App.defaultTip;}
return lastTip;}
App.trigger={delivery:function(){$('.delivery-toggle-takeout').removeClass('toggle-active');$('.delivery-toggle-delivery').addClass('toggle-active');$('.delivery-only').show();App.order['delivery_type']='delivery';App.cart.updateTotal();},takeout:function(){$('.delivery-toggle-delivery').removeClass('toggle-active');$('.delivery-toggle-takeout').addClass('toggle-active');$('.delivery-only, .field-error-zip').hide();App.order['delivery_type']='takeout';App.cart.updateTotal();},credit:function(){$('.pay-toggle-cash').removeClass('toggle-active');$('.pay-toggle-credit').addClass('toggle-active');$('.card-only').show();App.order['pay_type']='card';App.cart.updateTotal();},cash:function(){$('.pay-toggle-credit').removeClass('toggle-active');$('.pay-toggle-cash').addClass('toggle-active');$('.card-only').hide();App.order['pay_type']='cash';App.cart.updateTotal();}}
$(function(){App.test.init();$(document).on('touchclick','.signout-button',function(){App.signin.signOut();});$(document).on('touchclick','.signup-add-facebook-button',function(){App.signin.facebook.login();});$(document).on('touchclick','.change-location-inline',function(){App.loadHome(true);});$(document).on('submit','.button-letseat-formform',function(){$('.button-letseat-form').trigger('touchclick');return false;});$(document).on('touchclick','.button-letseat-form',function(){var success=function(){App.page.foodDelivery(true);};var error=function(){$('.location-address').val('').attr('placeholder','Oops! We couldn\'t find that address!');};var address=$.trim($('.location-address').val());if(!address){$('.location-address').val('').attr('placeholder','Please enter your address here');}else if(address&&address==App.loc.address()){console.log('SAME')
success();}else{console.log('DIFF')
App.loc.geocode(address,success,error);}});$(document).on('touchclick','.delivery-toggle-delivery',function(e){e.preventDefault();e.stopPropagation();App.trigger.delivery();App.track('Switch to delivery');});$(document).on('touchclick','.delivery-toggle-takeout',function(e){e.preventDefault();e.stopPropagation();App.trigger.takeout();App.track('Switch to takeout');});$(document).on('touchclick','.pay-toggle-credit',function(e){e.preventDefault();e.stopPropagation();App.trigger.credit();App.track('Switch to card');});$(document).on('touchclick','.pay-toggle-cash',function(e){e.preventDefault();e.stopPropagation();App.trigger.cash();App.track('Switch to cash');});$(document).on('touchclick','.location-detect',function(){$('.location-detect-loader').show();$('.location-detect-icon').hide();var error=function(){$('.location-address').val('Oh no! We couldn\'t locate you');$('.location-detect-loader').hide();$('.location-detect-icon').show();};var success=function(){App.page.foodDelivery();};App.loc.getLocationByBrowser(success,error);});$(document).on({mousedown:function(){$(this).addClass('location-detect-click');},touchstart:function(){$(this).addClass('location-detect-click');},mouseup:function(){$(this).removeClass('location-detect-click');},touchend:function(){$(this).removeClass('location-detect-click');}},'.location-detect');$$('.link-help').tap(function(e){e.stopPropagation();e.preventDefault();History.pushState({},'Crunchbutton - About','/help');});$$('.link-legal').tap(function(e){console.log('LEGAL',e)
e.stopPropagation();e.preventDefault();History.pushState({},'Crunchbutton - Legal','/legal');});$$('.link-orders').tap(function(e){e.stopPropagation();e.preventDefault();History.pushState({},'Crunchbutton - Orders','/orders');});if(App.isMobile()){$(document).on('touchclick','input[type="checkbox"]',function(e){e.stopPropagation();e.preventDefault();});$$('input[type="checkbox"]').tap(function(e){e.stopPropagation();e.preventDefault();$(this).checkToggle();});$$('label[for]').tap(function(e){e.stopPropagation();e.preventDefault();var target=document.getElementById($(this).attr('for'));if(target&&target.tagName=='INPUT'){switch($(target).attr('type')){case'text':case'password':case'number':case'phone':case'tel':$(target).focus();break;case'checkbox':$(target).checkToggle();break;}}
$(this).checkToggle();});$$('a[href]').tap(function(e){var el=$(this);var href=el.attr('href');if(!href||e.defaultPrevented){return;}
if($(this).attr('target')){window.open($(this).attr('href'),$(this).attr('target'));}else{location.href=$(this).attr('href');}});$(document).on('click',function(e,force){e.stopPropagation();e.preventDefault();});$(document).on({touchstart:function(e){if(navigator.userAgent.toLowerCase().indexOf('android')>-1){}
App.startX=event.touches[0].pageX;App.startY=event.touches[0].pageY;App.startOffset=document.all?iebody.scrollLeft:pageYOffset;$(this).addClass('meal-item-down');},touchmove:function(e){App.touchX=event.touches[0].pageX;App.touchY=event.touches[0].pageY;App.touchOffset=document.all?iebody.scrollLeft:pageYOffset;var maxDistance=25;if(Math.abs(App.startX-App.touchX)>maxDistance||Math.abs(App.startY-App.touchY)>maxDistance||Math.abs(App.startOffset-App.touchOffset)>maxDistance){$(this).removeClass('meal-item-down');}},touchend:function(e){if(navigator.userAgent.toLowerCase().indexOf('android')>-1){}
if(App.busy.isBusy()){return;}
var maxDistance=25;var r=$(this).closest('.meal-item').attr('data-permalink');var c=$(this).closest('.meal-item').attr('data-permalink-community');if((App.touchX==null&&App.touchY==null)||(Math.abs(App.startX-App.touchX)<maxDistance&&Math.abs(App.startY-App.touchY)<maxDistance&&Math.abs(App.startOffset-App.touchOffset)<maxDistance)){if(r){App.loadRestaurant(r);}else if(c){History.pushState({},c,c);App.routeAlias(c);}}
App.touchX=null;App.touchY=null;App.touchOffset=null;$(this).removeClass('meal-item-down');}},'.meal-item-content');}else{$(document).on({mousedown:function(){if(App.busy.isBusy()){return;}
if(navigator.userAgent.toLowerCase().indexOf('ios')>-1){return;}
$(this).addClass('meal-item-down');var self=$(this);var r=self.closest('.meal-item').attr('data-permalink');var c=self.closest('.meal-item').attr('data-permalink-community');setTimeout(function(){if(r){App.loadRestaurant(r);}else if(c){App.routeAlias(c);}},100);},mouseup:function(){$(this).removeClass('meal-item-down');}},'.meal-item-content');}
$$('.dish-item').tap(function(e){if($(this).attr('data-id_dish')){App.cart.add($(this).attr('data-id_dish'));}else if($(this).hasClass('restaurant-menu')){return;}});$$('.your-orders a').tap(function(){if($(this).attr('data-id_order')){History.pushState({},'Crunchbutton - Your Order','/order/'+$(this).attr('data-id_order'));}});$$('.cart-button-remove').tap(function(){App.cart.remove($(this).closest('.cart-item'));});$$('.cart-button-add').tap(function(){App.cart.clone($(this).closest('.cart-item'));});$$('.cart-item-config a').tap(function(){App.cart.customize($(this).closest('.cart-item'));});$$('.button-submitorder-form').tap(function(e){e.preventDefault();e.stopPropagation();App.crunchSoundAlreadyPlayed=false;App.isDeliveryAddressOk=false;App.cart.submit($(this),true);});$(document).on('touchclick','.button-deliver-payment, .dp-display-item a',function(){$('.payment-form').show();$('.delivery-payment-info, .content-padder-before').hide();});$(document).on({mousedown:function(){$(this).addClass('button-bottom-click');},touchstart:function(){$(this).addClass('button-bottom-click');},mouseup:function(){$(this).removeClass('button-bottom-click');},touchend:function(){$(this).removeClass('button-bottom-click');}},'.button-bottom');$(document).on('change','.cart-customize-select',function(){App.cart.customizeItem($(this));});$$('.cart-customize-check').tap(function(){var checkbox=$(this);setTimeout(function(){App.cart.customizeItem(checkbox);},1);});$$('.cart-item-customize-item label').tap(function(){$(this).prev('input').checkToggle();App.cart.customizeItem($(this).prev('input'));});$(document).on('change','[name="pay-tip"]',function(){App.order.tip=$(this).val();App.order.tipHasChanged=true;var total=App.cart.total();App.cart.updateTotal();});$$('.nav-back').tap(function(){History.back();});$$('.link-home').tap(function(){if(App.restaurants.list&&App.restaurants.list.length>0){App.page.foodDelivery();}else{App.loadHome(true);}});$(document).on('change','[name="pay-card-number"], [name="pay-card-month"], [name="pay-card-year"]',function(){if(!App.order.cardChanged){var self=$(this);var cardInfo=['[name="pay-card-number"]','[name="pay-card-month"]','[name="pay-card-year"]'];$(cardInfo).each(function(index,value){var input=$(value);if(self.attr('name')!=input.attr('name')){input.val('');}})}
App.order.cardChanged=true;});$(document).on('blur','[name=notes]',function(){App.giftcard.notesField.listener();});$(document).on('change, keyup','[name="pay-card-number"]',function(){App.creditCard.changeIcons($(this).val());});$(document).on('keyup','[name="pay-phone"]',function(){$(this).val(App.phone.format($(this).val()));});var haveConfig=function(json){$(document).trigger('have-config');App.processConfig(json);App._init=true;App.loadPage();};if(App.config){haveConfig(App.config)}else{$.getJSON('/api/config',haveConfig);}
$$('.cart-summary').tap(function(e){e.stopPropagation();e.preventDefault();$('html, body').animate({scrollTop:$('.cart-items').position().top-80},{duration:500,specialEasing:{scrollTop:'easeInOutQuart'}});});if(App.isMobile()){setInterval(function(){var focused=$(':focus');if(!focused.length){$('[data-position="fixed"]').show();return;}
focused=focused.get(0);if(focused.tagName=='SELECT'||focused.tagName=='INPUT'||focused.tagName=='TEXTAREA'){$('[data-position="fixed"]').hide();}else{$('[data-position="fixed"]').show();}},100);}
var checkForDistance=function(){if(App.order['delivery_type']=='takeout'){return;}};$(document).on('blur','[name="pay-address"]',function(){clearTimeout(App.checkForDistance);App.checkForDistance=setTimeout(checkForDistance,100);});$(document).on('change','[name="pay-address"]',function(){clearTimeout(App.checkForDistance);App.checkForDistance=setTimeout(checkForDistance,1000);});$(document).on('touchclick','.config-icon',function(){App.loadHome(true);});$(document).on('change','[name="pay-address"], [name="pay-name"], [name="pay-phone"], [name="pay-card-number"], [name="notes"]',function(){App.config.user.name=$('[name="pay-name"]').val();App.config.user.phone=App.phone.format($('[name="pay-phone"]').val());App.config.user.address=$('[name="pay-address"]').val();App.config.user.card=$('[name="pay-card-number"]').val();App.config.user.notes=$('[name="notes"]').val();App.config.user.card_exp_month=$('[name="pay-card-month"]').val();App.config.user.card_exp_year=$('[name="pay-card-year"]').val();});$(document).on('touchclick','.content-item-locations-city',function(){$('.main-content').html('');var permalink=$(this).attr('permalink');App.routeAlias(permalink,function(result){App.loc.realLoc={addressAlias:result.alias.address,lat:result.alias.lat,lon:result.alias.lon,prep:result.alias.prep,city:result.alias.city};App.loc.setFormattedLocFromResult();App.page.foodDelivery(true);});});App.signin.init();App.signup.init();App.suggestion.init();App.recommend.init();App.loc.init();App.credit.tooltip.init();});App.modal.contentWidth=function(){if($(window).width()>700){return 280;}
if($(window).width()<=700){return $(window).width()-50;}}
App.getCommunityById=function(id){for(x in App.communities){if(App.communities[x].id_community==id){return App.communities[x];}}
return false;}
App.message={};App.message.show=function(title,message){if($('.message-container').length>0){$('.message-container').html('<h1>'+title+'</h1><div class="message-container-content">'+message+'</div>');}else{var html='<div class="message-container">'+'<h1>'+title+'</h1>'+'<div class="message-container-content">'+
message+'</div>'+'</div>';$('.wrapper').append(html);}
$('.message-container').dialog({modal:true,dialogClass:'modal-fixed-dialog',width:App.modal.contentWidth(),close:function(event,ui){App.modal.shield.close();},});}
App.playAudio=function(audio,callback){var audio=$('#'+audio).get(0);try{audio.addEventListener('ended',function(){if(callback){callback();}});audio.play();}catch(e){}}
App.registerLocationsCookies=function(){$.cookie('location_lat',App.loc.lat,{expires:new Date(3000,01,01),path:'/'});$.cookie('location_lon',App.loc.lon,{expires:new Date(3000,01,01),path:'/'});$.cookie('location_range',(App.loc.range||App.defaultRange),{expires:new Date(3000,01,01),path:'/'});}
App.message.chrome=function(){var title='How to use Chrome',message='<p>'+'Just tap "Request Desktop Site.'+'</p>'+'<p align="center">'+'<img style="border:1px solid #000" src="/assets/images/chrome-options.png" />'+'</p>';App.message.show(title,message);};App.config={"user":{"id":"3459","id_user":"3459","active":"1","name":"MR TEST","email":null,"phone":"4052799645","stripe_id":null,"address":"10 Traverse Street, Providence, RI 02903","card":"************4242","delivery_type":"delivery","card_type":null,"uuid":null,"pay_type":"card","balanced_id":"AC44QMawBZ3T9FyS7zw3jinu","location_lat":"41.3106","location_lon":"-72.9279","card_exp_year":"2020","card_exp_month":"1","last_tip_type":"number","last_tip":"2.25","facebook":false,"has_auth":false,"presets":{"64":{"id_preset":"6670","id_restaurant":"64","id_user":"3459","notes":null,"id":"6670","delivery_type":"delivery","pay_type":"card","_dishes":{"27336":{"id_order_dish":"27336","id_order":null,"id_dish":"651","id_preset":"6670","id":"27336","_options":{"60472":{"id_order_dish_option":"60472","id_order_dish":"27336","id_option":"2444","id":"60472"},"60473":{"id_order_dish_option":"60473","id_order_dish":"27336","id_option":"2373","id":"60473"}}},"27337":{"id_order_dish":"27337","id_order":null,"id_dish":"657","id_preset":"6670","id":"27337"}}}},"ip":"177.132.50.96"},"env":"beta","ab":{"tagline":"tagline-no-free","slogan":"slogan-push-food","restaurantPage":"restaurant-page-noimage","dollarSign":"hide"},"loc":{"lat":-25.4167,"lon":-49.25,"city":"Curitiba","region":"18"}};;var dateTime={timer:0,now:false};dateTime.update=function(){var time=_gmtServer.split('/');dateTime.now=new Date(Number(time[0]),Number(time[1]-1),Number(time[2]),Number(time[3]),Number(time[4]),(Number(time[5])+dateTime.timer));dateTime.timer++;setTimeout(function(){dateTime.update();},1000);}
dateTime.toString=function(){return dateTime.now.toString('dd MMMM yyyy HH:mm:ss');}
dateTime.update();;if(typeof(console)=='undefined'){console={log:function(){return null;}};}
if(typeof(Number.prototype.toRad)==='undefined'){Number.prototype.toRad=function(){return this*Math.PI/180;}}
function _toRad(Value){return Value*Math.PI/180;}
var History=window.History;History.Adapter.bind(window,'statechange',function(){var State=History.getState();History.log(State.data,State.title,State.url);if(!App.config)return;if(App._init){App.loadPage();}});if(!typeof(App)=='undefined'){App={};}
App.capitalize=function(word){return word.charAt(0).toUpperCase()+word.slice(1);}
App.request=function(url,complete){$.getJSON(url,function(json){complete(json);});};App.cache=function(type,id){var finalid,args=arguments,complete,partComplete;complete=args[2]?args[2]:function(){};partComplete=function(){if(this.uuid){App.cached[type][id.uuid]=this;App.cached[type][id]=this;}
if(this.permalink){App.cached[type][id.permalink]=this;App.cached[type][id]=this;}
complete.call(this);}
if(typeof(id)=='object'){eval('App.cached[type][id.id] = new '+type+'(id,partComplete)');finalid=id.id;}else if(!App.cached[type][id]){eval('App.cached[type][id] = new '+type+'(id,partComplete)');}else{complete.call(App.cached[type][id]);}
return App.cached[type][finalid||id];};App.ceil=function(num){num=num*100;num=Math.ceil(num);return num/100;};App.phone={format:function(num){if(num!=null){num=num.replace(/^0|^1/,'');num=num.replace(/[^\d]*/gi,'');num=num.substr(0,10);if(num.length>=7){num=num.replace(/(\d{3})(\d{3})(.*)/,"$1-$2-$3");}else if(num.length>=4){num=num.replace(/(\d{3})(.*)/,"$1-$2");}}
return num;},validate:function(num){if(!num||num.length!=10){return false;}
var
nums=num.split(''),prev;for(x in nums){if(!prev){prev=nums[x];continue;}
if(nums[x]!=prev){return true;}}
return false;}};App.pad=function(number,length){var str=''+number;while(str.length<length){str='0'+str;}
return str;};App.formatTime=function(time){if(!time){return'';}
var vals=time.split(':');var pm=false;vals[0]=new String(vals[0]);vals[1]=vals[1]?new String(vals[1]):0;if(vals[0].match(/^[0-9]{3,4}$/i)){vals[1]=vals[0].substr(-2,2);vals[0]=vals[0].substr(0,vals[0].length-2);}
if(vals[0]=='12'){pm=true;}
if(vals[0]=='24'){vals[0]='00';}
if(vals[0]>12){vals[0]-=12;pm=true;}else{if(!pm&&time.match(/p/i)){pm=true;}
if(pm&&time.match(/a/i)){pm=false;}}
if(!vals[1]){vals[1]='00';}
vals[1]=vals[1].replace(/[^0-9]+/,'');vals[0]=new String(vals[0]).replace(/[^0-9]+/,'');vals[0]=App.pad(vals[0],2);vals[1]=App.pad(vals[1],2);if(vals[0]=='00'){vals[0]=12;}
return vals.join(':')+(pm?' PM':' AM');};App.unFormatTime=function(time){var part=time.split(' ');part[0]=part[0].split(':');part[0][0]=parseInt(part[0][0],10);if(part[1]=='PM'){if(part[0][0]!=12){part[0][0]=App.pad(part[0][0]+12,2);}}else{if(part[0][0]==12){part[0][0]='00';}}
return part[0][0]+':'+part[0][1];};App.cleanInput=function(text){text=App.cleanBad(text);var type=arguments[1];switch(type){case'float':text=text.replace(/[^0-9\.]+/i,'');break;case'text':default:text=text.replace(/[^a-z0-9\-_ \(\)\+\.\@\%\&\!\;\:\"\'\,\\\/]+/i,'');break;}
return text};App.cleanBad=function(s){s=s.replace(/\u2018|\u2019|\u201A|\uFFFD/g,"'");s=s.replace(/\u201c|\u201d|\u201e/g,'"');s=s.replace(/\u02C6/g,'^');s=s.replace(/\u2039/g,'<');s=s.replace(/\u203A/g,'>');s=s.replace(/\u2013/g,'-');s=s.replace(/\u2014/g,'--');s=s.replace(/\u2026/g,'...');s=s.replace(/\u00A9/g,'(c)');s=s.replace(/\u00AE/g,'(r)');s=s.replace(/\u2122/g,'TM');s=s.replace(/\u00BC/g,'1/4');s=s.replace(/\u00BD/g,'1/2');s=s.replace(/\u00BE/g,'3/4');s=s.replace(/[\u02DC|\u00A0]/g," ");return s;};App.loc={aproxLoc:null,realLoc:null,range:App.defaultRange,loaded:false,distance:function(params){try{var R=6371;var dLat=_toRad(params.to.lat-params.from.lat);var dLon=_toRad(params.to.lon-params.from.lon);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(_toRad(params.from.lat))*Math.cos(_toRad(params.to.lat))*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d;}catch(e){App.track('Location Error',{lat:App.loc.lat,lon:App.loc.lon,address:App.loc.address()});}},pos:function(){if(!App.loc.realLoc){return App.loc.aproxLoc;}else{return App.loc.realLoc;}},bind:function(event,fn){$(document).unbind(event)
$(document).one(event,fn);},address:function(){return App.loc.pos()?(App.loc.pos().addressEntered||App.loc.pos().addressReverse||App.loc.pos().addressAlias):'';},city:function(){return(App.loc.pos()&&App.loc.pos().city)?App.loc.pos().city:'';},prep:function(){return(App.loc.pos()&&App.loc.pos().prep)?App.loc.pos().prep:'in';},getLocationByBrowser:function(success,error){if(navigator.geolocation){App.loc.timerId=setTimeout(function(){error();},5000);navigator.geolocation.getCurrentPosition(function(position){clearTimeout(App.loc.timerId);App.loc.realLoc={lat:position.coords.latitude,lon:position.coords.longitude};App.track('Locations Shared',{lat:position.coords.latitude,lon:position.coords.longitude});App.loc.reverseGeocode(position.coords.latitude,position.coords.longitude,function(){success();},error);},function(){clearTimeout(App.loc.timerId);error();},{maximumAge:60000,timeout:5000,enableHighAccuracy:true});}else{error();}},getCityFromResult:function(results){if(!results){return;}
switch(results[0].types[0]){default:case'administrative_area_level_1':App.loc.realLoc.city=results[0].address_components[0].long_name;break;case'locality':App.loc.realLoc.city=results[0].address_components[0].long_name;App.loc.realLoc.region=results[0].address_components[2].short_name;break;case'street_address':App.loc.realLoc.city=results[0].address_components[2].long_name;App.loc.realLoc.region=results[0].address_components[4].short_name;break;case'postal_code':case'route':App.loc.realLoc.city=results[0].address_components[1].long_name;App.loc.realLoc.region=results[0].address_components[3].short_name;break;}
for(var x=0;x<results.length;x++){for(var i=0;i<results[x].address_components.length;i++){for(var j=0;j<results[x].address_components[i].types.length;j++){if(results[x].address_components[i].types[j]=='locality'){App.loc.realLoc.city=results[x].address_components[i].long_name;}}}}},getAddressFromResult:function(results){if(!results){return;}
App.loc.realLoc.addressReverse=results[0].formatted_address;},setFormattedLocFromResult:function(result){App.loc.getCityFromResult(result);App.loc.getAddressFromResult(result);$.cookie('location',JSON.stringify(App.loc.realLoc),{expires:App.cookieExpire,path:'/'});$('.loc-your-area').html(App.loc.city()||'your area');},setFormattedLoc:function(loc){$('.loc-your-area').html(loc);},init:function(){var lcookie=$.cookie('location')?JSON.parse($.cookie('location')):null;if(lcookie){App.loc.realLoc=lcookie;}else if(App.config.user.location_lat){App.loc.realLoc={lat:App.config.user.location_lat,lon:App.config.user.location_lon,addressEntered:App.config.user.address};}
google.load('maps','3',{callback:App.loc.preProcess,other_params:'sensor=false'});},preProcess:function(){console.log('preprocessing')
var success=function(){$(document).trigger('location-detected');};var error=function(){if(App.loc.aproxLoc){App.loc.realLoc=App.loc.aproxLoc;App.loc.reverseGeocode(App.loc.aproxLoc.lat,App.loc.aproxLoc.lon,function(){success();},function(){});}};var complete=function(lat,lon,city,region){if(lat){App.loc.aproxLoc={lat:lat,lon:lon,city:city,region:region};}else{App.loc.aproxLoc=null;}
App.loc.loaded=true;$(document).trigger('location-loaded');if(!App.loc.realLoc){App.loc.getLocationByBrowser(success,error);}}
if(google.loader.ClientLocation){complete(google.loader.ClientLocation.latitude,google.loader.ClientLocation.longitude,google.loader.ClientLocation.address.city,google.loader.ClientLocation.address.country_code=='US'&&google.loader.ClientLocation.address.region?google.loader.ClientLocation.address.region.toUpperCase():google.loader.ClientLocation.address.country_code);}else if(App.config.loc.lat){complete(App.config.loc.lat,App.config.loc.lon,App.config.loc.city,App.config.loc.region);}else{complete();}},doGeocode:function(address,success,error){address=$.trim(address);App.track('Location Entered',{address:address});var rsuccess=function(results){success(results);};var rerror=function(){var geocoder=new google.maps.Geocoder();geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});};App.routeAlias(address,rsuccess,rerror);},geocode:function(address,success,error){App.loc.doGeocode(address,function(results){if(results.alias){App.loc.realLoc={addressAlias:results.alias.address,lat:results.alias.lat,lon:results.alias.lon,prep:results.alias.prep,city:results.alias.city};App.loc.setFormattedLocFromResult();}else{App.loc.realLoc={addressEntered:address,lat:results[0].geometry.location.lat(),lon:results[0].geometry.location.lng()};App.loc.setFormattedLocFromResult(results);}
success();},function(){App.loc.realLoc=null;error();});},reverseGeocode:function(lat,lon,success,error){App.track('Location Reverse Geocode',{lat:lat,lon:lon});var geocoder=new google.maps.Geocoder();var latlng=new google.maps.LatLng(lat,lon);geocoder.geocode({'latLng':latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(results[1]){App.loc.setFormattedLocFromResult(results);success();}else{$('.location-address').val('Where are you?!');}}else{error();}});},doGeocodeWithBound:function(address,latLong,success,error){address=$.trim(address);App.track('Location Entered',{address:address});var circle=new google.maps.Circle({center:latLong,radius:App.boundingBoxMeters});var bounds=circle.getBounds();var geocoder=new google.maps.Geocoder();geocoder.geocode({address:address,bounds:bounds},function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});},theClosestAddress:function(results,latLong){var lat=latLong.lat();var lng=latLong.lng();var R=6371;var distances=[];var closest=-1;for(i=0;i<results.length;i++){var alat=results[i].geometry.location.lat();var alng=results[i].geometry.location.lng();var dLat=_toRad(alat-lat);var dLong=_toRad(alng-lng);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(_toRad(lat))*Math.cos(_toRad(lat))*Math.sin(dLong/2)*Math.sin(dLong/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;distances[i]=d;if(closest==-1||d<distances[closest]){closest=i;}}
return results[closest];},formatedAddress:function(location){return location.formatted_address.replace(', USA','');},validateAddressType:function(addressLocation){if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.ROOFTOP||addressLocation.geometry.location_type==google.maps.GeocoderLocationType.RANGE_INTERPOLATED)){return true;}
if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.APPROXIMATE)){for(var x in addressLocation.types){var addressType=addressLocation.types[x];if(addressType=='premise'||addressType=='subpremise'||addressType=='intersection'||addressType=='establishment'){return true;}}}
return false;},km2Miles:function(km){return km*0.621371;},Miles2Km:function(miles){return miles*1.60934;},log:function(){$.ajax({type:'POST',dataType:'json',data:App.loc.pos(),url:App.service+'loc_log/new',success:function(json){}});}};App.callPhone=function(phone){if(App.isMobile()){return'<a href="tel:'+App.phone.format(phone).replace(/\-/g,'')+'">'+phone+'</a>';}else{return phone;}}
App.isMobile=function(){return $.browser.mobile;}
App.iOS=function(){return /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());}
App.isAndroid=function(){return /android/i.test(navigator.userAgent.toLowerCase());}
App.isChrome=function(){return /chrom(e|ium)/.test(navigator.userAgent.toLowerCase())||/crios/.test(navigator.userAgent.toLowerCase())||(typeof window.chrome==='object');}
App.isChromeForIOS=function(){return App.isMobile()&&App.iOS()&&App.isChrome();}
var sort_by;(function(){var default_cmp=function(a,b){if(a==b)return 0;return a<b?-1:1;},getCmpFunc=function(primer,reverse){var cmp=default_cmp;if(primer){cmp=function(a,b){return default_cmp(primer(a),primer(b));};}
if(reverse){return function(a,b){return-1*cmp(a,b);};}
return cmp;};sort_by=function(){var fields=[],n_fields=arguments.length,field,name,reverse,cmp;for(var i=0;i<n_fields;i++){field=arguments[i];if(typeof field==='string'){name=field;cmp=default_cmp;}
else{name=field.name;cmp=getCmpFunc(field.primer,field.reverse);}
fields.push({name:name,cmp:cmp});}
return function(A,B){var a,b,name,cmp,result;for(var i=0,l=n_fields;i<l;i++){result=0;field=fields[i];name=field.name;cmp=field.cmp;result=cmp(A[name],B[name]);if(result!==0)break;}
return result;}}}());App.nl2br=function(string){return string.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,'$1<br/>$2');}
var touchclick=App.isMobile()?'touchend':'click';var touchup=App.isMobile()?'touchend':'mouseup';jQuery.event.special.touchclick={bindType:touchclick,delegateType:touchclick};jQuery.event.special.touchup={bindType:touchup,delegateType:touchup};if(window.jQuery){(function($){$.fn.checkToggle=function(params){var checks=$(this).filter('input[type="checkbox"]');$(this).filter('input[type="checkbox"]').each(function(){$(this).prop('checked',!$(this).is(':checked'));});return this;};})(jQuery);};App.page.home=function(force){if(!force&&!App.loc.loaded){App.loc.bind('location-loaded',function(){App.page.home(force);});App.loc.bind('location-detected',function(){App.page.home(force);});return;}
var homeSuccess=function(){$('.nav-back').removeClass('nav-back-show');$('.config-icon').addClass('config-icon-mobile-hide, config-icon-desktop-hide');$('.content').addClass('short-meal-list');App.showPage({page:'home',title:'Crunchbutton',data:{topCommunities:App.topCommunities,yourArea:App.loc.city()||'your area',autofocus:$(window).width()>=768?' autofocus="autofocus"':''}});if(navigator.userAgent.toLowerCase().indexOf('safari')>-1&&navigator.userAgent.toLowerCase().indexOf('mobile')==-1&&navigator.userAgent.toLowerCase().indexOf('chrome')==-1){$('.location-detect').css({'margin-top':'2px','height':'50px'});}else if(navigator.userAgent.toLowerCase().indexOf('firefox')>-1){$('.location-detect').css({'margin-top':'0px','height':'52px'});}};if(!force&&App.loc.address()&&App.restaurants.list===false){App.page.foodDelivery();return;}else{homeSuccess();}
if(!force&&App.loc.address()&&App.restaurants.list&&App.restaurants.list.length==0){App.loc.log();$('.home-greeting, .enter-location, .button-letseat-form').hide();$('.error-location').show();App.track('Location Error',{lat:App.loc.pos().lat,lon:App.loc.pos().lon,address:App.loc.address()});}else{$('.location-address').val('');$('.error-location').hide();$('.home-greeting, .enter-location, .button-letseat-form').show();}};App.page.restaurant=function(id){$('.config-icon').addClass('config-icon-mobile-hide');$('.nav-back').addClass('nav-back-show');App.cartHighlightEnabled=false;$('.content').removeClass('smaller-width');$('.content').removeClass('short-meal-list');App.cache('Restaurant',id,function(){if(App.restaurant&&App.restaurant.permalink!=id){App.cart.resetOrder();}
App.restaurant=this;var community=App.getCommunityById(App.restaurant.id_community);var lastOrderDelivery=false;var lastPayCash=false;if(App.config&&App.config.user&&App.config.user.presets&&App.config.user.presets[App.restaurant.id_restaurant]){lastOrderDelivery=App.config.user.presets[App.restaurant.id_restaurant].delivery_type;lastPayCash=App.config.user.presets[App.restaurant.id_restaurant].pay_type;App.order['delivery_type']=lastOrderDelivery;App.order['pay_type']=lastPayCash;}
App.showPage({tracking:{title:'Restaurant page loaded',data:{restaurant:App.restaurant.name}},page:'restaurant',title:App.restaurant.name+' | Food Delivery | Order from '+(community.name?community.name:'Local')+' Restaurants | Crunchbutton',data:{restaurant:App.restaurant,presets:App.config.user.presets,lastOrderDelivery:lastOrderDelivery,user:App.config.user,community:community,form:{tip:App.order.tip,name:App.config.user.name,phone:App.phone.format(App.config.user.phone),address:App.config.user.address,notes:(App.config.user&&App.config.user.presets&&App.config.user.presets[App.restaurant.id_restaurant])?App.config.user.presets[App.restaurant.id_restaurant].notes:'',card:{number:App.config.user.card,month:App.config.user.card_exp_month,year:App.config.user.card_exp_year}}}});if(App.loc.pos()&&App.loc.pos().addressEntered&&App.loc.pos().addressEntered!=App.config.user.address){var validatedAddress=function(){console.log('validatedAddress - started');if(google&&google.maps&&google.maps.Geocoder){var addressToVerify=App.loc.pos().addressEntered;var success=function(results){var address=results[0];console.log('validatedAddress - started - address',address);if(address){if(App.loc.validateAddressType(address)){console.log(' address ok ');if(App.useCompleteAddress){$('[name=pay-address]').val(App.loc.formatedAddress(address));}else{$('[name=pay-address]').val(addressToVerify);}}else{console.log(' address not ok ');}}};var error=function(){};App.loc.doGeocode(addressToVerify,success,error);}else{setTimeout(function(){validatedAddress();},10);}}
validatedAddress();}
if(App.config.user.presets){$('.payment-form').hide();}
if(App.cart.hasItems()){App.cart.reloadOrder();}else if(App.config.user&&App.config.user.presets&&App.config.user.presets[App.restaurant.id_restaurant]){try{App.cart.loadOrder(App.config.user.presets[App.restaurant.id_restaurant]);}catch(e){App.cart.loadOrder(App.restaurant.preset());}}else{App.cart.loadOrder(App.restaurant.preset());}
$('.body').css({'min-height':$('.restaurant-items').height()});setTimeout(function(){var total=App.cart.updateTotal();},200);App.cartHighlightEnabled=false;if(App.order['pay_type']=='cash'||lastPayCash=='cash'){App.trigger.cash();}else{App.trigger.credit();}
if(lastPayCash=='cash'){App.trigger.cash();}else if(lastPayCash=='card'){App.trigger.credit();}
if((lastOrderDelivery=='delivery'&&App.restaurant.delivery=='1')||(App.order['delivery_type']=='delivery'&&App.restaurant.delivery=='1')||(App.restaurant.takeout=='0')||(lastOrderDelivery!='takeout'&&App.restaurant.delivery=='1')){App.trigger.delivery();}
if(App.order['delivery_type']=='takeout'||App.restaurant.delivery!='1'){App.trigger.takeout();}
if((App.restaurant.takeout=='0'||App.order['delivery_type']=='delivery')&&!App.config.user.address){$('.payment-form').show();$('.delivery-payment-info, .content-padder-before').hide();}
$('.restaurant-gift').hide();App.credit.getCredit(function(){App.credit.show();App.cart.updateTotal();});if(!App.config.user.id_user){App.config.user.address=App.loc.enteredLoc;App.loc.enteredLoc='';}});};App.page.order=function(id){$('.config-icon').addClass('config-icon-mobile-hide');$('.nav-back').addClass('nav-back-show');if(App.justCompleted){App.justCompleted=false;}
App.signin.checkUser();App.cache('Order',id,function(){var order=this;if(!order.uuid){History.replaceState({},'Crunchbutton','/orders');return;}
App._order_uuid=id;App.facebook.preLoadOrderStatus();App.cache('Restaurant',order.id_restaurant,function(){var restaurant=this;$('.content').addClass('smaller-width');$('.main-content').css('width','auto');App.showPage({title:'Crunchbutton - Your Order',page:'order',data:{order:order,restaurant:restaurant,user:App.config.user.has_auth}});});});};App.page.legal=function(){App.currentPage='legal';$.getJSON('/api/legal',function(json){$('.main-content').html(json.data);App.refreshLayout();});};App.page.help=function(){App.currentPage='help';$.getJSON('/api/help',function(json){$('.main-content').html(json.data);App.refreshLayout();});};App.page.orders=function(){if(!App.config.user.id_user){History.pushState({},'Crunchbutton','/');return;}
$('.config-icon').addClass('config-icon-mobile-hide');$('.nav-back').addClass('nav-back-show');$.getJSON('/api/user/orders',function(json){App.showPage({title:'Your Account',page:'orders',data:{orders:json,user:App.user}});$(document).on('touchclick','.order-restaurant',function(){var permalink=$(this).attr('permalink');var name=$(this).attr('name');var loc='/'+App.restaurants.permalink+'/'+permalink;History.pushState({},'Crunchbutton - '+name,loc);});});App.refreshLayout();};App.foodDelivery={};App.foodDelivery.getRestaurants=function(success,error){if(!App.loc.pos()){error();return;}
var url=App.service+'restaurants?lat='+App.loc.pos().lat+'&lon='+App.loc.pos().lon+'&range='+(App.loc.range||App.defaultRange);App.restaurants.list=false;$.getJSON(url,function(json){App.restaurants.list=[];if(typeof json['restaurants']=='undefined'||json['restaurants'].length==0){error();}else{for(var x in json.restaurants){var res=new Restaurant(json.restaurants[x]);res.open();App.restaurants.list[App.restaurants.list.length]=res;};success();}});}
App.foodDelivery.localizedContent=function(){try{var slogan=App.slogan.slogan;var sloganReplace=App.loc.prep()+' '+App.loc.city();sloganReplace=$.trim(sloganReplace);var tagline=App.tagline.tagline.replace('%s',sloganReplace);slogan=slogan.replace('%s',sloganReplace);}catch(e){console.log('Failed to load dynamic text',App.slogan,App.tagline);var slogan='';var tagline='';}
var title=App.loc.city()+' Food Delivery | Order Food from '+(App.loc.city()||'Local')+' Restaurants | Crunchbutton';document.title=title;return{slogan:slogan,tagline:tagline,title:title};}
App.page.foodDelivery=function(refresh){if(refresh){App.restaurants.list=false;}
var success=function(){var loc='/'+App.restaurants.permalink;if(loc!=location.pathname){History.pushState({},'Crunchbutton','/'+App.restaurants.permalink);return;}
$('.config-icon').removeClass('config-icon-mobile-hide');$('.nav-back').removeClass('nav-back-show');if(App.restaurants.list.length==4){$('.content').addClass('short-meal-list');}else{$('.content').removeClass('short-meal-list');}
$('.content').removeClass('smaller-width');App.currentPage='food-delivery';var titles=App.foodDelivery.localizedContent();App.restaurants.list.sort(sort_by({name:'_open',reverse:true},{name:'delivery',reverse:true},{name:'_weight',primer:parseInt,reverse:true}));App.showPage({page:'restaurants',data:{slogan:titles.slogan,tagline:titles.tagline,restaurants:App.restaurants.list}});};var error=function(){App.loadHome();};if(App.restaurants.list===false){App.foodDelivery.getRestaurants(success,error);}else if(App.restaurants.list===[]){error();}else{success();}}
App.page.giftCard=function(path){App.page.home();App.giftcard.show(path);}
App.page.resetPassword=function(path){if(!App.signin.passwordHelp.reset.hasStarted){App.signin.passwordHelp.reset.hasStarted=true;$('.wrapper').append(App.signin.passwordHelp.reset.html(path));App.showReset=true;App.page.home(true);App.signin.passwordHelp.reset.init();}};App.signin.init=function(){$('.wrapper').append(App.render('signin'));$(document).on('touchclick','.signin-facebook-button',function(){App.signin.facebook.login();});$(document).on('touchclick','.signin-form-button',function(){App.signin.sendForm();});$(document).on('touchclick','.signin-password-help',function(){App.signin.passwordHelp.show();});$(document).on('touchclick','.signin-password-help-back',function(){App.signin.passwordHelp.hide();});$(document).on('touchclick','.signin-password-help-button',function(){App.signin.passwordHelp.sendForm();});$(document).on('submit','.signin-help-form',function(){App.signin.passwordHelp.sendForm();return false;});$(document).on('submit','.signin-form',function(e){App.signin.sendForm();e.stopPropagation();return false;});$(document).on('touchclick','.signin-icon',function(){App.signin.show();});$(document).on('touchclick','.signup-link',function(){App.signup.show(false);$('.signin-container').dialog('close');});$(document).on('touchclick','.sign-in-icon',function(){if(App.config.user.id_user){History.pushState({},'Crunchbutton - Orders','/orders');}else{App.signin.show();}});$(document).on('touchclick','.signout-icon',function(){App.signin.signOut();});$(document).on('touchclick','.signin-user',function(){History.pushState({},'Your Account','/orders');;});History.Adapter.bind(window,'statechange',function(){App.signin.checkUser();});App.signin.facebook.init();}
App.signin.sendForm=function(){var login=$('input[name=signin-email]').val();login=login.replace(/[^\d]*/gi,'')
if(!App.phone.validate(login)){login=$.trim($('input[name=signin-email]').val());if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(login)){login=false;}}
if(!login){alert('Please enter a valid email or phone.');$('input[name=signin-email]').focus();return;}
if($.trim($('input[name=signin-password]').val())==''){alert('Please enter your password.');$('input[name=signin-password]').focus();return;}
var email=login,password=$.trim($('input[name=signin-password]').val()),url=App.service+'user/auth';$('.signin-error').hide();$.ajax({type:'POST',url:url,data:{'email':email,'password':password},dataType:'json',success:function(json){if(json.error){$('.signin-error').fadeIn();}else{App.config.user=json;App.signin.checkUser();$('.signin-container').dialog('close');if(App.currentPage=='restaurant'&&App.restaurant.permalink){App.page.restaurant(App.restaurant.permalink);}
App.signin.manageLocation();if(App.giftcard.callback){App.giftcard.callback();}}}});}
App.signin.manageLocation=function(){if(App.loc.address()==''){if(App.config.user.address){App.loc.geocode(App.config.user.address,function(){App.page.foodDelivery(true);},function(){});}else if(App.config.user.location_lat&&App.config.user.location_lon){App.loc.reverseGeocode(App.config.user.location_lat,App.config.user.location_lon,function(){if(App.loc.realLoc.addressReverse){var address=App.loc.realLoc.addressReverse;App.loc.geocode(address,function(){App.page.foodDelivery(true);},function(){});}},function(){});}}}
App.signin.signOut=function(){if(confirm('Confirm sign out?')){if(App.signin.facebook.isLogged){FB.logout(function(){$.getJSON('/api/logout',function(){$('.signout-icon').hide();location.href='/';});});}else{$.getJSON('/api/logout',function(){$('.signout-icon').hide();location.href='/';});}}}
App.signin.facebook={running:false,init:function(){}};App.signin.facebook.processStatus=function(session){if(session.status==='connected'&&session.authResponse){if(session.authResponse.accessToken){App.facebook.registerToken(session.authResponse.accessToken);}
App.signin.facebook.isLogged=true;if(App.signin.facebook.shouldAuth){FB.api('/me',{fields:'name'},function(response){if(response.error){return;}
if(response.id){App.signin.facebook.shouldAuth=false;$('.signin-facebook-message').show();$('.signup-facebook-message').show();$('.signin-facebook').hide();$('.signup-facebook').hide();var url=App.service+'user/facebook';if(!App.signin.facebook.running){App.signin.facebook.running=true;$.ajax({type:'GET',url:url,dataType:'json',success:function(json){App.signin.facebook.running=true;if(json.error){if(json.error=='facebook id already in use'){alert('Sorry, It seems the facebook user is already related with other user.');}}else{App.processConfig(null,json);App.signin.checkUser();if(App.giftcard.callback){App.giftcard.callback();}
App.signin.manageLocation();}
$('.signin-container').dialog('close');$('.signup-container').dialog('close');if(App.currentPage=='restaurant'&&App.restaurant.permalink){App.page.restaurant(App.restaurant.permalink);}
if(App.currentPage=='orders'){App.page.orders()}
App.recommend.relateUser();}});}}});}}}
App.signin.facebook.login=function(){App.signin.facebook.shouldAuth=true;FB.login(App.signin.facebook.processStatus,{scope:App.facebookScope});};App.signin.show=function(){App.signin.passwordHelp.hide();$('.signin-facebook-message').hide();$('.signin-facebook').show();$('input[name=signin-email]').val('');$('input[name=signin-password]').val('');$('.signin-error').hide();$('.signin-container').dialog({dialogClass:'modal-fixed-dialog',modal:true,width:App.modal.contentWidth(),open:function(event,ui){$('.signin-email').focus();}});}
App.signin.checkUser=function(){if(App.config.user.id_user&&$.trim(App.config.user.id_user)!=''){$('.signin-user').show();$('.signin-icon').hide();$('.signout-icon').hide();$('.signin-box-header').addClass('signin-box-header-min');}else{$('.signin-user').hide();$('.signin-icon').show();$('.signup-icon').show();$('.signout-icon').hide();$('.signin-box-header').removeClass('signin-box-header-min');}
if(App.currentPage=='home'){$('.config-icon').addClass('config-icon-desktop-hide');}else{$('.config-icon').removeClass('config-icon-desktop-hide');}}
App.signin.passwordHelp={};App.signin.passwordHelp.show=function(){if($.trim($('input[name=signin-email]').val())!=''){$('input[name=password-help-email]').val($.trim($('input[name=signin-email]').val()));}
$('.signin-password-help-button').show();$('.signin-password-help-back').show();$('.signin-help-container').show();$('.signin-form-options').hide();$('.signin-password-help-message').hide();$('.signin-password-help-message').html('');$('input[name=password-help-email]').focus();}
App.signin.passwordHelp.hide=function(){$('.signin-help-container').hide();$('.signin-form-options').show();}
App.signin.passwordHelp.sendForm=function(){var login=$('input[name=password-help-email]').val();login=login.replace(/[^\d]*/gi,'')
if(!App.phone.validate(login)){login=$.trim($('input[name=password-help-email]').val());if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(login)){login=false;}}
if(!login){alert('Please enter a valid email or phone.');$('input[name=password-help-email]').focus();return;}
$('.password-help-error').html('');$('.password-help-error').hide();var url=App.service+'user/reset';$.ajax({type:'POST',url:url,data:{'email':login},dataType:'json',success:function(json){if(json.error){if(json.error=='user is not registred'){$('.password-help-error').html('Sorry, that email/phone is not registered with us.');$('.password-help-error').fadeIn();$('input[name=password-help-email]').focus()}}else{if(json.success='success'){$('.signin-password-help-message').show();$('.signin-password-help-button').hide();$('.signin-password-help-back').hide();var message='You will receive a code to reset your password! It will expire in 24 hours.';if(json.userHasFacebookAuth){message+='<br/>';message+='<br/>';message+='You can also try logging in with <span class="login-facebook">Facebook</span>.';}
$('.signin-password-help-message').html(message);$('.login-facebook').on('touchclick',function(){App.signin.show();});}}}});}
App.signin.passwordHelp.reset={};App.signin.passwordHelp.reset.init=function(){$('.password-reset-container').dialog({modal:true,dialogClass:'modal-fixed-dialog',width:App.modal.contentWidth(),close:function(event,ui){App.signin.passwordHelp.reset.close();},open:function(event,ui){$('input[name=password-reset-code]').focus();}});$('.password-reset-code-button').on('touchclick',function(){App.signin.passwordHelp.reset.sendForm();});$('.password-change-button').on('touchclick',function(){App.signin.passwordHelp.reset.change();});$('.password-reset-form').submit(function(){return false;});$('.password-change-form').submit(function(){return false;});}
App.signin.passwordHelp.reset.sendForm=function(){$('.password-reset-code-error').html('');$('.password-reset-code-error').hide();var code=$.trim($('input[name=password-reset-code]').val());if(code==''){alert('Please enter the reset code.');$('input[name=password-reset-code]').focus();return;}
var url=App.service+'user/code-validate';$.ajax({type:'POST',url:url,data:{'code':code},dataType:'json',success:function(json){if(json.error){if(json.error=='invalid code'){$('.password-reset-code-error').html('Sorry, this code is invalid.');}
if(json.error=='expired code'){$('.password-reset-code-error').html('Sorry, this code is expired.');}
$('.password-reset-code-error').fadeIn();$('input[name=password-reset-code]').focus()}else{if(json.success='valid code'){$('.password-reset-block').hide();$('.password-change-block').show();$('input[name=password-new]').focus();}}}});}
App.signin.passwordHelp.reset.change=function(){var code=$.trim($('input[name=password-reset-code]').val());var password=$.trim($('input[name=password-new]').val());if(password==''){alert('Please enter your password.');$('input[name=password-new]').focus();return;}
var url=App.service+'user/change-password';$.ajax({type:'POST',url:url,data:{'code':code,'password':password},dataType:'json',success:function(json){if(json.error){if(json.error=='invalid code'){$('.password-change-error').html('Sorry, this code is invalid.');}
if(json.error=='expired code'){$('.password-change-error').html('Sorry, this code is expired.');}
$('.password-change-error').fadeIn();}else{if(json.success='password changed'){$('.password-change-message').fadeIn();$('.password-change-block').find('h1').html('Done!');$('.password-change-message').html('Your password has changed!');App.signin.passwordHelp.hasChanged=true;}}
$('input[name=password-new]').hide();$('.password-change-button').hide();}});}
App.signin.passwordHelp.reset.close=function(){if(App.signin.passwordHelp.hasChanged){location.href='/';}}
App.signin.passwordHelp.reset.html=function(path){var code=(path.length>1)?(path[1]?path[1]:''):'';return App.render('passwordhelp',{code:code});}
App.signup={};App.signup.init=function(){$('.wrapper').append(App.render('signup'));$(document).on('touchclick','.signup-add-password-button',function(){App.signup.show(false);});$(document).on('touchclick','.signup-icon',function(){App.signup.show(false);});$(document).on('touchclick','.signup-form-button',function(){App.signup.sendForm();});$(document).on('touchclick','.signup-facebook-button',function(){App.signin.facebook.login();});$(document).on('touchclick','.signin-link',function(){App.signin.show();$('.signup-container').dialog('close');});$(document).on('submit','.signup-form',function(){App.signup.sendForm();return false;});}
App.signup.show=function(justFacebook){$('.signup-facebook').show();$('.signup-facebook-message').hide();if(App.config.user.facebook){$('.signup-facebook-container').hide();}else{$('.signup-facebook-container').show();}
$('input[name=signup-password]').val('');$('.signup-form-options').show();$('.signup-success-container').hide();if(justFacebook){$('.signup-form').hide();}else{$('.signup-form').show();}
$('.signin-error').hide();$('.signup-container').dialog({modal:true,dialogClass:'modal-fixed-dialog',width:App.modal.contentWidth(),open:function(event,ui){$('.signup-phone').focus();}});}
App.signup.checkLogin=function(){var login=$('input[name=pay-phone]').val().replace(/[^\d]*/gi,'');if(App.phone.validate(login)){var url=App.service+'user/verify/'+login
$.getJSON(url,function(json){if(json.error){if(json.error=='user exists'){$('input[name=pay-password]').val('');$('.password-field').hide();}}else{$('.password-field').fadeIn();$('input[name=pay-password]').val('');$('input[name=pay-password]').focus();}});}else{$('input[name=pay-password]').val('');$('.password-field').hide();}}
App.signup.sendForm=function(){login=$.trim($('input[name=signup-email]').val());if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(login)){login=false;}
if(!login){alert('Please enter a valid email email address.');$('input[name=signup-email]').focus();return;}
if($.trim($('input[name=signup-password]').val())==''){alert('Please enter your password.');$('input[name=signup-password]').focus();return;}
var password=$.trim($('input[name=signup-password]').val()),url=App.service+'user/create/local';$('.signup-error').hide();$.ajax({type:'POST',url:url,data:{'email':login,'password':password},dataType:'json',success:function(json){if(json.error){if(json.error=='user exists'){$('.signup-error').html('It seems that the email is already registered!');}
$('.signup-error').fadeIn();}else{App.processConfig(null,json);$('.success-phone').html(login);$('.signup-call-to-action').hide();$('.signup-form-options').hide();$('.signup-success-container').show();App.signin.checkUser();if(App.currentPage=='restaurant'&&App.restaurant.permalink){App.page.restaurant(App.restaurant.permalink);}
if(App.giftcard.callback){$('.signup-container').dialog('close');App.giftcard.callback();}
App.recommend.relateUser();}}});};App.suggestion.init=function(){$('.wrapper').append(App.render('suggestion'));$(document).on('touchclick','.suggestion-link',function(){App.suggestion.show();App.suggestion.itIsSending=false;});$(document).on('touchclick','.suggestion-form-button',function(){App.suggestion.send();});$(document).on('submit','.suggestion-form',function(){return false;});$(document).on('touchclick','.tooltip-help-mobile-touchable',function(){if($('.tooltip-help-content-mobile').is(':visible')){return;}
setTimeout(function(){$('.tooltip-help-content-mobile').show();},100);});$(document).on('touchclick','.tooltip-help-desktop',function(){if($('.tooltip-help-content-desktop').is(':visible')){return;}
setTimeout(function(){$('.tooltip-help-content-desktop').show();},100);});$(document).on('touchclick','.tooltip-help-content',function(e){e.stopPropagation();});$(document).on('touchclick','body',function(){$('.tooltip-help-content-mobile:visible').hide();$('.tooltip-help-content-desktop:visible').hide();});}
App.suggestion.send=function(){if($.trim($('input[name=suggestion-name]').val())==''){alert('Please enter a suggestion.');$('input[name=suggestion-name]').focus();return;}
var data={restaurant:App.restaurant.permalink,name:$('input[name=suggestion-name]').val()};if(!App.suggestion.itIsSending){App.suggestion.itIsSending=true;$.ajax({type:'POST',dataType:'json',data:data,url:App.service+'suggestion/new',success:function(content){console.log('saveds',new Date);App.suggestion.message('<h1>Awesome, thanks!!</h1>'+'<div class="suggestion-thanks-text">If you really wanna order that RIGHT NOW, call us at '+App.callPhone('646-783-1444')+'</div>');}});}}
App.suggestion.link=function(){return'<div class="suggestion-link-container">'+'<div class="suggestion-link-title">Really want something else?</div>'+'<a href="javascript:;" class="suggestion-link">Suggest other food</a>'+'</div>';}
App.suggestion.message=function(msg){$('.suggestion-form').hide();$('.suggestion-form-tip').hide();$('.suggestion-message').show();$('.suggestion-message').html(msg);}
App.suggestion.show=function(){$('input[name=suggestion-name]').val('');$('.suggestion-form').show();$('.suggestion-form-tip').show();$('.suggestion-message').hide();$('.suggestion-container').dialog({modal:true,dialogClass:'modal-fixed-dialog',width:App.modal.contentWidth(),open:function(event,ui){$('.suggestion-name').focus();}});}
App.suggestion.tooltipContainer=function(device){var help='Crunchbutton curates menus. We\'ve curated just the top food here. '+'If you really want something else, suggest it below.'
return'<span class="tooltip-help-'+device+'-container">'+
(device=='mobile'?'<span class="tooltip-help-mobile-touchable">':'')+'<span class="tooltip-help tooltip-help-'+device+'"><span>?</span>'+
(device=='mobile'?'</span>':'')+'</span>'+'<div class="tooltip-help-content tooltip-help-content-'+device+'">'+
help+'</div></span>';};var Quo;Quo=function(){var e,t,n;return t=[],e=function(t,r){var i;return t?e.toType(t)==="function"?e(document).ready(t):(i=e.getDOMObject(t,r),n(i,t)):n()},n=function(e,r){return e=e||t,e.__proto__=n.prototype,e.selector=r||"",e},e.extend=function(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){var n,r;r=[];for(n in t)r.push(e[n]=t[n]);return r}),e},n.prototype=e.fn={},e}(),window.Quo=Quo,"$$"in window||(window.$$=Quo),function(e){var t,n,r,i,s,o,u,a;return t=[],i=Object.prototype,r=/^\s*<(\w+|!)[^>]*>/,s=document.createElement("table"),o=document.createElement("tr"),n={tr:document.createElement("tbody"),tbody:s,thead:s,tfoot:s,td:o,th:o,"*":document.createElement("div")},e.toType=function(e){return i.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},e.isOwnProperty=function(e,t){return i.hasOwnProperty.call(e,t)},e.getDOMObject=function(t,n){var i,s,o;i=null,s=[1,9,11],o=e.toType(t);if(o==="array")i=u(t);else if(o==="string"&&r.test(t))i=e.fragment(t.trim(),RegExp.$1),t=null;else if(o==="string")i=e.query(document,t),n&&(i.length===1?i=e.query(i[0],n):i=e.map(function(){return e.query(i,n)}));else if(s.indexOf(t.nodeType)>=0||t===window)i=[t],t=null;return i},e.map=function(t,n){var r,i,s,o;o=[],r=void 0,i=void 0;if(e.toType(t)==="array"){r=0;while(r<t.length)s=n(t[r],r),s!=null&&o.push(s),r++}else for(i in t)s=n(t[i],i),s!=null&&o.push(s);return a(o)},e.each=function(t,n){var r,i;r=void 0,i=void 0;if(e.toType(t)==="array"){r=0;while(r<t.length){if(n.call(t[r],r,t[r])===!1)return t;r++}}else for(i in t)if(n.call(t[i],i,t[i])===!1)return t;return t},e.mix=function(){var t,n,r,i,s;r={},t=0,i=arguments.length;while(t<i){n=arguments[t];for(s in n)e.isOwnProperty(n,s)&&n[s]!==undefined&&(r[s]=n[s]);t++}
return r},e.fragment=function(t,r){var i;return r==null&&(r="*"),r in n||(r="*"),i=n[r],i.innerHTML=""+t,e.each(Array.prototype.slice.call(i.childNodes),function(){return i.removeChild(this)})},e.fn.map=function(t){return e.map(this,function(e,n){return t.call(e,n,e)})},e.fn.instance=function(e){return this.map(function(){return this[e]})},e.fn.filter=function(t){return e([].filter.call(this,function(n){return n.parentNode&&e.query(n.parentNode,t).indexOf(n)>=0}))},e.fn.forEach=t.forEach,e.fn.indexOf=t.indexOf,u=function(e){return e.filter(function(e){return e!==void 0&&e!==null})},a=function(e){return e.length>0?[].concat.apply([],e):e}}(Quo),function(e){var t,n,r,i,s,o,u;return r=null,t=/WebKit\/([\d.]+)/,n={Android:/(Android)\s+([\d.]+)/,ipad:/(iPad).*OS\s([\d_]+)/,iphone:/(iPhone\sOS)\s([\d_]+)/,Blackberry:/(BlackBerry|BB10|Playbook).*Version\/([\d.]+)/,FirefoxOS:/(Mozilla).*Mobile[^\/]*\/([\d\.]*)/,webOS:/(webOS|hpwOS)[\s\/]([\d.]+)/},e.isMobile=function(){return r=r||s(),r.isMobile&&r.os.name!=="firefoxOS"},e.environment=function(){return r=r||s(),r},e.isOnline=function(){return navigator.onLine},s=function(){var e,t;return t=navigator.userAgent,e={},e.browser=i(t),e.os=o(t),e.isMobile=!!e.os,e.screen=u(),e},i=function(e){var n;return n=e.match(t),n?n[0]:e},o=function(e){var t,r,i;t=null;for(r in n){i=e.match(n[r]);if(i){t={name:r==="iphone"||r==="ipad"?"ios":r,version:i[2].replace("_",".")};break}}
return t},u=function(){return{width:window.innerWidth,height:window.innerHeight}}}(Quo),function(e){var t,n,r,i,s,o;return r="parentNode",t=/^\.([\w-]+)$/,n=/^#[\w\d-]+$/,i=/^[\w-]+$/,e.query=function(e,r){var s;return r=r.trim(),t.test(r)?s=e.getElementsByClassName(r.replace(".","")):i.test(r)?s=e.getElementsByTagName(r):n.test(r)&&e===document?(s=e.getElementById(r.replace("#","")),s||(s=[])):s=e.querySelectorAll(r),s.nodeType?[s]:Array.prototype.slice.call(s)},e.fn.find=function(t){var n;return this.length===1?n=Quo.query(this[0],t):n=this.map(function(){return Quo.query(this,t)}),e(n)},e.fn.parent=function(e){var t;return t=e?o(this):this.instance(r),s(t,e)},e.fn.siblings=function(e){var t;return t=this.map(function(e,t){return Array.prototype.slice.call(t.parentNode.children).filter(function(e){return e!==t})}),s(t,e)},e.fn.children=function(e){var t;return t=this.map(function(){return Array.prototype.slice.call(this.children)}),s(t,e)},e.fn.get=function(e){return e===undefined?this:this[e]},e.fn.first=function(){return e(this[0])},e.fn.last=function(){return e(this[this.length-1])},e.fn.closest=function(t,n){var r,i;i=this[0],r=e(t),r.length||(i=null);while(i&&r.indexOf(i)<0)i=i!==n&&i!==document&&i.parentNode;return e(i)},e.fn.each=function(e){return this.forEach(function(t,n){return e.call(t,n,t)}),this},o=function(t){var n;n=[];while(t.length>0)t=e.map(t,function(e){if((e=e.parentNode)&&e!==document&&n.indexOf(e)<0)return n.push(e),e});return n},s=function(t,n){return n===undefined?e(t):e(t).filter(n)}}(Quo),function(e){var t,n,r;return t=["-webkit-","-moz-","-ms-","-o-",""],e.fn.addClass=function(e){return this.each(function(){if(!r(e,this.className))return this.className+=" "+e,this.className=this.className.trim()})},e.fn.removeClass=function(e){return this.each(function(){if(!e)return this.className="";if(r(e,this.className))return this.className=this.className.replace(e," ").replace(/\s+/g," ").trim()})},e.fn.toggleClass=function(e){return this.each(function(){return r(e,this.className)?this.className=this.className.replace(e," "):(this.className+=" "+e,this.className=this.className.trim())})},e.fn.hasClass=function(e){return r(e,this[0].className)},e.fn.style=function(e,t){return t?this.each(function(){return this.style[e]=t}):this[0].style[e]||n(this[0],e)},e.fn.css=function(e,t){return this.style(e,t)},e.fn.vendor=function(e,n){var r,i,s,o;o=[];for(i=0,s=t.length;i<s;i++)r=t[i],o.push(this.style(""+r+e,n));return o},r=function(e,t){var n;return n=t.split(/\s+/g),n.indexOf(e)>=0},n=function(e,t){return document.defaultView.getComputedStyle(e,"")[t]}}(Quo),function(e){return e.fn.attr=function(t,n){return e.toType(t)==="string"&&n===void 0?this[0].getAttribute(t):this.each(function(){return this.setAttribute(t,n)})},e.fn.removeAttr=function(e){return this.each(function(){return this.removeAttribute(e)})},e.fn.data=function(e,t){return this.attr("data-"+e,t)},e.fn.removeData=function(e){return this.removeAttr("data-"+e)},e.fn.val=function(t){return e.toType(t)==="string"?this.each(function(){return this.value=t}):this.length>0?this[0].value:null},e.fn.show=function(){return this.style("display","block")},e.fn.hide=function(){return this.style("display","none")},e.fn.height=function(){var e;return e=this.offset(),e.height},e.fn.width=function(){var e;return e=this.offset(),e.width},e.fn.offset=function(){var e;return e=this[0].getBoundingClientRect(),{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}},e.fn.remove=function(){return this.each(function(){if(this.parentNode!=null)return this.parentNode.removeChild(this)})}}(Quo),function(e){return e.fn.text=function(t){return t||e.toType(t)==="number"?this.each(function(){return this.textContent=t}):this[0].textContent},e.fn.html=function(t){var n;return n=e.toType(t),t||n==="number"||n==="string"?this.each(function(){return n==="string"||n==="number"?this.innerHTML=t:(this.innerHTML=null,this.appendChild(t))}):this[0].innerHTML},e.fn.append=function(t){var n;return n=e.toType(t),this.each(function(){var e=this;return n==="string"?this.insertAdjacentHTML("beforeend",t):n==="array"?t.each(function(t,n){return e.appendChild(n)}):this.appendChild(t)})},e.fn.prepend=function(t){var n;return n=e.toType(t),this.each(function(){var e=this;return n==="string"?this.insertAdjacentHTML("afterbegin",t):n==="array"?t.each(function(t,n){return e.insertBefore(n,e.firstChild)}):this.insertBefore(t,this.firstChild)})},e.fn.replaceWith=function(t){var n;return n=e.toType(t),this.each(function(){var e=this;if(this.parentNode)return n==="string"?this.insertAdjacentHTML("beforeBegin",t):n==="array"?t.each(function(t,n){return e.parentNode.insertBefore(n,e)}):this.parentNode.insertBefore(t,this)}),this.remove()},e.fn.empty=function(){return this.each(function(){return this.innerHTML=null})}}(Quo),function(e){var t,n,r,i,s,o,u,a,f,l,c;return t={TYPE:"GET",MIME:"json"},r={script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},n=0,e.ajaxSettings={type:t.TYPE,async:!0,success:{},error:{},context:null,dataType:t.MIME,headers:{},xhr:function(){return new window.XMLHttpRequest},crossDomain:!1,timeout:0},e.ajax=function(n){var r,u,l;u=e.mix(e.ajaxSettings,n),u.type===t.TYPE?u.url+=e.serializeParameters(u.data,"?"):u.data=e.serializeParameters(u.data);if(i(u.url))return e.jsonp(u);l=u.xhr(),l.onreadystatechange=function(){if(l.readyState===4)return clearTimeout(r),f(l,u)},l.open(u.type,u.url,u.async),a(l,u),u.timeout>0&&(r=setTimeout(function(){return c(l,u)},u.timeout));try{l.send(u.data)}catch(h){l=h,o("Resource not found",l,u)}
return u.async?l:s(l,u)},e.jsonp=function(t){var r,i,s,o;return t.async?(i=(("jsonp")+(++n)),s=document.createElement("script"),o={abort:function(){e(s).remove();if(i in window)return window[i]={}}},r=void 0,window[i]=function(n){return clearTimeout(r),e(s).remove(),delete window[i],l(n,o,t)},s.src=t.url.replace(RegExp("=\\?"),"="+i),e("head").append(s),t.timeout>0&&(r=setTimeout(function(){return c(o,t)},t.timeout)),o):console.error("QuoJS.ajax: Unable to make jsonp synchronous call.")},e.get=function(t,n,r,i){return e.ajax({url:t,data:n,success:r,dataType:i})},e.post=function(e,t,n,r){return u("POST",e,t,n,r)},e.put=function(e,t,n,r){return u("PUT",e,t,n,r)},e["delete"]=function(e,t,n,r){return u("DELETE",e,t,n,r)},e.json=function(n,r,i){return e.ajax({url:n,data:r,success:i,dataType:t.MIME})},e.serializeParameters=function(e,t){var n,r;t==null&&(t=""),r=t;for(n in e)e.hasOwnProperty(n)&&(r!==t&&(r+="&"),r+=n+"="+e[n]);return r===t?"":r},f=function(e,t){e.status>=200&&e.status<300||e.status===0?t.async&&l(s(e,t),e,t):o("QuoJS.ajax: Unsuccesful request",e,t)},l=function(e,t,n){n.success.call(n.context,e,t)},o=function(e,t,n){n.error.call(n.context,e,t,n)},a=function(e,t){var n;t.contentType&&(t.headers["Content-Type"]=t.contentType),t.dataType&&(t.headers.Accept=r[t.dataType]);for(n in t.headers)e.setRequestHeader(n,t.headers[n])},c=function(e,t){e.onreadystatechange={},e.abort(),o("QuoJS.ajax: Timeout exceeded",e,t)},u=function(t,n,r,i,s){return e.ajax({type:t,url:n,data:r,success:i,dataType:s,contentType:"application/x-www-form-urlencoded"})},s=function(e,n){var r;r=e.responseText;if(r)if(n.dataType===t.MIME)try{r=JSON.parse(r)}catch(i){r=i,o("QuoJS.ajax: Parse Error",e,n)}else n.dataType==="xml"&&(r=e.responseXML);return r},i=function(e){return RegExp("=\\?").test(e)}}(Quo),function(e){var t,n,r,i,s,o,u,a,f,l,c,h;return t=1,i={},r={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},n={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touch:"click",doubletap:"dblclick",orientationchange:"resize"},s=/complete|loaded|interactive/,e.fn.on=function(t,n,r){return n==="undefined"||e.toType(n)==="function"?this.bind(t,n):this.delegate(n,t,r)},e.fn.off=function(t,n,r){return n==="undefined"||e.toType(n)==="function"?this.unbind(t,n):this.undelegate(n,t,r)},e.fn.ready=function(t){return s.test(document.readyState)?t(e):e.fn.addEvent(document,"DOMContentLoaded",function(){return t(e)})},e.Event=function(e,t){var n,r;n=document.createEvent("Events"),n.initEvent(e,!0,!0,null,null,null,null,null,null,null,null,null,null,null,null);if(t)for(r in t)n[r]=t[r];return n},e.fn.bind=function(e,t){return this.each(function(){c(this,e,t)})},e.fn.unbind=function(e,t){return this.each(function(){h(this,e,t)})},e.fn.delegate=function(t,n,r){return this.each(function(i,s){c(s,n,r,t,function(n){return function(r){var i,u;u=e(r.target).closest(t,s).get(0);if(u)return i=e.extend(o(r),{currentTarget:u,liveFired:s}),n.apply(u,[i].concat([].slice.call(arguments,1)))}})})},e.fn.undelegate=function(e,t,n){return this.each(function(){h(this,t,n,e)})},e.fn.trigger=function(t,n){return e.toType(t)==="string"&&(t=e.Event(t,n)),this.each(function(){this.dispatchEvent(t)})},e.fn.addEvent=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},e.fn.removeEvent=function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},c=function(t,n,r,s,o){var f,c,h,p;return n=a(n),h=l(t),c=i[h]||(i[h]=[]),f=o&&o(r,n),p={event:n,callback:r,selector:s,proxy:u(f,r,t),delegate:f,index:c.length},c.push(p),e.fn.addEvent(t,p.event,p.proxy)},h=function(t,n,r,s){var o;return n=a(n),o=l(t),f(o,n,r,s).forEach(function(n){return delete i[o][n.index],e.fn.removeEvent(t,n.event,n.proxy)})},l=function(e){return e._id||(e._id=t++)},a=function(t){var r;return r=e.isMobile()?t:n[t],r||t},u=function(e,t,n){var r;return t=e||t,r=function(e){var r;return r=t.apply(n,[e].concat(e.data)),r===!1&&e.preventDefault(),r},r},f=function(e,t,n,r){return(i[e]||[]).filter(function(e){return e&&(!t||e.event===t)&&(!n||e.callback===n)&&(!r||e.selector===r)})},o=function(t){var n;return n=e.extend({originalEvent:t},t),e.each(r,function(e,r){return n[e]=function(){return this[r]=function(){return!0},t[e].apply(t,arguments)},n[r]=function(){return!1}}),n}}(Quo),function($$){var CURRENT_TOUCH,FIRST_TOUCH,GESTURE,GESTURES,HOLD_DELAY,TAPS,TOUCH_TIMEOUT,_angle,_capturePinch,_captureRotation,_cleanGesture,_distance,_fingersPosition,_getTouches,_hold,_isSwipe,_listenTouches,_onTouchEnd,_onTouchMove,_onTouchStart,_parentIfText,_swipeDirection,_trigger;return TAPS=null,GESTURE={},FIRST_TOUCH=[],CURRENT_TOUCH=[],TOUCH_TIMEOUT=void 0,HOLD_DELAY=650,GESTURES=["tap","singleTap","doubleTap","hold","swipe","swiping","swipeLeft","swipeRight","swipeUp","swipeDown","rotate","rotating","rotateLeft","rotateRight","pinch","pinching","pinchIn","pinchOut","drag","dragLeft","dragRight","dragUp","dragDown"],GESTURES.forEach(function(e){return $$.fn[e]=function(t){return $$(document.body).delegate(this.selector,e,t)},this}),$$(document).ready(function(){return _listenTouches()}),_listenTouches=function(){var e;return e=$$(document.body),e.bind("touchstart",_onTouchStart),e.bind("touchmove",_onTouchMove),e.bind("touchend",_onTouchEnd),e.bind("touchcancel",_cleanGesture)},_onTouchStart=function(e){var t,n,r,i;r=Date.now(),t=r-(GESTURE.last||r),TOUCH_TIMEOUT&&clearTimeout(TOUCH_TIMEOUT),i=_getTouches(e),n=i.length,FIRST_TOUCH=_fingersPosition(i,n),GESTURE.el=$$(_parentIfText(i[0].target)),GESTURE.fingers=n,GESTURE.last=r,GESTURE.taps||(GESTURE.taps=0),GESTURE.taps++;if(n===1)return n>=1&&(GESTURE.gap=t>0&&t<=250),setTimeout(_hold,HOLD_DELAY);if(n===2)return GESTURE.initial_angle=parseInt(_angle(FIRST_TOUCH),10),GESTURE.initial_distance=parseInt(_distance(FIRST_TOUCH),10),GESTURE.angle_difference=0,GESTURE.distance_difference=0},_onTouchMove=function(e){var t,n,r;return GESTURE.el&&(r=_getTouches(e),t=r.length,t===GESTURE.fingers?(CURRENT_TOUCH=_fingersPosition(r,t),n=_isSwipe(e),n&&(GESTURE.prevSwipe=!0),(n||GESTURE.prevSwipe===!0)&&_trigger("swiping"),t===2&&(_captureRotation(),_capturePinch(),e.preventDefault())):_cleanGesture()),!0},_isSwipe=function(e){var t,n,r;return t=!1,CURRENT_TOUCH[0]&&(n=Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>30,r=Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>30,t=GESTURE.el&&(n||r)),t},_onTouchEnd=function(e){var t,n,r,i,s;if(GESTURE.fingers!==1)return t=!1,GESTURE.angle_difference!==0&&(_trigger("rotate",{angle:GESTURE.angle_difference}),i=GESTURE.angle_difference>0?"rotateRight":"rotateLeft",_trigger(i,{angle:GESTURE.angle_difference}),t=!0),GESTURE.distance_difference!==0&&(_trigger("pinch",{angle:GESTURE.distance_difference}),r=GESTURE.distance_difference>0?"pinchOut":"pinchIn",_trigger(r,{distance:GESTURE.distance_difference}),t=!0),!t&&CURRENT_TOUCH[0]&&(Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>10||Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>10)&&(_trigger("drag"),n=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y),_trigger("drag"+n)),_cleanGesture();if(GESTURE.taps===2&&GESTURE.gap)return _trigger("doubleTap"),_cleanGesture();if(_isSwipe()||GESTURE.prevSwipe)return _trigger("swipe"),s=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y),_trigger("swipe"+s),_cleanGesture();_trigger("tap");if(GESTURE.taps===1)return TOUCH_TIMEOUT=setTimeout(function(){return _trigger("singleTap"),_cleanGesture()},100)},_fingersPosition=function(e,t){var n,r;r=[],n=0,e=e[0].targetTouches?e[0].targetTouches:e;while(n<t)r.push({x:e[n].pageX,y:e[n].pageY}),n++;return r},_captureRotation=function(){var angle,diff,i,symbol;angle=parseInt(_angle(CURRENT_TOUCH),10),diff=parseInt(GESTURE.initial_angle-angle,10);if(Math.abs(diff)>20||GESTURE.angle_difference!==0){i=0,symbol=GESTURE.angle_difference<0?"-":"+";while(Math.abs(diff-GESTURE.angle_difference)>90&&i++<10)eval("diff "+symbol+"= 180;");return GESTURE.angle_difference=parseInt(diff,10),_trigger("rotating",{angle:GESTURE.angle_difference})}},_capturePinch=function(){var e,t;t=parseInt(_distance(CURRENT_TOUCH),10),e=GESTURE.initial_distance-t;if(Math.abs(e)>10)return GESTURE.distance_difference=e,_trigger("pinching",{distance:e})},_trigger=function(e,t){if(GESTURE.el)return t=t||{},CURRENT_TOUCH[0]&&(t.iniTouch=GESTURE.fingers>1?FIRST_TOUCH:FIRST_TOUCH[0],t.currentTouch=GESTURE.fingers>1?CURRENT_TOUCH:CURRENT_TOUCH[0]),GESTURE.el.trigger(e,t)},_cleanGesture=function(e){return FIRST_TOUCH=[],CURRENT_TOUCH=[],GESTURE={},clearTimeout(TOUCH_TIMEOUT)},_angle=function(e){var t,n,r;return t=e[0],n=e[1],r=Math.atan((n.y-t.y)*-1/(n.x-t.x))*(180/Math.PI),r<0?r+180:r},_distance=function(e){var t,n;return t=e[0],n=e[1],Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y))*-1},_getTouches=function(e){return $$.isMobile()?e.touches:[e]},_parentIfText=function(e){return"tagName"in e?e:e.parentNode},_swipeDirection=function(e,t,n,r){var i,s;return i=Math.abs(e-t),s=Math.abs(n-r),i>=s?e-t>0?"Left":"Right":n-r>0?"Up":"Down"},_hold=function(){if(GESTURE.last&&Date.now()-GESTURE.last>=HOLD_DELAY)return _trigger("hold"),GESTURE.taps=0}}(Quo);;var Orm={properties:function(){var properties={};for(var name in this){if(name.indexOf('_')!==0&&!$.isFunction(this[name])){if(this[name]===true){properties[name]=1;}else if(this[name]===false){properties[name]=0;}else{properties[name]=this[name];}}}
return properties;},loadType:function(cls,data){if(!this['__'+data]){this['__'+data]=[];for(x in this['_'+data]){this['__'+data][this['__'+data].length]=App.cache(cls,this['_'+data][x]);}
this['_'+data]=null;}
return this['__'+data];},save:function(complete){if(!this.type)return;$.post(App.service+this.resource+(this.id?('/'+this.id):''),this.properties(),function(result){if(complete){complete(result);}});},load:function(id){var self=this;if(typeof(id)=='object'){this.finished(id);}else{App.request(App.service+self.resource+'/'+id,function(json){if(json.error){throw'ORM load error: '+json.error+"\nType: "+self.type+"\nResource: "+self.resource+"\nID: "+id;}else{self.finished(json);}});}}};function restaurantSort(a,b){var bubble;if((a.open()&&b.open())||(!a.open()&&!b.open())){bubble=parseInt(a.sort)-parseInt(b.sort);}else if(a.open()&&!b.open()){bubble=-1;}else if(!a.open()&&b.open()){bubble=1;}else{console.log('Should not be here',a,b);}
return bubble;}
var Community=function(id){this.type='Community';this.id_var='id_community';this.resource='community';var self=this;$.extend(self,Orm);if(arguments[1]){complete=arguments[1];}else{complete=function(){};}
self.restaurants=function(){if(!self.__restaurants){var openRestaurants=[];var closedRestaurants=[];for(x in self._restaurants){var restaurant=App.cache('Restaurant',self._restaurants[x]);if(restaurant.open()){openRestaurants[openRestaurants.length]=restaurant;}else{closedRestaurants[closedRestaurants.length]=restaurant;}}
openRestaurants.sort(restaurantSort);closedRestaurants.sort(restaurantSort);self.__restaurants=[];self._restaurants=null;for(x in openRestaurants){self.__restaurants[self.__restaurants.length]=openRestaurants[x];}
for(x in closedRestaurants){self.__restaurants[self.__restaurants.length]=closedRestaurants[x];}}
return self.__restaurants;}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.restaurants();if(complete){complete.call(self);}}
self.load(id);}
App.cached.Community={};;var Restaurant=function(id){this.type='Restaurant';this.id_var='id_restaurant';this.resource='restaurant';var
self=this,complete;$.extend(self,Orm);if(arguments[1]){complete=arguments[1];}else{complete=function(){};}
this._utcTime=function(serverTime)
{return this._parseDate(serverTime.add(-this._tzoffset).hours().toUTCString());}
this._parseDate=function(dateStr){if(!dateStr){return null;}
dateStr=dateStr.split(',');dateStr=(dateStr.length==2?dateStr[1]:dateStr[0]).trim();return Date.parse(dateStr);}
this._utcNow=function()
{return Date.parse(dateTime.toString());}
this.isAboutToClose=function(){var minimumTime=15;var today=Date.today().toString('ddd').toLowerCase();var tomorrow=Date.today().add(1).days().toString('ddd').toLowerCase();if(this._hours==undefined||this._hours[today]==undefined){return false;}
todayHours=this._hours[today];if(this._hours[tomorrow]){var tomorrowHours=this._hours[tomorrow];var tomorrowItOpensAt=tomorrowHours[0][0];var tomorrowItClosesAt=tomorrowHours[0][1];}else{var tomorrowItOpensAt=false;var tomorrowItClosesAt=false;}
for(i in todayHours){var openTime=Date.parse(todayHours[i][0]);var closeTime=Date.parse(todayHours[i][1]);var nextHour=parseInt(i)+1;if(todayHours[nextHour]){var nextHourOpenTime=todayHours[nextHour][0];var nextHourCloseTime=todayHours[nextHour][1];}else{var nextHourOpenTime=false;var nextHourCloseTime=false;}
var previousHour=parseInt(i)-1;if(todayHours[previousHour]){var previousHourOpenTime=todayHours[previousHour][0];var previousHourCloseTime=todayHours[previousHour][1];}else{var previousHourOpenTime=false;var previousHourCloseTime=false;}
if(todayHours[i][1]=='24:00'||todayHours[i][1]=='00:00'){closeTime=Date.parse('00:00');if(tomorrowItOpensAt=='00:00'||tomorrowItOpensAt=='0:00'){closeTime=Date.parse(tomorrowItClosesAt);}
else if(nextHourOpenTime=='00:00'||nextHourOpenTime=='0:00'){closeTime=Date.parse(nextHourCloseTime);}
else if(previousHourOpenTime=='00:00'||previousHourOpenTime=='0:00'){closeTime=Date.parse(previousHourCloseTime);}
closeTime.addDays(1);}
if(closeTime.compareTo(openTime)==-1){closeTime.addDays(1);}
closeTime=this._utcTime(closeTime);openTime=closeTime.clone().addMinutes(-1*minimumTime);utcNow=this._utcNow();if(utcNow.between(openTime,closeTime)){var minutes=(closeTime.getTime()-utcNow.getTime())/1000/60;minutes=Math.floor(minutes);return minutes;}}
return false;}
self.categories=function(){return self.loadType('Category','categories');}
self.notifications=function(){return self.loadType('Notification','notifications');}
self.top=function(){var categories=self.categories();for(var x in categories){var dishes=categories[x].dishes();for(var xx in dishes){if(dishes[xx].top==1){return dishes[xx];}}}}
self.deliveryDiff=function(){var total=self.delivery_min_amt=='subtotal'?App.cart.subtotal():App.cart.total();var diff=parseFloat(App.restaurant.delivery_min-total).toFixed(2);return diff;}
self.meetDeliveryMin=function(){var total=self.delivery_min_amt=='subtotal'?App.cart.subtotal():App.cart.total();return total<parseFloat(self.delivery_min)?true:false;}
self.dateFromItem=function(item,offset){var
theTime=item.split(':'),theDate=new Date();theDate.setHours(theTime[0]);theDate.setMinutes(theTime[1]+offset);return theDate;}
self.open=function(){if(this.open_for_business==="0"){this._open=false;return false;}
if(!this._hours){this._open=false;return false;}
var isOpen=false;var today=Date.today().toString('ddd').toLowerCase();if(this._hours==undefined||this._hours[today]==undefined){this._open=false;return false;}
todayHours=this._hours[today];for(i in todayHours){var openTime=this._parseDate(todayHours[i][0]);var closeTime=this._parseDate(todayHours[i][1]);if(todayHours[i][1]=='24:00'){closeTime=this._parseDate('00:00');closeTime.addDays(1);}
if(openTime){var openTime_utc=this._parseDate(openTime.add(-this._tzoffset).hours().toUTCString());}
if(closeTime){var closeTime_utc=this._parseDate(closeTime.add(-this._tzoffset).hours().toUTCString());}
var now_utc=this._utcNow();if(closeTime_utc){if(closeTime_utc.compareTo(openTime_utc)==-1){closeTime_utc.addDays(1);}}
if(openTime_utc&&closeTime_utc){if(now_utc.between(openTime_utc,closeTime_utc)){isOpen=true;break;}}}
this._open=isOpen;return isOpen;}
self.deliveryHere=function(param){var km=App.loc.distance({from:{lat:param.lat,lon:param.lon},to:{lat:this.loc_lat,lon:this.loc_long}});var miles=App.loc.km2Miles(km);return(miles<=this.delivery_radius)}
self.closedMessage=function(){var isOpenedAt={};var openTime=this._hours;var weekdayOrder=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];var patternHour=/([0])([1-9])(:)([0-9]{2})/;for(var day in openTime){var hours=openTime[day];var key='';var openedHoursText='';var openedHoursTextDivisor='';for(var hour in hours){var open=hours[hour][0];var close=hours[hour][1];key+=open+close;var formatedOpen=App.formatTime(open).toLowerCase().replace(patternHour,'\$2\$3\$4').replace(/:00/g,'').replace(' ','');var formatedClose=App.formatTime(close).toLowerCase().replace(patternHour,'\$2\$3\$4').replace(/:00/g,'').replace(' ','');openedHoursText+=openedHoursTextDivisor+formatedOpen+' - '+formatedClose;openedHoursTextDivisor=', ';}
key=key.replace(/\:/g,'');if(!isOpenedAt[key]){isOpenedAt[key]={days:{},hours:{}};}
openedHoursText=openedHoursText.replace('- 12am, 12am ','');isOpenedAt[key]['days'][day]=true;isOpenedAt[key]['hour']=openedHoursText;}
var _opened={};for(var hour in isOpenedAt){var days=isOpenedAt[hour]['days'];var commas='';var keys='';for(day in days){keys+=commas+App.capitalize(day);commas=', ';}
hours=isOpenedAt[hour]['hour'];_opened[keys]=hours;}
var _groupedDays={};for(var days in _opened){var weekdays=days.split(',');var nextPosition=-1;var sequenceStartedAt=false;var groupedDays={};var totalWeekdays=weekdays.length;for(var i=0;i<=totalWeekdays;++i){var weekday=$.trim(weekdays[i]);var position=weekdayOrder.indexOf(weekday);if(nextPosition!=position){sequenceStartedAt=weekday;groupedDays[sequenceStartedAt]=[];groupedDays[sequenceStartedAt]=[weekday];}
if(nextPosition==position){groupedDays[sequenceStartedAt].push(weekday);}
nextPosition=position+1;}
var key='';for(var group in groupedDays){if(group!=''){if(groupedDays[group].length==1){if(key!=''){key+=', ';}
key+=groupedDays[group][0];}
if(groupedDays[group].length==2){if(key!=''){key+=', ';}
key+=groupedDays[group][0]+', '+groupedDays[group][1];}
if(groupedDays[group].length>2){if(key!=''){key+=', ';}
key+=groupedDays[group][0]+' - '+groupedDays[group][groupedDays[group].length-1];}}}
key+=': ';_groupedDays[key]=_opened[days];}
var ordered=[];for(var index=0;index<weekdayOrder.length;++index){var weekday=weekdayOrder[index];for(var day in _groupedDays){var regexp=new RegExp('^'+weekday,'i')
if(regexp.test(day)){ordered.push(day+_groupedDays[day]);}}}
return ordered.join('\n');}
self.preset=function(){return self['_preset'];}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.categories();if(complete){complete.call(self);}}
self.load(id);}
App.cached.Restaurant={};;var Dish=function(id){this.type='Dish';this.id_var='id_dish';this.resource='dish';var self=this;$.extend(self,Orm);self.options=function(){return self.loadType('Option','options');}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.options();}
self.load(id);}
App.cached.Dish={};;var Option=function(id){this.type='Option';var self=this;self.optionPrice=function(options){var price=parseFloat(self.price);for(var x in self.prices){if(options.indexOf(self.prices[x].id_option_parent)!==-1){price+=parseFloat(self.prices[x].price);}}
return price;}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/option/'+id,function(json){for(x in json){self[x]=json[x];}});}}
App.cached.Option={};;var Category=function(id){this.type='Dish';var self=this;$.extend(self,Orm);self.dishes=function(){return self.loadType('Dish','dishes');}
self.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}
self.dishes();}else{App.request(App.service+'/category/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Category={};;var Notification=function(id){var self=this;$.extend(this,Orm);this.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/notification/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Notification={};;var Order=function(id){this.type='Order';this.id_var='id_order';this.resource='order';var self=this;$.extend(self,Orm);if(arguments[1]){complete=arguments[1];}else{complete=function(){};}
self.finished=function(data){for(x in data){self[x]=data[x];}
if(complete){complete.call(self);}}
self.load(id);}
App.cached.Order={};;App.facebook={api:{status:{order:'facebook/status/order/'},publish:{order:'facebook/publish/order/',permission:'facebook/publish/permission'},token:'facebook/token',login:'facebook/url',},maxtries:2,tries:0,token:false,orderStatus:false}
App.facebook.preLoadOrderStatus=function(){var url=App.service+App.facebook.api.status.order+App._order_uuid;$.getJSON(url,function(json){if(json.success){App.facebook.orderStatus=json.success;}else{App.facebook.orderStatus=false;}});}
App.facebook.postOrder=function(){if(!App.facebook.orderStatus){App.facebook.preLoadOrderStatus();alert('Oops, please try again!');return;}
var status=App.facebook.orderStatus;FB.ui({method:'stream.publish',user_message_prompt:'CrunchButton: Publish This!',message:status.message,attachment:{name:status.name,caption:status.caption,description:status.description,href:status.link,media:[{'type':'image','src':status.picture,'href':status.link}],},action_links:[{text:status.site_name,href:status.site_url}]},function(response){if(response&&response.post_id){alert('Thank you for sharing!');}});}
App.facebook.postOrderByAPI=function(uuid){App.facebook.postOrderResetTries();App.facebook.postOrderRun(uuid);}
App.facebook.postOrderResetTries=function(){App.facebook.tries=0;}
App.facebook.checkPublishPermission=function(success,error){var url=App.service+App.facebook.api.publish.permission;$.getJSON(url,function(json){if(json.success){success();}else if(json.error){error();}});}
App.facebook.postOrderRun=function(uuid){if(!App.facebook.token){App.facebook.requestLogin(function(){App.facebook.postOrderRun(uuid);})}else{App.facebook.checkPublishPermission(function(){App.facebook.postOrderAuto(uuid);},function(){if(App.facebook.tries<App.facebook.maxtries){App.facebook.tries++;App.facebook.requestPermission(function(){App.facebook.postOrderRun(uuid);});}else{alert('Oops, error. Please try it again.');window.location.reload();}});}}
App.facebook.postOrderAuto=function(uuid){if(App.facebook.token){var url=App.service+App.facebook.api.publish.order;$.ajax({type:'POST',url:url,data:{'uuid':uuid},dataType:'json',success:function(json){if(json.success){if(json.success=='status posted'){App.facebook.postOrderResetTries();alert('Thank you for sharing!');}}else if(json.error){alert('Oops, error. Please try it again.');}}});}}
App.facebook.requestLogin=function(callback){FB.login(function(response){App.facebook.processStatus(response,callback);},{scope:App.facebookScope});}
App.facebook.registerToken=function(token){if(!App.facebook.token){App.facebook.token=token;var url=App.service+App.facebook.api.token;$.cookie('fbtoken',token,{expires:new Date(3000,01,01),path:'/'});}}
App.facebook.requestPermission=function(callback){FB.ui({method:'permissions.request','perms':App.facebookScope,'display':'iframe'},function(response){callback();});}
App.facebook.processStatus=function(response,callback){if(response.status==='connected'&&response.authResponse){if(response.authResponse.accessToken){App.facebook.registerToken(response.authResponse.accessToken);}
callback();}}
$(function(){$(document).on('touchclick','.share-order-facebook-button',function(){App.facebook.postOrder();});});;App.support={api:{sms:'support/sms',},itIsSending:false}
App.support.init=function(){$('body').append(App.render('support'));$(document).on('click','.support-minimized',function(){App.support.maxi();});$(document).on('click','.support-maximized-header',function(){App.support.mini();});$(document).on('click','.support-maximized-button',function(){App.support.sendSMS();});}
App.support.maxi=function(){$('.support-minimized').hide();$('.support-maximized').show();$('input[name=support-name]').val(App.config.user.name||'');$('input[name=support-phone]').val(App.config.user.phone||'');$('textarea[name=support-message]').val('')}
App.support.mini=function(){$('.support-minimized').show();$('.support-maximized').hide();}
App.support.sendSMS=function(){if($.trim($('input[name=support-name]').val())==''){alert('Please enter your name.');$('input[name=support-name]').focus();return;}
if($.trim($('input[name=support-phone]').val())==''){alert('Please enter your phone.');$('input[name=support-phone]').focus();return;}
if(!App.phone.validate($.trim($('input[name=support-phone]').val()))){alert('Please enter a valid phone.');$('input[name=support-phone]').focus();return;}
if($.trim($('textarea[name=support-message]').val())==''){alert('Please enter the message.');$('input[name=support-message]').focus();return;}
var data={name:$('input[name=support-name]').val(),phone:$('input[name=support-phone]').val(),message:$('textarea[name=support-message]').val()};if(!App.support.itIsSending){App.support.itIsSending=true;alert('Thank you!');App.support.mini();$.ajax({type:'POST',dataType:'json',data:data,url:App.service+App.support.api.sms,success:function(json){App.support.itIsSending=false;}});}};App.recommend={api:{add:'suggestion/restaurant',relateuser:'suggestion/relateuser'},itIsSending:false,recommendations:false}
App.recommend.init=function(){$(document).on('touchclick','.home-recommend-button',function(){App.recommend.send();});$(document).on('keyup','.home-recommend-text',function(e){if(e.which==13){App.recommend.send();}});$(document).on('touchclick','.home-recommend-message-create-account',function(){App.signup.show(false);});}
App.recommend.send=function(){if($.trim($('.home-recommend-text').val())==''){alert("Please enter the restaurant\'s name.");$('.home-recommend-text').focus();return;}
var pos=App.loc.pos();var content='Address entered: '+pos.addressEntered+'\n'+'Address reverse: '+pos.addressReverse+'\n'+'City: '+pos.city+'\n'+'Region: '+pos.region+'\n'+'Lat: '+pos.lat+'\n'+'Lon: '+pos.lon;var data={name:$('.home-recommend-text').val(),content:content};if(!App.recommend.itIsSending){App.recommend.showThankYou();App.recommend.itIsSending=true;$.ajax({type:'POST',dataType:'json',data:data,url:App.service+App.recommend.api.add,success:function(json){App.recommend.itIsSending=false;if(!App.recommend.recommendations){App.recommend.recommendations=[];}
App.recommend.recommendations.push(json.id_suggestion);}});}}
App.recommend.relateUser=function(){if(App.recommend.recommendations){var url=App.service+App.recommend.api.relateuser;$.each(App.recommend.recommendations,function(index,value){var id_suggestion=value;var data={id_suggestion:id_suggestion,id_user:App.config.user.id_user};$.ajax({type:'POST',dataType:'json',data:data,url:url,success:function(json){}});});App.recommend.recommendations=false;}}
App.recommend.showThankYou=function(){$('.home-recommend-form').animate({'opacity':0},function(){$('.home-recommend-form').hide();$('.home-recommend-thank-you').css('opacity',0);$('.home-recommend-thank-you').show();$('.home-recommend-thank-you').animate({'opacity':1});});};App.credit={api:{byRestaurant:'user/credit/'},restaurant:{}}
App.credit.getCredit=function(complete){if(App.restaurant.id){var url=App.service+App.credit.api.byRestaurant+App.restaurant.id;$.getJSON(url,function(json){if(json.credit){App.credit.restaurant[App.restaurant.id]=json.credit;}else{App.credit.restaurant[App.restaurant.id]=0;}
if(complete){complete();}});}}
App.credit.tooltip={};App.credit.tooltip.init=function(){$(document).on('touchclick','.giftcard-badge',function(){App.credit.tooltip.show();});$(document).on('touchclick','body',function(){App.credit.tooltip.hide()});}
App.credit.tooltip.message=function(message){$('.giftcard-badge-tooltip').html(message);}
App.credit.tooltip.show=function(){if($('.giftcard-badge-tooltip').is(':visible')){return;}
setTimeout(function(){$('.giftcard-badge-tooltip').show();},100);}
App.credit.tooltip.hide=function(){$('.giftcard-badge-tooltip').hide();}
App.credit.hide=function(){$('.gift-card-message').hide();}
App.credit.show=function(){var gift=App.credit.restaurant[App.restaurant.id];if(parseFloat(gift)){var giftValue=App.ceil(gift).toFixed(2);var text='You have a '+((App.config.ab&&App.config.ab.dollarSign=='show')?'$':'')+giftValue+' gift card!';App.credit.tooltip.message(text);$('.gift-card-message').html(text);$('.gift-card-message').css('opacity',0);$('.gift-card-message').show();$('.gift-card-message').animate({'opacity':1},100);var integerGiftValue=parseInt(giftValue);if(integerGiftValue<giftValue){giftValue=integerGiftValue+'+';}else{giftValue=integerGiftValue;}
$('.giftcard-badge-value').html('$'+giftValue);$('.giftcard-badge').css('display','table');}else{$('.gift-card-message').hide();$('.giftcard-badge').css('display','none');}};App.giftcard={api:{code:'giftcard/code',validate:'giftcard/validate'},size:6,callback:false,hasStarted:false}
App.giftcard.show=function(path){if(!App.giftcard.hasStarted){App.giftcard.hasStarted=true;$('.wrapper').append(App.render('giftcard'));}
$('.giftcard-container').dialog({modal:true,dialogClass:'modal-fixed-dialog',width:App.modal.contentWidth(),close:function(event,ui){},open:function(event,ui){$('input[name=giftcard-code]').focus();}});setTimeout(function(){if(App.config.user.id_user&&$.trim(App.config.user.id_user)!=''){App.giftcard.process(path);}else{$('.giftcard-message-title').html('Welcome');$('.giftcard-message-text').html('Please <span class="giftcard-sign-in">sign in</span> to claim your gift card.');$(document).on('touchclick','.giftcard-sign-in',function(){App.giftcard.callback=function(){App.giftcard.callback=false;$('.giftcard-message-title').html('Gift card.');$('.giftcard-message-text').html('Just a sec.');App.giftcard.show(path);};$('.giftcard-container').dialog('close');App.signin.show();});}},300);}
App.giftcard.process=function(path){var code=(path.length>1)?(path[1]?path[1]:''):'';var url=App.service+App.giftcard.api.code;$.ajax({type:'POST',url:url,data:{'code':code},dataType:'json',success:function(json){var title='';var text='';if(json.error){title='Oops, error!'
if(json.error=='gift card already used'){text='Sorry, this gift card was already used.';}else if(json.error=='invalid gift card'){text='Sorry, this is an invalid gift card.';}else{text='Please try it again.';}}else{if(json.success){title='Gift card added!';var id_restaurant=json.success['id_restaurant'];var restaurant_name=json.success['restaurant'];var value='$'+json.success['value'];if(id_restaurant){var text='You\'ve got a  <span class="giftcard-value">'+value+'</span> gift card to <span id_restaurant="'+id_restaurant+'" class="giftcard-restaurant">'+restaurant_name+'</span>.'}else{var text='You\'ve got a  <span class="giftcard-value">'+value+'</span> gift card.'}
if(id_restaurant){$(document).on('touchclick','.giftcard-restaurant',function(){var id_restaurant=$(this).attr('id_restaurant');$('.giftcard-container').dialog('close');App.loadRestaurant(id_restaurant);});}}}
$('.giftcard-message-title').html(title);$('.giftcard-message-text').html(text);}});}
App.giftcard.notesField={value:0,isProcessing:false,callback:false,lastValue:0,backup:{value:0,backuped:false}};App.giftcard.notesField.listener=function(){if(App.giftcard.notesField.isProcessing){App.giftcard.notesField.callback=App.giftcard.notesField.listener;return false;}
App.giftcard.notesField.isProcessing=true;App.giftcard.notesField.value=0;$('.giftcard-info').html('');var notes=$.trim($('[name=notes]').val());var words=notes.split(' ');var giftcards={};App.giftcard.notesField.giftcards=[];for(var x in words){var word=$.trim(words[x]);if(word!=''){word=word.replace(/[^a-zA-Z 0-9]+/g,'');if(word.length==App.giftcard.size){giftcards[word]=word;}}}
var hasGiftsToValidate=false;$.each(giftcards,function(key,value){hasGiftsToValidate=true;App.giftcard.notesField.giftcards.push(value);App.giftcard.validate(value,App.giftcard.notesField.message);});if(!hasGiftsToValidate){App.giftcard.notesField.compareValues();}}
App.giftcard.notesField.compareValues=function(){if(App.giftcard.notesField.lastValue>App.giftcard.notesField.value){$('.giftcard-info').html('<span class="warning">'+'You just removed a gift card. If you still want to use that gift card, you must put it back in the notes field.'+'</span>');}
App.giftcard.notesField.lastValue=App.giftcard.notesField.value;App.giftcard.notesField.force(App.giftcard.notesField.value);App.giftcard.notesField.isProcessing=false;if(App.giftcard.notesField.callback){App.giftcard.notesField.callback();App.giftcard.notesField.callback=false;}}
App.giftcard.notesField.updateValue=function(){App.giftcard.notesField.force(App.giftcard.notesField.value);App.giftcard.notesField.giftcards.pop();if(App.giftcard.notesField.giftcards==0){App.giftcard.notesField.compareValues();}}
App.giftcard.notesField.message=function(giftinfo){var message=$('.giftcard-info').html();if($.trim(message)!=''){message+='<br/>';}
if(giftinfo.success){if(giftinfo.success.id_restaurant&&giftinfo.success.id_restaurant!=App.restaurant.id_restaurant){$('.giftcard-info').html(message+'The gift card ('+giftinfo.success.giftcard+') you are trying to use belongs to another restaurant.');}else{if(!giftinfo.success.id_restaurant){if(parseInt(App.restaurant.giftcard)!=1){$('.giftcard-info').html(message+'This restaurant does not accept gift card.');}else{$('.giftcard-info').html(message+'Congrats! This gift card ('+giftinfo.success.giftcard+') gives you $'+giftinfo.success.value+'.');App.giftcard.notesField.value=parseFloat(App.giftcard.notesField.value)+parseFloat(giftinfo.success.value);}}}}else{if(giftinfo.error=='gift card already used'){$('.giftcard-info').html(message+'The gift card ('+giftinfo.giftcard+') you are trying to use was already redeemed.');}}
App.giftcard.notesField.updateValue();}
App.giftcard.notesField.force=function(value){if(!App.giftcard.notesField.backup.backuped){App.giftcard.notesField.backup.backuped=true;App.giftcard.notesField.backup.value=parseFloat(App.credit.restaurant[App.restaurant.id]);}
App.credit.restaurant[App.restaurant.id]=parseFloat(App.giftcard.notesField.backup.value)+parseFloat(value);App.credit.show();App.cart.updateTotal();}
App.giftcard.validate=function(code,callback){var url=App.service+App.giftcard.api.validate;$.ajax({type:'POST',url:url,data:{'code':code},dataType:'json',success:function(json){if(callback){callback(json);}}});};App.creditCard={cards:[{'name':'master-card','pattern':/^5[1-5]/,'size':16},{'name':'visa','pattern':/^4/,'size':16},{'name':'amex','pattern':/^3[47]/,'size':15},{'name':'discover','pattern':/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,'size':16},]}
App.creditCard.validate=function(cardValue){var card=App.creditCard.detectType(cardValue);var isValid=false;if(card.size==cardValue.toString().length){isValid=App.creditCard.luhn(cardValue);}
if(isValid){$('[name="pay-card-number"]').addClass('credit-card-ok');}else{$('[name="pay-card-number"]').removeClass('credit-card-ok');}}
App.creditCard.luhn=function(cardValue){var sum=0;cardValueInverse=cardValue.toString().split('').reverse();for(n=i=0,size=cardValueInverse.length;i<size;n=++i){digit=cardValueInverse[n];digit=+digit;if(n%2){digit*=2;if(digit<10){sum+=digit;}else{sum+=digit-9;}}else{sum+=digit;}}
return sum%10===0;}
App.creditCard.changeIcons=function(cardValue){var card=App.creditCard.detectType(cardValue);if(card){$('.payment-card').addClass('to-grey');$('.payment-card').removeClass('to-color');$('.card-'+card.name).removeClass('to-grey');$('.card-'+card.name).addClass('to-color');$('.to-color').animate({'background-position-x':'0'},100);$('.to-grey').animate({'background-position-x':'-40px'},100);}else{$('.payment-card').animate({'background-position-x':'0'},100);}
App.creditCard.validate(cardValue);}
App.creditCard.detectType=function(cardValue){var cardType=false;$(App.creditCard.cards).each(function(index,card){if(card.pattern.test(cardValue)){cardType=card;}});return cardType;};(function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"===c.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;"undefined"!==typeof f?g=a[f]=[]:f="mixpanel";g.people=g.people||[];h=['disable','track','track_pageview','track_links','track_forms','register','register_once','unregister','identify','alias','name_tag','set_config','people.set','people.increment','people.track_charge','people.append'];for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])};a.__SV=1.2;})(document,window.mixpanel||[]);mixpanel.init("6eb260b54eecfd293d50b5f1423c6e98");;addEventListener('touchstart',function(){});addEventListener('load',function(event){setTimeout(scrollTo,80,0,1);},false);