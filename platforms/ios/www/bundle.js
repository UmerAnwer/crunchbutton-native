(function(win,doc){'use strict';var Snap=Snap||function(userOpts){var settings={element:null,dragger:null,disable:'none',addBodyClasses:true,hyperextensible:true,resistance:0.5,flickThreshold:50,transitionSpeed:0.3,easing:'ease',maxPosition:266,minPosition:-266,tapToClose:true,touchToDrag:true,slideIntent:40,minDragDistance:5},cache={simpleStates:{opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}}},eventList={},utils={hasTouch:(doc.ontouchstart===null),eventType:function(action){var eventTypes={down:(utils.hasTouch?'touchstart':'mousedown'),move:(utils.hasTouch?'touchmove':'mousemove'),up:(utils.hasTouch?'touchend':'mouseup'),out:(utils.hasTouch?'touchcancel':'mouseout')};return eventTypes[action];},page:function(t,e){return(utils.hasTouch&&e.touches.length&&e.touches[0])?e.touches[0]['page'+t]:e['page'+t];},klass:{has:function(el,name){return(el.className).indexOf(name)!==-1;},add:function(el,name){if(!utils.klass.has(el,name)&&settings.addBodyClasses){el.className+=" "+name;}},remove:function(el,name){if(settings.addBodyClasses){el.className=(el.className).replace(" "+name,"");}}},dispatchEvent:function(type){if(typeof eventList[type]==='function'){return eventList[type].call();}},vendor:function(){var tmp=doc.createElement("div"),prefixes='webkit Moz O ms'.split(' '),i;for(i in prefixes){if(typeof tmp.style[prefixes[i]+'Transition']!=='undefined'){return prefixes[i];}}},transitionCallback:function(){return(cache.vendor==='Moz'||cache.vendor==='ms')?'transitionend':cache.vendor+'TransitionEnd';},canTransform:function(){return typeof settings.element.style[cache.vendor+'Transform']!=='undefined';},deepExtend:function(destination,source){var property;for(property in source){if(source[property]&&source[property].constructor&&source[property].constructor===Object){destination[property]=destination[property]||{};utils.deepExtend(destination[property],source[property]);}else{destination[property]=source[property];}}
return destination;},angleOfDrag:function(x,y){var degrees,theta;theta=Math.atan2(-(cache.startDragY-y),(cache.startDragX-x));if(theta<0){theta+=2*Math.PI;}
degrees=Math.floor(theta*(180/Math.PI)-180);if(degrees<0&&degrees>-180){degrees=360-Math.abs(degrees);}
return Math.abs(degrees);},events:{addEvent:function addEvent(element,eventName,func){if(element.addEventListener){return element.addEventListener(eventName,func,false);}else if(element.attachEvent){return element.attachEvent("on"+eventName,func);}},removeEvent:function addEvent(element,eventName,func){if(element.addEventListener){return element.removeEventListener(eventName,func,false);}else if(element.attachEvent){return element.detachEvent("on"+eventName,func);}},prevent:function(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}}},parentUntil:function(el,attr){var isStr=typeof attr==='string';while(el.parentNode){if(isStr&&el.getAttribute&&el.getAttribute(attr)){return el;}else if(!isStr&&el===attr){return el;}
el=el.parentNode;}
return null;}},action={translate:{get:{matrix:function(index){if(!utils.canTransform()){return parseInt(settings.element.style.left,10);}else{var matrix=win.getComputedStyle(settings.element)[cache.vendor+'Transform'].match(/\((.*)\)/),ieOffset=8;if(matrix){matrix=matrix[1].split(',');if(matrix.length===16){index+=ieOffset;}
return parseInt(matrix[index],10);}
return 0;}}},easeCallback:function(){settings.element.style[cache.vendor+'Transition']='';cache.translation=action.translate.get.matrix(4);cache.easing=false;clearInterval(cache.animatingInterval);if(cache.easingTo===0){utils.klass.remove(doc.body,'snapjs-right');utils.klass.remove(doc.body,'snapjs-left');}
utils.dispatchEvent('animated');utils.events.removeEvent(settings.element,utils.transitionCallback(),action.translate.easeCallback);},easeTo:function(n){if(!utils.canTransform()){cache.translation=n;action.translate.x(n);}else{cache.easing=true;cache.easingTo=n;settings.element.style[cache.vendor+'Transition']='all '+settings.transitionSpeed+'s '+settings.easing;cache.animatingInterval=setInterval(function(){utils.dispatchEvent('animating');},1);clearInterval(cache.animatingInterval);utils.events.addEvent(settings.element,utils.transitionCallback(),action.translate.easeCallback);action.translate.x(n);}
if(n===0){settings.element.style[cache.vendor+'Transform']='';}},x:function(n){if((settings.disable==='left'&&n>0)||(settings.disable==='right'&&n<0)){return;}
if(!settings.hyperextensible){if(n===settings.maxPosition||n>settings.maxPosition){n=settings.maxPosition;}else if(n===settings.minPosition||n<settings.minPosition){n=settings.minPosition;}}
n=parseInt(n,10);if(isNaN(n)){n=0;}
if(utils.canTransform()){var theTranslate='translate3d('+n+'px, 0,0)';settings.element.style[cache.vendor+'Transform']=theTranslate;}else{settings.element.style.width=(win.innerWidth||doc.documentElement.clientWidth)+'px';settings.element.style.left=n+'px';settings.element.style.right='';}}},drag:{listen:function(){cache.translation=0;cache.easing=false;utils.events.addEvent(settings.element,utils.eventType('down'),action.drag.startDrag);utils.events.addEvent(settings.element,utils.eventType('move'),action.drag.dragging);utils.events.addEvent(settings.element,utils.eventType('up'),action.drag.endDrag);},stopListening:function(){utils.events.removeEvent(settings.element,utils.eventType('down'),action.drag.startDrag);utils.events.removeEvent(settings.element,utils.eventType('move'),action.drag.dragging);utils.events.removeEvent(settings.element,utils.eventType('up'),action.drag.endDrag);},startDrag:function(e){var target=e.target?e.target:e.srcElement,ignoreParent=utils.parentUntil(target,'data-snap-ignore');if(ignoreParent){utils.dispatchEvent('ignore');return;}
if(settings.dragger){var dragParent=utils.parentUntil(target,settings.dragger);if(!dragParent&&(cache.translation!==settings.minPosition&&cache.translation!==settings.maxPosition)){return;}}
utils.dispatchEvent('start');settings.element.style[cache.vendor+'Transition']='';cache.isDragging=true;cache.hasIntent=null;cache.intentChecked=false;cache.startDragX=utils.page('X',e);cache.startDragY=utils.page('Y',e);cache.dragWatchers={current:0,last:0,hold:0,state:''};cache.simpleStates={opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}};},dragging:function(e){if(cache.isDragging&&settings.touchToDrag){var thePageX=utils.page('X',e),thePageY=utils.page('Y',e),translated=cache.translation,absoluteTranslation=action.translate.get.matrix(4),whileDragX=thePageX-cache.startDragX,openingLeft=absoluteTranslation>0,translateTo=whileDragX,diff;if((cache.intentChecked&&!cache.hasIntent)){return;}
if(settings.addBodyClasses){if((absoluteTranslation)>0){utils.klass.add(doc.body,'snapjs-left');utils.klass.remove(doc.body,'snapjs-right');}else if((absoluteTranslation)<0){utils.klass.add(doc.body,'snapjs-right');utils.klass.remove(doc.body,'snapjs-left');}}
if(cache.hasIntent===false||cache.hasIntent===null){var deg=utils.angleOfDrag(thePageX,thePageY),inRightRange=(deg>=0&&deg<=settings.slideIntent)||(deg<=360&&deg>(360-settings.slideIntent)),inLeftRange=(deg>=180&&deg<=(180+settings.slideIntent))||(deg<=180&&deg>=(180-settings.slideIntent));if(!inLeftRange&&!inRightRange){cache.hasIntent=false;}else{cache.hasIntent=true;}
cache.intentChecked=true;}
if((settings.minDragDistance>=Math.abs(thePageX-cache.startDragX))||(cache.hasIntent===false)){return;}
utils.events.prevent(e);utils.dispatchEvent('drag');cache.dragWatchers.current=thePageX;if(cache.dragWatchers.last>thePageX){if(cache.dragWatchers.state!=='left'){cache.dragWatchers.state='left';cache.dragWatchers.hold=thePageX;}
cache.dragWatchers.last=thePageX;}else if(cache.dragWatchers.last<thePageX){if(cache.dragWatchers.state!=='right'){cache.dragWatchers.state='right';cache.dragWatchers.hold=thePageX;}
cache.dragWatchers.last=thePageX;}
if(openingLeft){if(settings.maxPosition<absoluteTranslation){diff=(absoluteTranslation-settings.maxPosition)*settings.resistance;translateTo=whileDragX-diff;}
cache.simpleStates={opening:'left',towards:cache.dragWatchers.state,hyperExtending:settings.maxPosition<absoluteTranslation,halfway:absoluteTranslation>(settings.maxPosition/2),flick:Math.abs(cache.dragWatchers.current-cache.dragWatchers.hold)>settings.flickThreshold,translation:{absolute:absoluteTranslation,relative:whileDragX,sinceDirectionChange:(cache.dragWatchers.current-cache.dragWatchers.hold),percentage:(absoluteTranslation/settings.maxPosition)*100}};}else{if(settings.minPosition>absoluteTranslation){diff=(absoluteTranslation-settings.minPosition)*settings.resistance;translateTo=whileDragX-diff;}
cache.simpleStates={opening:'right',towards:cache.dragWatchers.state,hyperExtending:settings.minPosition>absoluteTranslation,halfway:absoluteTranslation<(settings.minPosition/2),flick:Math.abs(cache.dragWatchers.current-cache.dragWatchers.hold)>settings.flickThreshold,translation:{absolute:absoluteTranslation,relative:whileDragX,sinceDirectionChange:(cache.dragWatchers.current-cache.dragWatchers.hold),percentage:(absoluteTranslation/settings.minPosition)*100}};}
action.translate.x(translateTo+translated);}},endDrag:function(e){if(cache.isDragging){utils.dispatchEvent('end');var translated=action.translate.get.matrix(4);if(cache.dragWatchers.current===0&&translated!==0&&settings.tapToClose){utils.events.prevent(e);action.translate.easeTo(0);cache.isDragging=false;cache.startDragX=0;return;}
if(cache.simpleStates.opening==='left'){if((cache.simpleStates.halfway||cache.simpleStates.hyperExtending||cache.simpleStates.flick)){if(cache.simpleStates.flick&&cache.simpleStates.towards==='left'){action.translate.easeTo(0);}else if((cache.simpleStates.flick&&cache.simpleStates.towards==='right')||(cache.simpleStates.halfway||cache.simpleStates.hyperExtending)){action.translate.easeTo(settings.maxPosition);}}else{action.translate.easeTo(0);}}else if(cache.simpleStates.opening==='right'){if((cache.simpleStates.halfway||cache.simpleStates.hyperExtending||cache.simpleStates.flick)){if(cache.simpleStates.flick&&cache.simpleStates.towards==='right'){action.translate.easeTo(0);}else if((cache.simpleStates.flick&&cache.simpleStates.towards==='left')||(cache.simpleStates.halfway||cache.simpleStates.hyperExtending)){action.translate.easeTo(settings.minPosition);}}else{action.translate.easeTo(0);}}
cache.isDragging=false;cache.startDragX=utils.page('X',e);}}}},init=function(opts){if(opts.element){utils.deepExtend(settings,opts);cache.vendor=utils.vendor();action.drag.listen();}};this.open=function(side){utils.klass.remove(doc.body,'snapjs-expand-left');utils.klass.remove(doc.body,'snapjs-expand-right');if(side==='left'){cache.simpleStates.opening='left';cache.simpleStates.towards='right';utils.klass.add(doc.body,'snapjs-left');utils.klass.remove(doc.body,'snapjs-right');action.translate.easeTo(settings.maxPosition);}else if(side==='right'){cache.simpleStates.opening='right';cache.simpleStates.towards='left';utils.klass.remove(doc.body,'snapjs-left');utils.klass.add(doc.body,'snapjs-right');action.translate.easeTo(settings.minPosition);}};this.close=function(){action.translate.easeTo(0);};this.expand=function(side){var to=win.innerWidth||doc.documentElement.clientWidth;if(side==='left'){utils.klass.add(doc.body,'snapjs-expand-left');utils.klass.remove(doc.body,'snapjs-expand-right');}else{utils.klass.add(doc.body,'snapjs-expand-right');utils.klass.remove(doc.body,'snapjs-expand-left');to*=-1;}
action.translate.easeTo(to);};this.on=function(evt,fn){eventList[evt]=fn;return this;};this.off=function(evt){if(eventList[evt]){eventList[evt]=false;}};this.enable=function(){action.drag.listen();};this.disable=function(){action.drag.stopListening();};this.settings=function(opts){utils.deepExtend(settings,opts);};this.state=function(){var state,fromLeft=action.translate.get.matrix(4);if(fromLeft===settings.maxPosition){state='left';}else if(fromLeft===settings.minPosition){state='right';}else{state='closed';}
return{state:state,info:cache.simpleStates};};init(userOpts);};if((typeof module!=='undefined')&&module.exports){module.exports=Snap;}
if(typeof ender==='undefined'){this.Snap=Snap;}
if((typeof define==="function")&&define.amd){define("snap",[],function(){return Snap;});}}).call(this,window,document);;Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);}else if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;}else{throw new TypeError(date1+" - "+date2);}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);};$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;}}
return-1;};$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];};$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}
return null;};$D.getTimezoneOffset=function(name){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;}}
return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);};$P.isToday=function(){return this.isSameDay(new Date());};$P.isSameDay=function(date){return this.clone().clearTime().equals(date.clone().clearTime());};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);};$P.addDays=function(value){this.setDate(this.getDate()+value);return this;};$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;return this;}
var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);}
if(x.seconds){this.addSeconds(x.seconds);}
if(x.minutes){this.addMinutes(x.minutes);}
if(x.hours){this.addHours(x.hours);}
if(x.weeks){this.addWeeks(x.weeks);}
if(x.months){this.addMonths(x.months);}
if(x.years){this.addYears(x.years);}
if(x.days){this.addDays(x.days);}
return this;};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;f=$d+((153*($m-3)+2)/5)+58+s;}
g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);}else if(n>364+s){w=1;}else{w=(n/7|0)+1;}
$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());};$D._validate=function(n,min,max,name){if(typeof n=="undefined"){return false;}else if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");}
return true;};$D.validateMillisecond=function(value){return $D._validate(value,0,999,"millisecond");};$D.validateSecond=function(value){return $D._validate(value,0,59,"second");};$D.validateMinute=function(value){return $D._validate(value,0,59,"minute");};$D.validateHour=function(value){return $D._validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return $D._validate(value,1,$D.getDaysInMonth(year,month),"day");};$D.validateMonth=function(value){return $D._validate(value,0,11,"month");};$D.validateYear=function(value){return $D._validate(value,0,9999,"year");};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());}
if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());}
if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());}
if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}
if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());}
if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());}
if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());}
if(config.timezone){this.setTimezone(config.timezone);}
if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);}
if(config.week&&$D._validate(config.week,0,53,"week")){this.setWeek(config.week);}
return this;};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;}
else if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);}
return this;}
return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);}};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?'0'+n:n;}
return'"'+this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z"';};}
$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$C.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);}}
var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");}
x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());default:return m;}}):this._toString();};}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,$N=Number.prototype;$P._orient=+1;$P._nth=null;$P._is=false;$P._same=false;$P._isSecond=false;$N._dateElement="day";$P.next=function(){this._orient=+1;return this;};$D.next=function(){return $D.today().next();};$P.last=$P.prev=$P.previous=function(){this._orient=-1;return this;};$D.last=$D.prev=$D.previous=function(){return $D.today().last();};$P.is=function(){this._is=true;return this;};$P.same=function(){this._same=true;this._isSecond=false;return this;};$P.today=function(){return this.same().day();};$P.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}
return false;};$P.at=function(time){return(typeof time==="string")?$D.parse(this.toString("d")+" "+time):this.set(time);};$N.fromNow=$N.after=function(date){var c={};c[this._dateElement]=this;return((!date)?new Date():date.clone()).add(c);};$N.ago=$N.before=function(date){var c={};c[this._dateElement]=this*-1;return((!date)?new Date():date.clone()).add(c);};var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),pxf=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),nth=("final first second third fourth fifth").split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++){o[px[i].toLowerCase()]=this["get"+pxf[i]]();}
return o;};$D.fromObject=function(config){config.week=null;return Date.today().set(config);};var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n;}
if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}
this._isSecond=false;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp){throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");}
return this;}
return this.moveToDayOfWeek(n,this._orient);};};var sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();if(n===0&&$C.firstDayOfWeek===1&&t.getDay()!==0){shift=shift+7;}
return t.addDays(shift);};};for(var i=0;i<dx.length;i++){$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i;$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i);$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);}
var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n;}
return this.moveToMonth(n,this._orient);};};var smf=function(n){return function(){return $D.today().set({month:n,day:1});};};for(var j=0;j<mx.length;j++){$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j;$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j);$P[mx[j]]=$P[mx[j].substring(0,3)]=mf(j);}
var ef=function(j){return function(){if(this._isSecond){this._isSecond=false;return this;}
if(this._same){this._same=this._is=false;var o1=this.toObject(),o2=(arguments[0]||new Date()).toObject(),v="",k=j.toLowerCase();for(var m=(px.length-1);m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v]){return false;}
if(k==v){break;}}
return true;}
if(j.substring(j.length-1)!="s"){j+="s";}
return this["add"+j](this._orient);};};var nf=function(n){return function(){this._dateElement=n;return this;};};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$P[de]=$P[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de);}
$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){if(this._same){return this._ss(arguments[0]);}
if(dayOfWeek||dayOfWeek===0){return this.moveToNthOccurrence(dayOfWeek,n);}
this._nth=n;if(n===2&&(dayOfWeek===undefined||dayOfWeek===null)){this._isSecond=true;return this.addSeconds(this._orient);}
return this;};};for(var l=0;l<nth.length;l++){$P[nth[l]]=(l===0)?nthfn(-1):nthfn(l);}}());(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'";}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)]);}else{throw new $P.Exception(s);}};},token:function(s){return function(s){return _.rtoken(new RegExp("^\s*"+s+"\s*"))(s);};},stoken:function(s){return _.rtoken(new RegExp("^"+s));},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s);}catch(e){qx.push(rx[0]);s=rx[1];continue;}
break;}
return[qx,s];};},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s);}catch(e){return[rx,s];}
rx.push(r[0]);s=r[1];}
return[rx,s];};},optional:function(p){return function(s){var r=null;try{r=p.call(this,s);}catch(e){return[null,s];}
return[r[0],r[1]];};},not:function(p){return function(s){try{p.call(this,s);}catch(e){return[null,s];}
throw new $P.Exception(s);};},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]];}:null;},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx));}
return rx;},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s));}catch(e){r=cache[s]=e;}
if(r instanceof $P.Exception){throw r;}else{return r;}};},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){r=null;}
if(r){return r;}}
throw new $P.Exception(s);};},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){throw new $P.Exception(s);}
rx.push(r[0]);s=r[1];}
return[rx,s];};},all:function(){var px=arguments,_=_;return _.each(_.optional(px));},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0];}
return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s);}catch(e){break;}
rx.push(r[0]);try{q=d.call(this,r[1]);}catch(ex){q=null;break;}
s=q[1];}
if(!r){throw new $P.Exception(s);}
if(q){throw new $P.Exception(q[1]);}
if(c){try{r=c.call(this,r[1]);}catch(ey){throw new $P.Exception(r[1]);}}
return[rx,(r?r[1]:s)];};},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]];};},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)));},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s);}catch(e){continue;}
rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1]);}catch(ex){last=true;}}else{last=true;}
if(!last&&q[1].length===0){last=true;}
if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j]);}}
p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1];}}
if(rx[1].length<best[1].length){best=rx;}
if(best[1].length===0){break;}}
if(best[0].length===0){return best;}
if(c){try{q=c.call(this,best[1]);}catch(ey){throw new $P.Exception(best[1]);}
best[1]=q[1];}
return best;};},forward:function(gr,fname){return function(s){return gr[fname].call(this,s);};},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]];};},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]];};},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s);}
return rx;};}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments);}else if(arguments[0]instanceof Array){args=arguments[0];}
if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx;}}else{return op.apply(null,arguments);}};};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]]);}
var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0]);}else{return op.apply(null,arguments);}};};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]]);}}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo;var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]));}else{if(ax[i]){rx.push(ax[i]);}}}
return rx;};$D.Grammar={};$D.Translator={hour:function(s){return function(){this.hour=Number(s);};},minute:function(s){return function(){this.minute=Number(s);};},second:function(s){return function(){this.second=Number(s);};},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase();};},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n);}else{this.timezone=s.toLowerCase();}};},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0]);};},month:function(s){return function(){this.month=(s.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1;};},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<$C.twoDigitYearMax)?2000:1900)));};},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(x){x=(x instanceof Array)?x:[x];for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this);}}
var now=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=now.getDate();}
if(!this.year){this.year=now.getFullYear();}
if(!this.month&&this.month!==0){this.month=now.getMonth();}
if(!this.day){this.day=1;}
if(!this.hour){this.hour=0;}
if(!this.minute){this.minute=0;}
if(!this.second){this.second=0;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.day>$D.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}
var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone});}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset});}
return r;},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null;}
for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this);}}
var today=$D.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else if(this.now){today=new Date();}
var expression=!!(this.days&&this.days!==null||this.orient||this.operator);var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){today.setTimeToNow();}
if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;expression=true;}}
if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(!this.month){this.month=temp.getMonth();}
this.year=temp.getFullYear();}
if(expression&&this.weekday&&this.unit!="month"){this.unit="day";gap=($D.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod);}
if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}
if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}
if(this.month&&!this.day&&this.value){today.set({day:this.value*1});if(!expression){this.day=this.value*1;}}
if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;expression=true;}
if(expression&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null;}
if(!this.unit){this.unit="day";}
if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*orient;}else if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}
this[this.unit+"s"]=this.value*orient;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(temp.getMonth()!==today.getMonth()){this.month=temp.getMonth();}}
if((this.month||this.month===0)&&!this.day){this.day=1;}
if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}
if(expression&&this.timezone&&this.day&&this.days){this.day=this.days;}
return(expression)?today.add(this):today.set(this);}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$C.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));}
fn=_C[keys]=_.any.apply(null,px);}
return fn;};g.ctoken2=function(key){return _.rtoken($C.regexPatterns[key]);};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s;};}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")));};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s;};});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s;};});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s;};});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"");};});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter);};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[$C.dateElementOrder]||g.mdy).call(this,s));};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt];}else{throw $D.Parsing.Exception(fmt);}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s));}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact);});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0]);};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]));}
return _.any.apply(null,rx);}else{return _get(fx);}};g._formats=g.formats(["\"yyyy-MM-ddTHH:mm:ssZ\"","yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r;}}catch(e){}
return g._start.call({},s);};$D._parse=$D.parse;$D.parse=function(s){var r=null;if(!s){return null;}
if(s instanceof Date){return s;}
try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};};$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s);};}());;;(function($,undefined){var supported,ls;if('localStorage'in window){try{ls=(typeof window.localStorage==='undefined')?undefined:window.localStorage;if(typeof ls=='undefined'||typeof window.JSON=='undefined'){supported=false;}else{supported=true;}}
catch(err){supported=false;}}
$.totalStorage=function(key,value,options){return $.totalStorage.impl.init(key,value);};$.totalStorage.setItem=function(key,value){return $.totalStorage.impl.setItem(key,value);};$.totalStorage.getItem=function(key){return $.totalStorage.impl.getItem(key);};$.totalStorage.getAll=function(){return $.totalStorage.impl.getAll();};$.totalStorage.deleteItem=function(key){return $.totalStorage.impl.deleteItem(key);};$.totalStorage.ls=function(value){supported=value?true:false;};$.totalStorage.impl={init:function(key,value){if(typeof value!='undefined'){return this.setItem(key,value);}else{return this.getItem(key);}},setItem:function(key,value){if(!supported){try{$.cookie(key,JSON.stringify(value));return value;}catch(e){console.log('Local Storage not supported by this browser. Install the cookie plugin on your site to take advantage of the same functionality. You can get it at https://github.com/carhartl/jquery-cookie');}}
var saver=JSON.stringify(value);ls.setItem(key,saver);return this.parseResult(saver);},getItem:function(key){if(!supported){try{return this.parseResult($.cookie(key));}catch(e){return null;}}
var item=ls.getItem(key);return this.parseResult(item);},deleteItem:function(key){if(!supported){try{$.cookie(key,null);return true;}catch(e){return false;}}
ls.removeItem(key);return true;},getAll:function(){var items=[];if(!supported){try{var pairs=document.cookie.split(";");for(var i=0;i<pairs.length;i++){var pair=pairs[i].split('=');var key=pair[0];items.push({key:key,value:this.parseResult($.cookie(key))});}}catch(e){return null;}}else{for(var j in ls){if(j.length){items.push({key:j,value:this.parseResult(ls.getItem(j))});}}}
return items;},parseResult:function(res){var ret;try{ret=JSON.parse(res);if(typeof ret=='undefined'){ret=res;}
if(ret=='true'){ret=true;}
if(ret=='false'){ret=false;}
if(parseFloat(ret)==ret&&typeof ret!="object"){ret=parseFloat(ret);}}catch(e){ret=res;}
return ret;}};})(jQuery);;
/*
 * jQuery Cookie Plugin v1.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($,document){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
$.cookie=function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value==null)){options=$.extend({},$.cookie.defaults,options);if(value==null){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=String(value);return(document.cookie=[encodeURIComponent(key),'=',options.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
options=value||$.cookie.defaults||{};var decode=options.raw?raw:decoded;var cookies=document.cookie.split('; ');for(var i=0,parts;(parts=cookies[i]&&cookies[i].split('='));i++){if(decode(parts.shift())===key){return decode(parts.join('='));}}
return null;};$.cookie.defaults={path:'/',expires:(new Date(3000,01,01))};})(jQuery,document);;function TimeMachine(){'use strict';var _fixedTime=null;this.__construct=function()
{if($.totalStorage('TimeMachine')){_fixedTime=$.totalStorage('TimeMachine');}}
this.now=function()
{'use strict';return(_fixedTime)?_fixedTime:Date.now();}
this.returnToPresent=function()
{'use strict';_fixedTime=false;}
this.toBeContinued=function()
{$.totalStorage('TimeMachine',_fixedTime);}
this.travel=function(newTime)
{'use strict';_fixedTime=Date.parse(newTime);}
this.__construct();}
var DeLorean=new TimeMachine();;(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);;
/* Magnific Popup - v0.9.3 - 2013-07-16
* http://dimsemenov.com/plugins/magnific-popup/
* Copyright (c) 2013 Dmitry Semenov; */
;(function($){var CLOSE_EVENT='Close',BEFORE_CLOSE_EVENT='BeforeClose',AFTER_CLOSE_EVENT='AfterClose',BEFORE_APPEND_EVENT='BeforeAppend',MARKUP_PARSE_EVENT='MarkupParse',OPEN_EVENT='Open',CHANGE_EVENT='Change',NS='mfp',EVENT_NS='.'+NS,READY_CLASS='mfp-ready',REMOVING_CLASS='mfp-removing',PREVENT_CLOSE_CLASS='mfp-prevent-close';var mfp,MagnificPopup=function(){},_isJQ=!!(window.jQuery),_prevStatus,_window=$(window),_body,_document,_prevContentType,_wrapClasses,_currPopupType;var _mfpOn=function(name,f){mfp.ev.on(NS+name+EVENT_NS,f);},_getEl=function(className,appendTo,html,raw){var el=document.createElement('div');el.className='mfp-'+className;if(html){el.innerHTML=html;}
if(!raw){el=$(el);if(appendTo){el.appendTo(appendTo);}}else if(appendTo){appendTo.appendChild(el);}
return el;},_mfpTrigger=function(e,data){mfp.ev.triggerHandler(NS+e,data);if(mfp.st.callbacks){e=e.charAt(0).toLowerCase()+e.slice(1);if(mfp.st.callbacks[e]){mfp.st.callbacks[e].apply(mfp,$.isArray(data)?data:[data]);}}},_setFocus=function(){(mfp.st.focus?mfp.content.find(mfp.st.focus).eq(0):mfp.wrap).trigger('focus');},_getCloseBtn=function(type){if(type!==_currPopupType||!mfp.currTemplate.closeBtn){mfp.currTemplate.closeBtn=$(mfp.st.closeMarkup.replace('%title%',mfp.st.tClose));_currPopupType=type;}
return mfp.currTemplate.closeBtn;},_checkInstance=function(){if(!$.magnificPopup.instance){mfp=new MagnificPopup();mfp.init();$.magnificPopup.instance=mfp;}},_checkIfClose=function(target){if($(target).hasClass(PREVENT_CLOSE_CLASS)){return;}
var closeOnContent=mfp.st.closeOnContentClick;var closeOnBg=mfp.st.closeOnBgClick;if(closeOnContent&&closeOnBg){return true;}else{if(!mfp.content||$(target).hasClass('mfp-close')||(mfp.preloader&&target===mfp.preloader[0])){return true;}
if((target!==mfp.content[0]&&!$.contains(mfp.content[0],target))){if(closeOnBg){if($.contains(document,target)){return true;}}}else if(closeOnContent){return true;}}
return false;},supportsTransitions=function(){var s=document.createElement('p').style,v=['ms','O','Moz','Webkit'];if(s['transition']!==undefined){return true;}
while(v.length){if(v.pop()+'Transition'in s){return true;}}
return false;};MagnificPopup.prototype={constructor:MagnificPopup,init:function(){var appVersion=navigator.appVersion;mfp.isIE7=appVersion.indexOf("MSIE 7.")!==-1;mfp.isIE8=appVersion.indexOf("MSIE 8.")!==-1;mfp.isLowIE=mfp.isIE7||mfp.isIE8;mfp.isAndroid=(/android/gi).test(appVersion);mfp.isIOS=(/iphone|ipad|ipod/gi).test(appVersion);mfp.supportsTransition=supportsTransitions();mfp.probablyMobile=(mfp.isAndroid||mfp.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent));_body=$(document.body);_document=$(document);mfp.popupsCache={};},open:function(data){var i;if(data.isObj===false){mfp.items=data.items.toArray();mfp.index=0;var items=data.items,item;for(i=0;i<items.length;i++){item=items[i];if(item.parsed){item=item.el[0];}
if(item===data.el[0]){mfp.index=i;break;}}}else{mfp.items=$.isArray(data.items)?data.items:[data.items];mfp.index=data.index||0;}
if(mfp.isOpen){mfp.updateItemHTML();return;}
mfp.types=[];_wrapClasses='';if(data.mainEl&&data.mainEl.length){mfp.ev=data.mainEl.eq(0);}else{mfp.ev=_document;}
if(data.key){if(!mfp.popupsCache[data.key]){mfp.popupsCache[data.key]={};}
mfp.currTemplate=mfp.popupsCache[data.key];}else{mfp.currTemplate={};}
mfp.st=$.extend(true,{},$.magnificPopup.defaults,data);mfp.fixedContentPos=mfp.st.fixedContentPos==='auto'?!mfp.probablyMobile:mfp.st.fixedContentPos;if(mfp.st.modal){mfp.st.closeOnContentClick=false;mfp.st.closeOnBgClick=false;mfp.st.showCloseBtn=false;mfp.st.enableEscapeKey=false;}
if(!mfp.bgOverlay){mfp.bgOverlay=_getEl('bg').on('click'+EVENT_NS,function(e){mfp.close();});mfp.wrap=_getEl('wrap').attr('tabindex',-1).on('click'+EVENT_NS,function(e){if(_checkIfClose(e.target)){mfp.close();}});mfp.container=_getEl('container',mfp.wrap);}
mfp.contentContainer=_getEl('content');if(mfp.st.preloader){mfp.preloader=_getEl('preloader',mfp.container,mfp.st.tLoading);}
var modules=$.magnificPopup.modules;for(i=0;i<modules.length;i++){var n=modules[i];n=n.charAt(0).toUpperCase()+n.slice(1);mfp['init'+n].call(mfp);}
_mfpTrigger('BeforeOpen');if(mfp.st.showCloseBtn){if(!mfp.st.closeBtnInside){mfp.wrap.append(_getCloseBtn());}else{_mfpOn(MARKUP_PARSE_EVENT,function(e,template,values,item){values.close_replaceWith=_getCloseBtn(item.type);});_wrapClasses+=' mfp-close-btn-in';}}
if(mfp.st.alignTop){_wrapClasses+=' mfp-align-top';}
if(mfp.fixedContentPos){mfp.wrap.css({overflow:mfp.st.overflowY,overflowX:'hidden',overflowY:mfp.st.overflowY});}else{mfp.wrap.css({top:_window.scrollTop(),position:'absolute'});}
if(mfp.st.fixedBgPos===false||(mfp.st.fixedBgPos==='auto'&&!mfp.fixedContentPos)){mfp.bgOverlay.css({height:_document.height(),position:'absolute'});}
if(mfp.st.enableEscapeKey){_document.on('keyup'+EVENT_NS,function(e){if(e.keyCode===27){mfp.close();}});}
_window.on('resize'+EVENT_NS,function(){mfp.updateSize();});if(!mfp.st.closeOnContentClick){_wrapClasses+=' mfp-auto-cursor';}
if(_wrapClasses)
mfp.wrap.addClass(_wrapClasses);var windowHeight=mfp.wH=_window.height();var windowStyles={};if(mfp.fixedContentPos){if(mfp._hasScrollBar(windowHeight)){var s=mfp._getScrollbarSize();if(s){windowStyles.paddingRight=s;}}}
if(mfp.fixedContentPos){if(!mfp.isIE7){windowStyles.overflow='hidden';}else{$('body, html').css('overflow','hidden');}}
var classesToadd=mfp.st.mainClass;if(mfp.isIE7){classesToadd+=' mfp-ie7';}
if(classesToadd){mfp._addClassToMFP(classesToadd);}
mfp.updateItemHTML();_mfpTrigger('BuildControls');$('html').css(windowStyles);mfp.bgOverlay.add(mfp.wrap).prependTo(document.body);mfp._lastFocusedEl=document.activeElement;setTimeout(function(){if(mfp.content){mfp._addClassToMFP(READY_CLASS);_setFocus();}else{mfp.bgOverlay.addClass(READY_CLASS);}
_document.on('focusin'+EVENT_NS,function(e){if(e.target!==mfp.wrap[0]&&!$.contains(mfp.wrap[0],e.target)){_setFocus();return false;}});},16);mfp.isOpen=true;mfp.updateSize(windowHeight);_mfpTrigger(OPEN_EVENT);},close:function(){if(!mfp.isOpen)return;_mfpTrigger(BEFORE_CLOSE_EVENT);mfp.isOpen=false;if(mfp.st.removalDelay&&!mfp.isLowIE&&mfp.supportsTransition){mfp._addClassToMFP(REMOVING_CLASS);setTimeout(function(){mfp._close();},mfp.st.removalDelay);}else{mfp._close();}},_close:function(){_mfpTrigger(CLOSE_EVENT);var classesToRemove=REMOVING_CLASS+' '+READY_CLASS+' ';mfp.bgOverlay.detach();mfp.wrap.detach();mfp.container.empty();if(mfp.st.mainClass){classesToRemove+=mfp.st.mainClass+' ';}
mfp._removeClassFromMFP(classesToRemove);if(mfp.fixedContentPos){var windowStyles={paddingRight:''};if(mfp.isIE7){$('body, html').css('overflow','');}else{windowStyles.overflow='';}
$('html').css(windowStyles);}
_document.off('keyup'+EVENT_NS+' focusin'+EVENT_NS);mfp.ev.off(EVENT_NS);mfp.wrap.attr('class','mfp-wrap').removeAttr('style');mfp.bgOverlay.attr('class','mfp-bg');mfp.container.attr('class','mfp-container');if(mfp.st.showCloseBtn&&(!mfp.st.closeBtnInside||mfp.currTemplate[mfp.currItem.type]===true)){if(mfp.currTemplate.closeBtn)
mfp.currTemplate.closeBtn.detach();}
if(mfp._lastFocusedEl){$(mfp._lastFocusedEl).trigger('focus');}
mfp.currItem=null;mfp.content=null;mfp.currTemplate=null;mfp.prevHeight=0;_mfpTrigger(AFTER_CLOSE_EVENT);},updateSize:function(winHeight){if(mfp.isIOS){var zoomLevel=document.documentElement.clientWidth/window.innerWidth;var height=window.innerHeight*zoomLevel;mfp.wrap.css('height',height);mfp.wH=height;}else{mfp.wH=winHeight||_window.height();}
if(!mfp.fixedContentPos){mfp.wrap.css('height',mfp.wH);}
_mfpTrigger('Resize');},updateItemHTML:function(){var item=mfp.items[mfp.index];mfp.contentContainer.detach();if(mfp.content)
mfp.content.detach();if(!item.parsed){item=mfp.parseEl(mfp.index);}
var type=item.type;_mfpTrigger('BeforeChange',[mfp.currItem?mfp.currItem.type:'',type]);mfp.currItem=item;if(!mfp.currTemplate[type]){var markup=mfp.st[type]?mfp.st[type].markup:false;_mfpTrigger('FirstMarkupParse',markup);if(markup){mfp.currTemplate[type]=$(markup);}else{mfp.currTemplate[type]=true;}}
if(_prevContentType&&_prevContentType!==item.type){mfp.container.removeClass('mfp-'+_prevContentType+'-holder');}
var newContent=mfp['get'+type.charAt(0).toUpperCase()+type.slice(1)](item,mfp.currTemplate[type]);mfp.appendContent(newContent,type);item.preloaded=true;_mfpTrigger(CHANGE_EVENT,item);_prevContentType=item.type;mfp.container.prepend(mfp.contentContainer);_mfpTrigger('AfterChange');},appendContent:function(newContent,type){mfp.content=newContent;if(newContent){if(mfp.st.showCloseBtn&&mfp.st.closeBtnInside&&mfp.currTemplate[type]===true){if(!mfp.content.find('.mfp-close').length){mfp.content.append(_getCloseBtn());}}else{mfp.content=newContent;}}else{mfp.content='';}
_mfpTrigger(BEFORE_APPEND_EVENT);mfp.container.addClass('mfp-'+type+'-holder');mfp.contentContainer.append(mfp.content);},parseEl:function(index){var item=mfp.items[index],type=item.type;if(item.tagName){item={el:$(item)};}else{item={data:item,src:item.src};}
if(item.el){var types=mfp.types;for(var i=0;i<types.length;i++){if(item.el.hasClass('mfp-'+types[i])){type=types[i];break;}}
item.src=item.el.attr('data-mfp-src');if(!item.src){item.src=item.el.attr('href');}}
item.type=type||mfp.st.type||'inline';item.index=index;item.parsed=true;mfp.items[index]=item;_mfpTrigger('ElementParse',item);return mfp.items[index];},addGroup:function(el,options){var eHandler=function(e){e.mfpEl=this;mfp._openClick(e,el,options);};if(!options){options={};}
var eName='click.magnificPopup';options.mainEl=el;if(options.items){options.isObj=true;el.off(eName).on(eName,eHandler);}else{options.isObj=false;if(options.delegate){el.off(eName).on(eName,options.delegate,eHandler);}else{options.items=el;el.off(eName).on(eName,eHandler);}}},_openClick:function(e,el,options){var midClick=options.midClick!==undefined?options.midClick:$.magnificPopup.defaults.midClick;if(!midClick&&(e.which===2||e.ctrlKey||e.metaKey)){return;}
var disableOn=options.disableOn!==undefined?options.disableOn:$.magnificPopup.defaults.disableOn;if(disableOn){if($.isFunction(disableOn)){if(!disableOn.call(mfp)){return true;}}else{if(_window.width()<disableOn){return true;}}}
if(e.type){e.preventDefault();if(mfp.isOpen){e.stopPropagation();}}
options.el=$(e.mfpEl);if(options.delegate){options.items=el.find(options.delegate);}
mfp.open(options);},updateStatus:function(status,text){if(mfp.preloader){if(_prevStatus!==status){mfp.container.removeClass('mfp-s-'+_prevStatus);}
if(!text&&status==='loading'){text=mfp.st.tLoading;}
var data={status:status,text:text};_mfpTrigger('UpdateStatus',data);status=data.status;text=data.text;mfp.preloader.html(text);mfp.preloader.find('a').on('click',function(e){e.stopImmediatePropagation();});mfp.container.addClass('mfp-s-'+status);_prevStatus=status;}},_addClassToMFP:function(cName){mfp.bgOverlay.addClass(cName);mfp.wrap.addClass(cName);},_removeClassFromMFP:function(cName){this.bgOverlay.removeClass(cName);mfp.wrap.removeClass(cName);},_hasScrollBar:function(winHeight){return((mfp.isIE7?_document.height():document.body.scrollHeight)>(winHeight||_window.height()));},_parseMarkup:function(template,values,item){var arr;if(item.data){values=$.extend(item.data,values);}
_mfpTrigger(MARKUP_PARSE_EVENT,[template,values,item]);$.each(values,function(key,value){if(value===undefined||value===false){return true;}
arr=key.split('_');if(arr.length>1){var el=template.find(EVENT_NS+'-'+arr[0]);if(el.length>0){var attr=arr[1];if(attr==='replaceWith'){if(el[0]!==value[0]){el.replaceWith(value);}}else if(attr==='img'){if(el.is('img')){el.attr('src',value);}else{el.replaceWith('<img src="'+value+'" class="'+el.attr('class')+'" />');}}else{el.attr(arr[1],value);}}}else{template.find(EVENT_NS+'-'+key).html(value);}});},_getScrollbarSize:function(){if(mfp.scrollbarSize===undefined){var scrollDiv=document.createElement("div");scrollDiv.id="mfp-sbm";scrollDiv.style.cssText='width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';document.body.appendChild(scrollDiv);mfp.scrollbarSize=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv);}
return mfp.scrollbarSize;}};$.magnificPopup={instance:null,proto:MagnificPopup.prototype,modules:[],open:function(options,index){_checkInstance();if(!options)
options={};options.isObj=true;options.index=index||0;return this.instance.open(options);},close:function(){return $.magnificPopup.instance.close();},registerModule:function(name,module){if(module.options){$.magnificPopup.defaults[name]=module.options;}
$.extend(this.proto,module.proto);this.modules.push(name);},defaults:{disableOn:0,key:null,midClick:false,mainClass:'',preloader:true,focus:'',closeOnContentClick:false,closeOnBgClick:true,closeBtnInside:true,showCloseBtn:true,enableEscapeKey:true,modal:false,alignTop:false,removalDelay:0,fixedContentPos:'auto',fixedBgPos:'auto',overflowY:'auto',closeMarkup:'<button title="%title%" type="button" class="mfp-close">&times;</button>',tClose:'Close (Esc)',tLoading:'Loading...'}};$.fn.magnificPopup=function(options){_checkInstance();var jqEl=$(this);if(typeof options==="string"){if(options==='open'){var items,itemOpts=_isJQ?jqEl.data('magnificPopup'):jqEl[0].magnificPopup,index=parseInt(arguments[1],10)||0;if(itemOpts.items){items=itemOpts.items[index];}else{items=jqEl;if(itemOpts.delegate){items=items.find(itemOpts.delegate);}
items=items.eq(index);}
mfp._openClick({mfpEl:items},jqEl,itemOpts);}else{if(mfp.isOpen)
mfp[options].apply(mfp,Array.prototype.slice.call(arguments,1));}}else{if(_isJQ){jqEl.data('magnificPopup',options);}else{jqEl[0].magnificPopup=options;}
mfp.addGroup(jqEl,options);}
return jqEl;};var INLINE_NS='inline',_hiddenClass,_inlinePlaceholder,_lastInlineElement,_putInlineElementsBack=function(){if(_lastInlineElement){_inlinePlaceholder.after(_lastInlineElement.addClass(_hiddenClass)).detach();_lastInlineElement=null;}};$.magnificPopup.registerModule(INLINE_NS,{options:{hiddenClass:'hide',markup:'',tNotFound:'Content not found'},proto:{initInline:function(){mfp.types.push(INLINE_NS);_mfpOn(CLOSE_EVENT+'.'+INLINE_NS,function(){_putInlineElementsBack();});},getInline:function(item,template){_putInlineElementsBack();if(item.src){var inlineSt=mfp.st.inline,el=$(item.src);if(el.length){var parent=el[0].parentNode;if(parent&&parent.tagName){if(!_inlinePlaceholder){_hiddenClass=inlineSt.hiddenClass;_inlinePlaceholder=_getEl(_hiddenClass);_hiddenClass='mfp-'+_hiddenClass;}
_lastInlineElement=el.after(_inlinePlaceholder).detach().removeClass(_hiddenClass);}
mfp.updateStatus('ready');}else{mfp.updateStatus('error',inlineSt.tNotFound);el=$('<div>');}
item.inlineElement=el;return el;}
mfp.updateStatus('ready');mfp._parseMarkup(template,{},item);return template;}}});})(window.jQuery||window.Zepto);;jQuery.easing['jswing']=jQuery.easing['swing'];jQuery.extend(jQuery.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return jQuery.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});;function FastClick(layer){'use strict';var oldOnClick,self=this;this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=layer;if(!layer||!layer.nodeType){throw new TypeError('Layer must be a document node');}
this.onClick=function(){return FastClick.prototype.onClick.apply(self,arguments);};this.onMouse=function(){return FastClick.prototype.onMouse.apply(self,arguments);};this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(self,arguments);};this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(self,arguments);};this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(self,arguments);};if(FastClick.notNeeded(layer)){return;}
if(this.deviceIsAndroid){layer.addEventListener('mouseover',this.onMouse,true);layer.addEventListener('mousedown',this.onMouse,true);layer.addEventListener('mouseup',this.onMouse,true);}
layer.addEventListener('click',this.onClick,true);layer.addEventListener('touchstart',this.onTouchStart,false);layer.addEventListener('touchend',this.onTouchEnd,false);layer.addEventListener('touchcancel',this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==='click'){rmv.call(layer,type,callback.hijacked||callback,capture);}else{rmv.call(layer,type,callback,capture);}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==='click'){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event);}}),capture);}else{adv.call(layer,type,callback,capture);}};}
if(typeof layer.onclick==='function'){oldOnClick=layer.onclick;layer.addEventListener('click',function(event){oldOnClick(event);},false);layer.onclick=null;}}
FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf('Android')>0;FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&(/OS ([6-9]|\d{2})_\d/).test(navigator.userAgent);FastClick.prototype.needsClick=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'button':case'select':case'textarea':if(target.disabled){return true;}
break;case'input':if((this.deviceIsIOS&&target.type==='file')||target.disabled){return true;}
break;case'label':case'video':return true;}
return(/\bneedsclick\b/).test(target.className);};FastClick.prototype.needsFocus=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'textarea':case'select':return true;case'input':switch(target.type){case'button':case'checkbox':case'file':case'image':case'radio':case'submit':return false;}
return!target.disabled&&!target.readOnly;default:return(/\bneedsfocus\b/).test(target.className);}};FastClick.prototype.sendClick=function(targetElement,event){'use strict';var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur();}
touch=event.changedTouches[0];clickEvent=document.createEvent('MouseEvents');clickEvent.initMouseEvent('click',true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent);};FastClick.prototype.focus=function(targetElement){'use strict';var length;if(this.deviceIsIOS&&targetElement.setSelectionRange){length=targetElement.value.length;targetElement.setSelectionRange(length,length);}else{targetElement.focus();}};FastClick.prototype.updateScrollParent=function(targetElement){'use strict';var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break;}
parentElement=parentElement.parentElement;}while(parentElement);}
if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop;}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){'use strict';if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode;}
return eventTarget;};FastClick.prototype.onTouchStart=function(event){'use strict';var targetElement,touch,selection;if(event.targetTouches.length>1){return true;}
targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(this.deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true;}
if(!this.deviceIsIOS4){if(touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false;}
this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement);}}
this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if((event.timeStamp-this.lastClickTime)<200){event.preventDefault();}
return true;};FastClick.prototype.touchHasMoved=function(event){'use strict';var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true;}
return false;};FastClick.prototype.findControl=function(labelElement){'use strict';if(labelElement.control!==undefined){return labelElement.control;}
if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor);}
return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');};FastClick.prototype.onTouchEnd=function(event){'use strict';var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null;}
if(!this.trackingClick){return true;}
if((event.timeStamp-this.lastClickTime)<200){this.cancelNextClick=true;return true;}
this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(this.deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent;}
targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==='label'){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(this.deviceIsAndroid){return false;}
targetElement=forElement;}}else if(this.needsFocus(targetElement)){if((event.timeStamp-trackingClickStart)>100||(this.deviceIsIOS&&window.top!==window&&targetTagName==='input')){this.targetElement=null;return false;}
this.focus(targetElement);if(!this.deviceIsIOS4||targetTagName!=='select'){this.targetElement=null;event.preventDefault();}
return false;}
if(this.deviceIsIOS&&!this.deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true;}}
if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event);}
return false;};FastClick.prototype.onTouchCancel=function(){'use strict';this.trackingClick=false;this.targetElement=null;};FastClick.prototype.onMouse=function(event){'use strict';if(!this.targetElement){return true;}
if(event.forwardedTouchEvent){return true;}
if(!event.cancelable){return true;}
if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation();}else{event.propagationStopped=true;}
event.stopPropagation();event.preventDefault();return false;}
return true;};FastClick.prototype.onClick=function(event){'use strict';var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true;}
if(event.target.type==='submit'&&event.detail===0){return true;}
permitted=this.onMouse(event);if(!permitted){this.targetElement=null;}
return permitted;};FastClick.prototype.destroy=function(){'use strict';var layer=this.layer;if(this.deviceIsAndroid){layer.removeEventListener('mouseover',this.onMouse,true);layer.removeEventListener('mousedown',this.onMouse,true);layer.removeEventListener('mouseup',this.onMouse,true);}
layer.removeEventListener('click',this.onClick,true);layer.removeEventListener('touchstart',this.onTouchStart,false);layer.removeEventListener('touchend',this.onTouchEnd,false);layer.removeEventListener('touchcancel',this.onTouchCancel,false);};FastClick.notNeeded=function(layer){'use strict';var metaViewport;if(typeof window.ontouchstart==='undefined'){return true;}
if((/Chrome\/[0-9]+/).test(navigator.userAgent)){if(FastClick.prototype.deviceIsAndroid){metaViewport=document.querySelector('meta[name=viewport]');if(metaViewport&&metaViewport.content.indexOf('user-scalable=no')!==-1){return true;}}else{return true;}}
if(layer.style.msTouchAction==='none'){return true;}
return false;};FastClick.attach=function(layer){'use strict';return new FastClick(layer);};if(typeof define!=='undefined'&&define.amd){define(function(){'use strict';return FastClick;});}else if(typeof module!=='undefined'&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick;}else{window.FastClick=FastClick;};
/*
 * Copyright (c) 2011-2013 Felix Gnass
 * Licensed under the MIT license
 */
(function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Spinner=e()})(this,function(){"use strict";function t(t,e){var i,n=document.createElement(t||"div");for(i in e)n[i]=e[i];return n}function e(t){for(var e=1,i=arguments.length;i>e;e++)t.appendChild(arguments[e]);return t}function i(t,e,i,n){var o=["opacity",e,~~(100*t),i,n].join("-"),r=.01+100*(i/n),a=Math.max(1-(1-t)/e*(100-r),t),s=u.substring(0,u.indexOf("Animation")).toLowerCase(),l=s&&"-"+s+"-"||"";return f[o]||(c.insertRule("@"+l+"keyframes "+o+"{"+"0%{opacity:"+a+"}"+r+"%{opacity:"+t+"}"+(r+.01)+"%{opacity:1}"+(r+e)%100+"%{opacity:"+t+"}"+"100%{opacity:"+a+"}"+"}",c.cssRules.length),f[o]=1),o}function n(t,e){var i,n,o=t.style;if(void 0!==o[e])return e;for(e=e.charAt(0).toUpperCase()+e.slice(1),n=0;d.length>n;n++)if(i=d[n]+e,void 0!==o[i])return i}function o(t,e){for(var i in e)t.style[n(t,i)||i]=e[i];return t}function r(t){for(var e=1;arguments.length>e;e++){var i=arguments[e];for(var n in i)void 0===t[n]&&(t[n]=i[n])}return t}function a(t){for(var e={x:t.offsetLeft,y:t.offsetTop};t=t.offsetParent;)e.x+=t.offsetLeft,e.y+=t.offsetTop;return e}function s(t){return this===void 0?new s(t):(this.opts=r(t||{},s.defaults,p),void 0)}function l(){function i(e,i){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}c.addRule(".spin-vml","behavior:url(#default#VML)"),s.prototype.lines=function(t,n){function r(){return o(i("group",{coordsize:u+" "+u,coordorigin:-l+" "+-l}),{width:u,height:u})}function a(t,a,s){e(f,e(o(r(),{rotation:360/n.lines*t+"deg",left:~~a}),e(o(i("roundrect",{arcsize:n.corners}),{width:l,height:n.width,left:n.radius,top:-n.width>>1,filter:s}),i("fill",{color:n.color,opacity:n.opacity}),i("stroke",{opacity:0}))))}var s,l=n.length+n.width,u=2*l,d=2*-(n.width+n.length)+"px",f=o(r(),{position:"absolute",top:d,left:d});if(n.shadow)for(s=1;n.lines>=s;s++)a(s,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(s=1;n.lines>=s;s++)a(s);return e(t,f)},s.prototype.opacity=function(t,e,i,n){var o=t.firstChild;n=n.shadow&&n.lines||0,o&&o.childNodes.length>e+n&&(o=o.childNodes[e+n],o=o&&o.firstChild,o=o&&o.firstChild,o&&(o.opacity=i))}}var u,d=["webkit","Moz","ms","O"],f={},c=function(){var i=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};s.defaults={},r(s.prototype,{spin:function(e){this.stop();var i,n,r=this,s=r.opts,l=r.el=o(t(0,{className:s.className}),{position:s.position,width:0,zIndex:s.zIndex}),d=s.radius+s.length+s.width;if(e&&(e.insertBefore(l,e.firstChild||null),n=a(e),i=a(l),o(l,{left:("auto"==s.left?n.x-i.x+(e.offsetWidth>>1):parseInt(s.left,10)+d)+"px",top:("auto"==s.top?n.y-i.y+(e.offsetHeight>>1):parseInt(s.top,10)+d)+"px"})),l.setAttribute("role","progressbar"),r.lines(l,r.opts),!u){var f,c=0,p=(s.lines-1)*(1-s.direction)/2,h=s.fps,m=h/s.speed,g=(1-s.opacity)/(m*s.trail/100),v=m/s.lines;(function y(){c++;for(var t=0;s.lines>t;t++)f=Math.max(1-(c+(s.lines-t)*v)%m*g,s.opacity),r.opacity(l,t*s.direction+p,f,s);r.timeout=r.el&&setTimeout(y,~~(1e3/h))})()}return r},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(n,r){function a(e,i){return o(t(),{position:"absolute",width:r.length+r.width+"px",height:r.width+"px",background:e,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/r.lines*l+r.rotate)+"deg) translate("+r.radius+"px"+",0)",borderRadius:(r.corners*r.width>>1)+"px"})}for(var s,l=0,d=(r.lines-1)*(1-r.direction)/2;r.lines>l;l++)s=o(t(),{position:"absolute",top:1+~(r.width/2)+"px",transform:r.hwaccel?"translate3d(0,0,0)":"",opacity:r.opacity,animation:u&&i(r.opacity,r.trail,d+l*r.direction,r.lines)+" "+1/r.speed+"s linear infinite"}),r.shadow&&e(s,o(a("#000","0 0 4px #000"),{top:"2px"})),e(n,e(s,a(r.color,"0 0 1px rgba(0,0,0,.1)")));return n},opacity:function(t,e,i){t.childNodes.length>e&&(t.childNodes[e].style.opacity=i)}});var h=o(t("group"),{behavior:"url(#default#VML)"});return!n(h,"transform")&&h.adj?l():u=n(h,"animation"),s});;
/*
 * Ladda 0.7.0 (2013-07-26, 16:54)
 * http://lab.hakim.se/ladda
 * MIT licensed
 *
 * Copyright (C) 2013 Hakim El Hattab, http://hakim.se
 */
(function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(["spin"],e):t.Ladda=e(t.Spinner)})(this,function(t){"use strict";function e(t){if(t===void 0)return console.warn("Ladda button target must be defined."),void 0;t.querySelector(".ladda-label")||(t.innerHTML='<span class="ladda-label">'+t.innerHTML+"</span>");var e=r(t),n=document.createElement("span");n.className="ladda-spinner",t.appendChild(n);var i,a={start:function(){return t.setAttribute("disabled",""),t.setAttribute("data-loading",""),clearTimeout(i),e.spin(n),this.setProgress(0),this},startAfter:function(t){return clearTimeout(i),i=setTimeout(function(){a.start()},t),this},stop:function(){return t.removeAttribute("disabled"),t.removeAttribute("data-loading"),clearTimeout(i),i=setTimeout(function(){e.stop()},1e3),this},toggle:function(){return this.isLoading()?this.stop():this.start(),this},setProgress:function(e){e=Math.max(Math.min(e,1),0);var n=t.querySelector(".ladda-progress");0===e&&n&&n.parentNode?n.parentNode.removeChild(n):(n||(n=document.createElement("div"),n.className="ladda-progress",t.appendChild(n)),n.style.width=(e||0)*t.offsetWidth+"px")},enable:function(){return this.stop(),this},disable:function(){return this.stop(),t.setAttribute("disabled",""),this},isLoading:function(){return t.hasAttribute("data-loading")}};return o.push(a),a}function n(t,n){n=n||{};var i=[];"string"==typeof t?i=a(document.querySelectorAll(t)):"object"==typeof t&&"string"==typeof t.nodeName&&(i=[t]);for(var r=0,o=i.length;o>r;r++)(function(){var t=i[r];if("function"==typeof t.addEventListener){var a=e(t),o=-1;t.addEventListener("click",function(){a.startAfter(1),"number"==typeof n.timeout&&(clearTimeout(o),o=setTimeout(a.stop,n.timeout)),"function"==typeof n.callback&&n.callback.apply(null,[a])},!1)}})()}function i(){for(var t=0,e=o.length;e>t;t++)o[t].stop()}function r(e){var n,i=e.offsetHeight;i>32&&(i*=.8),e.hasAttribute("data-spinner-size")&&(i=parseInt(e.getAttribute("data-spinner-size"),10)),e.hasAttribute("data-spinner-color")&&(n=e.getAttribute("data-spinner-color"));var r=12,a=.2*i,o=.6*a,s=7>a?2:3;return new t({color:n||"#fff",lines:r,radius:a,length:o,width:s,zIndex:"initial",top:"auto",left:"auto",className:""})}function a(t){for(var e=[],n=0;t.length>n;n++)e.push(t[n]);return e}var o=[];return{bind:n,create:e,stopAll:i}});;var App={tagline:'',service:'/api/',logService:'http://log.crunchbutton.com/api/',server:'/',imgServer:'/',cached:{},community:null,config:null,_init:false,_pageInit:false,_identified:false,touchX:null,touchY:null,touchOffset:null,localStorage:false,isPhoneGap:document.location.protocol=='file:',useNativeAlert:false,useNativeConfirm:true,ajaxTimeout:5000,splashHidden:false,restaurantsPaging:{enabled:true,desktop:9,mobile:6}};App.localStorage=App.isPhoneGap;App.NGinit=function(){$('body').attr('ng-controller','AppController');angular.bootstrap(document,['NGApp']);if(App.config.env=='live'){$('.footer').addClass('footer-hide');}};var NGApp=angular.module('NGApp',[]);NGApp.config(function($compileProvider){$compileProvider.urlSanitizationWhitelist(/.*/);});NGApp.config(function($httpProvider){var interceptor=function($q,$injector){function success(response){return response;}
function error(response){var status=response.status;if(!window.navigator.onLine){var showError=false;var url=response.config.url;if(url){if(url.indexOf(App.service)>=0){var api=url.split(App.service);if(api.length>0){api=api[1];var showErrorFor=['order','restaurant','user'];for(var i=0;i<showErrorFor.length;i++){if(api.indexOf(showErrorFor[i])>=0){showError=true;break;}}}}}else{showError=true;}
if(showError&&!$('.connection-error').is(':visible')){App.connectionError();if(App.busy.isBusy()){App.busy.unBusy();}}}
return $q.reject(response);}
return function(promise){return promise.then(success,error);}};$httpProvider.responseInterceptors.push(interceptor);});NGApp.config(['$routeProvider','$locationProvider',function($routeProvider,$locationProvider,RestaurantsService){$routeProvider.when('/location',{action:'location',controller:'LocationCtrl',templateUrl:'assets/view/location.html'}).when('/food-delivery',{action:'restaurants',controller:'RestaurantsCtrl',templateUrl:'assets/view/restaurants.html'}).when('/food-delivery/:id',{action:'restaurant',controller:'RestaurantCtrl',templateUrl:'assets/view/restaurant.html'}).when('/legal',{action:'legal',controller:'LegalCtrl',templateUrl:'assets/view/legal.html'}).when('/help',{action:'help',controller:'HelpCtrl',templateUrl:'assets/view/help.html'}).when('/orders',{action:'orders',controller:'OrdersCtrl',templateUrl:'assets/view/orders.html'}).when('/order/:id',{action:'order',controller:'OrderCtrl',templateUrl:'assets/view/order.html'}).when('/cities',{action:'cities',controller:'CitiesCtrl',templateUrl:'assets/view/cities.html'}).when('/giftcard',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/giftcard/:id',{action:'giftcard',controller:'GiftcardCtrl',templateUrl:'assets/view/home.html'}).when('/reset',{action:'reset',controller:'AccountResetCtrl',templateUrl:'assets/view/home.html'}).when('/reset/:id',{action:'reset',controller:'AccountResetCtrl',templateUrl:'assets/view/home.html'}).when('/invite/:id',{action:'invite',controller:'InviteCtrl',templateUrl:'assets/view/home.html'}).when('/',{action:'home',controller:'HomeCtrl',templateUrl:'assets/view/home.html'}).otherwise({action:'home',controller:'DefaultCtrl',templateUrl:'assets/view/home.html'});$locationProvider.html5Mode(!App.isPhoneGap);}]);NGApp.controller('AppController',function($scope,$route,$routeParams,$rootScope,$location,$window,AccountService,MainNavigationService,AccountSignOut,CartService,ReferralService){App.rootScope=$rootScope;App.location=$location;$rootScope.account=AccountService;$rootScope.navigation=MainNavigationService;$rootScope.signout=AccountSignOut;$rootScope.test=App.test;$rootScope.cartScroll=function(){$('html, body, .snap-content-inner').animate({scrollTop:156},100,$.easing.easeInOutQuart?'easeInOutQuart':null);};$rootScope.$on('userAuth',function(e,data){$rootScope.$safeApply(function($scope){if(data){$rootScope.account.user=data;App.config.user=data;}
if(!App.config.user.id_user){CartService.clean();}
console.log('userAuth!');if(!AccountService.forceDontReloadAfterAuth){$rootScope.reload();}
AccountService.forceDontReloadAfterAuth=false;});});$rootScope.focus=function(selector){setTimeout(function(){angular.element(selector).focus();},100);}
$rootScope.reload=function(){$route.reload();};$rootScope.link=function(link){App.go.apply(arguments);};$rootScope.back=function(){App.snap.close();var backwards=false;switch($route.current.action){case'order':backwards='/orders';break;case'restaurant':backwards='/food-delivery';break;case'restaurants':backwards='/location';break;}
if(backwards){App.go(backwards);}else{history.back();}};$rootScope.closePopup=function(){try{$.magnificPopup.close();}catch(e){}};$rootScope.$safeApply=function(fn){var phase=this.$root.$$phase;if(phase=='$apply'||phase=='$digest'){if(fn&&(typeof(fn)==='function')){this.$eval(fn);}}else{this.$apply(fn);}};$scope.$on('$routeChangeSuccess',function($currentRoute,$previousRoute){MainNavigationService.page=$route.current.action;$('body').removeClass(function(index,css){return(css.match(/\bpage-\S+/g)||[]).join(' ');}).addClass('page-'+MainNavigationService.page);setTimeout(function(){App.scrollTop();},1);if(App.isPhoneGap&&!App.splashHidden&&navigator.splashscreen){App.splashHidden=true;setTimeout(function(){navigator.splashscreen.hide();},1);}});$rootScope.windowWidth=$window.outerWidth;$rootScope.windowHeight=$window.outerHeight;angular.element($window).bind('resize',function(){$rootScope.windowWidth=$window.outerWidth;$rootScope.windowHeight=$window.outerHeight;$rootScope.$apply('windowWidth');$rootScope.$apply('windowHeight');});AccountService.checkUser();ReferralService.check();});App.alert=function(txt,title,useNativeAlert){setTimeout(function(){if(useNativeAlert&&App.isPhoneGap){navigator.notification.alert(txt,null,title||'Crunchbutton');}else if(useNativeAlert){alert(txt);}else{App.rootScope.$broadcast('notificationAlert',title||null,txt);}});};App.confirm=function(txt,title,fn,buttons){if(App.useNativeConfirm&&App.isPhoneGap){return navigator.notification.confirm(txt,fn,title||'Crunchbutton',buttons||'Ok,Cancel');}else{return confirm(txt);}};App.connectionError=function(){App.rootScope.$broadcast('notificationAlert','Connection Error','Sorry! We could not reach the server right now. Try again when your internet is back!');};App.go=function(url){App.location.path(url||'/');App.rootScope.$safeApply();};App.toggleMenu=function(){if(App.snap.state().state=='left'){App.snap.close();}else{App.snap.open('left');}};App.scrollTop=function(){setTimeout(function(){$('html, body, .snap-content-inner').animate({scrollTop:0},10,$.easing.easeInOutQuart?'easeInOutQuart':null);},1);};App.track=function(){if(App.config.env!='live'){return;}
if(arguments[0]=='Ordered'){$('img.conversion').remove();var i=$('<img class="conversion" src="https://www.googleadservices.com/pagead/conversion/996753959/?value='+Math.floor(arguments[1].total)+'&amp;label=-oawCPHy2gMQp4Sl2wM&amp;guid=ON&amp;script=0&url='+location.href+'">').appendTo($('body'));}};App.busy={_busy:false,_timer:null,_maxExec:25000,stage:function(){$('#Stage').height('100%').width('100%');return AdobeEdge.getComposition('EDGE-977700350').getStage();},isBusy:function(){return $('.app-busy').length?true:false;return App.busy._busy;},makeBusy:function(){if(App.busy._timer){clearTimeout(App.busy._timer);}
App.busy._timer=setTimeout(function(){App.alert('The app timed out processing your order. We can not determine if the order was placed or not. Please check your previous orders. Sorry!');App.busy.unBusy();},App.busy._maxExec);return $('body').append($('<div class="app-busy"></div>').append($('<div class="app-busy-loader"><div class="app-busy-loader-icon"></div></div>')));App.busy._busy=true;$('.order-sky-loader').addClass('play');App.busy.stage().play(0);},unBusy:function(){clearTimeout(App.busy._timer);return $('.app-busy').remove();App.busy._busy=false;$('.order-sky-loader').removeClass('play');App.busy.stage().stop();}};App.test={card:function(){angular.element('html').injector().get('OrderService')._test();},logout:function(){$.getJSON(App.service+'logout',function(){location.reload()});},cart:function(){App.alert(JSON.stringify(App.cart.items));},clearloc:function(){$.totalStorage('community',null);$.totalStorage('location_lat',null);$.totalStorage('location_lon',null);location.href='/';},reload:function(){location.reload();},location:function(){var position=angular.element('html').injector().get('PositionsService');var locs=position.locs;for(x in locs){var values=[];$.each(locs[x]._properties,function(key,value){values.push(key);values.push(': ');values.push((value||'-'));values.push(' | ');if(key=='results'){$.each(value,function(position,result){console.log('result: '+position,result);});}});console.log('Position: '+x,values.join(''));}}};App.processConfig=function(json,user){if(user&&!json){App.config.user=user;}else{App.config=json;}
App.AB.init();};App.init=function(config){if(App._init){return;}
App._init=true;App.verifyConnection.init();$(document).on('touchmove','.snap-drawers, .mfp-wrap, .support-container',function(e){e.preventDefault();e.stopPropagation();});FastClick.attach(document.body);if(App.isPhoneGap&&!App.iOS7()){$('body').removeClass('ios7');}
App.snap=new Snap({element:document.getElementById('snap-content'),disable:'right'});App.snap.on('end',function(){App.applyIOSPositionFix();});App.snap.on('start',function(){App.applyIOSPositionFix();});var snapperCheck=function(){if($(window).width()<=768){App.snap.enable();}else{App.snap.close();App.snap.disable();}};snapperCheck();$(window).resize(function(){snapperCheck();});$.totalStorage.ls(App.localStorage);if(typeof CB!=='undefined'&&CB.config){App.config=CB.config;CB.config=null;}
$(document).on('click','.button-deliver-payment, .dp-display-item a, .dp-display-item .clickable',function(){$('.payment-form').show();$('.delivery-payment-info, .content-padder-before').hide();});$(document).on({mousedown:function(){$(this).addClass('button-bottom-click');},touchstart:function(){$(this).addClass('button-bottom-click');},mouseup:function(){$(this).removeClass('button-bottom-click');},touchend:function(){$(this).removeClass('button-bottom-click');}},'.button-bottom');App.processConfig(config||App.config);App.AB.init();App.NGinit();$.cookie('loc','',{expires:(new Date(1970,01,01))});$.cookie('locv2','',{expires:(new Date(1970,01,01))});if(App.iOS()){$(':input').focus(function(){$(window).scrollTop($(window).scrollTop()+1);});}
App.phoneGapListener.init();};App.dialog={show:function(){if(arguments[1]){var src='<div class="zoom-anim-dialog small-container">'+'<h1>'+arguments[0]+'</h1>'+'<div class="small-container-content">'+arguments[1]+'</div>'+'</div>';}else if($(arguments[0]).length){var src=$(arguments[0]);}else{console.log('ERROR WITH DIALOG');return;}
$.magnificPopup.open({items:{src:src,type:'inline'},fixedContentPos:true,fixedBgPos:true,closeBtnInside:true,preloader:false,midClick:true,removalDelay:300,overflowY:'auto',mainClass:'my-mfp-zoom-in',callbacks:{open:function(){setTimeout(function(){if(App.iOS()){var width=angular.element('.mfp-bg').width();angular.element('.mfp-bg').width(width+10);}},1);},close:function(){$('.wrapper').removeClass('dialog-open-effect-a dialog-open-effect-b dialog-open-effect-c dialog-open-effect-d');App.applyIOSPositionFix();}}});},isOpen:function(){return $.magnificPopup&&$.magnificPopup.instance&&$.magnificPopup.instance.isOpen;}};App.playAudio=function(audio){if(App.isPhoneGap){try{navigator.notification.vibrate(100);}catch(e){}}
var audio=$('#'+audio).get(0);if(!audio){return};try{audio.play();}catch(e){}}
App.applyIOSPositionFix=function(){if(App.iOS()){setTimeout(function(){angular.element('body').css('width','+=1').css('width','-=1');$('.navs').css('width','+=1').css('width','-=1');$('.navs').css('left','+=1').css('left','-=1');setTimeout(function(){angular.element('body').css('width','+=1').css('width','-=1');$('.navs').css('width','+=1').css('width','-=1');$('.navs').css('left','+=1').css('left','-=1');},300);},200);}}
App.verifyConnection={isOffLine:false,forceReload:false,init:function(){if(App.isPhoneGap){App.verifyConnection.check();}},check:function(){var networkState=navigator.connection.type;if(networkState==Connection.NONE){App.verifyConnection.forceReload=true;App.verifyConnection.goOffline();}},goOffline:function(){if(App._remoteConfig){return;}
$('.connection-error').show();navigator.splashscreen.hide();App.verifyConnection.isOffLine=true;},goOnline:function(){if(App.verifyConnection.isOffLine){if(App.verifyConnection.forceReload){window.location.reload(true);App.verifyConnection.forceReload=false;}else{App.rootScope.reload();}}
App.verifyConnection.isOffLine=false;$('.connection-error').hide();}}
App.setNotificationBarStatus=function(status){App.rootScope.notificationBarStatus=status;App.rootScope.$safeApply();}
App.phoneGapListener={init:function(){if(App.isPhoneGap){document.addEventListener('deviceready',App.phoneGapListener.deviceready,false);document.addEventListener('pause',App.phoneGapListener.pause,false);document.addEventListener('resume',App.phoneGapListener.resume,false);document.addEventListener('online',App.phoneGapListener.online,false);if(!navigator.onLine){App.verifyConnection.goOffline();}}},deviceready:function(){},resume:function(){dateTime.restart();App.rootScope.$broadcast('appResume',false);},pause:function(){},online:function(){App.verifyConnection.goOnline();}};App.tokenizeCard=function(card,complete){balanced.card.create(card,function(response){var res={status:false};switch(response.status){case 201:res.status=true;res.id=response.data.id;res.uri=response.data.uri;res.lastfour=response.data.last_four;res.month=card.expiration_month;res.year=card.expiration_year;break;case 400:res.error='Missing fields';break;case 402:res.error='Unable to authorize';break;case 404:res.error='Unexpected error';break;case 409:res.error='Unable to validate';break;case 500:res.error='Error processing payment';break;case 999:res.error='Unable to reach payment server';break;}
console.debug('Balanced tokenization response',response);complete(res);});};App.profile={_timer:false,log:function(n){return;var now=new Date();if(App.profile._timer){console.debug('>> PROFILE',now.getTime()-App.profile._timer.getTime(),n);}else{console.debug('>> PROFILE',0,n);}
App.profile._timer=now;}}
App.share=function(params){var pic=params.picture||'http://crunchbutton.com/assets/images/facebook-like.png';if(App.isPhoneGap&&App.iOS()){var description=params.caption+".\r\n"+params.description.replace(/(<br \/>)|(\n)/g,'');CDV.FB.share([params.url,params.name,'',description,pic],params.success,params.fail);}else{FB.ui({method:'feed',user_message_prompt:'CrunchButton',link:params.url,href:params.url,picture:pic,name:params.name,caption:params.caption,description:params.description,attachment:{name:'CrunchButton',caption:' ',description:params.url,href:params.url,media:[{type:'image',src:pic,href:params.url}],},action_links:[{text:'CrunchButton',href:'https://crunchbutton.com'}],description:params.description},function(response){console.log(response);if(response&&response.post_id){if(typeof params.success==='function'){params.success(response);}}else{if(typeof params.fail==='function'){params.fail(response);}}});}};var dateTime={timer:0,now:false};dateTime.update=function(){var time=_gmtServer.split('/');dateTime.now=new Date(Number(time[0]),Number(time[1]-1),Number(time[2]),Number(time[3]),Number(time[4]),(Number(time[5])+dateTime.timer));dateTime.timer++;setTimeout(function(){dateTime.update();},1000);}
dateTime.restart=function(){dateTime.timer=0;dateTime.now=false;var now=new Date();_gmtServer=now.getUTCFullYear()+'/'+(now.getUTCMonth()+1)+'/'+now.getUTCDate()+'/'+now.getUTCHours()+'/'+now.getUTCMinutes()+'/'+now.getUTCSeconds();}
dateTime.toString=function(){return dateTime.now.toString('dd MMMM yyyy HH:mm:ss');}
dateTime.update();;if(typeof(console)=='undefined'){console={log:function(){return null;},debug:function(){return null;},error:function(){return null;}};}
if(typeof(Number.prototype.toRad)==='undefined'){Number.prototype.toRad=function(){return this*Math.PI/180;}}
var _toRad=function(){var Value=arguments.shift();return Number.prototype.toRad.call(Value,args);};if(!typeof(App)=='undefined'){App={};}
App.capitalize=function(word){return word.charAt(0).toUpperCase()+word.slice(1);};App.request=function(url,complete,error){if(angular&&angular.element&&angular.element('html')&&angular.element('html').injector()&&angular.element('html').injector().get('$http')){var http=angular.element('html').injector().get('$http');http({url:url,method:'GET'}).success(function(data){if(complete){complete(data);}}).error(function(data){if(error){error(data)}});}else{$.getJSON(url).done(complete).fail(error);}};App.cache=function(type,id){var finalid,args=arguments,complete,partComplete,partError;complete=args[2]?args[2]:function(){};error=args[3]?args[3]:function(){};partComplete=function(){if(this.uuid){App.cached[type][id.uuid]=this;App.cached[type][id]=this;}
if(this.permalink){App.cached[type][id.permalink]=this;App.cached[type][id]=this;}
complete.call(this);}
partError=function(){App.cached[type][id]=null;error.call(arguments);}
if(typeof(id)=='object'){eval('App.cached[type][id.id] = new '+type+'(id,partComplete, partError)');finalid=id.id;}else if(!App.cached[type][id]){eval('App.cached[type][id] = new '+type+'(id,partComplete, partError)');}else{complete.call(App.cached[type][id]);}
return App.cached[type][finalid||id];};App.ceil=function(num){num=num*100;num=Math.ceil(num);return num/100;};App.phone={format:function(num){if(num!=null){num=num.replace(/^0|^1/,'');num=num.replace(/[^\d]*/gi,'');num=num.substr(0,10);if(num.length>=7){num=num.replace(/(\d{3})(\d{3})(.*)/,"$1-$2-$3");}else if(num.length>=4){num=num.replace(/(\d{3})(.*)/,"$1-$2");}}
return num;},validate:function(num){if(!num){return false;}
num=num.replace(new RegExp('-','g'),'');if(!num||num.length!=10){return false;}
var
nums=num.split(''),prev;for(x in nums){if(!prev){prev=nums[x];continue;}
if(nums[x]!=prev){return true;}}
return false;}};App.pad=function(number,length){var str=''+number;while(str.length<length){str='0'+str;}
return str;};App.formatTime=function(time){if(!time){return'';}
var vals=time.split(':');var pm=false;vals[0]=new String(vals[0]);vals[1]=vals[1]?new String(vals[1]):0;if(vals[0].match(/^[0-9]{3,4}$/i)){vals[1]=vals[0].substr(-2,2);vals[0]=vals[0].substr(0,vals[0].length-2);}
if(vals[0]=='12'){pm=true;}
if(vals[0]=='24'){vals[0]='00';}
if(vals[0]>12){vals[0]-=12;pm=true;}else{if(!pm&&time.match(/p/i)){pm=true;}
if(pm&&time.match(/a/i)){pm=false;}}
if(!vals[1]){vals[1]='00';}
vals[1]=vals[1].replace(/[^0-9]+/,'');vals[0]=new String(vals[0]).replace(/[^0-9]+/,'');vals[0]=App.pad(vals[0],2);vals[1]=App.pad(vals[1],2);if(vals[0]=='00'){vals[0]=12;}
return vals.join(':')+(pm?' PM':' AM');};App.unFormatTime=function(time){var part=time.split(' ');part[0]=part[0].split(':');part[0][0]=parseInt(part[0][0],10);if(part[1]=='PM'){if(part[0][0]!=12){part[0][0]=App.pad(part[0][0]+12,2);}}else{if(part[0][0]==12){part[0][0]='00';}}
return part[0][0]+':'+part[0][1];};App.cleanInput=function(text){text=App.cleanBad(text);var type=arguments[1];switch(type){case'float':text=text.replace(/[^0-9\.]+/i,'');break;case'text':default:text=text.replace(/[^a-z0-9\-_ \(\)\+\.\@\%\&\!\;\:\"\'\,\\\/]+/i,'');break;}
return text};App.cleanBad=function(s){s=s.replace(/\u2018|\u2019|\u201A|\uFFFD/g,"'");s=s.replace(/\u201c|\u201d|\u201e/g,'"');s=s.replace(/\u02C6/g,'^');s=s.replace(/\u2039/g,'<');s=s.replace(/\u203A/g,'>');s=s.replace(/\u2013/g,'-');s=s.replace(/\u2014/g,'--');s=s.replace(/\u2026/g,'...');s=s.replace(/\u00A9/g,'(c)');s=s.replace(/\u00AE/g,'(r)');s=s.replace(/\u2122/g,'TM');s=s.replace(/\u00BC/g,'1/4');s=s.replace(/\u00BD/g,'1/2');s=s.replace(/\u00BE/g,'3/4');s=s.replace(/[\u02DC|\u00A0]/g," ");return s;};App.isMobile=function(){return App.isAndroid()||$.browser.mobile;}
App.isNarrowScreen=function(){return $(window).width()<=769;}
App.iOS=function(){return /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());}
App.iOS7=function(){return /iphone os 7_/i.test(navigator.userAgent.toLowerCase());}
App.isAndroid=function(){return /android/i.test(navigator.userAgent.toLowerCase());}
App.isChrome=function(){return /chrom(e|ium)/.test(navigator.userAgent.toLowerCase())||/crios/.test(navigator.userAgent.toLowerCase())||(typeof window.chrome==='object');}
var sort_by;(function(){var default_cmp=function(a,b){if(a==b)return 0;return a<b?-1:1;},getCmpFunc=function(primer,reverse){var cmp=default_cmp;if(primer){cmp=function(a,b){return default_cmp(primer(a),primer(b));};}
if(reverse){return function(a,b){return-1*cmp(a,b);};}
return cmp;};sort_by=function(){var fields=[],n_fields=arguments.length,field,name,reverse,cmp;for(var i=0;i<n_fields;i++){field=arguments[i];if(typeof field==='string'){name=field;cmp=default_cmp;}
else{name=field.name;cmp=getCmpFunc(field.primer,field.reverse);}
fields.push({name:name,cmp:cmp});}
return function(A,B){var a,b,name,cmp,result;for(var i=0,l=n_fields;i<l;i++){result=0;field=fields[i];name=field.name;cmp=field.cmp;result=cmp(A[name],B[name]);if(result!==0)break;}
return result;}}}());var startCoords={},endCoords={},cordsThresh=3;if(window.jQuery){(function($){$.fn.checkToggle=function(params){var checks=$(this).filter('input[type="checkbox"]');$(this).filter('input[type="checkbox"]').each(function(){$(this).prop('checked',!$(this).is(':checked'));});return this;};})(jQuery);};var Orm={properties:function(){var properties={};for(var name in this){if(name.indexOf('_')!==0&&!$.isFunction(this[name])){if(this[name]===true){properties[name]=1;}else if(this[name]===false){properties[name]=0;}else{properties[name]=this[name];}}}
return properties;},loadType:function(cls,data){if(!this['__'+data]){this['__'+data]=[];for(x in this['_'+data]){this['__'+data][this['__'+data].length]=App.cache(cls,this['_'+data][x]);}
this['_'+data]=null;}
return this['__'+data];},save:function(complete){if(!this.type)return;$.post(App.service+this.resource+(this.id?('/'+this.id):''),this.properties(),function(result){if(complete){complete(result);}});},load:function(id){var self=this;if(typeof(id)=='object'){this.finished(id);}else{App.request(App.service+self.resource+'/'+id,function(json){if(json.error){throw'ORM load error: '+json.error+"\nType: "+self.type+"\nResource: "+self.resource+"\nID: "+id;}else{self.finished(json);}},function(){if(typeof self.loadError=='function'){self.loadError.apply(self,arguments);}});}}};var Location=function(params){var self=this;this._properties={verified:true,city:null,region:null,lat:null,lon:null,type:null,subtype:null,address:null,prep:null};self.setCityFromResult=function(results){if(!results){return;}
var result=results[0]||results;if(typeof result.types==='string'){var type=result.types;}else{for(x in result.types){var type=result.types[x];}}
switch(type){case'locality':self._properties.city=result.address_components[0].long_name;self._properties.region=result.address_components[2].short_name;self._properties.detail=2;break;case'street_address':case'premise':self._properties.city=result.address_components[2].long_name;self._properties.region=result.address_components[4].short_name;self._properties.detail=5;break;case'postal_code':self._properties.city=result.address_components[1].long_name;self._properties.region=result.address_components[3].short_name;self._properties.detail=3;break;case'route':self._properties.city=result.address_components[1].long_name;self._properties.region=result.address_components[3].short_name;self._properties.detail=4;break;default:case'administrative_area_level_1':self._properties.city=result.address_components[0].long_name;self._properties.detail=1;break;}
for(var i=0;i<result.address_components.length;i++){for(var j=0;j<result.address_components[i].types.length;j++){if(result.address_components[i].types[j]=='locality'){self._properties.city=result.address_components[i].long_name;}}}};self.setAddressFromResult=function(results){if(!results){return;}
var result=results[0]||results;self._properties.address=result.formatted_address;};self.setZipFromResult=function(results){if(!results){return;}
var result=results[0]||results;for(var x in result.address_components){if(result.address_components[x].types[0]=='postal_code'){self._properties.zip=result.address_components[x].short_name;return;}}};self.distance=function(from){return App.loc.distance({to:{lat:self.lat(),lon:self.lon()},from:from});};self.city=function(){return self._properties.city||'';};self.prep=function(){return self._properties.prep||'in';};self.address=function(){return self._properties.address||'';};self.formatted=function(location){return self.address().replace(', USA','');};self.formattedWithDiff=function(){var address=self.formatted();if(self.entered()&&self.entered()!=''){var diff=self.getDiff();if(diff){return address+' ('+diff+')';}}
return address;}
self.zip=function(){return self._properties.zip||'';};self.lat=function(){return self._properties.lat||0;};self.lon=function(){return self._properties.lon||0;};self.valid=function(){switch(arguments[0]){case'restaurants':return(self.lat()||self.lon())?true:false;break;case'order':return(self.lat()||self.lon())&&self.verified()&&self.detail()>=5?true:false;break;default:return false;break;}};self.getDiff=function(){if(!self.entered()){return;}
var _formatted=self.formatted();var _entered=self.entered();_formatted=_formatted.replace(/,/g,'');_entered=_entered.replace(/,/g,'');a_formatted=_formatted.split(" ");a_entered=_entered.split(" ");var diff=new Array();if(a_formatted.length>a_entered.length){var long=a_formatted;var short=a_entered;}else{var long=a_entered;var short=a_formatted;}
for(x=0;x<long.length;x++){var has=false;for(y=0;y<short.length;y++){if(short[y]==long[x]){has=true;}}
if(!has){diff.push(long[x]);}}
return diff.join(" ");};self.verified=function(){return self._properties.verified;};self.type=function(){return self._properties.type;};self.detail=function(){return self._properties.detail;};self.region=function(){return self._properties.region;}
self.entered=function(){return self._properties.entered;}
self.setEntered=function(entered){self._properties.entered=entered;}
self.toCookie=function(){var properties={};for(var x in this._properties){if(x!='results'){properties[x]=this._properties[x];}}
return new Location(properties);}
for(var x in params){this._properties[x]=params[x];}
if(params&&params.results){self.setCityFromResult(params.results);self.setAddressFromResult(params.results);self.setZipFromResult(params.results);}};App.AB={options:{tagline:[{name:'tagline-for-free',tagline:'Order the top food %s. For free. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'},{name:'tagline-no-free',tagline:'Order the top food %s. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'}],slogan:[{name:'slogan-push-food',slogan:'Push a button. Get Food.'}],nothingInTheCartMobile:[{name:'empty-cart-mobile-begin',line:'Begin by tapping on anything from our curated menu below!'},{name:'empty-cart-mobile-food',line:'Choose food below!',disabled:true}],nothingInTheCartDesktop:[{name:'empty-cart-desktop-begin',line:'Begin by clicking on anything from our curated menu on the left!'},{name:'empty-cart-desktop-food',line:'Choose Food!'}],restaurantPage:[{name:'restaurant-page-noimage'},{name:'restaurant-page-image',disabled:true}],dollarSign:[{name:'show'},{name:'hide'}]},init:function(){App.AB.create(true);App.AB.load();},create:function(clear){if(clear){App.config.ab={};}
if(App.config&&!App.config.ab){App.config.ab={};}
for(var key in App.AB.options){if(App.config.ab[key]){return;}
var optionType=App.AB.options[key];var opts=[];for(var x in optionType){if(!optionType[x].disabled||optionType[x].disabled==false){opts[opts.length]=optionType[x];}}
var opt=opts[Math.floor(Math.random()*opts.length)];App.config.ab[key]=opt.name}
App.AB.save();},load:function(){App.slogan=App.AB.pluck('slogan',App.config.ab.slogan);App.tagline=App.AB.pluck('tagline',App.config.ab.tagline);if(!App.slogan||!App.tagline){App.AB.create(true);App.AB.load(true);}},pluck:function(option,name){for(var x in App.AB.options[option]){if(App.AB.options[option][x].name==name){return App.AB.options[option][x];}}
return null;},save:function(){$.ajax({url:App.service+'config',data:{ab:App.config.ab},dataType:'json',type:'POST',complete:function(json){}});}};;function restaurantSort(a,b){var bubble;if((a.open()&&b.open())||(!a.open()&&!b.open())){bubble=parseInt(a.sort)-parseInt(b.sort);}else if(a.open()&&!b.open()){bubble=-1;}else if(!a.open()&&b.open()){bubble=1;}else{console.log('Should not be here',a,b);}
return bubble;}
var Community=function(id){this.type='Community';this.id_var='id_community';this.resource='community';var self=this;$.extend(self,Orm);var complete=arguments[1]||null;self.loadError=arguments[2]||null;self.restaurants=function(){if(!self.__restaurants){var openRestaurants=[];var closedRestaurants=[];for(x in self._restaurants){var restaurant=App.cache('Restaurant',self._restaurants[x]);if(restaurant.open()){openRestaurants[openRestaurants.length]=restaurant;}else{closedRestaurants[closedRestaurants.length]=restaurant;}}
openRestaurants.sort(restaurantSort);closedRestaurants.sort(restaurantSort);self.__restaurants=[];self._restaurants=null;for(x in openRestaurants){self.__restaurants[self.__restaurants.length]=openRestaurants[x];}
for(x in closedRestaurants){self.__restaurants[self.__restaurants.length]=closedRestaurants[x];}}
return self.__restaurants;}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.restaurants();if(typeof complete=='function'){complete.call(self);}}
self.load(id);}
App.cached.Community={};;var Restaurant=function(id){this.type='Restaurant';this.id_var='id_restaurant';this.resource='restaurant';var
self=this,complete;$.extend(self,Orm);var complete=arguments[1]||null;self.loadError=arguments[2]||null;this._utcTime=function(serverTime)
{return this._parseDate(serverTime.add(-this._tzoffset).hours().toUTCString());}
this._parseDate=function(dateStr){if(!dateStr){return null;}
dateStr=dateStr.split(',');dateStr=(dateStr.length==2?dateStr[1]:dateStr[0]).trim();return Date.parse(dateStr);}
this._utcNow=function()
{return Date.parse(dateTime.toString());}
this.closesIn=function(trueIfItIsOpen){if(this.open_for_business==="0"){this._open=false;return false;}
if(!this._hours){this._open=false;return false;}
var today=Date.today().toString('ddd').toLowerCase();if(this._hours==undefined||this._hours[today]==undefined){this._open=false;return false;}
var yesterday=Date.parse('yesterday').toString('ddd').toLowerCase();if(this._hours[yesterday]!=undefined){yesterdayHours=this._hours[yesterday];for(i in yesterdayHours){try{var openTime=this._parseDate(yesterdayHours[i][0]);var closeTime=this._parseDate(yesterdayHours[i][1]);if(yesterdayHours[i][1]=='24:00'){closeTime=this._parseDate('00:00');if(closeTime){closeTime.addDays(1);}}
if(openTime){openTime.addDays(-1);var openTime_utc=this._parseDate(openTime.add(-this._tzoffset).hours().toUTCString());}
if(closeTime){closeTime.addDays(-1);var closeTime_utc=this._parseDate(closeTime.add(-this._tzoffset).hours().toUTCString());}
var now_utc=this._utcNow();if(openTime_utc&&closeTime_utc){if(now_utc.between(openTime_utc,closeTime_utc)){this._open=true;break;}}}catch(e){};}}
var todayHours=this._hours[today];for(i in todayHours){var openTime=this._parseDate(todayHours[i][0]);var closeTime=this._parseDate(todayHours[i][1]);if(todayHours[i][1]=='24:00'){closeTime=this._parseDate('00:00');if(closeTime){closeTime.addDays(1);}}
if(openTime){var openTime_utc=this._parseDate(openTime.add(-this._tzoffset).hours().toUTCString());}
if(closeTime){var closeTime_utc=this._parseDate(closeTime.add(-this._tzoffset).hours().toUTCString());}
var now_utc=this._utcNow();if(closeTime_utc){if(closeTime_utc.compareTo(openTime_utc)==-1){closeTime_utc.addDays(1);}}
if(openTime_utc&&closeTime_utc){if(now_utc.between(openTime_utc,closeTime_utc)){this._open=true;}}}
if(trueIfItIsOpen){return true;}
var today=Date.today().toString('ddd').toLowerCase();var tomorrow=Date.today().add(1).days().toString('ddd').toLowerCase();todayHours=this._hours[today];if(this._hours[tomorrow]){var tomorrowHours=this._hours[tomorrow];var tomorrowItOpensAt=tomorrowHours[0][0];var tomorrowItClosesAt=tomorrowHours[0][1];}else{var tomorrowItOpensAt=false;var tomorrowItClosesAt=false;}
for(i in todayHours){var openTime=Date.parse(todayHours[i][0]);var closeTime=Date.parse(todayHours[i][1]);var nextHour=parseInt(i)+1;if(todayHours[nextHour]){var nextHourOpenTime=todayHours[nextHour][0];var nextHourCloseTime=todayHours[nextHour][1];}else{var nextHourOpenTime=false;var nextHourCloseTime=false;}
var previousHour=parseInt(i)-1;if(todayHours[previousHour]){var previousHourOpenTime=todayHours[previousHour][0];var previousHourCloseTime=todayHours[previousHour][1];}else{var previousHourOpenTime=false;var previousHourCloseTime=false;}
if(todayHours[i][1]=='24:00'||todayHours[i][1]=='00:00'){closeTime=Date.parse('00:00');if(tomorrowItOpensAt=='00:00'||tomorrowItOpensAt=='0:00'){closeTime=Date.parse(tomorrowItClosesAt);}
else if(nextHourOpenTime=='00:00'||nextHourOpenTime=='0:00'){closeTime=Date.parse(nextHourCloseTime);}
else if(previousHourOpenTime=='00:00'||previousHourOpenTime=='0:00'){closeTime=Date.parse(previousHourCloseTime);}
closeTime.addDays(1);}
if(closeTime.compareTo(openTime)==-1){closeTime.addDays(1);}
closeTime=this._utcTime(closeTime);utcNow=this._utcNow();var minutes=(closeTime.getTime()-utcNow.getTime())/1000/60;minutes=Math.floor(minutes);this._closesIn=minutes;if(this._closesIn==0){this._open=false;}}
return false;}
self.categories=function(){return self.loadType('Category','categories');}
self.notifications=function(){return self.loadType('Notification','notifications');}
self.top=function(){var categories=self.categories();for(var x in categories){var dishes=categories[x].dishes();for(var xx in dishes){if(dishes[xx].top==1){return dishes[xx];}}}}
self.deliveryDiff=function(total){var diff=parseFloat(self.delivery_min-total).toFixed(2);return diff;}
self.meetDeliveryMin=function(total){return total<parseFloat(self.delivery_min)?true:false;}
self.dateFromItem=function(item,offset){var
theTime=item.split(':'),theDate=new Date();theDate.setHours(theTime[0]);theDate.setMinutes(theTime[1]+offset);return theDate;}
self.open=function(){return this.closesIn(true);}
self.deliveryHere=function(distance){return(distance<=this.delivery_radius)}
self.closedMessage=function(){var isOpenedAt={};var openTime=this._hours;var weekdayOrder=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];var patternHour=/([0])([1-9])(:)([0-9]{2})/;for(var day in openTime){var hours=openTime[day];var openedHoursText='';var openedHoursTextDivisor='';for(var hour in hours){var open=hours[hour][0];var close=hours[hour][1];var formatedOpen=App.formatTime(open).toLowerCase().replace(patternHour,'\$2\$3\$4').replace(/:00/g,'').replace(' ','');var formatedClose=App.formatTime(close).toLowerCase().replace(patternHour,'\$2\$3\$4').replace(/:00/g,'').replace(' ','');openedHoursText+=openedHoursTextDivisor+formatedOpen+' - '+formatedClose;openedHoursTextDivisor=', ';}
openedHoursText=openedHoursText.replace('- 12am, 12am ','');var regex=/12am/gi,result,indices=[];var times=0;while((result=regex.exec(openedHoursText))){times++;}
if(times>=2){var sequences=openedHoursText.split(',');for(var i=0;i<sequences.length;i++){if(sequences[i].indexOf('12am')>0){var first=sequences[i];}
if(sequences[i].indexOf('12am')==0){var last=sequences[i];}}
var newText=[];for(var i=0;i<sequences.length;i++){if(sequences[i]!=first&&sequences[i]!=last){newText.push(sequences[i]);newText.push(', ');}}
newText.push(first);newText.push(last);newText=newText.join('').replace('- 12am12am -',' - ');openedHoursText=newText;}
var key=openedHoursText.replace(/[\ \: \- ,]/g,'');if(!isOpenedAt[key]){isOpenedAt[key]={days:{},hours:{}};}
isOpenedAt[key]['days'][day]=true;isOpenedAt[key]['hour']=openedHoursText;}
var _opened={};for(var hour in isOpenedAt){var days=isOpenedAt[hour]['days'];var commas='';var keys='';for(day in days){keys+=commas+App.capitalize(day);commas=', ';}
hours=isOpenedAt[hour]['hour'];_opened[keys]=hours;}
var _groupedDays={};for(var days in _opened){var weekdays=days.split(',');var nextPosition=-1;var sequenceStartedAt=false;var groupedDays={};var totalWeekdays=weekdays.length;for(var i=0;i<=totalWeekdays;++i){var weekday=$.trim(weekdays[i]);var position=weekdayOrder.indexOf(weekday);if(nextPosition!=position){sequenceStartedAt=weekday;groupedDays[sequenceStartedAt]=[];groupedDays[sequenceStartedAt]=[weekday];}
if(nextPosition==position){groupedDays[sequenceStartedAt].push(weekday);}
nextPosition=position+1;}
var key='';for(var group in groupedDays){if(group!=''){if(groupedDays[group].length==1){if(key!=''){key+=', ';}
key+=groupedDays[group][0];}
if(groupedDays[group].length==2){if(key!=''){key+=', ';}
key+=groupedDays[group][0]+', '+groupedDays[group][1];}
if(groupedDays[group].length>2){if(key!=''){key+=', ';}
key+=groupedDays[group][0]+' - '+groupedDays[group][groupedDays[group].length-1];}}}
key+=': ';_groupedDays[key]=_opened[days];}
var ordered=[];for(var index=0;index<weekdayOrder.length;++index){var weekday=weekdayOrder[index];for(var day in _groupedDays){var regexp=new RegExp('^'+weekday,'i')
if(regexp.test(day)){ordered.push(day+_groupedDays[day]);}}}
return ordered.join('<br>');}
self.preset=function(){return self['_preset'];}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.categories();if(App.isPhoneGap){var img=self.image.replace(/^.*\/|\.[^.]*$/g,'');self.img=App.imgServer+'630x280/'+img+'.jpg?crop=1';self.img64=App.imgServer+'596x596/'+img+'.jpg';}
if(typeof complete=='function'){complete.call(self);}}
self.load(id);}
App.cached.Restaurant={};;var Dish=function(id){this.type='Dish';this.id_var='id_dish';this.resource='dish';var self=this;$.extend(self,Orm);self.options=function(){return self.loadType('Option','options');}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.options();}
self.load(id);}
App.cached.Dish={};;var Option=function(id){this.type='Option';var self=this;self.optionPrice=function(options){var price=parseFloat(self.price);for(var x in self.prices){if(options.indexOf(self.prices[x].id_option_parent)!==-1){price+=parseFloat(self.prices[x].price);}}
return price;}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/option/'+id,function(json){for(x in json){self[x]=json[x];}});}}
App.cached.Option={};;var Category=function(id){this.type='Dish';var self=this;$.extend(self,Orm);self.dishes=function(){return self.loadType('Dish','dishes');}
self.locName=function(community){return(self.loc=='1'&&community&&community.name)?(' at '+community.name):'';}
self.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}
self.dishes();}else{App.request(App.service+'/category/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Category={};;var Notification=function(id){var self=this;$.extend(this,Orm);this.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/notification/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Notification={};;var Order=function(id){this.type='Order';this.id_var='id_order';this.resource='order';var self=this;$.extend(self,Orm);var complete=arguments[1]||null;self.loadError=arguments[2]||null;self.finished=function(data){for(x in data){self[x]=data[x];}
if(typeof complete==='function'){complete.call(self);}}
self.load(id);}
App.cached.Order={};;App.log={api:{url:'log'},type:{order:'order-js',account:'account-js',location:'location-js'}}
App.log.doLog=function(data,callback){var url=App.logService+App.log.api.url;var info={data:data};info.type=(data.type)?data.type:'log-js';console.debug(data.type,info);$.ajax({type:'POST',url:url,dataType:'json',data:info,success:function(json){if(callback){callback(json);}}});}
App.log.order=function(info,action){App.log.doLog({'type':App.log.type.order,'info':info,'action':action});}
App.log.account=function(info,action){App.log.doLog({'type':App.log.type.account,'info':info,'action':action});}
App.log.location=function(info,action){App.log.doLog({'type':App.log.type.location,'info':info,'action':action});};NGApp.controller('LegalCtrl',function($scope,$http){if(!App.isPhoneGap){$http.get(App.service+'legal').success(function(data){$scope.legal=data.data.replace('[email]','moc.nottubhcnurc@eybdoog'.split('').reverse().join(''));});}});NGApp.controller('HelpCtrl',function($scope,$http,$compile,MainNavigationService){$scope.legal=function(){MainNavigationService.link('/legal');}
if(!App.isPhoneGap){$http.get(App.service+'help').success(function(data){var help='moc.nottubhcnurc@sremotsucyppah'.split('').reverse().join('');var join='moc.nottubhcnurc@nioj'.split('').reverse().join('');$scope.help=data.data.replace('[email]','<a href="mailto:'+help+'">'+help+'</a>').replace('[joinemail]','<a href="mailto:'+join+'">'+join+'</a>')
$scope.help=$compile($scope.help)($scope);});}});NGApp.controller('HomeCtrl',function($scope,$http,$location,RestaurantsService,LocationService){var location=LocationService;if(!App.isPhoneGap){location.init();}
var restaurants=RestaurantsService;$location.path('/'+restaurants.permalink);return;});NGApp.controller('DefaultCtrl',function($scope,$http,$location,CommunityAliasService,RestaurantsService){var community=CommunityAliasService;community.route($location.path(),function(results,restaurant){if(results.alias){community.position.addLocation(new Location({address:results.alias.address(),entered:results.address,type:'alias',lat:results.alias.lat(),lon:results.alias.lon(),city:results.alias.city(),prep:results.alias.prep()}));var url='/'+RestaurantsService.permalink+(restaurant?'/'+restaurant:'')
$location.path(url);}},function(){$location.path('/location');});});NGApp.controller('RestaurantsCtrl',function($scope,$rootScope,$http,$location,$timeout,RestaurantsService,LocationService){$scope.restaurants=false;$scope.showMoreRestaurants=function(){var step=3;$scope.restaurantsToShow+=step;}
var location=LocationService;if(!location.initied){location.init();$location.path('/');return;}
var motivationText=['You are awesome','You are loved','You are beautiful','You\'re at the top of your game','You are rad'];$scope.motivationText=motivationText[Math.floor(Math.random()*motivationText.length)];var restaurants=RestaurantsService;$scope.mealItemClass=App.isAndroid()?'meal-food-android':'';var updateStatus=function(){updateRestaurantsStatus=$timeout(function(){$scope.restaurants=restaurants.getStatus();$rootScope.$safeApply();updateStatus();},1000*35);}
$scope.$on('$destroy',function(){RestaurantsService.forceGetStatus=true;try{$timeout.cancel(updateRestaurantsStatus);}catch(e){}});if(RestaurantsService.forceGetStatus){setTimeout(function(){$scope.restaurants=restaurants.getStatus();updateStatus();$rootScope.$safeApply();},1);}
$rootScope.$on('appResume',function(e,data){if($location.path()=='/'+RestaurantsService.permalink){$scope.restaurants=restaurants.getStatus();updateStatus();}});$scope.display=function($event){var restaurant=this.restaurant;restaurant.closesIn();if(!restaurant._open){$rootScope.$broadcast('restaurantClosedClick',restaurant);}else{var el=$($event.target).parents('.meal-item').find('.meal-item-content');var s=$(el).data('spinner');if(s){s.start();}
App.cache('Restaurant',restaurant.permalink,function(){App.go('/'+restaurants.permalink+'/'+restaurant.permalink);},function(){App.connectionError();s.stop();});}};var prep=restaurants.position.pos().prep();var city=restaurants.position.pos().city();restaurants.list(function(){App.profile.log('return from list');if(App.restaurantsPaging.enabled){$scope.restaurantsToShow=App.isMobile()?App.restaurantsPaging.mobile:App.restaurantsPaging.desktop;}else{$scope.restaurantsToShow=100;}
try{var slogan=App.slogan.slogan;var sloganReplace=(prep||'in')+' '+(city||'your area');sloganReplace=$.trim(sloganReplace);var tagline=App.tagline.tagline.replace('%s',sloganReplace);slogan=slogan.replace('%s',sloganReplace);}catch(e){console.log('Failed to load dynamic text',App.slogan,App.tagline,e);var slogan='';var tagline='';}
document.title=(city||'')+' Food Delivery | Order Food from '+(city||'Local')+' Restaurants | Crunchbutton';$scope.restaurants=restaurants.sort();App.profile.log('returned sorting');setTimeout(function(){updateStatus();},1000*60);$scope.slogan=slogan;$scope.tagline=tagline;App.profile.log('finished everything');if($scope.restaurants.length==4){$('.content').addClass('short-meal-list');}else{$('.content').removeClass('short-meal-list');}
$('.content').removeClass('smaller-width');},function(){$location.path('/location');});});NGApp.controller('CitiesCtrl',function($scope){$scope.topCommunities=App.topCommunities;});NGApp.controller('LocationCtrl',function($scope,$http,$location,$rootScope,RestaurantsService,LocationService,AccountService,PositionsService,RecommendRestaurantService){var account=AccountService;var restaurants=RestaurantsService;$scope.warningPlaceholder=false;$scope.isProcessing=false;$scope.isUser=account.user.has_auth;$scope.notUser=!account.user.has_auth;$scope.topCommunities=App.topCommunities;$scope.recommend=RecommendRestaurantService;$scope.location=LocationService;if(!App.isPhoneGap){$scope.location.init();}
document.title='Food Delivery | Crunchbutton';$scope.yourArea=$scope.location.position.pos().city()||'your area';$scope.locationError=false;$scope.openCity=function(city){$location.path('/'+city);}
$scope.resetFormLocation=function(){$scope.location.form.address='';$scope.locationError=false;$scope.warningPlaceholder=false;setTimeout(function(){$scope.focus('.location-address');},250);}
$scope.$watch('location.position.pos().city()',function(newValue,oldValue,scope){$scope.yourArea=$scope.location.position.pos().city()||'your area';});$scope.$on('locationError',function(e,data){spin.stop();var entered=$scope.location.position.pos().entered();var isStreet=$scope.location.position.pos().valid('order');if(isStreet&&!entered.match(new RegExp(/\d{5}(?:[-\s]\d{4})?/))){$('.location-address').val('').attr('placeholder','Please include a zip code');$scope.$broadcast('locationNotServed',true);}else{$scope.locationError=true;}});$rootScope.$on('NewLocationAdded',function(e,data){$scope.recommend.greetings=false;});$scope.$on('locationNotServed',function(e,data){spin.stop();var pos=PositionsService.pos();if(pos.type()=='user'){var entered=$scope.location.position.pos().entered();var isStreet=$scope.location.position.pos().valid('order');if(isStreet&&!entered.match(new RegExp(/\d{5}(?:[-\s]\d{4})?/))){$('.location-address').val('').attr('placeholder','Please include a zip code');}else{$('.location-address').val('').attr('placeholder','Please include a zip code or city name');}}else{$('.location-address').val('').attr('placeholder','Please enter an address or zip');}
$rootScope.locationPlaceholder=$('.location-address').attr('placeholder');$rootScope.warningPlaceholder=true;$scope.warningPlaceholder=true;if(!App.dialog.isOpen()){$scope.focus('.location-address');}});if($rootScope.locationPlaceholder){$('.location-address').val('').attr('placeholder',$rootScope.locationPlaceholder);}
if($rootScope.locationPlaceholder){$scope.warningPlaceholder=$rootScope.warningPlaceholder;}
$scope.$on('$destroy',function(){$rootScope.locationPlaceholder=false;$rootScope.warningPlaceholder=false;AccountService.forceDontReloadAfterAuth=false;});var proceed=function(){$location.path('/'+restaurants.permalink);$scope.location.form.address='';$scope.warningPlaceholder=false;$scope.isProcessing=false;if(!$scope.$$phase){$scope.$apply();}};$scope.letsEat=function(){spin.start();$scope.location.form.address=$.trim($scope.location.form.address);if($scope.location.form.address==''){$('.location-address').val('').attr('placeholder',$('<div>').html('&#10148; Please enter your address here').text());spin.stop();$scope.warningPlaceholder=true;if(!App.dialog.isOpen()){$scope.focus('.location-address');}}else{if($scope.isProcessing){setTimeout(function(){$scope.isProcessing=false;},2000);return;}
$scope.isProcessing=true;$scope.location.addVerify($scope.location.form.address,function(){restaurants.list(proceed,function(){$scope.$broadcast('locationError');$scope.isProcessing=false;});},function(){spin.stop();var oopsText=App.isPhoneGap?'Oops! Please enter an address':'&#9785; Oops! Please enter a street name, number, and city';$('.location-address').val('').attr('placeholder',$('<div>').html(oopsText).text());$scope.warningPlaceholder=true;$scope.focus('.location-address');$scope.isProcessing=false;if(!$scope.$$phase){$scope.$apply();}});}}
$scope.locEat=function(){var locSpin=$('.location-detect').data('spinner');var error=function(){$scope.$broadcast('locationNotServed');locSpin.stop();}
locSpin.start();$scope.location.getLocationByBrowser(function(loc){$scope.location.position.addLocation(loc);restaurants.list(proceed,error);},error);};var spin={start:function(){if(spin.obj){spin.obj.start();}},stop:function(){if(spin.obj){spin.obj.stop();}}};setTimeout(function(){spin.obj=$('.button-letseat-form').data('spinner');},500);});NGApp.controller('RestaurantCtrl',function($scope,$http,$routeParams,$rootScope,$timeout,RestaurantService,OrderService,CreditService,GiftCardService,PositionsService,MainNavigationService,CreditCardService){var order=OrderService;order.loaded=false;order.startStoreEntederInfo=false;$scope.order={};$scope.order.form=order.form;$scope.order.info=order.info;$scope.open=false;$scope.nothingInTheCartDesktop=App.AB.pluck('nothingInTheCartDesktop',App.config.ab.nothingInTheCartDesktop).line;$scope.nothingInTheCartMobile=App.AB.pluck('nothingInTheCartMobile',App.config.ab.nothingInTheCartMobile).line;$scope.order.creditCardChanged=function(){order._cardInfoHasChanged=true;};var creditCard=CreditCardService;var updateStatus=function(){updateRestaurantStatus=$timeout(function(){$scope.restaurant.closesIn();var open=$scope.restaurant._open;if($scope.open!=open){$scope.open=open;}
if(!$scope.$$phase){$scope.$apply();}
updateStatus();},1000*15);}
$scope.$on('$destroy',function(){$timeout.cancel(updateRestaurantStatus);});$rootScope.$on('appResume',function(e,data){updateStatus();});updateStatus();order.cart.setRestaurant($routeParams.id);MainNavigationService.order=$scope.order;$scope.order.updateTotal=function(){return order.updateTotal();}
$scope.order.subtotal=function(){return order.subtotal();}
$scope.order.total=function(){return order.total();}
$scope.order.submit=function(){return order.submit();}
$scope.order.cardInfoChanged=function(){return order.cardInfoChanged();}
$scope.order.toogleDelivery=function(type){return order.toogleDelivery(type);}
$scope.order.tooglePayment=function(type){return order.tooglePayment(type);}
$scope.order._years=function(){return order._years();}
$scope.order._months=function(){return order._months();}
$scope.order._tips=function(){return order._tips();}
$scope.showCreditPayment=function(){$scope.order.tooglePayment('card');$scope.order.showForm=true;$rootScope.closePopup();}
$scope.addressLetMeChangeIt=function(){$rootScope.closePopup();$scope.order.showForm=true;setTimeout(function(){$scope.focus('#pay-address');},450);}
$scope.addressPlaceAnyway=function(){$rootScope.closePopup();setTimeout(function(){order.submit(true);;},300);}
$scope.giftCardCreditPayment=function(){$rootScope.closePopup();$scope.order.tooglePayment('card');$scope.order.showForm=true;}
$scope.order.tipChanged=function(){return order.tipChanged();}
$rootScope.$on('orderProcessingError',function(e,data){order.showForm=true;$scope.order.showForm=order.showForm;});$scope.$on('orderLoaded',function(e,data){$scope.order.loaded=order.loaded;$scope.order.showForm=order.showForm;$scope.$watch('order.form',function(newValue,oldValue,scope){if(order.startStoreEntederInfo&&!order.account.user.id_user){var userEntered=angular.copy(order.form);userEntered.cardNumber='';$.totalStorage('userEntered',userEntered);}},true);GiftCardService.notes_field.lastValidation=false;$scope.checkGiftCard();});$scope.order.cart={};$scope.order.cart.add=function(item){return order.cart.add(item);}
$scope.order.cart.remove=function(item){return order.cart.remove(item);}
$scope.order.cart.customizeItem=function(option,item){return order.cart.customizeItem(option,item);}
$scope.order.cart.hasItems=function(){return order.cart.hasItems();}
$scope.$watch('order.cart.items',function(newValue,oldValue,scope){$scope.order.updateTotal();},true);$scope.user=order.account.user;$scope.AB={dollar:(App.config.ab&&App.config.ab.dollarSign=='show')?'$':'',restaurantPage:(App.config.ab&&App.config.ab.restaurantPage=='restaurant-page-noimage')?' restaurant-pic-wrapper-hidden':''};var giftcard=GiftCardService;$scope.giftcard={giftcards:{}};$scope.$on('giftCardUpdate',function(e,data){$scope.giftcard.giftcards.success=giftcard.notes_field.giftcards.success;$scope.giftcard.giftcards.error=giftcard.notes_field.giftcards.error;$scope.giftcard.value=giftcard.notes_field.value;$scope.giftcard.removed=giftcard.notes_field.removed;$scope.giftcard.hasGiftCards=giftcard.notes_field.hasGiftCards;$scope.giftcard.justOneGiftCardError=giftcard.notes_field.justOneGiftCardError;$scope.giftcard.hasValue=(parseFloat(giftcard.notes_field.value)>0);});$scope.checkGiftCard=function(){giftcard.notes_field.content=$scope.order.form.notes;giftcard.notes_field.start();}
var credit=CreditService;$scope.credit={hasValue:false};$scope.$on('creditChanged',function(e,data){$scope.credit.value=credit.value;$scope.credit.number=parseFloat(credit.value);$scope.credit.redeemed=credit.redeemed;$scope.order.updateTotal();if(parseFloat($scope.credit.value)>0){$scope.credit.hasValue=true;}else{$scope.credit.hasValue=false;}});$scope.$on('creditCardInfoChanged',function(e,data){$scope.order.creditCardChanged();});var restaurantService=RestaurantService;$scope.$on('restaurantLoaded',function(e,data){var community=data.community;$scope.restaurant=data.restaurant;order.restaurant=$scope.restaurant;MainNavigationService.restaurant=$scope.restaurant;$scope.restaurant.closesIn();$scope.open=$scope.restaurant._open;order.init();giftcard.notes_field.id_restaurant=$scope.restaurant.id_restaurant;giftcard.notes_field.restaurant_accepts=($scope.restaurant.giftcard>0);if(OrderService.account.user&&OrderService.account.user.id_user){credit.getCredit($scope.restaurant.id_restaurant);}
document.title=$scope.restaurant.name+' | Food Delivery | Order from '+(community.name?community.name:'Local')+' Restaurants | Crunchbutton';var position=PositionsService;var address=position.pos();if(address.type()=='user'&&address.valid('order')){if(order._useCompleteAddress){$scope.order.form.address=address.formatted();}else{$scope.order.form.address=address.entered();}}
App.scrollTop();$scope.order.cart.items=order.cart.getItems();$scope.ignoreGiftCardWithCashOrder=false;setTimeout(function(){$scope.checkGiftCard();},500);});$('.config-icon').addClass('config-icon-mobile-hide');$('.nav-back').addClass('nav-back-show');$('.content').removeClass('smaller-width');$('.content').removeClass('short-meal-list');restaurantService.init();});NGApp.controller('OrderCtrl',function($scope,$http,$location,$routeParams,$filter,AccountService,AccountModalService,OrderViewService,ReferralService){if(!AccountService.isLogged()){$location.path('/');return;}
$scope.account={user:AccountService.user,has_auth:AccountService.user.has_auth};$scope.modal={signupOpen:AccountModalService.signupOpen};$scope.order={};$scope.restaurant={};OrderViewService.load();$scope.isMobile=App.isMobile();$scope.facebook=function(){OrderViewService.facebook.postOrder();}
$scope.referral={invite_url:ReferralService.invite_url,value:ReferralService.value,enabled:ReferralService.enabled}
if(!ReferralService.invite_url){ReferralService.getStatus();}
$scope.$on('referralStatusLoaded',function(e,data){$scope.referral.invite_url=ReferralService.invite_url;$scope.referral.invite_url_cleared=$scope.referral.value=ReferralService.value;$scope.referral.enabled=ReferralService.enabled;});$scope.$on('OrderViewLoadedOrder',function(e,order){$scope.order=order;$scope.$safeApply();});$scope.referral.cleaned_url=function(){return ReferralService.cleaned_url();}});NGApp.controller('OrdersCtrl',function($scope,$http,$location,AccountService,AccountSignOut,OrdersService,AccountModalService,ReferralService,FacebookService){if(!AccountService.isLogged()){$location.path('/');return;}
$scope.account=AccountService;$scope.signout=AccountSignOut.do;$scope.facebook=AccountModalService.facebookOpen;$scope.orders={};$scope.orders.restaurant=OrdersService.restaurant;$scope.orders.receipt=OrdersService.receipt;if(OrdersService.reload){OrdersService.load();}else{$scope.orders.list=OrdersService.list;}
$scope.$on('OrdersLoaded',function(e,data){$scope.orders.list=OrdersService.list;});$scope.referral={invite_url:ReferralService.invite_url,value:ReferralService.value,limit:ReferralService.limit,invites:ReferralService.invites,enabled:ReferralService.enabled}
$scope.referral.cleaned_url=function(){return ReferralService.cleaned_url();}
if(!ReferralService.invite_url){ReferralService.getStatus();}
$scope.$on('referralStatusLoaded',function(e,data){$scope.referral.invites=ReferralService.invites;$scope.referral.limit=ReferralService.limit;$scope.referral.invite_url=ReferralService.invite_url;$scope.referral.value=ReferralService.value;$scope.referral.enabled=ReferralService.enabled;});$scope.referral.facebook=function(){FacebookService.postInvite($scope.referral.invite_url);}
$scope.referral.twitter=function(){window.open('https://twitter.com/intent/tweet?url='+$scope.referral.invite_url+'&text=#nom','_system');}});NGApp.controller('GiftcardCtrl',function($scope,$location,GiftCardService){setTimeout(function(){GiftCardService.open();},300);});NGApp.controller('AccountModalHeaderCtrl',function($scope,$http,AccountModalService){$scope.modal=AccountModalService;});NGApp.controller('AccountFacebookCtrl',function($scope,$http,AccountModalService,AccountService,AccountHelpService){$scope.modal=AccountModalService;});NGApp.controller('AccountSignInCtrl',function($scope,$http,AccountModalService,AccountService,AccountHelpService){$scope.modal=AccountModalService;$scope.account=AccountService;$scope.help=AccountHelpService;});NGApp.controller('AccountSignUpCtrl',function($scope,$http,AccountModalService,AccountService){$scope.modal=AccountModalService;$scope.account=AccountService;$scope.$watch('account.user',function(newValue,oldValue,scope){$scope.account.user=newValue;if(newValue){$scope.modal.header=false;}});});NGApp.controller('AccountResetCtrl',function($scope,$http,$location,AccountResetService,AccountModalService){if($location.path().indexOf('reset')>=0){$scope.reset=AccountResetService;AccountModalService.resetOpen();$location.path('/');}});NGApp.controller('GiftCardCtrl',function($scope,$http,$rootScope,GiftCardService){$scope.giftcard={};$scope.user=GiftCardService.account.user;$scope.modal=GiftCardService.modal;$scope.giftcard.value=GiftCardService.value;$rootScope.$on('GiftCardProcessed',function(e,data){$scope.user=GiftCardService.account.user;$scope.giftcard.value=GiftCardService.value;$scope.modal=GiftCardService.modal;});});NGApp.controller('MainHeaderCtrl',function($scope,MainNavigationService,OrderService){$scope.navigation=MainNavigationService;$scope.order=OrderService;$scope.$watch('navigation.page',function(newValue,oldValue,scope){$scope.navigation.control();});});NGApp.controller('RecommendRestaurantCtrl',function($scope,$http,$rootScope,RecommendRestaurantService,AccountService,AccountModalService){$scope.recommend=RecommendRestaurantService;$scope.account=AccountService;$scope.modal=AccountModalService;$scope.signupOpen=function(){AccountService.forceDontReloadAfterAuth=true;AccountModalService.signupOpen();}
$rootScope.$on('userCreated',function(e,data){RecommendRestaurantService.relateUser();});});NGApp.controller('RestaurantClosedCtrl',function($scope,$rootScope){$rootScope.$on('restaurantClosedClick',function(e,r){if($scope.$$phase){$scope.restaurant=r;App.dialog.show('.restaurant-closed-container');}else{$rootScope.$apply(function(scope){scope.restaurant=r;App.dialog.show('.restaurant-closed-container');});}});});NGApp.controller('RecommendFoodCtrl',function($scope,$http,RecommendFoodService){$scope.recommend=RecommendFoodService;});NGApp.controller('SupportCtrl',function($scope,$http,SupportService){$scope.support=SupportService;});NGApp.controller('SideMenuCtrl',function(){});NGApp.controller('NotificationAlertCtrl',function($scope,$rootScope){$rootScope.$on('notificationAlert',function(e,title,message){if($scope.$$phase){$scope.title=title;$scope.message=message;App.dialog.show('.notification-alert-container');}else{$rootScope.$apply(function(scope){scope.title=title;scope.message=message;App.dialog.show('.notification-alert-container');});}});});NGApp.controller('InviteCtrl',function($scope,$routeParams,$location,ReferralService){$.cookie('referral',$routeParams.id);$location.path('/');});NGApp.controller('NoInternetCtrl',function($scope){$.cookie('referral',$routeParams.id);$location.path('/');});;NGApp.filter('formatPhone',function(){return function(input){if(input!=null){input=input.replace(/^0|^1/,'');input=input.replace(/[^\d]*/gi,'');input=input.substr(0,10);if(input.length>=7){input=input.replace(/(\d{3})(\d{3})(.*)/,"$1-$2-$3");}else if(input.length>=4){input=input.replace(/(\d{3})(.*)/,"$1-$2");}}
return input;};});NGApp.filter('formatPrice',function(){return function(input){if(input!=null){input=parseFloat(input).toFixed(2)}
return input;};});NGApp.filter('nl2br',function(){return function(input){if(input!=null){return input.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,'$1<br/>$2');}
return input;};});NGApp.filter('callPhone',function(){return function(input){if(input!=null){if(App.isMobile()){return'<a href="tel:'+App.phone.format(phone).replace(/\-/g,'')+'">'+phone+'</a>';}}
return input;};});NGApp.filter('iif',function(){return function(input,trueValue,falseValue){return input?trueValue:falseValue;};});;NGApp.directive('facebookSigninButton',function(AccountFacebookService){return{restrict:'A',templateUrl:'assets/view/account.facebook.html',scope:{title:'@'},controller:function($scope){$scope.facebook=AccountFacebookService;}};;});NGApp.directive('restaurantIsClosed',function(){return{restrict:'A',templateUrl:'assets/view/restaurant.closed.inline.html'};;});NGApp.directive('preLoadImage',function(){return function(scope,element,attrs){if(attrs.preLoad){var image=new Image();image.src=attrs.preLoad;}};});NGApp.directive('suggestionToolTip',function(){return{restrict:'A',templateUrl:'assets/view/restaurant.suggestion.tooltip.html',scope:{type:'@'},controller:function($scope){$scope.show=false;}};;});NGApp.directive('ngEnter',function(){return function(scope,element,attrs){element.bind('keydown keypress',function(event){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.ngEnter);});event.preventDefault();}});};});NGApp.directive('ngClickSelectAll',function(){return{restrict:'A',link:function(scope,element,attrs){element.bind('click',function(){element.select();});}};});NGApp.directive('customCheckbox',function(){if(!App.isMobile()){return{restrict:'E'};}
return{restrict:'A',require:'ngModel',replace:true,template:'<span class="custom-checkbox icon-check-sign"></span>',link:function(scope,elem,attrs,ctrl){var label=angular.element('label[for="'+attrs.id+'"]');label.bind('click',function(){scope.$apply(function(){elem.toggleClass('checked');ctrl.$setViewValue(elem.hasClass('checked'));});});elem.bind('click',function(){scope.$apply(function(){elem.toggleClass('checked');ctrl.$setViewValue(elem.hasClass('checked'));});});ctrl.$render=function(){if(!elem.hasClass('checked')&&ctrl.$viewValue){elem.addClass('checked');}else if(elem.hasClass('checked')&&!ctrl.$viewValue){elem.removeClass('checked');}};}}});NGApp.directive('ngBlur',function(){return{restrict:'A',link:function(scope,element,attrs){element.bind('blur',function(){scope.$apply(attrs.ngBlur);});}};});NGApp.directive('ngInstant',function(){return function(scope,element,attrs){element.bind(App.isMobile()?'touchstart':'click',function(e){scope.$apply(attrs['ngInstant'],element);e.preventDefault();e.stopPropagation();});};});NGApp.directive('ngKeyDown',function(){return{restrict:'A',link:function(scope,elem,attr){angular.element(elem).bind('keydown',function(evt){scope.$eval(attr.ngKeyDown);});}};});NGApp.directive('ngKeyUp',function(){return{restrict:'A',link:function(scope,elem,attr){angular.element(elem).bind('keyup',function(evt){scope.$eval(attr.ngKeyUp);});}};});NGApp.directive('ngSpinner',function(){return{restrict:'A',link:function(scope,elem,attr){setTimeout(function(){elem.data('spinner',Ladda.create(elem.get(0)));},1);}};});NGApp.directive('ngSimulateReadOnly',function(){return{restrict:'A',link:function(scope,elem,attr){if(App.isMobile()||App.isPhoneGap){angular.element(elem).bind('click keyup keydown change focus',function(evt){elem.val(attr.ngSimulateReadOnly);elem.select();});}else{elem.attr('readonly','readonly');angular.element(elem).bind('click',function(evt){elem.select();});}}};});NGApp.directive('ngFormatPhone',function($filter){return function(scope,element,attrs){element.bind('keyup',function(event){element.val($filter('formatPhone')(element.val()));});};});;NGApp.factory('AccountService',function($http,$rootScope,PositionsService){var service={callback:false,user:false,error:{signin:false,signup:false},form:{email:'',password:''}};service.reset=function(){service.form.email='';service.form.password='';}
service.checkUser=function(){if(service.isLogged()){service.user=App.config.user;$rootScope.$safeApply();}else{service.updateInfo();}}
service.isLogged=function(){if(App.config.user&&App.config.user.id_user!=''){service.user=App.config.user;}
if(service.user){if(service.user.id_user!=''){return true;}}
return false;}
service.signin=function(){if(!service.isValidEmailPhone()){App.alert('Please enter a valid email or phone.',null,true);$rootScope.focus('.signin-email');return;}
if(!service.isValidPassword()){App.alert('Please enter your password.',null,true);$rootScope.focus('.signin-password');return;}
service.purify();service.error.signin=false;var url=App.service+'user/auth';$http({method:'POST',url:url,data:$.param({'email':service.form.email,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){App.log.account({'error':data.error},'sign in error');service.error.signin=true;}else{service.user=data;service.updateInfo();if(service.callback){service.callback();service.callback=false;}else{$.magnificPopup.close();$rootScope.$broadcast('userAuth',service.user);}}});}
service.signup=function(){if(!service.isValidEmailPhone()){App.alert('Please enter a valid email or phone.',null,true);$rootScope.focus('.signup-email');return;}
if(!service.isValidPassword()){App.alert('Please enter a password.',null,true);$rootScope.focus('.signup-password');return;}
service.purify();service.error.signin=false;var url=App.service+'user/create/local';$http({method:'POST',url:url,data:$.param({'email':service.form.email,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='user exists'){service.error.signup=true;}
App.log.account({'error':data.error,'login':service.form.email},'sign up error');}else{service.updateInfo();service.user=data;if(service.callback){service.callback();service.callback=false;}else{$.magnificPopup.close();$rootScope.$broadcast('userCreated',service.user);$rootScope.$broadcast('userAuth',service.user);}}});}
service.updateInfo=function(data,callback){var url=App.service+'user';$http({method:'GET',url:url}).success(function(data){if(data.id_user!=''){service.user=data;App.config.user=data;$rootScope.$safeApply();}
if(callback){callback();}});}
service.purify=function(){service.form.email=$.trim(service.form.email);service.form.password=$.trim(service.form.password);}
service.isValidEmailPhone=function(){if(!App.phone.validate(service.form.email)){if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(service.form.email)){return false}}
return true;}
service.isValidPassword=function(){if(service.form.password){return service.form.password!='';}
return false;}
return service;});NGApp.factory('AccountHelpService',function($http,$rootScope,AccountService,AccountModalService){var service={visible:false,error:false,success:{visible:false,facebook:{visible:false}}};var account=AccountService;var modal=AccountModalService;service.show=function(show){service.visible=show;modal.header=!show;if(show){service.reset();$rootScope.focus('.help-email');}else{$rootScope.focus('.signin-email');}}
service.reset=function(){service.error=false;service.success.visible=false;service.success.facebook.visible=false;}
service.sendForm=function(){if(!account.isValidEmailPhone()){App.alert('Please enter a valid email or phone.',null,true);$rootScope.focus('.help-email');return;}
var url=App.service+'user/reset';$http({method:'POST',url:url,data:$.param({'email':account.form.email}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='user is not registred'){service.error=true;$rootScope.focus('.help-email');}}else{if(data.success='success'){service.success.visible=true;service.error=false;if(data.userHasFacebookAuth){help.success.facebook.visible=true;}}}});}
return service;});NGApp.factory('AccountModalService',function($http,$rootScope,FacebookService){var service={header:true,signin:true,signup:false,facebookLogin:false};service.facebook=FacebookService;service.signinOpen=function(){service.header=true;App.dialog.show('.account-container');service.toggleSignForm('signin');}
service.signupOpen=function(){service.header=true;App.dialog.show('.account-container');service.toggleSignForm('signup');}
service.facebookOpen=function(){service.header=false;App.dialog.show('.account-container');service.toggleSignForm('facebook');}
service.resetOpen=function(){App.dialog.show('.account-reset-container');}
service.toggleSignForm=function(form){service.facebook.wait=false;service.signin=(form=='signin');service.signup=(form=='signup');service.facebookLogin=(form=='facebook');if(service.signin){if(!App.iOS()){$rootScope.focus('.signin-email');}}
if(service.signup){if(!App.iOS()){$rootScope.focus('.signup-email');}}}
service.headerIsVisible=function(){return service.header.visible;}
return service;});NGApp.factory('AccountFacebookService',function($http,FacebookService){var service={};service.facebook=FacebookService;service.account=service.facebook.account;service.auth=function(){service.facebook.wait=true;FB.login(service.facebook.processStatus,{scope:App.facebookScope});}
service.signout=function(callback){service.facebook.signout(callback);}
return service;});NGApp.factory('AccountSignOut',function($http,$rootScope,$location,AccountFacebookService,AccountService,MainNavigationService){var service={};service.facebook=AccountFacebookService;service.signoutConfirmed=function(button){if(button!=1){return;}
$.each(['token','location','PHPSESSID','fbtoken','userEntered'],function(index,value){$.totalStorage(value,null);});var signout=function(){$http.get(App.service+'logout').success(function(data){$http.get(App.service+'config').success(function(data){$rootScope.$broadcast('userAuth',data.user);App.processConfig(data);});MainNavigationService.link('/location');}).error(function(){console.debug('couldnt log out',arguments)});AccountService.reset();};if(service.facebook.facebook.logged||service.facebook.facebook.account.user.facebook){try{service.facebook.signout();}catch(e){console.log('e',e);}
signout();}else{signout();}}
service.do=function(){if(App.confirm('Confirm sign out?','Crunchbutton',service.signoutConfirmed)){service.signoutConfirmed(1);}}
return service;});NGApp.factory('AccountResetService',function($http,$location){var service={step:1,form:{code:'',password:''},success:false,error:false};service.form.code=$location.path().replace('/reset','');service.form.code=service.form.code.replace('/','');service.validateCode=function(){service.form.code=$.trim(service.form.code);if(service.form.code==''){service.error='empty';$('#account-reset-code').focus();return;}
var url=App.service+'user/code-validate';$http({method:'POST',url:url,data:$.param({'code':service.form.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='invalid code'){service.error='invalid';}
if(data.error=='expired code'){service.error='expired';}
$('#account-reset-code').focus();return;}else{if(data.success='valid code'){service.step=2;service.error=false;}}});}
service.changePassword=function(){service.form.password=$.trim(service.form.password);if(service.form.password==''){service.error='empty';$('#account-reset-password').focus();return;}
var url=App.service+'user/change-password';$http({method:'POST',url:url,data:$.param({'code':service.form.code,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){service.error='invalid';service.step=1;return;}else{if(data.success='password changed'){service.success=true;}}});}
return service;});;NGApp.factory('MainNavigationService',function($http,$location,$rootScope,$route,AccountModalService,RestaurantsService,OrderViewService){var service={page:'',buttons:{location:false,menu:true}};service.menu=App.toggleMenu;service.modal=AccountModalService;service.home=function(){if(App.isPhoneGap||App.isMobile()){service.menu();}else{service.link();}}
service.goToRestaurants=function(){return service.link(RestaurantsService.permalink);}
service.link=function(path){$location.path(path||'/');App.snap.close();}
service.signin=function(){service.modal.signinOpen();}
service.control=function(){switch(service.page){case'restaurant':case'order':service.buttons.location=true;service.buttons.back=true;service.buttons.menu=false;if(OrderViewService.newOrder){service.buttons.back=false;service.buttons.menu=true;}
break;default:service.buttons.back=false;service.buttons.location=(service.page!='location');service.buttons.menu=true;break;}}
return service;});;NGApp.factory('RestaurantsService',function($http,$rootScope,PositionsService){var service={permalink:'food-delivery',forceLoad:true,forceGetStatus:false};var restaurants=false;service.reset=function(){restaurants=false;}
service.getRestaurants=function(){return restaurants;}
service.position=PositionsService;service.sort=function(){App.profile.log('start sort');var list=restaurants;for(var x in list){list[x]._short_description=(list[x].short_description||('Top Order: '+(list[x].top_name?(list[x].top_name||list[x].top_name):'')));};list.sort(sort_by({name:'_open',reverse:true},{name:'delivery',reverse:true},{name:'_weight',primer:parseInt,reverse:true}));App.profile.log('end sort');restaurants=list;return restaurants;}
service.getStatus=function(){App.profile.log('start status');var list=restaurants;for(var x in list){App.profile.log('start calc open');App.profile.log('end calc open');list[x].closesIn();if(!list[x]._open||list[x]._closesIn==0){list[x]._tag='closed';}else{if(list[x].delivery!='1'){list[x]._tag='takeout';}else{if(list[x]._closesIn<=list[x]._minimumTime&&list[x]._closesIn>0){list[x]._tag='closing';}}}
list[x]._short_description=(list[x].short_description||('Top Order: '+(list[x].top_name?(list[x].top_name||list[x].top_name):'')));};App.profile.log('end status');restaurants=list;return restaurants;}
service.list=function(success,error){if(!service.position.pos().valid('restaurants')){if(error){error();}
return false;}
App.profile.log('start list');if(restaurants===false||service.forceLoad){var url=App.service+'restaurants?lat='+service.position.pos().lat()+'&lon='+service.position.pos().lon()+'&range='+(service.position.range||2);service.forceGetStatus=false;$http.get(url,{cache:false}).success(function(data){App.profile.log('got list');var list=[];if(typeof data.restaurants=='undefined'||data.restaurants.length==0){if(error){error();return false;}}else{for(var x in data.restaurants){list[list.length]=new Restaurant(data.restaurants[x]);}
restaurants=list;if(success){success(list);}
return list;}});service.forceLoad=false;}else{if(success){success(restaurants);}
return restaurants;}}
$rootScope.$on('NewLocationAdded',function(e,data){service.forceLoad=true;});return service;});NGApp.factory('CommunityService',function($http){var service={};service.getById=function(id){for(x in App.communities){if(App.communities[x].id_community==id){return App.communities[x];}}
return false;}
return service;});NGApp.factory('RestaurantService',function($http,$routeParams,$rootScope,CommunityService){var service={};service.init=function(){App.cache('Restaurant',$routeParams.id,function(){var restaurant=this;var community=CommunityService.getById(restaurant.id_community);$rootScope.$broadcast('restaurantLoaded',{restaurant:restaurant,community:community});});}
return service;});;NGApp.factory('CommunityAliasService',function(PositionsService){var service={};service.position=PositionsService;service.route=function(id,success,error){var parts=id.toLowerCase().split('/');var alias=false;var restaurant=false;for(x in parts){if(parts[x]!=''){if(App.aliases[parts[x]]){alias=App.aliases[parts[x]];}else{restaurant=parts[x];}}}
success=success||function(){};error=error||function(){};if(alias){var loc=App.locations[alias.id_community];if(loc.loc_lat&&loc.loc_lon){var res=new Location({lat:loc.loc_lat,lon:loc.loc_lon,type:'alias',verified:true,prep:alias.prep,city:alias.name_alt,address:alias.name_alt});success({alias:res},restaurant);return;}}
error();};return service;});;NGApp.factory('RecommendRestaurantService',function($http,PositionsService,AccountService){var service={form:{restaurant:''},greetings:false};service.position=PositionsService;service.account=AccountService;var recommendations=[];service.addRecommendation=function(id){recommendations.push(id);}
service.send=function(){if(service.form.restaurant==''){App.alert("Please enter the restaurant\'s name.");$('.recommend-restaurant').focus();return;}
var pos=service.position.pos();var content='Address entered: '+pos.entered()+'\n'+'Address reverse: '+pos.address()+'\n'+'City: '+pos.city()+'\n'+'Region: '+pos.region()+'\n'+'Lat: '+pos.lat()+'\n'+'Lon: '+pos.lon();var url=App.service+'suggestion/restaurant';$http({method:'POST',url:url,data:$.param({name:service.form.restaurant,content:content}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.greetings=true;if(!service.account.user.id_user){service.addRecommendation(data.id_suggestion);}
service.form.restaurant='';});}
service.getRecommendations=function(){if(recommendations.length>0){return recommendations;}
return false;}
service.relateUser=function(){if(service.getRecommendations()&&service.account.user.id_user){var url=App.service+'suggestion/relateuser';$.each(recommendations,function(index,value){var id_suggestion=value;$http({method:'POST',url:url,data:$.param({id_suggestion:id_suggestion,id_user:service.account.user.id_user}),headers:{'Content-Type':'application/x-www-form-urlencoded'}});});recommendations=false;}}
return service;});NGApp.factory('RecommendFoodService',function($http,$routeParams){var service={thanks:false,isSending:false,modal:{},form:{name:''}};service.reset=function(){service.thanks=false;service.isSending=false;service.form.name='';}
service.modal.open=function(){service.reset();App.dialog.show('.suggest-food-container');};service.send=function(){service.form.name=$.trim(service.form.name);if(service.form.name==''){App.alert('Please enter a suggestion.');$('#suggestion-name').focus();return;}
service.isSending=true;var url=App.service+'suggestion/new';$http({method:'POST',url:url,data:$.param({restaurant:$routeParams.id,name:service.form.name}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.thanks=true;service.isSending=false;});}
return service;});;NGApp.factory('SupportService',function($http,AccountService){var service={minimized:true,maximized:false,thanks:false,form:{}};service.account=AccountService;service.form.name=angular.copy(service.account.user.name);service.form.phone=angular.copy(service.account.user.phone);service.form.message='';service.toggle=function(){service.minimized=!service.minimized;service.maximized=!service.maximized;if(service.maximized){$('.support-container').addClass('support-container-maximized');service.reset();}else{$('.support-container').removeClass('support-container-maximized');}}
service.reset=function(){service.form.message='';service.thanks=false;}
service.send=function(){service.purify();if(service.form.name==''){App.alert('Please enter your name.');$('input[name=support-name]').focus();return;}
if(service.form.phone==''){App.alert('Please enter your phone.');$('input[name=support-phone]').focus();return;}
if(!App.phone.validate(service.form.phone)){App.alert('Please enter a valid phone.');$('input[name=support-phone]').focus();return;}
if(service.form.message==''){App.alert('Please enter the message.');$('textarea[name=support-message]').focus();return;}
if(!service.isSending){service.isSending=true;var url=App.service+'support/sms';$http({method:'POST',url:url,data:$.param({name:service.form.name,phone:service.form.phone,message:service.form.message}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.thanks=true;service.isSending=false;});}}
service.purify=function(){service.form.name=$.trim(service.form.name);service.form.phone=$.trim(service.form.phone);service.form.message=$.trim(service.form.message);}
return service;});;NGApp.factory('OrderService',function($http,$location,$rootScope,$filter,AccountService,CartService,LocationService,CreditService,GiftCardService,OrderViewService){var service={};service.location=LocationService;service.account=AccountService;service.cart=CartService;service.giftcard=GiftCardService;service.credit=CreditService;service.restaurant={};service.startStoreEntederInfo=false;$rootScope.$on('userAuth',function(e,data){service.account=AccountService;service.showForm=true;});service._previousTip=0;service.form={delivery_type:'delivery',pay_type:'card',make_default:true};service.showForm=true;service.loaded=false;service.info={dollarSign:'',breakdownDescription:'',extraCharges:'',deliveryMinDiff:'',cartSummary:'',totalText:'',creditLeft:''}
service.toogleDelivery=function(type){if(type!=service.form.delivery_type){service.form.delivery_type=type;if(service.form.delivery_type=='takeout'){service.form.tip=0;}
service.updateTotal();}}
service.tooglePayment=function(type){if(type!=service.form.pay_type){service.form.pay_type=type;service.updateTotal();}}
service.init=function(){service.location.loadRestaurantsPage=false;service.location.init();if(App.config.ab&&App.config.ab.dollarSign=='show'){service.info.dollarSign='$';}
if(service.account.user&&service.account.user.last_tip){var tip=service.account.user.last_tip;}else{var tip='autotip';}
service._deliveryAddressOk=false;service._tipHasChanged=false;service._cardInfoHasChanged=false;service._crunchSoundPlayded=false;service._useRestaurantBoundingBox=false;service._useCompleteAddress=false;service._completeAddressWithZipCode=true;service.form.pay_type=(service.account.user&&service.account.user.pay_type)?service.account.user.pay_type:'card';if(service.restaurant.credit!=1&&service.form.pay_type=='card'){service.form.pay_type='cash';}
if(service.restaurant.cash!=1&&service.form.pay_type=='cash'){service.form.pay_type='card';}
service.form.delivery_type=(service.account.user&&service.account.user.presets&&service.account.user.presets[service.restaurant.id_restaurant])?service.account.user.presets[service.restaurant.id_restaurant].delivery_type:'delivery';if(service.restaurant.delivery!=1){service.form.delivery_type='takeout';}
if(service.restaurant.takeout!=1&&service.form.delivery_type=='takeout'){service.form.delivery_type='delivery';}
service.form.autotip=0;service.form.tip=service._lastTipNormalize(tip);service.form.name=service.account.user.name;service.form.phone=$filter('formatPhone')(service.account.user.phone);service.form.address=service.account.user.address;service.form.notes=(service.account.user&&service.account.user.presets&&service.account.user.presets[service.restaurant.id_restaurant]&&service.account.user.presets[service.restaurant.id_restaurant].notes)?service.account.user.presets[service.restaurant.id_restaurant].notes:'';if(service.form.delivery_type=='takeout'){service.form.tip=0;}
if(service.giftcard.code){service.form.notes+=' '+service.giftcard.code;}
service.form.cardNumber=service.account.user.card;service.form.cardMonth=(service.account.user.card_exp_month)?service.account.user.card_exp_month:'';service.form.cardYear=(service.account.user.card_exp_year)?service.account.user.card_exp_year:'';service.updateTotal();if(!service.account.user.id_user){var userEntered=$.totalStorage('userEntered');if(userEntered){service.form.name=(userEntered.name&&userEntered.name!=''?userEntered.name:service.form.name);service.form.phone=$filter('formatPhone')((userEntered.phone&&userEntered.phone!=''?userEntered.phone:service.form.phone));service.form.address=(userEntered.address&&userEntered.address!=''?userEntered.address:service.form.address);service.form.notes=(userEntered.notes&&userEntered.notes!=''?userEntered.notes:service.form.notes);service.form.delivery_type=(userEntered.delivery_type&&userEntered.delivery_type!=''?userEntered.delivery_type:service.form.delivery_type);service.form.pay_type=(userEntered.pay_type&&userEntered.pay_type!=''?userEntered.pay_type:service.form.pay_type);service.form.cardMonth=(userEntered.cardMonth&&userEntered.cardMonth!=''?userEntered.cardMonth:service.form.cardMonth);service.form.cardYear=(userEntered.cardYear&&userEntered.cardYear!=''?userEntered.cardYear:service.form.cardYear);if(userEntered.tip&&userEntered.tip!=''){var _tip=userEntered.tip;setTimeout(function(){service.form.tip=_tip;service.tipChanged();service.updateTotal();},10);}else{service.updateTotal();}}
service.startStoreEntederInfo=true;}
if(service.account.user&&(service.form.delivery_type=='takeout'||(service.form.delivery_type=='delivery'&&service.account.user.address))){service.showForm=false;}else{service.showForm=true;}
if(service.cart.hasItems()){service.reloadOrder();}else if(service.account.user&&service.account.user.presets&&service.account.user.presets[service.restaurant.id_restaurant]){try{service.loadOrder(service.account.user.presets[service.restaurant.id_restaurant]);}catch(e){if(service.restaurant.preset){service.loadOrder(service.restaurant.preset());}}}else{if(service.restaurant.preset){service.loadOrder(service.restaurant.preset());}}
service.loaded=true;$rootScope.$broadcast('orderLoaded',true);}
service.reloadOrder=function(){var cart=service.cart.getCart();service.cart.reset()
service.loadFlatOrder(cart);}
service.loadFlatOrder=function(cart){for(var x in cart){service.cart.add(cart[x].id,{options:cart[x].options?cart[x].options:[]});}}
service.loadOrder=function(order){try{if(order){var dishes=order['_dishes'];for(var x in dishes){var options=[];for(var xx in dishes[x]['_options']){options[options.length]=dishes[x]['_options'][xx].id_option;}
if(App.cached.Dish[dishes[x].id_dish]!=undefined){service.cart.add(dishes[x].id_dish,{options:options});}}}}catch(e){console.log(e.stack);}}
service.extraChargesText=function(breakdown){var elements=[];var text='';if(breakdown.delivery){elements.push(service.info.dollarSign+breakdown.delivery.toFixed(2)+' delivery');}
if(breakdown.fee){elements.push(service.info.dollarSign+breakdown.fee.toFixed(2)+' fee');}
if(breakdown.taxes){elements.push(service.info.dollarSign+breakdown.taxes.toFixed(2)+' taxes');}
if(breakdown.tip&&breakdown.tip>0){elements.push(service.info.dollarSign+breakdown.tip+' tip');}
if(elements.length){if(elements.length>2){var lastOne=elements.pop();var elements=[elements.join(', ')];elements.push(lastOne);}
var text=elements.join(' & ');}
return text;}
service.subtotal=function(){return service.cart.subtotal();}
service._breackDownDelivery=function(){var delivery=0;if(service.restaurant.delivery_fee&&service.form.delivery_type=='delivery'){delivery=parseFloat(service.restaurant.delivery_fee);}
delivery=App.ceil(delivery);return delivery;}
service._breackDownFee=function(feeTotal){var fee=0;if(service.restaurant.fee_customer){fee=(feeTotal*(parseFloat(service.restaurant.fee_customer)/100));}
fee=App.ceil(fee);return fee;}
service._breackDownTaxes=function(feeTotal){var taxes=(feeTotal*(service.restaurant.tax/100));taxes=App.ceil(taxes);return taxes;}
service._breakdownTip=function(total){var tip=0;if(service.form.pay_type=='card'){if(service.form.tip==='autotip'){return parseFloat(service.form.autotip);}
tip=(total*(service.form.tip/100));}
tip=App.ceil(tip);return tip;}
service.total=function(){var
total=0,dish,options,feeTotal=0,totalItems=0,finalAmount=0;var breakdown=this.totalbreakdown();total=breakdown.subtotal;feeTotal=total;feeTotal+=breakdown.delivery;feeTotal+=breakdown.fee;finalAmount=feeTotal+breakdown.taxes;finalAmount+=this._breakdownTip(total);return App.ceil(finalAmount).toFixed(2);}
service.charged=function(){var finalAmount=this.total();var credit=parseFloat(service.credit.value);if(service.form.pay_type=='card'&&credit){finalAmount=finalAmount-credit;if(finalAmount<0){finalAmount=0;}}
return App.ceil(finalAmount).toFixed(2);}
service.totalbreakdown=function(){var elements={};var total=this.subtotal();var feeTotal=total;elements['subtotal']=this.subtotal();elements['delivery']=this._breackDownDelivery();feeTotal+=elements['delivery'];elements['fee']=this._breackDownFee(feeTotal);feeTotal+=elements['fee'];elements['taxes']=this._breackDownTaxes(feeTotal);elements['tip']=this._breakdownTip(total);return elements;}
service.submit=function(forceAddressOk){if(forceAddressOk){service._deliveryAddressOk=true;}else{service._deliveryAddressOk=false;}
service.processOrder();}
service.errors=function(errors){var error='';for(var x in errors){error+='<li><i class="icon-li icon-warning-sign"></i>'+errors[x]+'</li>';}
App.alert('<ul class="icons-ul">'+error+'</ul>');}
service.processOrder=function(){if(App.busy.isBusy()){return;}
App.busy.makeBusy();if(service.form.address&&service.form.address!=''){service.form.address=service.location.ordinalReplace(service.form.address);}
var order={address:service.form.address,phone:service.form.phone,name:service.form.name,cart:service.cart.getCart(),pay_type:service.form.pay_type,delivery_type:service.form.delivery_type,restaurant:service.restaurant.id,make_default:service.form.make_default,notes:service.form.notes,lat:service.location.position.pos().lat(),lon:service.location.position.pos().lon()};if(order.pay_type=='card'){order.tip=service.form.tip;order.autotip_value=service.form.autotip;}
var displayErrors=function(errors){if(!$.isEmptyObject(errors)){$('body').scrollTop($('.payment-form').position().top-80);service.errors(errors);App.busy.unBusy();App.track('OrderError',errors);App.log.order({'errors':errors},'validation error');return true;}
return false;}
var errors={};if(!order.name){errors['name']='Please enter your name.';}
if(!App.phone.validate(order.phone)){errors['phone']='Please enter a valid phone #.';}
if(order.delivery_type=='delivery'&&!order.address){errors['address']='Please enter an address.';}
if(order.pay_type=='card'&&((service._cardInfoHasChanged&&!service.form.cardNumber)||(!service.account.user.id_user&&!service.form.cardNumber))){errors['card']='Please enter a valid card #.';}
if(!service.cart.hasItems()){errors['noorder']='Please add something to your order.';}
var _total=service.restaurant.delivery_min_amt=='subtotal'?service.subtotal():service.total();if(service.restaurant.meetDeliveryMin(_total)&&service.form.delivery_type=='delivery'){errors['delivery_min']='Please meet the delivery minimum of '+service.info.dollarSign+service.restaurant.delivery_min+'.';}
var er=displayErrors(errors);if(er){return;}
if(order.delivery_type=='delivery'){if(service.account&&service.account.user&&service.account.user.last_order){if(service.account.user.last_order.communities.indexOf(service.restaurant.id_community)>-1){var lastAddress=service.account.user.last_order.address;var currentAdress=service.form.address;if($.trim(lastAddress)!=''&&$.trim(lastAddress)==$.trim(currentAdress)){service._deliveryAddressOk=true;App.log.order({'address':lastAddress,'restaurant':service.restaurant.name},'legacy address');}}}
if(!service._deliveryAddressOk){if(service.location.bounding&&google&&google.maps&&google.maps.LatLng){var latLong=new google.maps.LatLng(service.location.bounding.lat,service.location.bounding.lon);}
if(service._useRestaurantBoundingBox){var latLong=new google.maps.LatLng(service.restaurant.loc_lat,service.restaurant.loc_long);}
if(!latLong){App.busy.unBusy();App.dialog.show('.address-not-found-warning');return;}
var success=function(results){var theClosestAddress=service.location.theClosestAddress(results,latLong);var isTheAddressOk=service.restaurant.id_restaurant==26?true:service.location.validateAddressType(theClosestAddress.result);if(isTheAddressOk){theClosestAddress=theClosestAddress.location;if(service.form.address!=theClosestAddress.formatted()){theClosestAddress.setEntered(service.form.address);}
var lat=theClosestAddress.lat();var lon=theClosestAddress.lon();if(service._useCompleteAddress){service.form.address=theClosestAddress.formatted();order.address=service.form.address;}
var distance=service.location.distance({from:{lat:lat,lon:lon},to:{lat:service.restaurant.loc_lat,lon:service.restaurant.loc_long}});distance=service.location.km2Miles(distance);if(!service.restaurant.deliveryHere(distance)){App.alert('Sorry, you are out of delivery range or have an invalid address. <br>Please check your address, or order takeout.');App.busy.unBusy();$rootScope.$safeApply(function(){service.showForm=true;if(!App.isPhoneGap){$('[name="pay-address"]').focus();}
service.form.address=theClosestAddress.formatted();});App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address out of delivery range');return;}else{if(service._completeAddressWithZipCode){var zipCode=theClosestAddress.zip();var typed_address=service.form.address;if(typed_address.indexOf(zipCode)<0){var addressWithZip=typed_address+' - '+zipCode;service.form.address=addressWithZip;}}
App.busy.unBusy();service._deliveryAddressOk=true;service.processOrder();}}else{App.alert('Oops, it looks like your address is incomplete. <br>Please enter a street name, number, and city.');App.busy.unBusy();$rootScope.$safeApply(function(){service.showForm=true;$('[name="pay-address"]').focus();});App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address not found or invalid');}}
var error=function(){App.alert('Oops, it looks like your address is incomplete. <br>Please enter a street name, number, and city.');App.busy.unBusy();App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address not found');};service.location.doGeocodeWithBound(order.address,latLong,success,error);return;}}
if(order.delivery_type=='takeout'){service._deliveryAddressOk=true;}
if(!service._deliveryAddressOk){return;}
var processOrder=function(card){if(card===false){}else if(!card.status){var er=displayErrors({process:card.error});return;}else{order.card={id:card.id,uri:card.uri,lastfour:card.lastfour,month:card.month,year:card.year};}
if(!service._crunchSoundPlayded){App.playAudio('get-food-audio');service._crunchSoundPlayded=true;}
order.phone=order.phone.replace(/-/g,'');var url=App.service+'order';$http({method:'POST',url:url,data:$.param(order),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(json){try{if(json.uuid){var uuid=json.uuid;}else{console.error('Error',json);App.log.order(json,'processing error');if(!json.errors){json={status:'false',errors:['Sorry! An error has occurred trying to place your order! <br/> Please make sure your credit card info is correct!']};}
$rootScope.$broadcast('orderProcessingError',true);}}catch(e){console.error('Exception',e,json);App.log.order(json,'processing error');json={status:'false',errors:['Sorry! An error has occurred trying to place your order! <br/> Please make sure your credit card info is correct!']};$rootScope.$broadcast('orderProcessingError',true);}
if(json.status=='false'){service.errors(json.errors);App.track('OrderError',json.errors);App.log.order({'errors':json.errors},'validation error - php');}else{if(json.token){$.cookie('token',json.token);}
$.totalStorage('userEntered',null);service.startStoreEntederInfo=false;service.account.updateInfo();App.cache('Order',json.uuid,function(){App.track('Ordered',{'total':this.final_price,'subtotal':this.price,'tip':this.tip,'restaurant':service.restaurant.name,'paytype':this.pay_type,'ordertype':this.order_type,'user':this.user,'items':service.cart.totalItems()});service.cart.clean();service.giftcard.notes_field.reset();$rootScope.$safeApply(function(){$rootScope.$broadcast('newOrder');OrderViewService.newOrder=true;$location.path('/order/'+uuid);});});}
setTimeout(function(){App.busy.unBusy();},400);});}
if(service._cardInfoHasChanged&&order.pay_type=='card'){App.tokenizeCard({card_number:service.form.cardNumber,expiration_month:service.form.cardMonth,expiration_year:service.form.cardYear,security_code:null},processOrder);}else{order.card={};processOrder(false);}}
service.tipChanged=function(){service._tipHasChanged=true;service._previousTip=service.form.tip;service.updateTotal();}
service.cardInfoChanged=function(){service._cardInfoHasChanged=true;}
service.updateTotal=function(){if(!service.restaurant.id_restaurant){return;}
service.info.totalText=service.info.dollarSign+service.charged();var tipText='',feesText='',totalItems=0,credit=parseFloat(service.credit.value),hasFees=((service.restaurant.delivery_fee&&service.form.delivery_type=='delivery')||service.restaurant.fee_customer)?true:false;for(var x in service.items){totalItems++;}
service._autotip();var wasTipChanged=false;if(service.form.delivery_type=='takeout'&&service.form.pay_type=='card'){wasTipChanged=true;}else if(service.form.delivery_type=='delivery'&&service.form.pay_type=='card'){if(!service._tipHasChanged){service.form.tip=(service.account.user.last_tip)?service.account.user.last_tip:'autotip';service.form.tip=service._lastTipNormalize(service.form.tip);wasTipChanged=true;}else{service.form.tip=service._previousTip;wasTipChanged=true;}}
if(wasTipChanged){service.info.totalText=service.info.dollarSign+this.charged();}
var _total=service.restaurant.delivery_min_amt=='subtotal'?service.subtotal():service.total();if(service.restaurant.meetDeliveryMin(_total)&&service.form.delivery_type=='delivery'){service.info.deliveryMinDiff=service.restaurant.deliveryDiff(_total);}else{service.info.deliveryMinDiff='';}
service.info.totalItems=service.cart.totalItems();service.info.extraCharges=service.extraChargesText(service.totalbreakdown());service.info.breakdownDescription=service.info.dollarSign+this.subtotal().toFixed(2);service.info.cartSummary=service.cart.summary();if(service.form.pay_type=='card'&&credit>0){service.info.creditLeft='';if(this.total()<credit){service.info.creditLeft=App.ceil((credit-this.total())).toFixed(2);credit=this.total();}}}
service._autotip=function(){var subtotal=service.totalbreakdown().subtotal;var autotipValue
if(subtotal===0){autotipValue=0;}else{autotipValue=Math.ceil(4*(subtotal*0.107+0.85))/4;}
service.form.autotip=autotipValue;}
service._autotipText=function(){var autotipText=service.form.autotip?' ('+service.info.dollarSign+service.form.autotip+')':'';return'Autotip'+autotipText;}
service._years=function(){var years=[];years.push({value:'',label:'Year'});var date=new Date().getFullYear();for(var x=date;x<=date+20;x++){years.push({value:x.toString(),label:x.toString()});}
return years;}
service._months=function(){var months=[];months.push({value:'',label:'Month'});for(var x=1;x<=12;x++){months.push({value:x.toString(),label:x.toString()});}
return months;}
service._tips=function(){var tips=[];tips.push({value:'autotip',label:service._autotipText()});tips.push({value:0,label:'Tip with cash'});var _tips=[10,15,18,20,25,30];for(var x in _tips){tips.push({value:_tips[x],label:'tip '+_tips[x]+' %'});}
return tips;}
service._lastTipNormalize=function(lastTip){if(lastTip==='autotip'){return lastTip;}
if(service.account.user&&service.account.user.last_tip_type&&service.account.user.last_tip_type=='number'){return'autotip';}
lastTip=parseInt(lastTip);var tips=service._tips();for(x in tips){if(lastTip==parseInt(tips[x].value)){return lastTip;}}
return'autotip';}
service._test=function(){$rootScope.$safeApply(function(){service._useRestaurantBoundingBox=true;service.form.name='MR TEST';service.form.phone='405-279-9645';service.form.address=service.restaurant.address;service.form.cardNumber='4242424242424242';service.form.cardMonth='2';service.form.cardYear='2016';service.form.tip='autotip';service.tooglePayment('card');if(!service._askedAboutFood){service._askedAboutFood=true;if(confirm('Add some food?')){var categories=service.restaurant.categories()
for(x in categories){category=categories[x];var dishes=category.dishes();for(y in dishes){var dish=dishes[y];service.cart.add(dish.id_dish);}}}}
$rootScope.$broadcast('creditCardInfoChanged',true);});}
return service;});NGApp.factory('OrdersService',function($http,$location,$rootScope,RestaurantsService,OrderViewService){var service={list:false,reload:true};var restaurants=RestaurantsService;service.load=function(){if(service.list&&!service.reload){return service.list;}
OrderViewService.newOrder=false;list=false;service.list=list;$http.get(App.service+'user/orders',{cache:false}).success(function(json){service.reload=false;if(json){for(var x in json){json[x].timeFormat=json[x]._date_tz.replace(/^[0-9]+-([0-9]+)-([0-9]+) ([0-9]+:[0-9]+):[0-9]+$/i,'$1/$2 $3');}
list=json;}else{list=true;}
service.list=list;$rootScope.$broadcast('OrdersLoaded',service.list);});}
service.restaurant=function(permalink){$location.path('/'+restaurants.permalink+'/'+permalink);};service.receipt=function(id_order){$location.path('/order/'+id_order);};$rootScope.$on('userAuth',function(e,data){service.reload=true;});$rootScope.$on('newOrder',function(e,data){service.reload=true;});return service;});NGApp.factory('OrderViewService',function($routeParams,$location,$rootScope,$http,FacebookService){var service={order:false,reload:true,newOrder:false};service.facebook=FacebookService;service.load=function(){var url=App.service+'order/'+$routeParams.id;var error=function(){$location.path('/');}
$http({method:'GET',url:url,cache:true}).success(function(data){service.order=data;if(service.order.uuid){service.order._final_price=parseFloat(service.order.final_price).toFixed(2);if(service.order.credit){service.order._credit=parseFloat(service.order.credit).toFixed(2);}
if(service.newOrder){service.order.new=service.newOrder;}else{service.order.new=false;}
service.facebook._order_uuid=service.order.uuid;service.facebook.preLoadOrderStatus();$rootScope.$broadcast('OrderViewLoadedOrder',service.order);}else{error();}}).error(function(data){error();});}
return service;});;NGApp.factory('FacebookService',function($http,$location,$rootScope,AccountService,ReferralService){var service={token:false,_order_uuid:false,orderStatus:false,logged:false,doAuth:true,wait:false,running:false,error:{unknown:false,userExists:false,login:false}}
service.referral=ReferralService;service.account=AccountService;service.preLoadOrderStatus=function(uuid){$http.get(App.service+'facebook/status/order/'+service._order_uuid).success(function(data){if(data.success){service.orderStatus=data.success;}else{service.orderStatus=false;}});}
service.postOrder=function(){if(service.orderStatus){var status=service.orderStatus;status.link=service.referral.cleaned_url();App.share({url:'http://'+status.link,name:status.name,caption:status.caption,description:status.description,picture:status.picture});}else{service.preLoadOrderStatus();App.alert('Oops, please try again!');return;}}
service.postInvite=function(url){App.share({url:url,name:'Noms',caption:' ',description:url});}
service.requestPermission=function(callback){callback=typeof callback==='function'?callback:function(){};FB.ui({method:'permissions.request',perms:serviceScope,display:'iframe'},callback);}
service.processStatus=function(status){if(status.status==='connected'&&status.authResponse){service.logged=true;service.error.unknown=false;service.error.userExists=false;service.error.login=false;service.token=status.authResponse.accessToken;$.totalStorage('fbtoken',service.token);if(App.config.user.id_user&&App.config.user.facebook){return;}
if(status.authResponse.userID){App.log.account({'userID':status.authResponse.userID},'facebook login');if(!service.running){service.running=true;App.log.account({'userID':status.authResponse.userID,'running':service.running},'facebook running');var data={};url=App.service+'user/facebook?fbrtoken='+service.token;$http({method:'GET',url:url,cache:false}).success(function(data){App.log.account({'userID':status.authResponse.userID,'running':service.running,'data':data},'facebook ajax');if(data.error){if(data.error=='facebook id already in use'){App.log.account({'error':data.error},'facebook error');service.error.userExists=true;}
service.running=false;return;}else{service.account.updateInfo();service.account.user=data;if(service.account.callback){service.account.callback();service.account.callback=false;}else{try{$.magnificPopup.close();}catch(e){}}}
App.log.account({'userID':status.authResponse.userID},'facebook currentPage');$rootScope.$broadcast('userAuth',service.user);service.running=false;});}}}else{service.logged=false;service.error.unknown=false;service.error.userExists=false;service.error.login=false;service.token=null;$.totalStorage('fbtoken',null);}}
service.signout=function(callback){FB.logout(function(){service.logged=false;if(typeof callback==='function'){callback();}});}
return service;});;NGApp.factory('GiftCardService',function($http,$location,$rootScope,AccountModalService,CreditService,RestaurantsService){var service={redeemed:false,code:false,value:'',notes_field:{lastValidation:'',content:'',giftcards:{success:[],error:[]},value:'0.00',removed:false,id_restaurant:null,hasGiftCards:false,restaurant_accepts:false},modal:{intro:true,error:false,success:false,restaurant:false,}};credit=CreditService;service.accountModal=AccountModalService;service.account=service.accountModal.facebook.account;service.open=function(){App.dialog.show('.giftcard-container');service.parseURLCode();if(service.modal.intro){setTimeout(function(){service.processModal();$location.path('/location');},100);}}
service.openRestaurant=function(){$location.path('/'+RestaurantsService.permalink+'/'+service.modal.restaurant.permalink);service.modal.close();}
service.parseURLCode=function(){service.code=$location.path().replace('/giftcard','');service.code=service.code.replace('/','');}
service.viewed=function(){var url=App.service+'giftcard/viewed';$http({method:'POST',url:url,data:$.param({'code':service.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}});}
service.processModal=function(){if(!service.code||service.code==''){return;}
if(!(/^\w+$/.test($.trim(service.code)))){service.code='';return;}
service.modal.reset();setTimeout(function(){service.redeemed=false;service.validate(function(data){service.modal.intro=false;if(data.error){service.modal.error=true;switch(data.error){case'gift card already used':service.viewed();service.modal.error='used';break;case'invalid gift card':service.modal.error='invalid';break;default:service.modal.error='unknow';break;}
service.code=false;}else if(data.success){service.viewed();service.modal.success=true;service.value=data.success['value'];if(data.success['id_restaurant']){service.modal.restaurant={id_restaurant:data.success['id_restaurant'],name:data.success['restaurant'],permalink:data.success['permalink']};}else{service.modal.restaurant=false;}
$rootScope.$broadcast('GiftCardProcessed',true);if(service.redeemed){service.code='';}}});},500);}
service.modal.reset=function(){service.modal.intro=true;service.modal.error=false;service.modal.success=false;service.modal.restaurant=false;}
service.modal.signIn=function(){service.account.callback=function(){service.open();service.processModal();}
service.modal.close();setTimeout(function(){service.accountModal.signinOpen();},500);}
service.modal.close=function(){$.magnificPopup.close();}
service.validate=function(callback){service.code=$.trim(service.code);if(service.code==''){callback({error:true});return;}
if(service.redeemed){var url=App.service+'giftcard/code';}else{var url=App.service+'giftcard/validate';}
$http({method:'POST',url:url,data:$.param({'code':service.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){callback(data);}).error(function(data,status){callback({error:true});});}
service.notes_field.reset=function(){service.notes_field.content='';service.notes_field.giftcards={success:[],error:[]};service.notes_field.value='0.00';service.notes_field.removed=false;service.notes_field.id_restaurant=null;service.notes_field.hasGiftCards=false;service.notes_field.restaurant_accepts=false;service.code=false;}
service.notes_field.start=function(){service.notes_field.hasGiftCards=false;service.notes_field.giftcards.success=[];if(service.notes_field.content==''){service.notes_field.lastValidation='';service.notes_field.checkAllValidated();}
if(service.notes_field.content&&service.notes_field.content!=''){var words=service.notes_field.content;if(words==service.notes_field.lastValidation){return;}
service.notes_field.lastValidation=words;if(!service.notes_field.running){service.notes_field.running=true;var url=App.service+'giftcard/validate-words';$http({method:'POST',url:url,data:$.param({'words':words}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.success){service.notes_field.hasGiftCards=true;var giftcard=data.success;if(giftcard.id_restaurant&&giftcard.id_restaurant!=service.notes_field.id_restaurant){giftcard.error='other restaurant';}
service.notes_field.giftcards.success.push(data.success);}else if(data.error){service.notes_field.giftcards.success=[];}
service.notes_field.total--;service.notes_field.checkAllValidated();service.notes_field.running=false;}).error(function(data,status){service.notes_field.total--;service.notes_field.checkAllValidated();service.notes_field.running=false;});}}}
service.notes_field.checkAllValidated=function(){service.notes_field.compareValues();$rootScope.$broadcast('giftCardUpdate');}
service.notes_field.compareValues=function(){service.notes_field.removed=false;var values=0;if(service.notes_field.giftcards.success.length>0){$.each(service.notes_field.giftcards.success,function(key,giftcard){if(giftcard&&!giftcard.error){values+=parseFloat(giftcard.value);}});}
if(service.notes_field.value>values){service.notes_field.removed=true;}
if(service.notes_field.restaurant_accepts){service.notes_field.value=App.ceil(values).toFixed(2);credit.setValue(App.ceil(credit.redeemed+values).toFixed(2));}
$rootScope.$broadcast('creditChanged',{value:service.value});}
return service;});NGApp.factory('CreditService',function($http,$rootScope){var service={value:'0.00',tooltip:false,redeemed:0};service.setValue=function(value){service.value=value;$rootScope.$broadcast('creditChanged',{value:service.value});}
service.getCredit=function(restaurant_id){var url=App.service+'user/credit/'+restaurant_id;$http({url:url}).success(function(data){if(data.credit){service.setValue(App.ceil(data.credit).toFixed(2));service.redeemed=data.credit;}else{service.setValue(App.ceil(0).toFixed(2));service.redeemed=0;}}).error(function(){service.setValue(App.ceil(0).toFixed(2));service.redeemed=0;});}
return service;});;NGApp.factory('PositionsService',function($rootScope){var service={bounding:null,locs:[],storageLimit:4}
service.addLocation=function(loc){service.locs.push(loc);var locs=[];for(x in service.locs){locs.push(service.locs[x].toCookie());}
if(locs.length>service.storageLimit){locs=locs.slice(locs.length-service.storageLimit);}
$.totalStorage('locsv3',locs);$rootScope.$broadcast('NewLocationAdded',true);}
service.pos=function(){return((service.locs.length)?service.locs[service.locs.length-1]:new Location);}
return service;});NGApp.factory('LocationService',function($location,$rootScope,RestaurantsService,PositionsService,AccountService,CommunityAliasService){var service={form:{address:''},range:2,boundingBoxMeters:8000,loaded:false,locationNotServed:false,initied:false,loadRestaurantsPage:true,initied:false}
var community=CommunityAliasService;service.account=AccountService;service.position=PositionsService;service.restaurantsService=RestaurantsService;service.distance=function(params){try{var R=6371;var dLat=service.toRad(params.to.lat-params.from.lat);var dLon=service.toRad(params.to.lon-params.from.lon);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(service.toRad(params.from.lat))*Math.cos(service.toRad(params.to.lat))*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d;}catch(e){var pos=service.position.pos();App.track('Location Error',{lat:pos.lat,lon:pos.lon,address:pos.address()});}}
service.getClosest=function(results,latLong){var from={lat:latLong.lat(),lon:latLong.lng()};var distances=[];var closest=-1;for(i=0;i<results.length;i++){var d=service.distance({to:{lat:results[i].geometry.location.lat(),lon:results[i].geometry.location.lng()},from:from});distances[i]=d;if(closest==-1||d<distances[closest]){closest=i;}}
return results[closest];}
service.getLocationByBrowser=function(success,error){var success=success||function(){};var error=error||function(){};if(navigator.geolocation){service.timerId=setTimeout(function(){error();},5000);navigator.geolocation.getCurrentPosition(function(position){clearTimeout(service.timerId);service.position.addLocation(new Location({lat:position.coords.latitude,lon:position.coords.longitude,type:'geolocation'}));App.track('Locations Shared',{lat:position.coords.latitude,lon:position.coords.longitude});service.reverseGeocode(position.coords.latitude,position.coords.longitude,success,error);},function(){clearTimeout(service.timerId);error();},{maximumAge:60000,timeout:5000,enableHighAccuracy:true});}else{error();}}
service.init=function(){if(service.initied){return;}
service.initied=true;if(App.config.loc.lat&&App.config.loc.lon){service.bounding=App.config.loc;service.bounding.type='geoip';}
var cookieLocs=$.totalStorage('locsv3');var cookieBounding=$.totalStorage('boundingv2');if(cookieLocs){for(var x in cookieLocs){service.position.addLocation(new Location(cookieLocs[x]._properties));}}
if(cookieBounding){service.bounding=cookieBounding;service.bounding.type='cookie';}
if(service.account&&service.account.user&&service.account.user.location_lat){service.bounding={lat:service.account.user.location_lat,lon:service.account.user.location_lon,type:'user'};}
if(App.isPhoneGap){}else{try{if(google&&google.load&&!google.maps){google.load('maps','3',{callback:service.googleCallback,other_params:'sensor=false'});}}catch(e){}}}
service.googleCallback=function(){console.debug('PROCESSING LOCATION DATA FROM GOOGLE API');var error=function(){if(service.bounding&&service.bounding.lat&&service.bounding.lon&&!service.bounding.city){service.reverseGeocode(service.bounding.lat,service.bounding.lon,function(loc){service.bounding.city=loc.city();service.bounding.region='';service.position.addLocation(loc);service.restaurantsService.list(function(){if(service.loadRestaurantsPage){$location.path('/'+RestaurantsService.permalink);}
service.loadRestaurantsPage=true;},function(){$rootScope.$broadcast('locationError',true);});},function(){});}}
service.loaded=true;if(google.loader.ClientLocation){if(google.loader.ClientLocation.latitude&&google.loader.ClientLocation.longitude){service.bounding={lat:google.loader.ClientLocation.latitude,lon:google.loader.ClientLocation.longitude,city:google.loader.ClientLocation.address.city,region:google.loader.ClientLocation.address.country_code=='US'&&google.loader.ClientLocation.address.region?google.loader.ClientLocation.address.region.toUpperCase():google.loader.ClientLocation.address.country_code,type:'googleip'};}}
if(service.position.locs.length){var loc=service.position.pos();service.reverseGeocode(loc.lat(),loc.lon(),function(loc){service.bounding={lat:loc.lat(),lon:loc.lon(),city:loc.city()};service.restaurantsService.list(function(){if(service.loadRestaurantsPage){$location.path('/'+RestaurantsService.permalink);}
service.loadRestaurantsPage=true;},function(){$rootScope.$broadcast('locationNotServed',true);});},function(){});}else
if(!service.position.locs.length){service.getLocationByBrowser(function(loc){service.bounding={lat:loc.lat(),lon:loc.lon(),city:loc.city(),type:'geolocation'};service.position.addLocation(loc);service.restaurantsService.list(function(){if(service.loadRestaurantsPage){$location.path('/'+RestaurantsService.permalink);}
service.loadRestaurantsPage=true;},function(){$rootScope.$broadcast('locationNotServed',true);});},error);}else{error();}}
service.geocode=function(address,success,error){service.doGeocode(address,function(results){if(results.alias){var loc=new Location({address:results.alias.address(),entered:address,type:'alias',lat:results.alias.lat(),lon:results.alias.lon(),city:results.alias.city(),prep:results.alias.prep()});}else{if(service.bounding){var latLong=new google.maps.LatLng(service.bounding.lat,service.bounding.lon);var closest=service.getClosest(results,latLong);}else{var closest=results[0];}
var loc=new Location({results:results,entered:address,type:'user',lat:closest.geometry.location.lat(),lon:closest.geometry.location.lng()});}
success(loc);},function(){error();});}
service.doGeocode=function(address,success,error,ignoreRoute){address=$.trim(address);App.track('Location Entered',{address:address});var rsuccess=function(results){success(results);};var rerror=function(){var params={address:address};if(service.bounding&&google&&google.maps){var latLong=new google.maps.LatLng(service.bounding.lat,service.bounding.lon);var circle=new google.maps.Circle({center:latLong,radius:service.boundingBoxMeters});var bounds=circle.getBounds();params.bounds=bounds;}
var geocoder=new google.maps.Geocoder();geocoder.geocode(params,function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});};community.route(address,rsuccess,rerror);}
service.ordinalReplace=function(address){var ordinals={'first':'1st','second':'2nd','third':'3rd','fourth':'4th','fifth':'5th','sixth':'6th','seventh':'7th','eighth':'8th','ninth':'9th','tenth':'10th','eleventh':'11th','twelfth':'12th','thirteenth':'13th','fourteenth':'14th','fifteenth':'15th','sixteenth':'16th','seventeenth':'17th','eighteenth':'18th','nineteenth':'19th','twentieth':'20th'};for(ordinal in ordinals){var regex=new RegExp('('+ordinal+')','gi');address=address.replace(regex,ordinals[ordinal]);}
return address;}
service.doGeocodeWithBound=function(address,latLong,success,error){var circle=new google.maps.Circle({center:latLong,radius:service.boundingBoxMeters});var bounds=circle.getBounds();var geocoder=new google.maps.Geocoder();geocoder.geocode({address:address,bounds:bounds},function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});}
service.reverseGeocode=function(lat,lon,success,error){App.track('Location Reverse Geocode',{lat:lat,lon:lon});var geocoder=new google.maps.Geocoder();var latlng=new google.maps.LatLng(lat,lon);geocoder.geocode({'latLng':latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(results[1]){success(new Location({results:results,lat:lat,lon:lon}));}else{error();}}else{error();}});}
service.theClosestAddress=function(results,latLong){var lat=latLong.lat();var lng=latLong.lng();var R=6371;var distances=[];var closest=-1;for(i=0;i<results.length;i++){var alat=results[i].geometry.location.lat();var alng=results[i].geometry.location.lng();var dLat=service.toRad(alat-lat);var dLong=service.toRad(alng-lng);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(service.toRad(lat))*Math.cos(service.toRad(lat))*Math.sin(dLong/2)*Math.sin(dLong/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;distances[i]=d;if(closest==-1||d<distances[closest]){closest=i;}}
address=results[closest];var loc=new Location({type:'closest',lat:address.geometry.location.lat(),lon:address.geometry.location.lng()});loc.setAddressFromResult(address);loc.setCityFromResult(address);loc.setZipFromResult(address);return{result:address,location:loc};}
service.validateAddressType=function(addressLocation){if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.ROOFTOP||addressLocation.geometry.location_type==google.maps.GeocoderLocationType.RANGE_INTERPOLATED)){return true;}
if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.APPROXIMATE)){for(var x in addressLocation.types){var addressType=addressLocation.types[x];if(addressType=='premise'||addressType=='subpremise'||addressType=='intersection'||addressType=='establishment'){return true;}}}
return false;}
service.km2Miles=function(km){return km*0.621371;}
service.Miles2Km=function(miles){return miles*1.60934;}
service.toRad=function(number){return number*Math.PI/180;}
service.addVerify=function(){if(arguments[0]&&typeof arguments[1]!='function'){var success=arguments[2];var error=arguments[3];}else{var address=arguments[0];var success=arguments[1];var error=arguments[2];for(var x in service.locs){if(service.locs[x].entered==address&&service.locs[x].verified){success(service.locs[x]);return;}}
service.geocode(address,function(loc){service.position.addLocation(loc);success();$.totalStorage.setItem('boundingv2',service.bounding);},error);}}
return service;});;NGApp.factory('CartService',function(){var service={restaurants:{},id_restaurant:null}
service.uuid=function(){var id='c-'+service.restaurants[service.id_restaurant].uuidInc;service.restaurants[service.id_restaurant].uuidInc++;return id;}
service.setRestaurant=function(id_restaurant){service.id_restaurant=id_restaurant;if(!service.restaurants[service.id_restaurant]){service.restaurants[service.id_restaurant]={uuidInc:0,items:{}}}}
service.clean=function(){for(x in service.restaurants){service.restaurants[x]={uuidInc:0,items:{}};}}
service.add=function(item){var id=service.uuid(),dish=App.cache('Dish',item);dish_options=dish.options(),options=[];var expanded=true;if(arguments[1]){options=arguments[1].options;expanded=false;for(var i in dish_options){if(dish_options[i].type=='select'){var hasSelectedOption=false;var defaultValue=false;for(var j in dish_options){if(dish_options[j].id_option_parent==dish_options[i].id_option){if(dish_options[j]['default']==1){defaultValue=dish_options[j]['id_option'];}
for(var k in options){if(options[k]==dish_options[j].id_option){hasSelectedOption=true;}}}}
if(defaultValue&&!hasSelectedOption){options[options.length]=defaultValue;}}}}else{for(var x in dish_options){if(dish_options[x]['default']==1){options[options.length]=dish_options[x].id_option;}}}
service.restaurants[service.id_restaurant].items[id]={};service.restaurants[service.id_restaurant].items[id].id=item;service.restaurants[service.id_restaurant].items[id].options=options;service.restaurants[service.id_restaurant].items[id].details={};service.restaurants[service.id_restaurant].items[id].details.id=id;service.restaurants[service.id_restaurant].items[id].details.name=dish.name;service.restaurants[service.id_restaurant].items[id].details.description=dish.description!=null?dish.description:'';service.restaurants[service.id_restaurant].items[id].details.customization={};service.restaurants[service.id_restaurant].items[id].details.customization.customizable=(dish.options().length>0);service.restaurants[service.id_restaurant].items[id].details.customization.expanded=(expanded&&(parseInt(dish.expand_view)>0));service.restaurants[service.id_restaurant].items[id].details.customization.options=service._parseCustomOptions(dish_options,options);service.restaurants[service.id_restaurant].items[id].details.customization.rawOptions=dish_options;App.track('Dish added',{id_dish:dish.id_dish,name:dish.name});}
service.clone=function(item){var
cart=service.restaurants[service.id_restaurant].items[item],newoptions=[];for(var x in cart.options){newoptions[newoptions.length]=cart.options[x];}
service.add(cart.id,{options:newoptions});App.track('Dish cloned');}
service.getItems=function(){return service.restaurants[service.id_restaurant].items;}
service.reset=function(){service.restaurants[service.id_restaurant].uuidInc=0;service.restaurants[service.id_restaurant].items={};}
service.remove=function(item){App.track('Dish removed');delete service.restaurants[service.id_restaurant].items[item];}
service.customizeItem=function(option,item){var cartitem=service.restaurants[service.id_restaurant].items[item.details.id];if(option){if(option.type=='select'){var options=item.details.customization.rawOptions;for(var i in options){if(options[i].id_option_parent!=option.id_option){continue;}
for(var x in cartitem.options){if(cartitem.options[x]==options[i].id_option&&options[i].id_option_parent==option.id_option){cartitem.options.splice(x,1);break;}}}
cartitem.options[cartitem.options.length]=option.selected;}else if(option.type=='check'){if(option.checked){cartitem.options[cartitem.options.length]=option.id_option;}else{for(var x in cartitem.options){if(cartitem.options[x]==option.id_option){cartitem.options.splice(x,1);break;}}}}}
service.restaurants[service.id_restaurant].items[item.details.id]=cartitem;}
service.customizeItemPrice=function(price,force){if(price!='0.00'||force){return' ('+((price<0)?'minus $':'+ $')+parseFloat(Math.abs(price)).toFixed(2)+')';}
return'';}
service.getCart=function(){var cart=[];for(x in service.restaurants[service.id_restaurant].items){var index=cart.length;cart[index]={id:service.restaurants[service.id_restaurant].items[x].id,options:service.restaurants[service.id_restaurant].items[x].options};}
return cart;}
service.hasItems=function(){if(service.restaurants[service.id_restaurant]){if(!$.isEmptyObject(service.restaurants[service.id_restaurant].items)){return true;}
return false;}}
service.summary=function(){var items={};for(var x in service.restaurants[service.id_restaurant].items){if(items[service.restaurants[service.id_restaurant].items[x].details.name]){items[service.restaurants[service.id_restaurant].items[x].details.name]++;}else{items[service.restaurants[service.id_restaurant].items[x].details.name]=1;}}
var text='';for(x in items){text=',\u00A0\u00A0'+text;if(items[x]>1){text=x+'\u00A0('+items[x]+')'+text;}else{text=x+text;}}
return text.substr(0,text.length-3);}
service.subtotal=function(){var
total=0,options;for(var x in service.restaurants[service.id_restaurant].items){total+=parseFloat(App.cached['Dish'][service.restaurants[service.id_restaurant].items[x].id].price);options=service.restaurants[service.id_restaurant].items[x].options;for(var xx in options){var option=App.cached['Option'][options[xx]];if(option===undefined)continue;total+=parseFloat(option.optionPrice(options));}}
total=App.ceil(total);return total;}
service.totalItems=function(){var size=0;for(var x in service.restaurants[service.id_restaurant].items){if(service.restaurants[service.id_restaurant].items.hasOwnProperty(x)){size++;}}
return size;}
service._parseCustomOptions=function(options,selectedOptions){var parsedOptions=[];for(var x in options){var newOption={};var rawOption=options[x];if(rawOption.id_option_parent){continue;}
newOption.type=rawOption.type;newOption.id_option=rawOption.id_option;newOption.name=rawOption.name+(rawOption.description||'');if(rawOption.type=='check'){newOption.id_option=rawOption.id_option;newOption.price=rawOption.optionPrice(options);newOption.priceFormated=service.customizeItemPrice(newOption.price);newOption.checked=($.inArray(rawOption.id_option,selectedOptions)!==-1);}
if(rawOption.type=='select'){newOption.options=[];newOption.selected=false;for(var i in options){if(options[i].id_option_parent==rawOption.id_option){var newSubOption={};newSubOption.id_option=options[i].id_option;newSubOption.id_option_parent=options[i].id_option_parent;newSubOption.price=options[i].price;newSubOption.priceFormated=service.customizeItemPrice(newSubOption.price);newSubOption.selected=($.inArray(options[i].id_option,selectedOptions)!==-1);newSubOption.name=options[i].name+(options[i].description||'')+service.customizeItemPrice(newSubOption.price,(rawOption.price_linked=='1'));newOption.options.push(newSubOption);if(newSubOption.selected){newOption.selected=options[i].id_option;}}}}
parsedOptions.push(newOption);}
return parsedOptions;}
return service;});;NGApp.factory('CreditCardService',function($http){var service={};service.cards=[{'name':'master-card','pattern':/^5[1-5]/,'size':16},{'name':'visa','pattern':/^4/,'size':16},{'name':'amex','pattern':/^3[47]/,'size':15},{'name':'discover','pattern':/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,'size':16},];service.validate=function(cardValue){var card=service.detectType(cardValue);var isValid=false;if(card.size==cardValue.toString().length){isValid=service.luhn(cardValue);}
if(isValid){$('[name="pay-card-number"]').addClass('credit-card-ok');}else{$('[name="pay-card-number"]').removeClass('credit-card-ok');}}
service.luhn=function(cardValue){var sum=0;cardValueInverse=cardValue.toString().split('').reverse();for(n=i=0,size=cardValueInverse.length;i<size;n=++i){digit=cardValueInverse[n];digit=+digit;if(n%2){digit*=2;if(digit<10){sum+=digit;}else{sum+=digit-9;}}else{sum+=digit;}}
return sum%10===0;}
service.changeIcons=function(cardValue){var card=service.detectType(cardValue);if(card){$('.payment-card').addClass('grey');$('.card-'+card.name).removeClass('grey');}else{$('.payment-card').removeClass('grey');}
service.validate(cardValue);}
service.detectType=function(cardValue){var cardType=false;$(service.cards).each(function(index,card){if(card.pattern.test(cardValue)){cardType=card;}});return cardType;}
return service;});;NGApp.factory('ReferralService',function($http,$rootScope,$location){var service={invite_url:null,value:0,invites:0,limit:0};service.check=function(){var param=$location.search();if(param.invite){$.cookie('referral',param.invite);$location.url($location.path());}}
service.getInviteCode=function(){var url=App.service+'referral/code';$http({url:url,method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.invite_url=data.invite_url;$rootScope.$broadcast('referralCodeLoaded',true);}).error(function(data,status){console.log({error:data});});}
service.getValue=function(){var url=App.service+'referral/value';$http({url:url,method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.value=data.value;$rootScope.$broadcast('referralValueLoaded',true);}).error(function(data,status){console.log({error:data});});}
service.getStatus=function(){var url=App.service+'referral/status';$http({url:url,method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.enabled=data.enabled;service.invites=data.invites;service.value=data.value;service.limit=data.limit;service.invite_url=data.invite_url;$rootScope.$broadcast('referralStatusLoaded',true);}).error(function(data,status){console.log({error:data});});}
service.cleaned_url=function(){return service.invite_url&&service.invite_url.replace('http://','');}
$rootScope.$on('userAuth',function(e,data){service.invite_url=null;service.value=0;service.invites=0;service.limit=0;});return service;});;addEventListener('touchstart',function(){});addEventListener('load',function(event){setTimeout(scrollTo,80,0,1);},false);