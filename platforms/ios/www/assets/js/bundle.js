(function(win,doc){'use strict';var Snap=Snap||function(userOpts){var settings={element:null,dragger:null,disable:'none',addBodyClasses:true,hyperextensible:true,resistance:0.5,flickThreshold:50,transitionSpeed:0.3,easing:'ease',maxPosition:266,minPosition:-266,tapToClose:true,touchToDrag:true,slideIntent:40,minDragDistance:5},cache={simpleStates:{opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}}},eventList={},utils={hasTouch:(doc.ontouchstart===null),eventType:function(action){var eventTypes={down:(utils.hasTouch?'touchstart':'mousedown'),move:(utils.hasTouch?'touchmove':'mousemove'),up:(utils.hasTouch?'touchend':'mouseup'),out:(utils.hasTouch?'touchcancel':'mouseout')};return eventTypes[action];},page:function(t,e){return(utils.hasTouch&&e.touches.length&&e.touches[0])?e.touches[0]['page'+t]:e['page'+t];},klass:{has:function(el,name){return(el.className).indexOf(name)!==-1;},add:function(el,name){if(!utils.klass.has(el,name)&&settings.addBodyClasses){el.className+=" "+name;}},remove:function(el,name){if(settings.addBodyClasses){el.className=(el.className).replace(" "+name,"");}}},dispatchEvent:function(type){if(typeof eventList[type]==='function'){return eventList[type].call();}},vendor:function(){var tmp=doc.createElement("div"),prefixes='webkit Moz O ms'.split(' '),i;for(i in prefixes){if(typeof tmp.style[prefixes[i]+'Transition']!=='undefined'){return prefixes[i];}}},transitionCallback:function(){return(cache.vendor==='Moz'||cache.vendor==='ms')?'transitionend':cache.vendor+'TransitionEnd';},canTransform:function(){return typeof settings.element.style[cache.vendor+'Transform']!=='undefined';},deepExtend:function(destination,source){var property;for(property in source){if(source[property]&&source[property].constructor&&source[property].constructor===Object){destination[property]=destination[property]||{};utils.deepExtend(destination[property],source[property]);}else{destination[property]=source[property];}}
return destination;},angleOfDrag:function(x,y){var degrees,theta;theta=Math.atan2(-(cache.startDragY-y),(cache.startDragX-x));if(theta<0){theta+=2*Math.PI;}
degrees=Math.floor(theta*(180/Math.PI)-180);if(degrees<0&&degrees>-180){degrees=360-Math.abs(degrees);}
return Math.abs(degrees);},events:{addEvent:function addEvent(element,eventName,func){if(element.addEventListener){return element.addEventListener(eventName,func,false);}else if(element.attachEvent){return element.attachEvent("on"+eventName,func);}},removeEvent:function addEvent(element,eventName,func){if(element.addEventListener){return element.removeEventListener(eventName,func,false);}else if(element.attachEvent){return element.detachEvent("on"+eventName,func);}},prevent:function(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}}},parentUntil:function(el,attr){var isStr=typeof attr==='string';while(el.parentNode){if(isStr&&el.getAttribute&&el.getAttribute(attr)){return el;}else if(!isStr&&el===attr){return el;}
el=el.parentNode;}
return null;}},action={translate:{get:{matrix:function(index){if(!utils.canTransform()){return parseInt(settings.element.style.left,10);}else{var matrix=win.getComputedStyle(settings.element)[cache.vendor+'Transform'].match(/\((.*)\)/),ieOffset=8;if(matrix){matrix=matrix[1].split(',');if(matrix.length===16){index+=ieOffset;}
return parseInt(matrix[index],10);}
return 0;}}},easeCallback:function(){settings.element.style[cache.vendor+'Transition']='';cache.translation=action.translate.get.matrix(4);cache.easing=false;clearInterval(cache.animatingInterval);if(cache.easingTo===0){utils.klass.remove(doc.body,'snapjs-right');utils.klass.remove(doc.body,'snapjs-left');}
utils.dispatchEvent('animated');utils.events.removeEvent(settings.element,utils.transitionCallback(),action.translate.easeCallback);},easeTo:function(n){if(!utils.canTransform()){cache.translation=n;action.translate.x(n);}else{cache.easing=true;cache.easingTo=n;settings.element.style[cache.vendor+'Transition']='all '+settings.transitionSpeed+'s '+settings.easing;cache.animatingInterval=setInterval(function(){utils.dispatchEvent('animating');},1);utils.events.addEvent(settings.element,utils.transitionCallback(),action.translate.easeCallback);action.translate.x(n);}
if(n===0){settings.element.style[cache.vendor+'Transform']='';}},x:function(n){if((settings.disable==='left'&&n>0)||(settings.disable==='right'&&n<0)){return;}
if(!settings.hyperextensible){if(n===settings.maxPosition||n>settings.maxPosition){n=settings.maxPosition;}else if(n===settings.minPosition||n<settings.minPosition){n=settings.minPosition;}}
n=parseInt(n,10);if(isNaN(n)){n=0;}
if(utils.canTransform()){var theTranslate='translate3d('+n+'px, 0,0)';settings.element.style[cache.vendor+'Transform']=theTranslate;}else{settings.element.style.width=(win.innerWidth||doc.documentElement.clientWidth)+'px';settings.element.style.left=n+'px';settings.element.style.right='';}}},drag:{listen:function(){cache.translation=0;cache.easing=false;utils.events.addEvent(settings.element,utils.eventType('down'),action.drag.startDrag);utils.events.addEvent(settings.element,utils.eventType('move'),action.drag.dragging);utils.events.addEvent(settings.element,utils.eventType('up'),action.drag.endDrag);},stopListening:function(){utils.events.removeEvent(settings.element,utils.eventType('down'),action.drag.startDrag);utils.events.removeEvent(settings.element,utils.eventType('move'),action.drag.dragging);utils.events.removeEvent(settings.element,utils.eventType('up'),action.drag.endDrag);},startDrag:function(e){var target=e.target?e.target:e.srcElement,ignoreParent=utils.parentUntil(target,'data-snap-ignore');if(ignoreParent){utils.dispatchEvent('ignore');return;}
if(settings.dragger){var dragParent=utils.parentUntil(target,settings.dragger);if(!dragParent&&(cache.translation!==settings.minPosition&&cache.translation!==settings.maxPosition)){return;}}
utils.dispatchEvent('start');settings.element.style[cache.vendor+'Transition']='';cache.isDragging=true;cache.hasIntent=null;cache.intentChecked=false;cache.startDragX=utils.page('X',e);cache.startDragY=utils.page('Y',e);cache.dragWatchers={current:0,last:0,hold:0,state:''};cache.simpleStates={opening:null,towards:null,hyperExtending:null,halfway:null,flick:null,translation:{absolute:0,relative:0,sinceDirectionChange:0,percentage:0}};},dragging:function(e){if(cache.isDragging&&settings.touchToDrag){var thePageX=utils.page('X',e),thePageY=utils.page('Y',e),translated=cache.translation,absoluteTranslation=action.translate.get.matrix(4),whileDragX=thePageX-cache.startDragX,openingLeft=absoluteTranslation>0,translateTo=whileDragX,diff;if((cache.intentChecked&&!cache.hasIntent)){return;}
if(settings.addBodyClasses){if((absoluteTranslation)>0){utils.klass.add(doc.body,'snapjs-left');utils.klass.remove(doc.body,'snapjs-right');}else if((absoluteTranslation)<0){utils.klass.add(doc.body,'snapjs-right');utils.klass.remove(doc.body,'snapjs-left');}}
if(cache.hasIntent===false||cache.hasIntent===null){var deg=utils.angleOfDrag(thePageX,thePageY),inRightRange=(deg>=0&&deg<=settings.slideIntent)||(deg<=360&&deg>(360-settings.slideIntent)),inLeftRange=(deg>=180&&deg<=(180+settings.slideIntent))||(deg<=180&&deg>=(180-settings.slideIntent));if(!inLeftRange&&!inRightRange){cache.hasIntent=false;}else{cache.hasIntent=true;}
cache.intentChecked=true;}
if((settings.minDragDistance>=Math.abs(thePageX-cache.startDragX))||(cache.hasIntent===false)){return;}
utils.events.prevent(e);utils.dispatchEvent('drag');cache.dragWatchers.current=thePageX;if(cache.dragWatchers.last>thePageX){if(cache.dragWatchers.state!=='left'){cache.dragWatchers.state='left';cache.dragWatchers.hold=thePageX;}
cache.dragWatchers.last=thePageX;}else if(cache.dragWatchers.last<thePageX){if(cache.dragWatchers.state!=='right'){cache.dragWatchers.state='right';cache.dragWatchers.hold=thePageX;}
cache.dragWatchers.last=thePageX;}
if(openingLeft){if(settings.maxPosition<absoluteTranslation){diff=(absoluteTranslation-settings.maxPosition)*settings.resistance;translateTo=whileDragX-diff;}
cache.simpleStates={opening:'left',towards:cache.dragWatchers.state,hyperExtending:settings.maxPosition<absoluteTranslation,halfway:absoluteTranslation>(settings.maxPosition/2),flick:Math.abs(cache.dragWatchers.current-cache.dragWatchers.hold)>settings.flickThreshold,translation:{absolute:absoluteTranslation,relative:whileDragX,sinceDirectionChange:(cache.dragWatchers.current-cache.dragWatchers.hold),percentage:(absoluteTranslation/settings.maxPosition)*100}};}else{if(settings.minPosition>absoluteTranslation){diff=(absoluteTranslation-settings.minPosition)*settings.resistance;translateTo=whileDragX-diff;}
cache.simpleStates={opening:'right',towards:cache.dragWatchers.state,hyperExtending:settings.minPosition>absoluteTranslation,halfway:absoluteTranslation<(settings.minPosition/2),flick:Math.abs(cache.dragWatchers.current-cache.dragWatchers.hold)>settings.flickThreshold,translation:{absolute:absoluteTranslation,relative:whileDragX,sinceDirectionChange:(cache.dragWatchers.current-cache.dragWatchers.hold),percentage:(absoluteTranslation/settings.minPosition)*100}};}
action.translate.x(translateTo+translated);}},endDrag:function(e){if(cache.isDragging){utils.dispatchEvent('end');var translated=action.translate.get.matrix(4);if(cache.dragWatchers.current===0&&translated!==0&&settings.tapToClose){utils.events.prevent(e);action.translate.easeTo(0);cache.isDragging=false;cache.startDragX=0;return;}
if(cache.simpleStates.opening==='left'){if((cache.simpleStates.halfway||cache.simpleStates.hyperExtending||cache.simpleStates.flick)){if(cache.simpleStates.flick&&cache.simpleStates.towards==='left'){action.translate.easeTo(0);}else if((cache.simpleStates.flick&&cache.simpleStates.towards==='right')||(cache.simpleStates.halfway||cache.simpleStates.hyperExtending)){action.translate.easeTo(settings.maxPosition);}}else{action.translate.easeTo(0);}}else if(cache.simpleStates.opening==='right'){if((cache.simpleStates.halfway||cache.simpleStates.hyperExtending||cache.simpleStates.flick)){if(cache.simpleStates.flick&&cache.simpleStates.towards==='right'){action.translate.easeTo(0);}else if((cache.simpleStates.flick&&cache.simpleStates.towards==='left')||(cache.simpleStates.halfway||cache.simpleStates.hyperExtending)){action.translate.easeTo(settings.minPosition);}}else{action.translate.easeTo(0);}}
cache.isDragging=false;cache.startDragX=utils.page('X',e);}}}},init=function(opts){if(opts.element){utils.deepExtend(settings,opts);cache.vendor=utils.vendor();action.drag.listen();}};this.open=function(side){utils.klass.remove(doc.body,'snapjs-expand-left');utils.klass.remove(doc.body,'snapjs-expand-right');if(side==='left'){cache.simpleStates.opening='left';cache.simpleStates.towards='right';utils.klass.add(doc.body,'snapjs-left');utils.klass.remove(doc.body,'snapjs-right');action.translate.easeTo(settings.maxPosition);}else if(side==='right'){cache.simpleStates.opening='right';cache.simpleStates.towards='left';utils.klass.remove(doc.body,'snapjs-left');utils.klass.add(doc.body,'snapjs-right');action.translate.easeTo(settings.minPosition);}};this.close=function(){action.translate.easeTo(0);};this.expand=function(side){var to=win.innerWidth||doc.documentElement.clientWidth;if(side==='left'){utils.klass.add(doc.body,'snapjs-expand-left');utils.klass.remove(doc.body,'snapjs-expand-right');}else{utils.klass.add(doc.body,'snapjs-expand-right');utils.klass.remove(doc.body,'snapjs-expand-left');to*=-1;}
action.translate.easeTo(to);};this.on=function(evt,fn){eventList[evt]=fn;return this;};this.off=function(evt){if(eventList[evt]){eventList[evt]=false;}};this.enable=function(){action.drag.listen();};this.disable=function(){action.drag.stopListening();};this.settings=function(opts){utils.deepExtend(settings,opts);};this.state=function(){var state,fromLeft=action.translate.get.matrix(4);if(fromLeft===settings.maxPosition){state='left';}else if(fromLeft===settings.minPosition){state='right';}else{state='closed';}
return{state:state,info:cache.simpleStates};};init(userOpts);};if((typeof module!=='undefined')&&module.exports){module.exports=Snap;}
if(typeof ender==='undefined'){this.Snap=Snap;}
if((typeof define==="function")&&define.amd){define("snap",[],function(){return Snap;});}}).call(this,window,document);;Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);}else if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;}else{throw new TypeError(date1+" - "+date2);}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);};$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;}}
return-1;};$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];};$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}
return null;};$D.getTimezoneOffset=function(name){var z=$C.timezones,p;for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;}}
return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);};$P.isToday=function(){return this.isSameDay(new Date());};$P.isSameDay=function(date){return this.clone().clearTime().equals(date.clone().clearTime());};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);};$P.addDays=function(value){this.setDate(this.getDate()+value);return this;};$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;return this;}
var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);}
if(x.seconds){this.addSeconds(x.seconds);}
if(x.minutes){this.addMinutes(x.minutes);}
if(x.hours){this.addHours(x.hours);}
if(x.weeks){this.addWeeks(x.weeks);}
if(x.months){this.addMonths(x.months);}
if(x.years){this.addYears(x.years);}
if(x.days){this.addDays(x.days);}
return this;};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;f=$d+((153*($m-3)+2)/5)+58+s;}
g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);}else if(n>364+s){w=1;}else{w=(n/7|0)+1;}
$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());};$D._validate=function(n,min,max,name){if(typeof n=="undefined"){return false;}else if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");}
return true;};$D.validateMillisecond=function(value){return $D._validate(value,0,999,"millisecond");};$D.validateSecond=function(value){return $D._validate(value,0,59,"second");};$D.validateMinute=function(value){return $D._validate(value,0,59,"minute");};$D.validateHour=function(value){return $D._validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return $D._validate(value,1,$D.getDaysInMonth(year,month),"day");};$D.validateMonth=function(value){return $D._validate(value,0,11,"month");};$D.validateYear=function(value){return $D._validate(value,0,9999,"year");};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());}
if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());}
if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());}
if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}
if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());}
if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());}
if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());}
if(config.timezone){this.setTimezone(config.timezone);}
if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);}
if(config.week&&$D._validate(config.week,0,53,"week")){this.setWeek(config.week);}
return this;};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;}
else if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);}
return this;}
return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);}};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?'0'+n:n;}
return'"'+this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z"';};}
$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$C.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);}}
var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");}
x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());default:return m;}}):this._toString();};}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,$N=Number.prototype;$P._orient=+1;$P._nth=null;$P._is=false;$P._same=false;$P._isSecond=false;$N._dateElement="day";$P.next=function(){this._orient=+1;return this;};$D.next=function(){return $D.today().next();};$P.last=$P.prev=$P.previous=function(){this._orient=-1;return this;};$D.last=$D.prev=$D.previous=function(){return $D.today().last();};$P.is=function(){this._is=true;return this;};$P.same=function(){this._same=true;this._isSecond=false;return this;};$P.today=function(){return this.same().day();};$P.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}
return false;};$P.at=function(time){return(typeof time==="string")?$D.parse(this.toString("d")+" "+time):this.set(time);};$N.fromNow=$N.after=function(date){var c={};c[this._dateElement]=this;return((!date)?new Date():date.clone()).add(c);};$N.ago=$N.before=function(date){var c={};c[this._dateElement]=this*-1;return((!date)?new Date():date.clone()).add(c);};var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),pxf=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),nth=("final first second third fourth fifth").split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++){o[px[i].toLowerCase()]=this["get"+pxf[i]]();}
return o;};$D.fromObject=function(config){config.week=null;return Date.today().set(config);};var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n;}
if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}
this._isSecond=false;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp){throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");}
return this;}
return this.moveToDayOfWeek(n,this._orient);};};var sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();if(n===0&&$C.firstDayOfWeek===1&&t.getDay()!==0){shift=shift+7;}
return t.addDays(shift);};};for(var i=0;i<dx.length;i++){$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i;$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i);$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);}
var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n;}
return this.moveToMonth(n,this._orient);};};var smf=function(n){return function(){return $D.today().set({month:n,day:1});};};for(var j=0;j<mx.length;j++){$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j;$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j);$P[mx[j]]=$P[mx[j].substring(0,3)]=mf(j);}
var ef=function(j){return function(){if(this._isSecond){this._isSecond=false;return this;}
if(this._same){this._same=this._is=false;var o1=this.toObject(),o2=(arguments[0]||new Date()).toObject(),v="",k=j.toLowerCase();for(var m=(px.length-1);m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v]){return false;}
if(k==v){break;}}
return true;}
if(j.substring(j.length-1)!="s"){j+="s";}
return this["add"+j](this._orient);};};var nf=function(n){return function(){this._dateElement=n;return this;};};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$P[de]=$P[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de);}
$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){if(this._same){return this._ss(arguments[0]);}
if(dayOfWeek||dayOfWeek===0){return this.moveToNthOccurrence(dayOfWeek,n);}
this._nth=n;if(n===2&&(dayOfWeek===undefined||dayOfWeek===null)){this._isSecond=true;return this.addSeconds(this._orient);}
return this;};};for(var l=0;l<nth.length;l++){$P[nth[l]]=(l===0)?nthfn(-1):nthfn(l);}}());(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'";}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)]);}else{throw new $P.Exception(s);}};},token:function(s){return function(s){return _.rtoken(new RegExp("^\s*"+s+"\s*"))(s);};},stoken:function(s){return _.rtoken(new RegExp("^"+s));},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s);}catch(e){qx.push(rx[0]);s=rx[1];continue;}
break;}
return[qx,s];};},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s);}catch(e){return[rx,s];}
rx.push(r[0]);s=r[1];}
return[rx,s];};},optional:function(p){return function(s){var r=null;try{r=p.call(this,s);}catch(e){return[null,s];}
return[r[0],r[1]];};},not:function(p){return function(s){try{p.call(this,s);}catch(e){return[null,s];}
throw new $P.Exception(s);};},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]];}:null;},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx));}
return rx;},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s));}catch(e){r=cache[s]=e;}
if(r instanceof $P.Exception){throw r;}else{return r;}};},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){r=null;}
if(r){return r;}}
throw new $P.Exception(s);};},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){throw new $P.Exception(s);}
rx.push(r[0]);s=r[1];}
return[rx,s];};},all:function(){var px=arguments,_=_;return _.each(_.optional(px));},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0];}
return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s);}catch(e){break;}
rx.push(r[0]);try{q=d.call(this,r[1]);}catch(ex){q=null;break;}
s=q[1];}
if(!r){throw new $P.Exception(s);}
if(q){throw new $P.Exception(q[1]);}
if(c){try{r=c.call(this,r[1]);}catch(ey){throw new $P.Exception(r[1]);}}
return[rx,(r?r[1]:s)];};},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]];};},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)));},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s);}catch(e){continue;}
rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1]);}catch(ex){last=true;}}else{last=true;}
if(!last&&q[1].length===0){last=true;}
if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j]);}}
p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1];}}
if(rx[1].length<best[1].length){best=rx;}
if(best[1].length===0){break;}}
if(best[0].length===0){return best;}
if(c){try{q=c.call(this,best[1]);}catch(ey){throw new $P.Exception(best[1]);}
best[1]=q[1];}
return best;};},forward:function(gr,fname){return function(s){return gr[fname].call(this,s);};},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]];};},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]];};},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s);}
return rx;};}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments);}else if(arguments[0]instanceof Array){args=arguments[0];}
if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx;}}else{return op.apply(null,arguments);}};};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]]);}
var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0]);}else{return op.apply(null,arguments);}};};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]]);}}());(function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo;var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]));}else{if(ax[i]){rx.push(ax[i]);}}}
return rx;};$D.Grammar={};$D.Translator={hour:function(s){return function(){this.hour=Number(s);};},minute:function(s){return function(){this.minute=Number(s);};},second:function(s){return function(){this.second=Number(s);};},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase();};},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n);}else{this.timezone=s.toLowerCase();}};},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0]);};},month:function(s){return function(){this.month=(s.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1;};},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<$C.twoDigitYearMax)?2000:1900)));};},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(x){x=(x instanceof Array)?x:[x];for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this);}}
var now=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=now.getDate();}
if(!this.year){this.year=now.getFullYear();}
if(!this.month&&this.month!==0){this.month=now.getMonth();}
if(!this.day){this.day=1;}
if(!this.hour){this.hour=0;}
if(!this.minute){this.minute=0;}
if(!this.second){this.second=0;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.day>$D.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}
var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone});}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset});}
return r;},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null;}
for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this);}}
var today=$D.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else if(this.now){today=new Date();}
var expression=!!(this.days&&this.days!==null||this.orient||this.operator);var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){today.setTimeToNow();}
if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;expression=true;}}
if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(!this.month){this.month=temp.getMonth();}
this.year=temp.getFullYear();}
if(expression&&this.weekday&&this.unit!="month"){this.unit="day";gap=($D.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod);}
if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}
if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}
if(this.month&&!this.day&&this.value){today.set({day:this.value*1});if(!expression){this.day=this.value*1;}}
if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;expression=true;}
if(expression&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null;}
if(!this.unit){this.unit="day";}
if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*orient;}else if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}
this[this.unit+"s"]=this.value*orient;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(temp.getMonth()!==today.getMonth()){this.month=temp.getMonth();}}
if((this.month||this.month===0)&&!this.day){this.day=1;}
if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}
if(expression&&this.timezone&&this.day&&this.days){this.day=this.days;}
return(expression)?today.add(this):today.set(this);}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$C.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));}
fn=_C[keys]=_.any.apply(null,px);}
return fn;};g.ctoken2=function(key){return _.rtoken($C.regexPatterns[key]);};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s;};}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")));};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s;};});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s;};});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s;};});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"");};});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter);};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[$C.dateElementOrder]||g.mdy).call(this,s));};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt];}else{throw $D.Parsing.Exception(fmt);}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s));}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact);});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0]);};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]));}
return _.any.apply(null,rx);}else{return _get(fx);}};g._formats=g.formats(["\"yyyy-MM-ddTHH:mm:ssZ\"","yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r;}}catch(e){}
return g._start.call({},s);};$D._parse=$D.parse;$D.parse=function(s){var r=null;if(!s){return null;}
if(s instanceof Date){return s;}
try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};};$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s);};}());;;(function($,undefined){var supported,ls;if('localStorage'in window){try{ls=(typeof window.localStorage==='undefined')?undefined:window.localStorage;if(typeof ls=='undefined'||typeof window.JSON=='undefined'){supported=false;}else{supported=true;}}
catch(err){supported=false;}}
$.totalStorage=function(key,value,options){return $.totalStorage.impl.init(key,value);};$.totalStorage.setItem=function(key,value){return $.totalStorage.impl.setItem(key,value);};$.totalStorage.getItem=function(key){return $.totalStorage.impl.getItem(key);};$.totalStorage.getAll=function(){return $.totalStorage.impl.getAll();};$.totalStorage.deleteItem=function(key){return $.totalStorage.impl.deleteItem(key);};$.totalStorage.ls=function(value){supported=value?true:false;};$.totalStorage.impl={init:function(key,value){if(typeof value!='undefined'){return this.setItem(key,value);}else{return this.getItem(key);}},setItem:function(key,value){if(!supported){try{$.cookie(key,JSON.stringify(value));return value;}catch(e){console.log('Local Storage not supported by this browser. Install the cookie plugin on your site to take advantage of the same functionality. You can get it at https://github.com/carhartl/jquery-cookie');}}
var saver=JSON.stringify(value);ls.setItem(key,saver);return this.parseResult(saver);},getItem:function(key){if(!supported){try{return this.parseResult($.cookie(key));}catch(e){return null;}}
var item=ls.getItem(key);return this.parseResult(item);},deleteItem:function(key){if(!supported){try{$.cookie(key,null);return true;}catch(e){return false;}}
ls.removeItem(key);return true;},getAll:function(){var items=[];if(!supported){try{var pairs=document.cookie.split(";");for(var i=0;i<pairs.length;i++){var pair=pairs[i].split('=');var key=pair[0];items.push({key:key,value:this.parseResult($.cookie(key))});}}catch(e){return null;}}else{for(var j in ls){if(j.length){items.push({key:j,value:this.parseResult(ls.getItem(j))});}}}
return items;},parseResult:function(res){var ret;try{ret=JSON.parse(res);if(typeof ret=='undefined'){ret=res;}
if(ret=='true'){ret=true;}
if(ret=='false'){ret=false;}
if(parseFloat(ret)==ret&&typeof ret!="object"){ret=parseFloat(ret);}}catch(e){ret=res;}
return ret;}};})(jQuery);;
/*
 * jQuery Cookie Plugin v1.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($,document){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
$.cookie=function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value==null)){options=$.extend({},$.cookie.defaults,options);if(value==null){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=String(value);return(document.cookie=[encodeURIComponent(key),'=',options.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
options=value||$.cookie.defaults||{};var decode=options.raw?raw:decoded;var cookies=document.cookie.split('; ');for(var i=0,parts;(parts=cookies[i]&&cookies[i].split('='));i++){if(decode(parts.shift())===key){return decode(parts.join('='));}}
return null;};$.cookie.defaults={};})(jQuery,document);;function TimeMachine(){'use strict';var _fixedTime=null;this.__construct=function()
{if($.totalStorage('TimeMachine')){_fixedTime=$.totalStorage('TimeMachine');}}
this.now=function()
{'use strict';return(_fixedTime)?_fixedTime:Date.now();}
this.returnToPresent=function()
{'use strict';_fixedTime=false;}
this.toBeContinued=function()
{$.totalStorage('TimeMachine',_fixedTime);}
this.travel=function(newTime)
{'use strict';_fixedTime=Date.parse(newTime);}
this.__construct();}
var DeLorean=new TimeMachine();;(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);;
/* Magnific Popup - v0.9.3 - 2013-07-16
* http://dimsemenov.com/plugins/magnific-popup/
* Copyright (c) 2013 Dmitry Semenov; */
;(function($){var CLOSE_EVENT='Close',BEFORE_CLOSE_EVENT='BeforeClose',AFTER_CLOSE_EVENT='AfterClose',BEFORE_APPEND_EVENT='BeforeAppend',MARKUP_PARSE_EVENT='MarkupParse',OPEN_EVENT='Open',CHANGE_EVENT='Change',NS='mfp',EVENT_NS='.'+NS,READY_CLASS='mfp-ready',REMOVING_CLASS='mfp-removing',PREVENT_CLOSE_CLASS='mfp-prevent-close';var mfp,MagnificPopup=function(){},_isJQ=!!(window.jQuery),_prevStatus,_window=$(window),_body,_document,_prevContentType,_wrapClasses,_currPopupType;var _mfpOn=function(name,f){mfp.ev.on(NS+name+EVENT_NS,f);},_getEl=function(className,appendTo,html,raw){var el=document.createElement('div');el.className='mfp-'+className;if(html){el.innerHTML=html;}
if(!raw){el=$(el);if(appendTo){el.appendTo(appendTo);}}else if(appendTo){appendTo.appendChild(el);}
return el;},_mfpTrigger=function(e,data){mfp.ev.triggerHandler(NS+e,data);if(mfp.st.callbacks){e=e.charAt(0).toLowerCase()+e.slice(1);if(mfp.st.callbacks[e]){mfp.st.callbacks[e].apply(mfp,$.isArray(data)?data:[data]);}}},_setFocus=function(){(mfp.st.focus?mfp.content.find(mfp.st.focus).eq(0):mfp.wrap).trigger('focus');},_getCloseBtn=function(type){if(type!==_currPopupType||!mfp.currTemplate.closeBtn){mfp.currTemplate.closeBtn=$(mfp.st.closeMarkup.replace('%title%',mfp.st.tClose));_currPopupType=type;}
return mfp.currTemplate.closeBtn;},_checkInstance=function(){if(!$.magnificPopup.instance){mfp=new MagnificPopup();mfp.init();$.magnificPopup.instance=mfp;}},_checkIfClose=function(target){if($(target).hasClass(PREVENT_CLOSE_CLASS)){return;}
var closeOnContent=mfp.st.closeOnContentClick;var closeOnBg=mfp.st.closeOnBgClick;if(closeOnContent&&closeOnBg){return true;}else{if(!mfp.content||$(target).hasClass('mfp-close')||(mfp.preloader&&target===mfp.preloader[0])){return true;}
if((target!==mfp.content[0]&&!$.contains(mfp.content[0],target))){if(closeOnBg){if($.contains(document,target)){return true;}}}else if(closeOnContent){return true;}}
return false;},supportsTransitions=function(){var s=document.createElement('p').style,v=['ms','O','Moz','Webkit'];if(s['transition']!==undefined){return true;}
while(v.length){if(v.pop()+'Transition'in s){return true;}}
return false;};MagnificPopup.prototype={constructor:MagnificPopup,init:function(){var appVersion=navigator.appVersion;mfp.isIE7=appVersion.indexOf("MSIE 7.")!==-1;mfp.isIE8=appVersion.indexOf("MSIE 8.")!==-1;mfp.isLowIE=mfp.isIE7||mfp.isIE8;mfp.isAndroid=(/android/gi).test(appVersion);mfp.isIOS=(/iphone|ipad|ipod/gi).test(appVersion);mfp.supportsTransition=supportsTransitions();mfp.probablyMobile=(mfp.isAndroid||mfp.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent));_body=$(document.body);_document=$(document);mfp.popupsCache={};},open:function(data){var i;if(data.isObj===false){mfp.items=data.items.toArray();mfp.index=0;var items=data.items,item;for(i=0;i<items.length;i++){item=items[i];if(item.parsed){item=item.el[0];}
if(item===data.el[0]){mfp.index=i;break;}}}else{mfp.items=$.isArray(data.items)?data.items:[data.items];mfp.index=data.index||0;}
if(mfp.isOpen){mfp.updateItemHTML();return;}
mfp.types=[];_wrapClasses='';if(data.mainEl&&data.mainEl.length){mfp.ev=data.mainEl.eq(0);}else{mfp.ev=_document;}
if(data.key){if(!mfp.popupsCache[data.key]){mfp.popupsCache[data.key]={};}
mfp.currTemplate=mfp.popupsCache[data.key];}else{mfp.currTemplate={};}
mfp.st=$.extend(true,{},$.magnificPopup.defaults,data);mfp.fixedContentPos=mfp.st.fixedContentPos==='auto'?!mfp.probablyMobile:mfp.st.fixedContentPos;if(mfp.st.modal){mfp.st.closeOnContentClick=false;mfp.st.closeOnBgClick=false;mfp.st.showCloseBtn=false;mfp.st.enableEscapeKey=false;}
if(!mfp.bgOverlay){mfp.bgOverlay=_getEl('bg').on('click'+EVENT_NS,function(e){mfp.close();});mfp.wrap=_getEl('wrap').attr('tabindex',-1).on('click'+EVENT_NS,function(e){if(_checkIfClose(e.target)){mfp.close();}});mfp.container=_getEl('container',mfp.wrap);}
mfp.contentContainer=_getEl('content');if(mfp.st.preloader){mfp.preloader=_getEl('preloader',mfp.container,mfp.st.tLoading);}
var modules=$.magnificPopup.modules;for(i=0;i<modules.length;i++){var n=modules[i];n=n.charAt(0).toUpperCase()+n.slice(1);mfp['init'+n].call(mfp);}
_mfpTrigger('BeforeOpen');if(mfp.st.showCloseBtn){if(!mfp.st.closeBtnInside){mfp.wrap.append(_getCloseBtn());}else{_mfpOn(MARKUP_PARSE_EVENT,function(e,template,values,item){values.close_replaceWith=_getCloseBtn(item.type);});_wrapClasses+=' mfp-close-btn-in';}}
if(mfp.st.alignTop){_wrapClasses+=' mfp-align-top';}
if(mfp.fixedContentPos){mfp.wrap.css({overflow:mfp.st.overflowY,overflowX:'hidden',overflowY:mfp.st.overflowY});}else{mfp.wrap.css({top:_window.scrollTop(),position:'absolute'});}
if(mfp.st.fixedBgPos===false||(mfp.st.fixedBgPos==='auto'&&!mfp.fixedContentPos)){mfp.bgOverlay.css({height:_document.height(),position:'absolute'});}
if(mfp.st.enableEscapeKey){_document.on('keyup'+EVENT_NS,function(e){if(e.keyCode===27){mfp.close();}});}
_window.on('resize'+EVENT_NS,function(){mfp.updateSize();});if(!mfp.st.closeOnContentClick){_wrapClasses+=' mfp-auto-cursor';}
if(_wrapClasses)
mfp.wrap.addClass(_wrapClasses);var windowHeight=mfp.wH=_window.height();var windowStyles={};if(mfp.fixedContentPos){if(mfp._hasScrollBar(windowHeight)){var s=mfp._getScrollbarSize();if(s){windowStyles.paddingRight=s;}}}
if(mfp.fixedContentPos){if(!mfp.isIE7){windowStyles.overflow='hidden';}else{$('body, html').css('overflow','hidden');}}
var classesToadd=mfp.st.mainClass;if(mfp.isIE7){classesToadd+=' mfp-ie7';}
if(classesToadd){mfp._addClassToMFP(classesToadd);}
mfp.updateItemHTML();_mfpTrigger('BuildControls');$('html').css(windowStyles);mfp.bgOverlay.add(mfp.wrap).prependTo(document.body);mfp._lastFocusedEl=document.activeElement;setTimeout(function(){if(mfp.content){mfp._addClassToMFP(READY_CLASS);_setFocus();}else{mfp.bgOverlay.addClass(READY_CLASS);}
_document.on('focusin'+EVENT_NS,function(e){if(e.target!==mfp.wrap[0]&&!$.contains(mfp.wrap[0],e.target)){_setFocus();return false;}});},16);mfp.isOpen=true;mfp.updateSize(windowHeight);_mfpTrigger(OPEN_EVENT);},close:function(){if(!mfp.isOpen)return;_mfpTrigger(BEFORE_CLOSE_EVENT);mfp.isOpen=false;if(mfp.st.removalDelay&&!mfp.isLowIE&&mfp.supportsTransition){mfp._addClassToMFP(REMOVING_CLASS);setTimeout(function(){mfp._close();},mfp.st.removalDelay);}else{mfp._close();}},_close:function(){_mfpTrigger(CLOSE_EVENT);var classesToRemove=REMOVING_CLASS+' '+READY_CLASS+' ';mfp.bgOverlay.detach();mfp.wrap.detach();mfp.container.empty();if(mfp.st.mainClass){classesToRemove+=mfp.st.mainClass+' ';}
mfp._removeClassFromMFP(classesToRemove);if(mfp.fixedContentPos){var windowStyles={paddingRight:''};if(mfp.isIE7){$('body, html').css('overflow','');}else{windowStyles.overflow='';}
$('html').css(windowStyles);}
_document.off('keyup'+EVENT_NS+' focusin'+EVENT_NS);mfp.ev.off(EVENT_NS);mfp.wrap.attr('class','mfp-wrap').removeAttr('style');mfp.bgOverlay.attr('class','mfp-bg');mfp.container.attr('class','mfp-container');if(mfp.st.showCloseBtn&&(!mfp.st.closeBtnInside||mfp.currTemplate[mfp.currItem.type]===true)){if(mfp.currTemplate.closeBtn)
mfp.currTemplate.closeBtn.detach();}
if(mfp._lastFocusedEl){$(mfp._lastFocusedEl).trigger('focus');}
mfp.currItem=null;mfp.content=null;mfp.currTemplate=null;mfp.prevHeight=0;_mfpTrigger(AFTER_CLOSE_EVENT);},updateSize:function(winHeight){if(mfp.isIOS){var zoomLevel=document.documentElement.clientWidth/window.innerWidth;var height=window.innerHeight*zoomLevel;mfp.wrap.css('height',height);mfp.wH=height;}else{mfp.wH=winHeight||_window.height();}
if(!mfp.fixedContentPos){mfp.wrap.css('height',mfp.wH);}
_mfpTrigger('Resize');},updateItemHTML:function(){var item=mfp.items[mfp.index];mfp.contentContainer.detach();if(mfp.content)
mfp.content.detach();if(!item.parsed){item=mfp.parseEl(mfp.index);}
var type=item.type;_mfpTrigger('BeforeChange',[mfp.currItem?mfp.currItem.type:'',type]);mfp.currItem=item;if(!mfp.currTemplate[type]){var markup=mfp.st[type]?mfp.st[type].markup:false;_mfpTrigger('FirstMarkupParse',markup);if(markup){mfp.currTemplate[type]=$(markup);}else{mfp.currTemplate[type]=true;}}
if(_prevContentType&&_prevContentType!==item.type){mfp.container.removeClass('mfp-'+_prevContentType+'-holder');}
var newContent=mfp['get'+type.charAt(0).toUpperCase()+type.slice(1)](item,mfp.currTemplate[type]);mfp.appendContent(newContent,type);item.preloaded=true;_mfpTrigger(CHANGE_EVENT,item);_prevContentType=item.type;mfp.container.prepend(mfp.contentContainer);_mfpTrigger('AfterChange');},appendContent:function(newContent,type){mfp.content=newContent;if(newContent){if(mfp.st.showCloseBtn&&mfp.st.closeBtnInside&&mfp.currTemplate[type]===true){if(!mfp.content.find('.mfp-close').length){mfp.content.append(_getCloseBtn());}}else{mfp.content=newContent;}}else{mfp.content='';}
_mfpTrigger(BEFORE_APPEND_EVENT);mfp.container.addClass('mfp-'+type+'-holder');mfp.contentContainer.append(mfp.content);},parseEl:function(index){var item=mfp.items[index],type=item.type;if(item.tagName){item={el:$(item)};}else{item={data:item,src:item.src};}
if(item.el){var types=mfp.types;for(var i=0;i<types.length;i++){if(item.el.hasClass('mfp-'+types[i])){type=types[i];break;}}
item.src=item.el.attr('data-mfp-src');if(!item.src){item.src=item.el.attr('href');}}
item.type=type||mfp.st.type||'inline';item.index=index;item.parsed=true;mfp.items[index]=item;_mfpTrigger('ElementParse',item);return mfp.items[index];},addGroup:function(el,options){var eHandler=function(e){e.mfpEl=this;mfp._openClick(e,el,options);};if(!options){options={};}
var eName='click.magnificPopup';options.mainEl=el;if(options.items){options.isObj=true;el.off(eName).on(eName,eHandler);}else{options.isObj=false;if(options.delegate){el.off(eName).on(eName,options.delegate,eHandler);}else{options.items=el;el.off(eName).on(eName,eHandler);}}},_openClick:function(e,el,options){var midClick=options.midClick!==undefined?options.midClick:$.magnificPopup.defaults.midClick;if(!midClick&&(e.which===2||e.ctrlKey||e.metaKey)){return;}
var disableOn=options.disableOn!==undefined?options.disableOn:$.magnificPopup.defaults.disableOn;if(disableOn){if($.isFunction(disableOn)){if(!disableOn.call(mfp)){return true;}}else{if(_window.width()<disableOn){return true;}}}
if(e.type){e.preventDefault();if(mfp.isOpen){e.stopPropagation();}}
options.el=$(e.mfpEl);if(options.delegate){options.items=el.find(options.delegate);}
mfp.open(options);},updateStatus:function(status,text){if(mfp.preloader){if(_prevStatus!==status){mfp.container.removeClass('mfp-s-'+_prevStatus);}
if(!text&&status==='loading'){text=mfp.st.tLoading;}
var data={status:status,text:text};_mfpTrigger('UpdateStatus',data);status=data.status;text=data.text;mfp.preloader.html(text);mfp.preloader.find('a').on('click',function(e){e.stopImmediatePropagation();});mfp.container.addClass('mfp-s-'+status);_prevStatus=status;}},_addClassToMFP:function(cName){mfp.bgOverlay.addClass(cName);mfp.wrap.addClass(cName);},_removeClassFromMFP:function(cName){this.bgOverlay.removeClass(cName);mfp.wrap.removeClass(cName);},_hasScrollBar:function(winHeight){return((mfp.isIE7?_document.height():document.body.scrollHeight)>(winHeight||_window.height()));},_parseMarkup:function(template,values,item){var arr;if(item.data){values=$.extend(item.data,values);}
_mfpTrigger(MARKUP_PARSE_EVENT,[template,values,item]);$.each(values,function(key,value){if(value===undefined||value===false){return true;}
arr=key.split('_');if(arr.length>1){var el=template.find(EVENT_NS+'-'+arr[0]);if(el.length>0){var attr=arr[1];if(attr==='replaceWith'){if(el[0]!==value[0]){el.replaceWith(value);}}else if(attr==='img'){if(el.is('img')){el.attr('src',value);}else{el.replaceWith('<img src="'+value+'" class="'+el.attr('class')+'" />');}}else{el.attr(arr[1],value);}}}else{template.find(EVENT_NS+'-'+key).html(value);}});},_getScrollbarSize:function(){if(mfp.scrollbarSize===undefined){var scrollDiv=document.createElement("div");scrollDiv.id="mfp-sbm";scrollDiv.style.cssText='width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';document.body.appendChild(scrollDiv);mfp.scrollbarSize=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv);}
return mfp.scrollbarSize;}};$.magnificPopup={instance:null,proto:MagnificPopup.prototype,modules:[],open:function(options,index){_checkInstance();if(!options)
options={};options.isObj=true;options.index=index||0;return this.instance.open(options);},close:function(){return $.magnificPopup.instance.close();},registerModule:function(name,module){if(module.options){$.magnificPopup.defaults[name]=module.options;}
$.extend(this.proto,module.proto);this.modules.push(name);},defaults:{disableOn:0,key:null,midClick:false,mainClass:'',preloader:true,focus:'',closeOnContentClick:false,closeOnBgClick:true,closeBtnInside:true,showCloseBtn:true,enableEscapeKey:true,modal:false,alignTop:false,removalDelay:0,fixedContentPos:'auto',fixedBgPos:'auto',overflowY:'auto',closeMarkup:'<button title="%title%" type="button" class="mfp-close">&times;</button>',tClose:'Close (Esc)',tLoading:'Loading...'}};$.fn.magnificPopup=function(options){_checkInstance();var jqEl=$(this);if(typeof options==="string"){if(options==='open'){var items,itemOpts=_isJQ?jqEl.data('magnificPopup'):jqEl[0].magnificPopup,index=parseInt(arguments[1],10)||0;if(itemOpts.items){items=itemOpts.items[index];}else{items=jqEl;if(itemOpts.delegate){items=items.find(itemOpts.delegate);}
items=items.eq(index);}
mfp._openClick({mfpEl:items},jqEl,itemOpts);}else{if(mfp.isOpen)
mfp[options].apply(mfp,Array.prototype.slice.call(arguments,1));}}else{if(_isJQ){jqEl.data('magnificPopup',options);}else{jqEl[0].magnificPopup=options;}
mfp.addGroup(jqEl,options);}
return jqEl;};var INLINE_NS='inline',_hiddenClass,_inlinePlaceholder,_lastInlineElement,_putInlineElementsBack=function(){if(_lastInlineElement){_inlinePlaceholder.after(_lastInlineElement.addClass(_hiddenClass)).detach();_lastInlineElement=null;}};$.magnificPopup.registerModule(INLINE_NS,{options:{hiddenClass:'hide',markup:'',tNotFound:'Content not found'},proto:{initInline:function(){mfp.types.push(INLINE_NS);_mfpOn(CLOSE_EVENT+'.'+INLINE_NS,function(){_putInlineElementsBack();});},getInline:function(item,template){_putInlineElementsBack();if(item.src){var inlineSt=mfp.st.inline,el=$(item.src);if(el.length){var parent=el[0].parentNode;if(parent&&parent.tagName){if(!_inlinePlaceholder){_hiddenClass=inlineSt.hiddenClass;_inlinePlaceholder=_getEl(_hiddenClass);_hiddenClass='mfp-'+_hiddenClass;}
_lastInlineElement=el.after(_inlinePlaceholder).detach().removeClass(_hiddenClass);}
mfp.updateStatus('ready');}else{mfp.updateStatus('error',inlineSt.tNotFound);el=$('<div>');}
item.inlineElement=el;return el;}
mfp.updateStatus('ready');mfp._parseMarkup(template,{},item);return template;}}});})(window.jQuery||window.Zepto);;jQuery.easing['jswing']=jQuery.easing['swing'];jQuery.extend(jQuery.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return jQuery.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});;function FastClick(layer){'use strict';var oldOnClick,self=this;this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=layer;if(!layer||!layer.nodeType){throw new TypeError('Layer must be a document node');}
this.onClick=function(){return FastClick.prototype.onClick.apply(self,arguments);};this.onMouse=function(){return FastClick.prototype.onMouse.apply(self,arguments);};this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(self,arguments);};this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(self,arguments);};this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(self,arguments);};if(FastClick.notNeeded(layer)){return;}
if(this.deviceIsAndroid){layer.addEventListener('mouseover',this.onMouse,true);layer.addEventListener('mousedown',this.onMouse,true);layer.addEventListener('mouseup',this.onMouse,true);}
layer.addEventListener('click',this.onClick,true);layer.addEventListener('touchstart',this.onTouchStart,false);layer.addEventListener('touchend',this.onTouchEnd,false);layer.addEventListener('touchcancel',this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==='click'){rmv.call(layer,type,callback.hijacked||callback,capture);}else{rmv.call(layer,type,callback,capture);}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==='click'){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event);}}),capture);}else{adv.call(layer,type,callback,capture);}};}
if(typeof layer.onclick==='function'){oldOnClick=layer.onclick;layer.addEventListener('click',function(event){oldOnClick(event);},false);layer.onclick=null;}}
FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf('Android')>0;FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&(/OS ([6-9]|\d{2})_\d/).test(navigator.userAgent);FastClick.prototype.needsClick=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'button':case'select':case'textarea':if(target.disabled){return true;}
break;case'input':if((this.deviceIsIOS&&target.type==='file')||target.disabled){return true;}
break;case'label':case'video':return true;}
return(/\bneedsclick\b/).test(target.className);};FastClick.prototype.needsFocus=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'textarea':case'select':return true;case'input':switch(target.type){case'button':case'checkbox':case'file':case'image':case'radio':case'submit':return false;}
return!target.disabled&&!target.readOnly;default:return(/\bneedsfocus\b/).test(target.className);}};FastClick.prototype.sendClick=function(targetElement,event){'use strict';var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur();}
touch=event.changedTouches[0];clickEvent=document.createEvent('MouseEvents');clickEvent.initMouseEvent('click',true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent);};FastClick.prototype.focus=function(targetElement){'use strict';var length;if(this.deviceIsIOS&&targetElement.setSelectionRange){length=targetElement.value.length;targetElement.setSelectionRange(length,length);}else{targetElement.focus();}};FastClick.prototype.updateScrollParent=function(targetElement){'use strict';var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break;}
parentElement=parentElement.parentElement;}while(parentElement);}
if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop;}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){'use strict';if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode;}
return eventTarget;};FastClick.prototype.onTouchStart=function(event){'use strict';var targetElement,touch,selection;if(event.targetTouches.length>1){return true;}
targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(this.deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true;}
if(!this.deviceIsIOS4){if(touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false;}
this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement);}}
this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if((event.timeStamp-this.lastClickTime)<200){event.preventDefault();}
return true;};FastClick.prototype.touchHasMoved=function(event){'use strict';var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true;}
return false;};FastClick.prototype.findControl=function(labelElement){'use strict';if(labelElement.control!==undefined){return labelElement.control;}
if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor);}
return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');};FastClick.prototype.onTouchEnd=function(event){'use strict';var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null;}
if(!this.trackingClick){return true;}
if((event.timeStamp-this.lastClickTime)<200){this.cancelNextClick=true;return true;}
this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(this.deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent;}
targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==='label'){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(this.deviceIsAndroid){return false;}
targetElement=forElement;}}else if(this.needsFocus(targetElement)){if((event.timeStamp-trackingClickStart)>100||(this.deviceIsIOS&&window.top!==window&&targetTagName==='input')){this.targetElement=null;return false;}
this.focus(targetElement);if(!this.deviceIsIOS4||targetTagName!=='select'){this.targetElement=null;event.preventDefault();}
return false;}
if(this.deviceIsIOS&&!this.deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true;}}
if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event);}
return false;};FastClick.prototype.onTouchCancel=function(){'use strict';this.trackingClick=false;this.targetElement=null;};FastClick.prototype.onMouse=function(event){'use strict';if(!this.targetElement){return true;}
if(event.forwardedTouchEvent){return true;}
if(!event.cancelable){return true;}
if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation();}else{event.propagationStopped=true;}
event.stopPropagation();event.preventDefault();return false;}
return true;};FastClick.prototype.onClick=function(event){'use strict';var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true;}
if(event.target.type==='submit'&&event.detail===0){return true;}
permitted=this.onMouse(event);if(!permitted){this.targetElement=null;}
return permitted;};FastClick.prototype.destroy=function(){'use strict';var layer=this.layer;if(this.deviceIsAndroid){layer.removeEventListener('mouseover',this.onMouse,true);layer.removeEventListener('mousedown',this.onMouse,true);layer.removeEventListener('mouseup',this.onMouse,true);}
layer.removeEventListener('click',this.onClick,true);layer.removeEventListener('touchstart',this.onTouchStart,false);layer.removeEventListener('touchend',this.onTouchEnd,false);layer.removeEventListener('touchcancel',this.onTouchCancel,false);};FastClick.notNeeded=function(layer){'use strict';var metaViewport;if(typeof window.ontouchstart==='undefined'){return true;}
if((/Chrome\/[0-9]+/).test(navigator.userAgent)){if(FastClick.prototype.deviceIsAndroid){metaViewport=document.querySelector('meta[name=viewport]');if(metaViewport&&metaViewport.content.indexOf('user-scalable=no')!==-1){return true;}}else{return true;}}
if(layer.style.msTouchAction==='none'){return true;}
return false;};FastClick.attach=function(layer){'use strict';return new FastClick(layer);};if(typeof define!=='undefined'&&define.amd){define(function(){'use strict';return FastClick;});}else if(typeof module!=='undefined'&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick;}else{window.FastClick=FastClick;};var App={currentPage:null,tagline:'',service:'/api/',server:'/',imgServer:'/',cached:{},community:null,page:{},config:null,forceHome:false,cookieExpire:new Date(3000,01,01),order:{cardChanged:false,pay_type:'card',delivery_type:'delivery',tip:'autotip'},signin:{},suggestion:{},restaurants:{permalink:'food-delivery',forceLoad:false},defaultRange:2,modal:{},hasBack:false,_init:false,_pageInit:false,_identified:false,isDeliveryAddressOk:false,touchX:null,touchY:null,touchOffset:null,boundingBoxMeters:8000,localStorage:false,isPhoneGap:document.location.protocol=='file:'};App.localStorage=App.isPhoneGap;App.alert=function(txt,title){setTimeout(function(){if(1==2&&App.isPhoneGap){navigator.notification.alert(txt,null,title||'Crunchbutton');}else{alert(txt);}});};App.go=function(url){App.rootScope.$apply(function($location){$location.path(App.isPhoneGap?url:'index.html#'+url);});};App.toggleMenu=function(){if(App.snap.state().state=='left'){App.snap.close();}else{App.snap.open('left');}};App.NGinit=function(){$('body').attr('ng-controller','AppController');angular.bootstrap(document,['NGApp']);if(App.config.env=='live'){$('.footer').addClass('footer-hide');}};var NGApp=angular.module('NGApp',[]);NGApp.config(function($compileProvider){$compileProvider.urlSanitizationWhitelist(/.*/);});NGApp.config(['$routeProvider','$locationProvider',function($routeProvider,$locationProvider){$routeProvider.when('/location',{action:'location',controller:'location',templateUrl:'assets/view/location.html'}).when('/'+App.restaurants.permalink,{action:'restaurants',controller:'restaurants',templateUrl:'assets/view/restaurants.html'}).when('/'+App.restaurants.permalink+'/:id',{action:'restaurant',controller:'restaurant',templateUrl:'assets/view/restaurant.html'}).when('/legal',{action:'legal',controller:'legal',templateUrl:'assets/view/legal.html'}).when('/help',{action:'help',controller:'help',templateUrl:'assets/view/help.html'}).when('/orders',{action:'orders',controller:'orders',templateUrl:'assets/view/orders.html'}).when('/order/:id',{action:'order',controller:'order',templateUrl:'assets/view/order.html'}).when('/cities',{action:'cities',controller:'cities',templateUrl:'assets/view/cities.html'}).when('/giftcard',{action:'giftcard',controller:'giftcard',templateUrl:'assets/view/home.html'}).when('/giftcard/:id',{action:'giftcard',controller:'giftcard',templateUrl:'assets/view/home.html'}).when('/reset',{action:'reset',controller:'reset',templateUrl:'assets/view/home.html'}).when('/reset/:id',{action:'reset',controller:'reset',templateUrl:'assets/view/home.html'}).when('/',{action:'home',controller:'home',templateUrl:'assets/view/home.html'}).otherwise({action:'home.default',controller:'default',templateUrl:'assets/view/home.html'});$locationProvider.html5Mode(!App.isPhoneGap);}]);NGApp.controller('AppController',function($scope,$route,$routeParams,$rootScope,$location,AccountService,MainNavigationService){App.rootScope=$rootScope;App.location=$location;$rootScope.link=function(link){$location.path(link||'/');};$rootScope.back=function(){history.back();};$rootScope.nl2br=function(t){return App.nl2br(t);};$rootScope.formatPhone=function(t){return App.phone.format(t);};$rootScope.formatPrice=function(t){return parseFloat(t).toFixed(2);};$rootScope.$safeApply=function(fn){fn=fn||function(){};if($rootScope.$$phase){if(fn){fn();}}
else{$rootScope.$apply(fn);}};$scope.$on('$routeChangeSuccess',function($currentRoute,$previousRoute){MainNavigationService.page=$route.current.action;return;var renderAction=$route.current.action;var renderPath=renderAction.split('.');$scope.renderAction=renderAction;$scope.renderPath=renderPath;if(App.isChromeForIOS()){App.message.chrome();}
setTimeout(function(){scrollTo(0,1);},80);});AccountService.checkUser();});App.track=function(){if(App.config.env!='live'){return;}
if(arguments[0]=='Ordered'){$('img.conversion').remove();mixpanel.people.track_charge(arguments[1].total);var i=$('<img class="conversion" src="https://www.googleadservices.com/pagead/conversion/996753959/?value='+Math.floor(arguments[1].total)+'&amp;label=-oawCPHy2gMQp4Sl2wM&amp;guid=ON&amp;script=0&url='+location.href+'">').appendTo($('body'));}
if(arguments[1]){mixpanel.track(arguments[0],arguments[1]);}else{mixpanel.track(arguments[0]);}};App.trackProperty=function(prop,value){if(App.config.env!='live'){return;}
var params={};params[prop]=value;mixpanel.register_once(params);};App.identify=function(){if(App.config.env!='live'){return;}
if(App.config.user.uuid){mixpanel.identify(App.config.user.uuid);mixpanel.people.set({$name:App.config.user.name,$ip:App.config.user.ip,$email:App.config.user.email});}};App.busy={isBusy:function(){return $('.app-busy').length?true:false;},makeBusy:function(){$('body').append($('<div class="app-busy"></div>').append($('<div class="app-busy-loader"><div class="app-busy-loader-icon"></div></div>')));},unBusy:function(){$('.app-busy').remove();}};App.test={card:function(){angular.element('html').injector().get('OrderService')._test();},logout:function(){$.getJSON(App.service+'logout',function(){location.reload()});},cart:function(){App.alert(JSON.stringify(App.cart.items));},clearloc:function(){$.totalstorage('community',null);$.totalstorage('location_lat',null);$.totalstorage('location_lon',null);location.href='/';},init:function(){$('.test-card').click(function(){App.test.card();});$('.test-logout').click(function(){App.test.logout();});$('.test-cart').click(function(){App.test.cart();});$('.test-clearloc').click(function(){App.test.clearloc();});}};App.processConfig=function(json,user){if(user&&!json){App.config.user=user;}else{App.config=json;}
App.AB.init();if(App.config.user){App.identify();}};App.init=function(config){if(App._init){return;}
App._init=true;FastClick.attach(document.body);if(App.isPhoneGap&&App.iOS7()){$('body').addClass('ios7');}
App.snap=new Snap({element:document.getElementById('snap-content'),disable:'right'});var snapperCheck=function(){if($(window).width()<=768){App.snap.enable();}else{App.snap.close();App.snap.disable();}};snapperCheck();$(window).resize(function(){snapperCheck();});$.totalStorage.ls(App.localStorage);if(typeof CB!=='undefined'&&CB.config){App.config=CB.config;CB.config=null;}
$(document).on('click','.location-detect',function(){$('.location-detect-loader').show();$('.location-detect-icon').hide();var error=function(){$('.location-address').val('Oh no! We couldn\'t locate you');$('.location-detect-loader').hide();$('.location-detect-icon').show();};var success=function(){App.page.foodDelivery();};App.loc.getLocationByBrowser(success,error);});$(document).on({mousedown:function(){$(this).addClass('location-detect-click');},touchstart:function(){$(this).addClass('location-detect-click');},mouseup:function(){$(this).removeClass('location-detect-click');},touchend:function(){$(this).removeClass('location-detect-click');}},'.location-detect');if(App.isMobile()){$(document).on('click','input[type="checkbox"]',function(e){e.stopPropagation();e.preventDefault();});$('input[type="checkbox"]').click(function(e){e.stopPropagation();e.preventDefault();$(this).checkToggle();});$('label[for]').click(function(e){e.stopPropagation();e.preventDefault();var target=document.getElementById($(this).attr('for'));if(target&&target.tagName=='INPUT'){switch($(target).attr('type')){case'text':case'password':case'number':case'phone':case'tel':$(target).focus();break;case'checkbox':$(target).checkToggle();break;}}
$(this).checkToggle();});$('a[href]').click(function(e){var el=$(this);var href=el.attr('href');if(!href||e.defaultPrevented){return;}
if($(this).attr('target')){window.open($(this).attr('href'),$(this).attr('target'));}else{location.href=$(this).attr('href');}});}
$(document).on('click','.button-deliver-payment, .dp-display-item a, .dp-display-item .clickable',function(){$('.payment-form').show();$('.delivery-payment-info, .content-padder-before').hide();});$(document).on({mousedown:function(){$(this).addClass('button-bottom-click');},touchstart:function(){$(this).addClass('button-bottom-click');},mouseup:function(){$(this).removeClass('button-bottom-click');},touchend:function(){$(this).removeClass('button-bottom-click');}},'.button-bottom');App.processConfig(config||App.config);App.AB.init();App.test.init();App.NGinit();};App.getCommunityById=function(id){for(x in App.communities){if(App.communities[x].id_community==id){return App.communities[x];}}
return false;}
App.dialog={show:function(){if(arguments[1]){var src='<div class="zoom-anim-dialog small-container">'+'<h1>'+arguments[0]+'</h1>'+'<div class="small-container-content">'+arguments[1]+'</div>'+'</div>';}else if($(arguments[0]).length){var src=$(arguments[0]);}else{console.log('ERROR WITH DIALOG');return;}
$.magnificPopup.open({items:{src:src,type:'inline'},fixedContentPos:true,fixedBgPos:true,closeBtnInside:true,preloader:false,midClick:true,removalDelay:300,overflowY:'auto',mainClass:'my-mfp-slide-bottom',callbacks:{open:function(){setTimeout(function(){},1);},close:function(){$('.wrapper').removeClass('dialog-open-effect-a dialog-open-effect-b dialog-open-effect-c dialog-open-effect-d');}}});}};App.message={chrome:function(){var title='How to use Chrome',message='<p>'+'Just tap "Request Desktop Site."'+'</p>'+'<p align="center">'+'<img style="border:1px solid #000" src="/assets/images/chrome-options.png" />'+'</p>';App.dialog.show(title,message);}};App.playAudio=function(audio){if(App.isPhoneGap){try{navigator.notification.vibrate(100);}catch(e){}}
var audio=$('#'+audio).get(0);if(!audio){return};try{audio.play();}catch(e){}};var dateTime={timer:0,now:false};dateTime.update=function(){var time=_gmtServer.split('/');dateTime.now=new Date(Number(time[0]),Number(time[1]-1),Number(time[2]),Number(time[3]),Number(time[4]),(Number(time[5])+dateTime.timer));dateTime.timer++;setTimeout(function(){dateTime.update();},1000);}
dateTime.toString=function(){return dateTime.now.toString('dd MMMM yyyy HH:mm:ss');}
dateTime.update();;if(typeof(console)=='undefined'){console={log:function(){return null;},debug:function(){return null;}};}
if(typeof(Number.prototype.toRad)==='undefined'){Number.prototype.toRad=function(){return this*Math.PI/180;}}
var _toRad=function(){var Value=arguments.shift();return Number.prototype.toRad.call(Value,args);};if(!typeof(App)=='undefined'){App={};}
App.capitalize=function(word){return word.charAt(0).toUpperCase()+word.slice(1);};App.request=function(url,complete){$.getJSON(url,function(json){complete(json);});};App.cache=function(type,id){var finalid,args=arguments,complete,partComplete;complete=args[2]?args[2]:function(){};partComplete=function(){if(this.uuid){App.cached[type][id.uuid]=this;App.cached[type][id]=this;}
if(this.permalink){App.cached[type][id.permalink]=this;App.cached[type][id]=this;}
complete.call(this);}
if(typeof(id)=='object'){eval('App.cached[type][id.id] = new '+type+'(id,partComplete)');finalid=id.id;}else if(!App.cached[type][id]){eval('App.cached[type][id] = new '+type+'(id,partComplete)');}else{complete.call(App.cached[type][id]);}
return App.cached[type][finalid||id];};App.ceil=function(num){num=num*100;num=Math.ceil(num);return num/100;};App.phone={format:function(num){if(num!=null){num=num.replace(/^0|^1/,'');num=num.replace(/[^\d]*/gi,'');num=num.substr(0,10);if(num.length>=7){num=num.replace(/(\d{3})(\d{3})(.*)/,"$1-$2-$3");}else if(num.length>=4){num=num.replace(/(\d{3})(.*)/,"$1-$2");}}
return num;},validate:function(num){if(!num){return false;}
num=num.replace(new RegExp('-','g'),'');if(!num||num.length!=10){return false;}
var
nums=num.split(''),prev;for(x in nums){if(!prev){prev=nums[x];continue;}
if(nums[x]!=prev){return true;}}
return false;}};App.pad=function(number,length){var str=''+number;while(str.length<length){str='0'+str;}
return str;};App.formatTime=function(time){if(!time){return'';}
var vals=time.split(':');var pm=false;vals[0]=new String(vals[0]);vals[1]=vals[1]?new String(vals[1]):0;if(vals[0].match(/^[0-9]{3,4}$/i)){vals[1]=vals[0].substr(-2,2);vals[0]=vals[0].substr(0,vals[0].length-2);}
if(vals[0]=='12'){pm=true;}
if(vals[0]=='24'){vals[0]='00';}
if(vals[0]>12){vals[0]-=12;pm=true;}else{if(!pm&&time.match(/p/i)){pm=true;}
if(pm&&time.match(/a/i)){pm=false;}}
if(!vals[1]){vals[1]='00';}
vals[1]=vals[1].replace(/[^0-9]+/,'');vals[0]=new String(vals[0]).replace(/[^0-9]+/,'');vals[0]=App.pad(vals[0],2);vals[1]=App.pad(vals[1],2);if(vals[0]=='00'){vals[0]=12;}
return vals.join(':')+(pm?' PM':' AM');};App.unFormatTime=function(time){var part=time.split(' ');part[0]=part[0].split(':');part[0][0]=parseInt(part[0][0],10);if(part[1]=='PM'){if(part[0][0]!=12){part[0][0]=App.pad(part[0][0]+12,2);}}else{if(part[0][0]==12){part[0][0]='00';}}
return part[0][0]+':'+part[0][1];};App.cleanInput=function(text){text=App.cleanBad(text);var type=arguments[1];switch(type){case'float':text=text.replace(/[^0-9\.]+/i,'');break;case'text':default:text=text.replace(/[^a-z0-9\-_ \(\)\+\.\@\%\&\!\;\:\"\'\,\\\/]+/i,'');break;}
return text};App.cleanBad=function(s){s=s.replace(/\u2018|\u2019|\u201A|\uFFFD/g,"'");s=s.replace(/\u201c|\u201d|\u201e/g,'"');s=s.replace(/\u02C6/g,'^');s=s.replace(/\u2039/g,'<');s=s.replace(/\u203A/g,'>');s=s.replace(/\u2013/g,'-');s=s.replace(/\u2014/g,'--');s=s.replace(/\u2026/g,'...');s=s.replace(/\u00A9/g,'(c)');s=s.replace(/\u00AE/g,'(r)');s=s.replace(/\u2122/g,'TM');s=s.replace(/\u00BC/g,'1/4');s=s.replace(/\u00BD/g,'1/2');s=s.replace(/\u00BE/g,'3/4');s=s.replace(/[\u02DC|\u00A0]/g," ");return s;};App.callPhone=function(phone){if(App.isMobile()){return'<a href="tel:'+App.phone.format(phone).replace(/\-/g,'')+'">'+phone+'</a>';}else{return phone;}}
App.isMobile=function(){return $.browser.mobile;}
App.isNarrowScreen=function(){return $(window).width()<=769;}
App.iOS=function(){return /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());}
App.iOS7=function(){return /iphone os 7_/i.test(navigator.userAgent.toLowerCase());}
App.isAndroid=function(){return /android/i.test(navigator.userAgent.toLowerCase());}
App.isChrome=function(){return /chrom(e|ium)/.test(navigator.userAgent.toLowerCase())||/crios/.test(navigator.userAgent.toLowerCase())||(typeof window.chrome==='object');}
App.isChromeForIOS=function(){return App.isMobile()&&App.iOS()&&App.isChrome();}
var sort_by;(function(){var default_cmp=function(a,b){if(a==b)return 0;return a<b?-1:1;},getCmpFunc=function(primer,reverse){var cmp=default_cmp;if(primer){cmp=function(a,b){return default_cmp(primer(a),primer(b));};}
if(reverse){return function(a,b){return-1*cmp(a,b);};}
return cmp;};sort_by=function(){var fields=[],n_fields=arguments.length,field,name,reverse,cmp;for(var i=0;i<n_fields;i++){field=arguments[i];if(typeof field==='string'){name=field;cmp=default_cmp;}
else{name=field.name;cmp=getCmpFunc(field.primer,field.reverse);}
fields.push({name:name,cmp:cmp});}
return function(A,B){var a,b,name,cmp,result;for(var i=0,l=n_fields;i<l;i++){result=0;field=fields[i];name=field.name;cmp=field.cmp;result=cmp(A[name],B[name]);if(result!==0)break;}
return result;}}}());App.nl2br=function(string){if(string){return string.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,'$1<br/>$2');}}
var startCoords={},endCoords={},cordsThresh=3;if(window.jQuery){(function($){$.fn.checkToggle=function(params){var checks=$(this).filter('input[type="checkbox"]');$(this).filter('input[type="checkbox"]').each(function(){$(this).prop('checked',!$(this).is(':checked'));});return this;};})(jQuery);}
NGApp.filter('iif',function(){return function(input,trueValue,falseValue){return input?trueValue:falseValue;};});NGApp.directive('ngInstant',function(){return function(scope,element,attrs){element.bind(App.isMobile()?'touchstart':'click',function(e){scope.$apply(attrs['ngInstant'],element);e.preventDefault();e.stopPropagation();});};});;NGApp.controller('legal',function($scope,$http){$http.get(App.service+'legal').success(function(data){$scope.legal=data.data;});});NGApp.controller('help',function($scope,$http){$http.get(App.service+'help').success(function(data){$scope.help=data.data;$('.crunchbutton-join-mail').html('moc.nottubhcnurc@nioj'.split('').reverse().join(''));});});NGApp.controller('home',function($scope,$http,$location,RestaurantsService){$scope.restaurantsService=RestaurantsService;$scope.restaurantsService.list(function(){$location.path('/'+App.restaurants.permalink);},function(){$location.path('/location');});});NGApp.controller('default',function($scope,$http,$location,CommunityAliasService){var community=CommunityAliasService;community.route($location.path(),function(results){if(results.alias){community.position.addLocation(new Location({address:results.alias.address(),entered:results.address,type:'alias',lat:results.alias.lat(),lon:results.alias.lon(),city:results.alias.city(),prep:results.alias.prep()}));$location.path('/'+App.restaurants.permalink);}},function(){$location.path('/location');});});NGApp.controller('restaurants',function($scope,$http,$location,RestaurantsService){$scope.mealItemClass=App.isAndroid()?'meal-food-android':'';$scope.restaurants=RestaurantsService;$scope.display=function(){if(!this.restaurant.open()){App.alert("This restaurant is currently closed. It will be open during the following hours ("+this.restaurant._tzabbr+"):\n\n"+this.restaurant.closedMessage());App.busy.unBusy();}else{$location.path('/'+App.restaurants.permalink+'/'+this.restaurant.permalink);}};$scope.restaurants.list(function(){try{var slogan=App.slogan.slogan;var sloganReplace=$scope.restaurants.position.pos().prep()+' '+$scope.restaurants.position.pos().city();sloganReplace=$.trim(sloganReplace);var tagline=App.tagline.tagline.replace('%s',sloganReplace);slogan=slogan.replace('%s',sloganReplace);}catch(e){console.log('Failed to load dynamic text',App.slogan,App.tagline,e);var slogan='';var tagline='';}
document.title=$scope.restaurants.position.pos().city()+' Food Delivery | Order Food from '+($scope.restaurants.position.pos().city()||'Local')+' Restaurants | Crunchbutton';$scope.restaurants=$scope.restaurants.sort();$scope.slogan=slogan;$scope.tagline=tagline;if($scope.restaurants.length==4){$('.content').addClass('short-meal-list');}else{$('.content').removeClass('short-meal-list');}
$('.content').removeClass('smaller-width');$('.nav-back').removeClass('nav-back-show');},function(){$location.path('/location');});});NGApp.controller('cities',function($scope,$http){$scope.topCommunities=App.topCommunities;});NGApp.controller('location',function($scope,$http,$location,RestaurantsService,LocationService,AccountService){var account=AccountService;$scope.isUser=account.user.has_auth;$scope.notUser=!account.user.has_auth;$scope.topCommunities=App.topCommunities;$scope.location=LocationService;if(!App.isPhoneGap){$scope.location.init();}
$scope.yourArea=$scope.location.position.pos().city()||'your area';$scope.restaurantsService=RestaurantsService;$scope.locationError=false;$scope.openCity=function(city){$location.path('/'+city);}
$scope.resetFormLocation=function(){$scope.location.form.address='';$scope.locationError=false;}
$scope.$watch('location.position.pos().city()',function(newValue,oldValue,scope){$scope.yourArea=$scope.location.position.pos().city()||'your area';});$scope.letsEat=function(){$scope.location.form.address=$.trim($scope.location.form.address);if($scope.location.form.address==''){$('.location-address').val('').attr('placeholder','Please enter your address here');}else{$scope.location.addVerify($scope.location.form.address,function(){$scope.restaurantsService.list(function(){$location.path('/'+App.restaurants.permalink);},function(){$scope.recommend.greetings=false;$scope.locationError=true;});},function(){$('.location-address').val('').attr('placeholder','Oops! We couldn\'t find that address!');});}}});NGApp.controller('restaurant',function($scope,$http,$routeParams,RestaurantService,OrderService,CreditService,GiftCardService,PositionsService){var order=OrderService;order.loaded=false;$scope.order={};$scope.order.form=order.form;$scope.order.info=order.info;$scope.order.showForm=order.showForm;$scope.order.updateTotal=function(){return order.updateTotal();}
$scope.order.subtotal=function(){return order.subtotal();}
$scope.order.submit=function(){return order.submit();}
$scope.order.cardInfoChanged=function(){return order.cardInfoChanged();}
$scope.order.toogleDelivery=function(type){return order.toogleDelivery(type);}
$scope.order.tooglePayment=function(type){return order.tooglePayment(type);}
$scope.order._years=function(){return order._years();}
$scope.order._months=function(){return order._months();}
$scope.order._tips=function(){return order._tips();}
$scope.$on('orderLoaded',function(e,data){$scope.order.loaded=order.loaded;$scope.order.showForm=order.showForm;});$scope.order.cart={};$scope.order.cart.items=order.cart.items;$scope.order.cart.add=function(item){return order.cart.add(item);}
$scope.order.cart.remove=function(item){return order.cart.remove(item);}
$scope.order.cart.customizeItem=function(option,item){return order.cart.customizeItem(option,item);}
$scope.order.cart.hasItems=function(){return order.cart.hasItems();}
$scope.$watch('order.cart.items',function(newValue,oldValue,scope){$scope.order.updateTotal();},true);$scope.user=order.account.user;$scope.AB={dollar:(App.config.ab&&App.config.ab.dollarSign=='show')?'$':'',changeablePrice:function(dish){return(App.config.ab&&App.config.ab.changeablePrice=='show'&&dish.changeable_price)?'+':''},restaurantPage:(App.config.ab&&App.config.ab.restaurantPage=='restaurant-page-noimage')?' restaurant-pic-wrapper-hidden':''};var giftcard=GiftCardService;$scope.giftcard={giftcards:{}};$scope.$on('giftCardUpdate',function(e,data){$scope.giftcard.giftcards.success=giftcard.notes_field.giftcards.success;$scope.giftcard.giftcards.error=giftcard.notes_field.giftcards.error;$scope.giftcard.value=giftcard.notes_field.value;$scope.giftcard.removed=giftcard.notes_field.removed;$scope.giftcard.hasGiftCards=giftcard.notes_field.hasGiftCards;});$scope.checkGiftCard=function(){giftcard.notes_field.content=$scope.order.form.notes;giftcard.notes_field.start();}
$scope.$watch('order.form.notes',function(newValue,oldValue,scope){$scope.checkGiftCard();});var credit=CreditService;$scope.credit={};$scope.$on('creditChanged',function(e,data){$scope.credit.value=credit.value;$scope.credit.redeemed=credit.redeemed;$scope.order.updateTotal();});var restaurantService=RestaurantService;$scope.$on('restaurantLoaded',function(e,data){var community=data.community;$scope.restaurant=data.restaurant;order.restaurant=$scope.restaurant;order.init();giftcard.notes_field.id_restaurant=$scope.restaurant.id_restaurant;giftcard.notes_field.restaurant_accepts=($scope.restaurant.giftcard>0);credit.getCredit($scope.restaurant.id_restaurant);document.title=$scope.restaurant.name+' | Food Delivery | Order from '+(community.name?community.name:'Local')+' Restaurants | Crunchbutton';var position=PositionsService;var address=position.pos();if(address.type()=='user'&&address.valid('order')){if(order._useCompleteAddress){$scope.order.form.address=address.formatted();}else{$scope.order.form.address=address.entered();}}
$('.body').css({'min-height':$('.restaurant-items').height()});});$('.config-icon').addClass('config-icon-mobile-hide');$('.nav-back').addClass('nav-back-show');$('.content').removeClass('smaller-width');$('.content').removeClass('short-meal-list');restaurantService.init();});NGApp.controller('order',function($scope,$http,$location,$routeParams,AccountService,AccountModalService,OrderViewService){$scope.account=AccountService;if(!$scope.account.isLogged()){$location.path('/'+App.restaurants.permalink);return;}
$scope.modal=AccountModalService;$scope.order=OrderViewService;$scope.order.load();$scope.callPhone=function(phone){return App.callPhone(phone);}
$scope.facebook=function(){$scope.order.facebook.postOrder();}});NGApp.controller('orders',function($scope,$http,$location,AccountService,AccountSignOut,OrdersService){$scope.account=AccountService;if(!$scope.account.isLogged()){$location.path('/'+App.restaurants.permalink);return;}
$scope.signout=AccountSignOut;$scope.orders=OrdersService;$scope.orders.all();});NGApp.controller('giftcard',function($scope,$location,GiftCardService){$scope.giftcard=GiftCardService;$scope.giftcard.parseURLCode();$location.path('/location');setTimeout(function(){$scope.giftcard.giftCardModal.open();},300);});NGApp.controller('reset',function($scope,$location,AccountModalService){$scope.modal=AccountModalService;$scope.modal.resetOpen();$location.path('/');});App.foodDelivery={};;App.signin.manageLocation=function(){return;if(App.loc.address()==''){if(App.config.user.address){App.loc.geocode(App.config.user.address,function(){App.page.foodDelivery(true);},function(){});}else if(App.config.user.location_lat&&App.config.user.location_lon){App.loc.reverseGeocode(App.config.user.location_lat,App.config.user.location_lon,function(){if(App.loc.realLoc.addressReverse){var address=App.loc.realLoc.addressReverse;App.loc.geocode(address,function(){App.page.foodDelivery(true);},function(){});}},function(){});}}};App.__cart={uuidInc:0,items:{},uuid:function(){var id='c-'+App.cart.uuidInc;App.cart.uuidInc++;return id;},add:function(item){var
id=App.cart.uuid(),opt=App.cached['Dish'][item].options(),options=[];if(arguments[1]){options=arguments[1].options;}else{for(var x in opt){if(opt[x]['default']==1){options[options.length]=opt[x].id_option;}}}
App.cart.items[id]={id:item,options:options};var el=$('<div class="cart-item cart-item-dish" data-cart_id="'+id+'"></div>');el.append('<div class="cart-button cart-button-remove"><span></span></div>');el.append('<div class="cart-item-name">'+App.cache('Dish',item).name+' <span class="cart-item-description">'+(App.cache('Dish',item).description!=null?App.cache('Dish',item).description:'')+'</span></div>');if(App.cached['Dish'][item].options().length){el.append('<div class="cart-item-config"><a href="javascript:;">Customize</a></div>');}
el.hide();if($(window).width()>769){$('.cart-items-content').append(el);}else{$('.cart-items-content').prepend(el);}
el.show();if(parseInt(App.cache('Dish',item).expand_view)>0){App.cart.customize(el);}
App.cart.updateTotal();App.track('Dish added',{id_dish:App.cache('Dish',item).id_dish,name:App.cache('Dish',item).name});},clone:function(item){var
cartid=item.attr('data-cart_id'),cart=App.cart.items[cartid],newoptions=[];for(var x in cart.options){newoptions[newoptions.length]=cart.options[x];}
App.cart.add(cart.id,{options:newoptions});App.track('Dish cloned');},remove:function(item){var
cart=item.attr('data-cart_id');App.track('Dish removed');delete App.cart.items[cart];item.remove();$('.cart-item-customize[data-id_cart_item="'+cart+'"]').remove();App.cart.updateTotal();},updateTotal:function(){var
totalText=(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.charged(),tipText='',feesText='',totalItems=0,credit=0,hasFees=((App.restaurant.delivery_fee&&App.order.delivery_type=='delivery')||App.restaurant.fee_customer)?true:false;if(App.credit.restaurant[App.restaurant.id]){credit=parseFloat(App.credit.restaurant[App.restaurant.id]);}
for(var x in App.cart.items){totalItems++;}
App.cart.autotip();var wasTipChanged=false;if(App.order.delivery_type=='takeout'&&App.order['pay_type']=='card'){if(typeof App.order.tipHasChanged=='undefined'){App.order.tip=0;wasTipChanged=true;}}else if(App.order.delivery_type=='delivery'&&App.order['pay_type']=='card'){if(typeof App.order.tipHasChanged=='undefined'){App.order.tip=(App.config.user.last_tip)?App.config.user.last_tip:'autotip';App.order.tip=App.lastTipNormalize(App.order.tip);wasTipChanged=true;}}
if(wasTipChanged){$('[name="pay-tip"]').val(App.order.tip);totalText=(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.charged();}
if(App.restaurant.meetDeliveryMin()&&App.order.delivery_type=='delivery'){$('.delivery-minimum-error').show();$('.delivery-min-diff').html(App.restaurant.deliveryDiff());}else{$('.delivery-minimum-error').hide();}
$('.cart-summary-item-count span').html(totalItems);if(!this.subtotal()){$('.payment-total, .dp-display-payment').hide();}else{$('.payment-total, .dp-display-payment').show();}
var breakdown=App.cart.totalbreakdown();var extraCharges=App.cart.extraChargesText(breakdown);if(extraCharges){$('.cart-breakdownDescription').html((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.subtotal().toFixed(2)+' (+'+extraCharges+')');}else{$('.cart-breakdownDescription').html((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+this.subtotal().toFixed(2));}
if(App.order.pay_type=='card'&&credit>0){var creditLeft='';if(this.total()<credit){var creditLeft='<span class="gift-left"> - You\'ll still have '+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+App.ceil((credit-this.total())).toFixed(2)+' gift card left </span>';credit=this.total();}
$('.cart-gift').html('&nbsp;(- '+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+App.ceil(credit).toFixed(2)+' credit '+creditLeft+') ');}else{$('.cart-gift').html('');}
setTimeout(function(){if(App.order.pay_type=='cash'&&credit>0){$('.cart-giftcard-message').html('<span class="giftcard-payment-message">Pay with a card, NOT CASH, to use your  '+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+App.ceil(credit).toFixed(2)+' gift card!</span>');}else{$('.cart-giftcard-message').html('');}},1000);$('.cart-total').html(totalText);if(App.order['pay_type']=='card'){$('.cash-order-aprox').html('');$('.cart-paymentType').html('by card');}else{$('.cash-order-aprox').html('approximately');$('.cart-paymentType').html('');}
if($('.cart-total').html()==totalText){}
if(!totalItems){$('.default-order-check').hide();}else{$('.default-order-check').show();}
var
totalItems={},name,text='';$('.cart-summary-items').html('');for(var x in App.cart.items){name=App.cached['Dish'][App.cart.items[x].id].name;if(totalItems[name]){totalItems[name]++;}else{totalItems[name]=1;}}
for(x in totalItems){text=',&nbsp;&nbsp;'+text;if(totalItems[x]>1){text=x+'&nbsp;('+totalItems[x]+')'+text;}else{text=x+text;}}
$('.cart-summary-items').html(text.substr(0,text.length-13));$('.cart-item-customize-price').each(function(){var dish=$(this).closest('.cart-item-customize').attr('data-id_cart_item'),option=$(this).closest('.cart-item-customize-item').attr('data-id_option'),cartitem=App.cart.items[dish],opt=App.cached['Option'][option],price=opt.optionPrice(cartitem.options);$(this).html(App.cart.customizeItemPrice(price));});},customizeItemPrice:function(price,force){var priceText='';if(price!='0.00'||force){priceText='&nbsp;(';priceText+=(price<0)?'minus $':'+ $';priceText+=parseFloat(Math.abs(price)).toFixed(2);priceText+=')';}
return priceText;},customize:function(item){var
cart=item.attr('data-cart_id'),old=$('.cart-item-customize[data-id_cart_item="'+cart+'"]');if(old.length){old.remove();}else{var
el=$('<div class="cart-item-customize" data-id_cart_item="'+cart+'"></div>').insertAfter(item),cartitem=App.cart.items[cart],obj=App.cached['Dish'][cartitem.id],opt=obj.options();for(var x in opt){if(opt[x].id_option_parent){continue;}
if(opt[x].type=='check'){var price=opt[x].optionPrice(cartitem.options);var check=$('<input type="checkbox" class="cart-customize-check">');if($.inArray(opt[x].id_option,cartitem.options)!==-1){check.attr('checked','checked');}
var option=$('<div class="cart-item-customize-item" data-id_option="'+opt[x].id_option+'"></div>').append(check).append('<label class="cart-item-customize-name">'+
opt[x].name+(opt[x].description||'')+'</label><label class="cart-item-customize-price">'+
App.cart.customizeItemPrice(price)+'</label>');el.append(option);}}
for(var x in opt){if(opt[x].id_option_parent){continue;}
if(opt[x].type=='select'){var select=$('<select class="cart-customize-select">');for(var i in opt){if(opt[i].id_option_parent==opt[x].id_option){var price=opt[i].price;var option=$('<option value="'+opt[i].id_option+'">'+opt[i].name+(opt[i].description||'')+App.cart.customizeItemPrice(price,(opt[x].price_linked=='1'))+'</option>');if($.inArray(opt[i].id_option,cartitem.options)!==-1){option.attr('selected','selected');}
select.append(option);}}
var option=$('<div class="cart-item-customize-item" data-id_option="'+opt[x].id_option+'"></div>').append('<label class="cart-item-customize-select-name">'+opt[x].name+(opt[x].description||'')+'</label>').append(select);el.append(option);}}}
App.track('Dish customized');},customizeItem:function(item){var
cart=item.closest('.cart-item-customize').attr('data-id_cart_item'),cartitem=App.cart.items[cart],customitem=item.closest('.cart-item-customize-item'),opt=customitem.attr('data-id_option');if(opt){if(item.hasClass('cart-customize-select')){var obj=App.cached['Dish'][cartitem.id],opts=obj.options();for(var i in opts){if(opts[i].id_option_parent!=opt){continue;}
for(var x in cartitem.options){if(cartitem.options[x]==opts[i].id){cartitem.options.splice(x,1);break;}}}
cartitem.options[cartitem.options.length]=item.val();}else if(item.hasClass('cart-customize-check')){if(item.is(':checked')){cartitem.options[cartitem.options.length]=opt;}else{for(var x in cartitem.options){if(cartitem.options[x]==opt){cartitem.options.splice(x,1);break;}}}}}
App.cart.updateTotal();},extraChargesText:function(breakdown){var elements=[];var text='';if(breakdown.delivery){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.delivery.toFixed(2)+' delivery');}
if(breakdown.fee){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.fee.toFixed(2)+' fee');}
if(breakdown.taxes){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.taxes.toFixed(2)+' taxes');}
if(breakdown.tip&&breakdown.tip>0){elements.push((App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+breakdown.tip+' tip');}
if(elements.length){if(elements.length>2){var lastOne=elements.pop();var elements=[elements.join(', ')];elements.push(lastOne);}
var text=elements.join(' & ');}
return text;},getCart:function(){var cart=[];for(x in App.cart.items){cart[cart.length]=App.cart.items[x];}
return cart;},submit:function(){if(App.busy.isBusy()){return;}
App.busy.makeBusy();var read=$('.payment-form').length?true:false;if(read){App.config.user.name=$('[name="pay-name"]').val();App.config.user.phone=$('[name="pay-phone"]').val().replace(/[^\d]*/gi,'');if(App.order['delivery_type']=='delivery'){App.config.user.address=$('[name="pay-address"]').val();}
App.order.tip=$('[name="pay-tip"]').val();}
var order={cart:App.cart.getCart(),pay_type:App.order['pay_type'],delivery_type:App.order['delivery_type'],restaurant:App.restaurant.id,make_default:$('#default-order-check').is(':checked'),notes:$('[name="notes"]').val(),lat:(App.loc.pos())?App.loc.pos().lat:null,lon:(App.loc.pos())?App.loc.pos().lon:null};if(order.pay_type=='card'){order.tip=App.order.tip||'3';order.autotip_value=$('[name=pay-autotip-value]').val();}
if(read){order.address=App.config.user.address;order.phone=App.config.user.phone;order.name=App.config.user.name;if(App.order.cardChanged){order.card={number:$('[name="pay-card-number"]').val(),month:$('[name="pay-card-month"]').val(),year:$('[name="pay-card-year"]').val()};}else{order.card={};}}
console.log('ORDER:',order);var errors={};if(!order.name){errors['name']='Please enter your name.';}
if(!App.phone.validate(order.phone)){errors['phone']='Please enter a valid phone #.';}
if(order.delivery_type=='delivery'&&!order.address){errors['address']='Please enter an address.';}
if(order.pay_type=='card'&&((App.order.cardChanged&&!order.card.number)||(!App.config.user.id_user&&!order.card.number))){errors['card']='Please enter a valid card #.';}
if(!App.cart.hasItems()){errors['noorder']='Please add something to your order.';}
if(!$.isEmptyObject(errors)){var error='';for(var x in errors){error+=errors[x]+"\n";}
$('body').scrollTop($('.payment-form').position().top-80);App.alert(error);App.busy.unBusy();App.track('OrderError',errors);App.log.order({'errors':errors},'validation error');return;}
if(App.iOS()&&!App.crunchSoundAlreadyPlayed){App.playAudio('get-food-audio');App.crunchSoundAlreadyPlayed=true;}
if(order.delivery_type=='delivery'){if(App.config&&App.config.user&&App.config.user.last_order){if(App.config.user.last_order.communities.indexOf(App.restaurant.id_community)>-1){var lastAddress=App.config.user.last_order.address;var currentAdress=$('[name=pay-address]').val();if($.trim(lastAddress)!=''&&$.trim(lastAddress)==$.trim(currentAdress)){App.isDeliveryAddressOk=true;App.log.order({'address':lastAddress,'restaurant':App.restaurant.name},'legacy address');}}}}
if(order.delivery_type=='takeout'){App.isDeliveryAddressOk=true;}
App.isDeliveryAddressOk=true;if(!App.isDeliveryAddressOk){return;}
if(!App.crunchSoundAlreadyPlayed){App.playAudio('get-food-audio');App.crunchSoundAlreadyPlayed=true;}
$.ajax({url:App.service+'order',data:order,dataType:'html',type:'POST',complete:function(json){try{json=$.parseJSON(json.responseText);}catch(e){App.log.order(json.responseText,'processing error');json={status:'false',errors:['Sorry! Something went horribly wrong trying to place your order!']};}
if(json.status=='false'){var error='';for(x in json.errors){error+=json.errors[x]+"\n";}
App.track('OrderError',json.errors);App.alert(error);App.log.order({'errors':json.errors},'validation error - php');}else{if(json.token){$.totalStorage('token',json.token);}
$('.link-orders').show();order.cardChanged=false;App.justCompleted=true;App.giftcard.notesCode=false;var totalItems=0;for(var x in App.cart.items){totalItems++;}
App.request(App.service+'config',App.processConfig);App.cache('Order',json.uuid,function(){App.track('Ordered',{'total':this.final_price,'subtotal':this.price,'tip':this.tip,'restaurant':App.restaurant.name,'paytype':this.pay_type,'ordertype':this.order_type,'user':this.user,'items':totalItems});App.order.cardChanged=false;App.loc.changeLocationAddressHasChanged=false;delete App.order.tipHasChanged;App.go('/order/'+this.uuid);});}
setTimeout(function(){App.busy.unBusy();},400);}});},subtotal:function(){var
total=0,options;for(var x in App.cart.items){total+=parseFloat(App.cached['Dish'][App.cart.items[x].id].price);options=App.cart.items[x].options;for(var xx in options){var option=App.cached['Option'][options[xx]];if(option===undefined)continue;total+=parseFloat(option.optionPrice(options));}}
total=App.ceil(total);return total;},_breackDownDelivery:function(){var delivery=0;if(App.restaurant.delivery_fee&&App.order.delivery_type=='delivery'){delivery=parseFloat(App.restaurant.delivery_fee);}
delivery=App.ceil(delivery);return delivery;},_breackDownFee:function(feeTotal){var fee=0;if(App.restaurant.fee_customer){fee=(feeTotal*(parseFloat(App.restaurant.fee_customer)/100));}
fee=App.ceil(fee);return fee;},_breackDownTaxes:function(feeTotal){var taxes=(feeTotal*(App.restaurant.tax/100));taxes=App.ceil(taxes);return taxes;},_breakdownTip:function(total){var tip=0;if(App.order['pay_type']=='card'){if(App.order.tip==='autotip'){return parseFloat($('[name=pay-autotip-value]').val());}
tip=(total*(App.order.tip/100));}
tip=App.ceil(tip);return tip;},total:function(){var
total=0,dish,options,feeTotal=0,totalItems=0,finalAmount=0;var breakdown=this.totalbreakdown();total=breakdown.subtotal;feeTotal=total;feeTotal+=breakdown.delivery;feeTotal+=breakdown.fee;finalAmount=feeTotal+breakdown.taxes;finalAmount+=this._breakdownTip(total);return App.ceil(finalAmount).toFixed(2);},charged:function(){var finalAmount=this.total();if(App.order.pay_type=='card'&&App.credit.restaurant[App.restaurant.id]){finalAmount=finalAmount-App.ceil(App.credit.restaurant[App.restaurant.id]).toFixed(2);if(finalAmount<0){finalAmount=0;}}
return App.ceil(finalAmount).toFixed(2);},totalbreakdown:function(){var elements={};var total=this.subtotal();var feeTotal=total;elements['subtotal']=this.subtotal();elements['delivery']=this._breackDownDelivery();feeTotal+=elements['delivery'];elements['fee']=this._breackDownFee(feeTotal);feeTotal+=elements['fee'];elements['taxes']=this._breackDownTaxes(feeTotal);elements['tip']=this._breakdownTip(total);return elements;},resetOrder:function(){App.cart.items={};$('.cart-items-content, .cart-total').html('');},reloadOrder:function(){var cart=App.cart.items;App.cart.resetOrder();App.cart.loadFlatOrder(cart);},loadFlatOrder:function(cart){for(var x in cart){App.cart.add(cart[x].id,{options:cart[x].options?cart[x].options:[]});}},loadOrder:function(order){try{if(order){var dishes=order['_dishes'];for(var x in dishes){var options=[];for(var xx in dishes[x]['_options']){options[options.length]=dishes[x]['_options'][xx].id_option;}
if(App.cached.Dish[dishes[x].id_dish]!=undefined){App.cart.add(dishes[x].id_dish,{options:options});}}}}catch(e){console.log(e.stack);}
App.cart.updateTotal();},hasItems:function(){if(!$.isEmptyObject(App.cart.items)){return true;}
return false;},autotip:function(){var subtotal=App.cart.totalbreakdown().subtotal;var autotipValue
if(subtotal===0){autotipValue=0;}else{autotipValue=Math.ceil(4*(subtotal*0.107+0.85))/4;}
$('[name="pay-autotip-value"]').val(autotipValue);var autotipText=autotipValue?' ('+(App.config.ab&&App.config.ab.dollarSign=='show'?'$':'')+autotipValue+')':'';$('[name=pay-tip] [value=autotip]').html('Autotip'+autotipText);}};;var Orm={properties:function(){var properties={};for(var name in this){if(name.indexOf('_')!==0&&!$.isFunction(this[name])){if(this[name]===true){properties[name]=1;}else if(this[name]===false){properties[name]=0;}else{properties[name]=this[name];}}}
return properties;},loadType:function(cls,data){if(!this['__'+data]){this['__'+data]=[];for(x in this['_'+data]){this['__'+data][this['__'+data].length]=App.cache(cls,this['_'+data][x]);}
this['_'+data]=null;}
return this['__'+data];},save:function(complete){if(!this.type)return;$.post(App.service+this.resource+(this.id?('/'+this.id):''),this.properties(),function(result){if(complete){complete(result);}});},load:function(id){var self=this;if(typeof(id)=='object'){this.finished(id);}else{App.request(App.service+self.resource+'/'+id,function(json){if(json.error){throw'ORM load error: '+json.error+"\nType: "+self.type+"\nResource: "+self.resource+"\nID: "+id;}else{self.finished(json);}});}}};var Location=function(params){var self=this;this._properties={verified:true,city:null,region:null,lat:null,lon:null,type:null,subtype:null,address:null,prep:null};self.setCityFromResult=function(results){if(!results){return;}
var result=results[0]||results;if(typeof result.types==='string'){var type=result.types;}else{for(x in result.types){var type=result.types[x];}}
switch(type){case'locality':self._properties.city=result.address_components[0].long_name;self._properties.region=result.address_components[2].short_name;self._properties.detail=2;break;case'street_address':self._properties.city=result.address_components[2].long_name;self._properties.region=result.address_components[4].short_name;self._properties.detail=5;break;case'postal_code':self._properties.city=result.address_components[1].long_name;self._properties.region=result.address_components[3].short_name;self._properties.detail=3;break;case'route':self._properties.city=result.address_components[1].long_name;self._properties.region=result.address_components[3].short_name;self._properties.detail=4;break;default:case'administrative_area_level_1':self._properties.city=result.address_components[0].long_name;self._properties.detail=1;break;}
for(var i=0;i<result.address_components.length;i++){for(var j=0;j<result.address_components[i].types.length;j++){if(result.address_components[i].types[j]=='locality'){self._properties.city=result.address_components[i].long_name;}}}};self.setAddressFromResult=function(results){if(!results){return;}
var result=results[0]||results;self._properties.address=result.formatted_address;};self.setZipFromResult=function(results){if(!results){return;}
var result=results[0]||results;for(var x in result.address_components){if(result.address_components[x].types[0]=='postal_code'){self._properties.zip=result.address_components[x].short_name;return;}}};self.distance=function(from){return App.loc.distance({to:{lat:self.lat(),lon:self.lon()},from:from});};self.city=function(){return self._properties.city||'';};self.prep=function(){return self._properties.prep||'in';};self.address=function(){return self._properties.address||'';};self.formatted=function(location){return self.address().replace(', USA','');};self.zip=function(){return self._properties.zip||'';};self.lat=function(){return self._properties.lat||0;};self.lon=function(){return self._properties.lon||0;};self.valid=function(){switch(arguments[0]){case'restaurants':return(self.lat()||self.lon())?true:false;break;case'order':return(self.lat()||self.lon())&&self.verified()&&self.detail()>=5?true:false;break;default:return false;break;}};self.verified=function(){return self._properties.verified;};self.type=function(){return self._properties.type;};self.detail=function(){return self._properties.detail;};self.region=function(){return self._properties.region;}
self.entered=function(){return self._properties.entered;}
for(var x in params){this._properties[x]=params[x];}
if(params&&params.results){self.setCityFromResult(params.results);self.setAddressFromResult(params.results);self.setZipFromResult(params.results);}};App.AB={options:{tagline:[{name:'tagline-for-free',tagline:'Order the top food %s. For free. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'},{name:'tagline-no-free',tagline:'Order the top food %s. <br /> After you order, everything is saved for future 1 click ordering. <br /><strong>Choose a restaurant:</strong>'}],slogan:[{name:'slogan-push-food',slogan:'Push a button. Get Food.'}],restaurantPage:[{name:'restaurant-page-noimage'},{name:'restaurant-page-image',disabled:true}],dollarSign:[{name:'show'},{name:'hide'}],changeablePrice:[{name:'show'},{name:'hide'}]},init:function(){if(!App.config.ab){App.AB.create(true);}
App.AB.load();},create:function(clear){if(clear){App.config.ab={};}
for(var key in App.AB.options){if(App.config.ab[key]){return;}
var optionType=App.AB.options[key];var opts=[];for(var x in optionType){if(!optionType[x].disabled||optionType[x].disabled==false){opts[opts.length]=optionType[x];}}
var opt=opts[Math.floor(Math.random()*opts.length)];App.config.ab[key]=opt.name
App.trackProperty('AB-'+key,opt.name);}
App.AB.save();console.log(App.config.ab);},load:function(){App.slogan=App.AB.pluck('slogan',App.config.ab.slogan);App.tagline=App.AB.pluck('tagline',App.config.ab.tagline);if(!App.slogan||!App.tagline){App.AB.create(true);App.AB.load(true);}},pluck:function(option,name){for(var x in App.AB.options[option]){if(App.AB.options[option][x].name==name){return App.AB.options[option][x];}}
return null;},save:function(){$.ajax({url:App.service+'config',data:{ab:App.config.ab},dataType:'json',type:'POST',complete:function(json){}});}};;function restaurantSort(a,b){var bubble;if((a.open()&&b.open())||(!a.open()&&!b.open())){bubble=parseInt(a.sort)-parseInt(b.sort);}else if(a.open()&&!b.open()){bubble=-1;}else if(!a.open()&&b.open()){bubble=1;}else{console.log('Should not be here',a,b);}
return bubble;}
var Community=function(id){this.type='Community';this.id_var='id_community';this.resource='community';var self=this;$.extend(self,Orm);if(arguments[1]){complete=arguments[1];}else{complete=function(){};}
self.restaurants=function(){if(!self.__restaurants){var openRestaurants=[];var closedRestaurants=[];for(x in self._restaurants){var restaurant=App.cache('Restaurant',self._restaurants[x]);if(restaurant.open()){openRestaurants[openRestaurants.length]=restaurant;}else{closedRestaurants[closedRestaurants.length]=restaurant;}}
openRestaurants.sort(restaurantSort);closedRestaurants.sort(restaurantSort);self.__restaurants=[];self._restaurants=null;for(x in openRestaurants){self.__restaurants[self.__restaurants.length]=openRestaurants[x];}
for(x in closedRestaurants){self.__restaurants[self.__restaurants.length]=closedRestaurants[x];}}
return self.__restaurants;}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.restaurants();if(complete){complete.call(self);}}
self.load(id);}
App.cached.Community={};;var Restaurant=function(id){this.type='Restaurant';this.id_var='id_restaurant';this.resource='restaurant';var
self=this,complete;$.extend(self,Orm);if(arguments[1]){complete=arguments[1];}else{complete=function(){};}
this._utcTime=function(serverTime)
{return this._parseDate(serverTime.add(-this._tzoffset).hours().toUTCString());}
this._parseDate=function(dateStr){if(!dateStr){return null;}
dateStr=dateStr.split(',');dateStr=(dateStr.length==2?dateStr[1]:dateStr[0]).trim();return Date.parse(dateStr);}
this._utcNow=function()
{return Date.parse(dateTime.toString());}
this.isAboutToClose=function(){var minimumTime=15;var today=Date.today().toString('ddd').toLowerCase();var tomorrow=Date.today().add(1).days().toString('ddd').toLowerCase();if(this._hours==undefined||this._hours[today]==undefined){return false;}
todayHours=this._hours[today];if(this._hours[tomorrow]){var tomorrowHours=this._hours[tomorrow];var tomorrowItOpensAt=tomorrowHours[0][0];var tomorrowItClosesAt=tomorrowHours[0][1];}else{var tomorrowItOpensAt=false;var tomorrowItClosesAt=false;}
for(i in todayHours){var openTime=Date.parse(todayHours[i][0]);var closeTime=Date.parse(todayHours[i][1]);var nextHour=parseInt(i)+1;if(todayHours[nextHour]){var nextHourOpenTime=todayHours[nextHour][0];var nextHourCloseTime=todayHours[nextHour][1];}else{var nextHourOpenTime=false;var nextHourCloseTime=false;}
var previousHour=parseInt(i)-1;if(todayHours[previousHour]){var previousHourOpenTime=todayHours[previousHour][0];var previousHourCloseTime=todayHours[previousHour][1];}else{var previousHourOpenTime=false;var previousHourCloseTime=false;}
if(todayHours[i][1]=='24:00'||todayHours[i][1]=='00:00'){closeTime=Date.parse('00:00');if(tomorrowItOpensAt=='00:00'||tomorrowItOpensAt=='0:00'){closeTime=Date.parse(tomorrowItClosesAt);}
else if(nextHourOpenTime=='00:00'||nextHourOpenTime=='0:00'){closeTime=Date.parse(nextHourCloseTime);}
else if(previousHourOpenTime=='00:00'||previousHourOpenTime=='0:00'){closeTime=Date.parse(previousHourCloseTime);}
closeTime.addDays(1);}
if(closeTime.compareTo(openTime)==-1){closeTime.addDays(1);}
closeTime=this._utcTime(closeTime);openTime=closeTime.clone().addMinutes(-1*minimumTime);utcNow=this._utcNow();if(utcNow.between(openTime,closeTime)){var minutes=(closeTime.getTime()-utcNow.getTime())/1000/60;minutes=Math.floor(minutes);return minutes;}}
return false;}
self.categories=function(){return self.loadType('Category','categories');}
self.notifications=function(){return self.loadType('Notification','notifications');}
self.top=function(){var categories=self.categories();for(var x in categories){var dishes=categories[x].dishes();for(var xx in dishes){if(dishes[xx].top==1){return dishes[xx];}}}}
self.deliveryDiff=function(total){var diff=parseFloat(self.delivery_min-total).toFixed(2);return diff;}
self.meetDeliveryMin=function(total){return total<parseFloat(self.delivery_min)?true:false;}
self.dateFromItem=function(item,offset){var
theTime=item.split(':'),theDate=new Date();theDate.setHours(theTime[0]);theDate.setMinutes(theTime[1]+offset);return theDate;}
self.open=function(){if(this.open_for_business==="0"){this._open=false;return false;}
if(!this._hours){this._open=false;return false;}
var isOpen=false;var today=Date.today().toString('ddd').toLowerCase();if(this._hours==undefined||this._hours[today]==undefined){this._open=false;return false;}
todayHours=this._hours[today];for(i in todayHours){var openTime=this._parseDate(todayHours[i][0]);var closeTime=this._parseDate(todayHours[i][1]);if(todayHours[i][1]=='24:00'){closeTime=this._parseDate('00:00');closeTime.addDays(1);}
if(openTime){var openTime_utc=this._parseDate(openTime.add(-this._tzoffset).hours().toUTCString());}
if(closeTime){var closeTime_utc=this._parseDate(closeTime.add(-this._tzoffset).hours().toUTCString());}
var now_utc=this._utcNow();if(closeTime_utc){if(closeTime_utc.compareTo(openTime_utc)==-1){closeTime_utc.addDays(1);}}
if(openTime_utc&&closeTime_utc){if(now_utc.between(openTime_utc,closeTime_utc)){isOpen=true;break;}}}
this._open=isOpen;return isOpen;}
self.deliveryHere=function(distance){return(distance<=this.delivery_radius)}
self.closedMessage=function(){var isOpenedAt={};var openTime=this._hours;var weekdayOrder=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];var patternHour=/([0])([1-9])(:)([0-9]{2})/;for(var day in openTime){var hours=openTime[day];var key='';var openedHoursText='';var openedHoursTextDivisor='';for(var hour in hours){var open=hours[hour][0];var close=hours[hour][1];key+=open+close;var formatedOpen=App.formatTime(open).toLowerCase().replace(patternHour,'\$2\$3\$4').replace(/:00/g,'').replace(' ','');var formatedClose=App.formatTime(close).toLowerCase().replace(patternHour,'\$2\$3\$4').replace(/:00/g,'').replace(' ','');openedHoursText+=openedHoursTextDivisor+formatedOpen+' - '+formatedClose;openedHoursTextDivisor=', ';}
key=key.replace(/\:/g,'');if(!isOpenedAt[key]){isOpenedAt[key]={days:{},hours:{}};}
openedHoursText=openedHoursText.replace('- 12am, 12am ','');isOpenedAt[key]['days'][day]=true;isOpenedAt[key]['hour']=openedHoursText;}
var _opened={};for(var hour in isOpenedAt){var days=isOpenedAt[hour]['days'];var commas='';var keys='';for(day in days){keys+=commas+App.capitalize(day);commas=', ';}
hours=isOpenedAt[hour]['hour'];_opened[keys]=hours;}
var _groupedDays={};for(var days in _opened){var weekdays=days.split(',');var nextPosition=-1;var sequenceStartedAt=false;var groupedDays={};var totalWeekdays=weekdays.length;for(var i=0;i<=totalWeekdays;++i){var weekday=$.trim(weekdays[i]);var position=weekdayOrder.indexOf(weekday);if(nextPosition!=position){sequenceStartedAt=weekday;groupedDays[sequenceStartedAt]=[];groupedDays[sequenceStartedAt]=[weekday];}
if(nextPosition==position){groupedDays[sequenceStartedAt].push(weekday);}
nextPosition=position+1;}
var key='';for(var group in groupedDays){if(group!=''){if(groupedDays[group].length==1){if(key!=''){key+=', ';}
key+=groupedDays[group][0];}
if(groupedDays[group].length==2){if(key!=''){key+=', ';}
key+=groupedDays[group][0]+', '+groupedDays[group][1];}
if(groupedDays[group].length>2){if(key!=''){key+=', ';}
key+=groupedDays[group][0]+' - '+groupedDays[group][groupedDays[group].length-1];}}}
key+=': ';_groupedDays[key]=_opened[days];}
var ordered=[];for(var index=0;index<weekdayOrder.length;++index){var weekday=weekdayOrder[index];for(var day in _groupedDays){var regexp=new RegExp('^'+weekday,'i')
if(regexp.test(day)){ordered.push(day+_groupedDays[day]);}}}
return ordered.join('\n');}
self.preset=function(){return self['_preset'];}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.categories();if(App.isPhoneGap){var img=self.image.replace(/^.*\/|\.[^.]*$/g,'');self.img=App.imgServer+'630x280/'+img+'.jpg?crop=1';self.img64=App.imgServer+'596x596/'+img+'.jpg';}
if(complete){complete.call(self);}}
self.load(id);}
App.cached.Restaurant={};;var Dish=function(id){this.type='Dish';this.id_var='id_dish';this.resource='dish';var self=this;$.extend(self,Orm);self.options=function(){return self.loadType('Option','options');}
self.finished=function(data){for(x in data){self[x]=data[x];}
self.options();}
self.load(id);}
App.cached.Dish={};;var Option=function(id){this.type='Option';var self=this;self.optionPrice=function(options){var price=parseFloat(self.price);for(var x in self.prices){if(options.indexOf(self.prices[x].id_option_parent)!==-1){price+=parseFloat(self.prices[x].price);}}
return price;}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/option/'+id,function(json){for(x in json){self[x]=json[x];}});}}
App.cached.Option={};;var Category=function(id){this.type='Dish';var self=this;$.extend(self,Orm);self.dishes=function(){return self.loadType('Dish','dishes');}
self.locName=function(community){return(self.loc=='1'&&community&&community.name)?(' at '+community.name):'';}
self.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}
self.dishes();}else{App.request(App.service+'/category/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Category={};;var Notification=function(id){var self=this;$.extend(this,Orm);this.loadType=function(cls,data){if(!self['__'+data]){self['__'+data]=[];for(x in self['_'+data]){self['__'+data][self['__'+data].length]=App.cache(cls,self['_'+data][x]);}
self['_'+data]=null;}
return self['__'+data];}
if(typeof(id)=='object'){for(x in id){self[x]=id[x];}}else{App.request(App.service+'/notification/'+id,function(json){for(x in json){self[x]=json[x];}
self.options();});}}
App.cached.Notification={};;var Order=function(id){this.type='Order';this.id_var='id_order';this.resource='order';var self=this;$.extend(self,Orm);if(arguments[1]){complete=arguments[1];}else{complete=function(){};}
self.finished=function(data){for(x in data){self[x]=data[x];}
if(complete){complete.call(self);}}
self.load(id);}
App.cached.Order={};;App.creditCard={cards:[{'name':'master-card','pattern':/^5[1-5]/,'size':16},{'name':'visa','pattern':/^4/,'size':16},{'name':'amex','pattern':/^3[47]/,'size':15},{'name':'discover','pattern':/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,'size':16},]}
App.creditCard.validate=function(cardValue){var card=App.creditCard.detectType(cardValue);var isValid=false;if(card.size==cardValue.toString().length){isValid=App.creditCard.luhn(cardValue);}
if(isValid){$('[name="pay-card-number"]').addClass('credit-card-ok');}else{$('[name="pay-card-number"]').removeClass('credit-card-ok');}}
App.creditCard.luhn=function(cardValue){var sum=0;cardValueInverse=cardValue.toString().split('').reverse();for(n=i=0,size=cardValueInverse.length;i<size;n=++i){digit=cardValueInverse[n];digit=+digit;if(n%2){digit*=2;if(digit<10){sum+=digit;}else{sum+=digit-9;}}else{sum+=digit;}}
return sum%10===0;}
App.creditCard.changeIcons=function(cardValue){var card=App.creditCard.detectType(cardValue);if(card){$('.payment-card').addClass('to-grey');$('.payment-card').removeClass('to-color');$('.card-'+card.name).removeClass('to-grey');$('.card-'+card.name).addClass('to-color');$('.to-color').animate({'background-position-x':'0'},100);$('.to-grey').animate({'background-position-x':'-40px'},100);}else{$('.payment-card').animate({'background-position-x':'0'},100);}
App.creditCard.validate(cardValue);}
App.creditCard.detectType=function(cardValue){var cardType=false;$(App.creditCard.cards).each(function(index,card){if(card.pattern.test(cardValue)){cardType=card;}});return cardType;};App.log={api:{url:'log'},type:{order:'order-js',account:'account-js',location:'location-js'}}
App.log.doLog=function(data,callback){var url=App.service+App.log.api.url;var info={data:data};info.type=(data.type)?data.type:'log-js';$.ajax({type:'POST',url:url,dataType:'json',data:info,success:function(json){if(callback){callback(json);}}});}
App.log.order=function(info,action){App.log.doLog({'type':App.log.type.order,'info':info,'action':action});}
App.log.account=function(info,action){App.log.doLog({'type':App.log.type.account,'info':info,'action':action});}
App.log.location=function(info,action){App.log.doLog({'type':App.log.type.location,'info':info,'action':action});};function AccountModalHeaderCtrl($scope,$http,AccountModalService){$scope.modal=AccountModalService;}
function AccountSignInCtrl($scope,$http,AccountModalService,AccountService,AccountHelpService){$scope.modal=AccountModalService;$scope.account=AccountService;$scope.help=AccountHelpService;}
function AccountSignUpCtrl($scope,$http,AccountModalService,AccountService){$scope.modal=AccountModalService;$scope.account=AccountService;$scope.$watch('account.user',function(newValue,oldValue,scope){$scope.account.user=newValue;if(newValue){$scope.modal.header=false;}});}
function AccountResetCtrl($scope,$http,AccountResetService){$scope.reset=AccountResetService;}
function GiftCardCtrl($scope,$http,GiftCardService){$scope.giftcard=GiftCardService;$scope.giftcard.processModal();}
function MainHeaderCtrl($scope,MainNavigationService){$scope.navigation=MainNavigationService;$scope.$watch('navigation.page',function(newValue,oldValue,scope){$scope.navigation.control();});}
function RecommendRestaurantCtrl($scope,$http,RecommendRestaurantService,AccountService,AccountModalService){$scope.recommend=RecommendRestaurantService;$scope.account=AccountService;$scope.modal=AccountModalService;}
function RecommendFoodCtrl($scope,$http,RecommendFoodService){$scope.recommend=RecommendFoodService;}
function SupportCtrl($scope,$http,SupportService){$scope.support=SupportService;}
function SideMenuCtrl($scope,MainNavigationService){$scope.navigation=MainNavigationService;};NGApp.directive('facebookSigninButton',function(AccountFacebookService){return{restrict:'A',templateUrl:'assets/view/account.facebook.html',scope:{title:'@'},controller:function($scope){$scope.facebook=AccountFacebookService;}};;});NGApp.directive('ngEnter',function(){return function(scope,element,attrs){element.bind('keydown keypress',function(event){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.ngEnter);});event.preventDefault();}});};});NGApp.directive('ng-blur',function(){return{restrict:'A',link:function postLink(scope,element,attrs){element.bind('blur',function(){scope.$apply(attrs.ngBlur);});}};});;NGApp.factory('AccountService',function($http,$rootScope){var service={callback:false,user:false,error:{signin:false,signup:false},form:{email:'',password:''}};service.checkUser=function(){if(service.isLogged()){service.user=App.config.user;$rootScope.$safeApply();}else{service.updateInfo();}}
service.isLogged=function(){if(App.config.user&&App.config.user.id_user!=''){service.user=App.config.user;}
if(service.user){if(service.user.id_user!=''){return true;}}
return false;}
service.signin=function(){if(!service.isValidEmailPhone()){alert('Please enter a valid email or phone.');$('.signin-email').focus();return;}
if(!service.isValidPassword()){alert('Please enter your password.');$('.signin-password').focus();return;}
service.purify();service.error.signin=false;var url=App.service+'user/auth';$http({method:'POST',url:url,data:$.param({'email':service.form.email,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){App.log.account({'error':data.error},'sign in error');service.error.signin=true;}else{service.user=data;service.updateInfo();if(service.callback){service.callback();service.callback=false;}else{$.magnificPopup.close();if(App.currentPage=='restaurant'&&App.restaurant.permalink){App.page.restaurant(App.restaurant.permalink);}
App.signin.manageLocation();}}});}
service.signup=function(){if(!service.isValidEmailPhone()){alert('Please enter a valid email or phone.');$('.signup-email').focus();return;}
if(!service.isValidPassword()){alert('Please enter a password.');$('.signup-password').focus();return;}
service.purify();service.error.signin=false;var url=App.service+'user/create/local';$http({method:'POST',url:url,data:$.param({'email':service.form.email,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='user exists'){service.error.signup=true;}
App.log.account({'error':data.error,'login':service.form.email},'sign up error');}else{service.updateInfo();service.user=data;if(service.callback){service.callback();service.callback=false;}else{$.magnificPopup.close();if(App.currentPage=='restaurant'&&App.restaurant.permalink){App.page.restaurant(App.restaurant.permalink);}
App.signin.manageLocation();}}});}
service.updateInfo=function(data,callback){var url=App.service+'user';$http({method:'GET',url:url}).success(function(data){if(data.id_user!=''){service.user=data;App.config.user=data;App.identify();$rootScope.$safeApply();}
if(callback){callback();}});}
service.purify=function(){service.form.email=$.trim(service.form.email);service.form.password=$.trim(service.form.password);}
service.isValidEmailPhone=function(){if(!App.phone.validate(service.form.email)){if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(service.form.email)){return false}}
return true;}
service.isValidPassword=function(){return service.password!='';}
return service;});NGApp.factory('AccountHelpService',function($http,AccountService,AccountModalService){var service={visible:false,error:false,success:{visible:false,facebook:{visible:false}}};var account=AccountService;var modal=AccountModalService;service.show=function(show){service.visible=show;modal.header=!show;if(show){service.reset();}}
service.reset=function(){service.error=false;service.success.visible=false;service.success.facebook.visible=false;}
service.sendForm=function(){if(!account.isValidEmailPhone()){alert('Please enter a valid email or phone.');$('.help-email').focus();return;}
var url=App.service+'user/reset';$http({method:'POST',url:url,data:$.param({'email':account.form.email}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='user is not registred'){service.error=true;$('input[name=password-help-email]').focus()}}else{if(data.success='success'){service.success.visible=true;service.error=false;if(data.userHasFacebookAuth){help.success.facebook.visible=true;}}}});}
return service;});NGApp.factory('AccountModalService',function($http,FacebookService){var service={header:true,signin:true,signup:false};service.facebook=FacebookService;service.signinOpen=function(){service.header=true;App.dialog.show('.account-container');service.toggleSignForm('signin');}
service.signupOpen=function(){service.header=true;App.dialog.show('.account-container');service.toggleSignForm('signup');}
service.resetOpen=function(){App.dialog.show('.account-reset-container');}
service.toggleSignForm=function(form){service.facebook.wait=false;if(form=='signin'){service.signin=true;service.signup=false;}else{service.signin=false;service.signup=true;}}
service.headerIsVisible=function(){return service.header.visible;}
return service;});NGApp.factory('AccountFacebookService',function($http,FacebookService){var service={};service.facebook=FacebookService;service.account=service.facebook.account;service.auth=function(){service.facebook.wait=true;FB.login(service.facebook.startAuth,{scope:App.facebookScope});}
service.signout=function(callback){service.facebook.signout(callback);}
return service;});NGApp.factory('AccountSignOut',function($http,AccountFacebookService){var service={};service.facebook=AccountFacebookService;service.do=function(){if(confirm('Confirm sign out?')){$.each(['token','location','PHPSESSID'],function(index,value){$.totalStorage(value,null);});var signout=function(){var url=App.service+'logout';$http({method:'GET',url:url}).success(function(data){location.href='/';});};if(service.facebook.facebook.logged||service.facebook.facebook.account.user.facebook){service.facebook.signout(function(){signout()});}else{signout();}}}
return service;});NGApp.factory('AccountResetService',function($http,$location){var service={step:1,form:{code:'',password:''},success:false,error:false};service.form.code=$location.path().replace('/reset','');service.form.code=service.form.code.replace('/','');service.validateCode=function(){service.form.code=$.trim(service.form.code);if(service.form.code==''){service.error='empty';$('#account-reset-code').focus();return;}
var url=App.service+'user/code-validate';$http({method:'POST',url:url,data:$.param({'code':service.form.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){if(data.error=='invalid code'){service.error='invalid';}
if(data.error=='expired code'){service.error='expired';}
$('#account-reset-code').focus();return;}else{if(data.success='valid code'){service.step=2;service.error=false;}}});}
service.changePassword=function(){service.form.password=$.trim(service.form.password);if(service.form.password==''){service.error='empty';$('#account-reset-password').focus();return;}
var url=App.service+'user/change-password';$http({method:'POST',url:url,data:$.param({'code':service.form.code,'password':service.form.password}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.error){service.error='invalid';service.step=1;return;}else{if(data.success='password changed'){service.success=true;}}});}
return service;});;NGApp.factory('MainNavigationService',function($http,$location,AccountService,AccountModalService){var service={page:'',buttons:{location:false,menu:true}};service.menu=App.toggleMenu;service.account=AccountService;service.modal=AccountModalService;service.home=function(){if(App.isPhoneGap||App.isMobile()){service.menu();}else{service.link();}}
service.link=function(path){$location.path(path||'/');App.snap.close();}
service.signin=function(){service.modal.signinOpen();}
service.control=function(){switch(service.page){case'restaurant':service.buttons.location=false;service.buttons.back=true;service.buttons.menu=false;break;default:service.buttons.back=false;service.buttons.location=false;service.buttons.menu=true;break;}}
return service;});;NGApp.factory('RestaurantsService',function($http,PositionsService){var service={};var restaurants=false;var isSorted=false;service.reset=function(){restaurants=false;isSorted=false;}
service.position=PositionsService;service.sort=function(){if(isSorted){return restaurants;}
var list=restaurants;for(var x in list){list[x].open();if(!list[x]._open){list[x]._tag='closed';}else{if(list[x].delivery!='1'){list[x]._tag='takeout';}else if(list[x].isAboutToClose()){list[x]._tag='closing';}}
list[x]._short_description=(list[x].short_description||('Top Order: '+(list[x].top_name?(list[x].top_name||list[x].top_name):'')));};list.sort(sort_by({name:'_open',reverse:true},{name:'delivery',reverse:true},{name:'_weight',primer:parseInt,reverse:true}));isSorted=true;restaurants=list;return restaurants;}
service.list=function(success,error){if(!service.position.pos().valid('restaurants')){if(error){error();}
return false;}
if(restaurants===false||App.restaurants.forceLoad){var url=App.service+'restaurants?lat='+service.position.pos().lat()+'&lon='+service.position.pos().lon()+'&range='+(service.position.range||App.defaultRange);$http.get(url,{cache:true}).success(function(data){var list=[];if(typeof data.restaurants=='undefined'||data.restaurants.length==0){if(error){error();return false;}}else{for(var x in data.restaurants){list[list.length]=new Restaurant(data.restaurants[x]);}
restaurants=list;if(success){success(list);}
return list;}});isSorted=false;App.restaurants.forceLoad=false;}else{if(success){success(restaurants);}
return restaurants;}}
return service;});NGApp.factory('RestaurantService',function($http,$routeParams,$rootScope){var service={};service.init=function(){App.cache('Restaurant',$routeParams.id,function(){var restaurant=this;var community=App.getCommunityById(restaurant.id_community);$rootScope.$broadcast('restaurantLoaded',{restaurant:restaurant,community:community});});}
return service;});;NGApp.factory('CommunityAliasService',function(PositionsService){var service={};service.position=PositionsService;service.route=function(id,success,error){id=id.replace('/','').toLowerCase();alias=App.aliases[id]||false;success=success||function(){};error=error||function(){};if(alias){var loc=App.locations[alias.id_community];if(loc.loc_lat&&loc.loc_lon){var res=new Location({lat:loc.loc_lat,lon:loc.loc_lon,type:'alias',verified:true,prep:alias.prep,city:alias.name_alt,address:alias.name_alt});success({alias:res});return;}}
error();};return service;});;NGApp.factory('RecommendRestaurantService',function($http,PositionsService,AccountService){var service={form:{restaurant:''},greetings:false};service.position=PositionsService;service.account=AccountService;var recommendations=[];service.addRecommendation=function(id){recommendations.push(id);}
service.send=function(){if(service.form.restaurant==''){alert("Please enter the restaurant\'s name.");$('.recommend-restaurant').focus();return;}
var pos=service.position.pos();var content='Address entered: '+pos.entered()+'\n'+'Address reverse: '+pos.address()+'\n'+'City: '+pos.city()+'\n'+'Region: '+pos.region()+'\n'+'Lat: '+pos.lat()+'\n'+'Lon: '+pos.lon();var url=App.service+'suggestion/restaurant';$http({method:'POST',url:url,data:$.param({name:service.form.restaurant,content:content}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.greetings=true;service.addRecommendation(data.id_suggestion);service.form.restaurant='';});}
service.getRecommendations=function(){if(recommendations.length>0){return recommendations;}
return false;}
service.relateUser=function(){if(service.getRecommendations()){var url=App.service+'suggestion/relateuser';$.each(recommendations,function(index,value){var id_suggestion=value;$http({method:'POST',url:url,data:$.param({id_suggestion:id_suggestion,id_user:service.account.user.id_user}),headers:{'Content-Type':'application/x-www-form-urlencoded'}});});recommendations=false;}}
return service;});NGApp.factory('RecommendFoodService',function($http){var service={thanks:false,isSending:false,modal:{},form:{name:''}};service.reset=function(){service.thanks=false;service.isSending=false;service.form.name='';}
service.modal.open=function(){service.reset();App.dialog.show('.suggest-food-container');};service.send=function(){service.form.name=$.trim(service.form.name);if(service.form.name==''){alert('Please enter a suggestion.');$('#suggestion-name').focus();return;}
service.isSending=true;var url=App.service+'suggestion/new';$http({method:'POST',url:url,data:$.param({restaurant:App.restaurant.permalink,name:service.form.name}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.thanks=true;service.isSending=false;});}
return service;});;NGApp.factory('SupportService',function($http,AccountService){var service={minimized:true,maximized:false,thanks:false,form:{}};service.account=AccountService;service.form.name=angular.copy(service.account.user.name);service.form.phone=angular.copy(service.account.user.phone);service.form.message='';service.toggle=function(){service.minimized=!service.minimized;service.maximized=!service.maximized;if(service.maximized){$('.support-container').addClass('support-container-maximized');service.reset();}else{$('.support-container').removeClass('support-container-maximized');}}
service.reset=function(){service.form.message='';service.thanks=false;}
service.send=function(){service.purify();if(service.form.name==''){alert('Please enter your name.');$('input[name=support-name]').focus();return;}
if(service.form.phone==''){alert('Please enter your phone.');$('input[name=support-phone]').focus();return;}
if(!App.phone.validate(service.form.phone)){alert('Please enter a valid phone.');$('input[name=support-phone]').focus();return;}
if(service.form.message==''){alert('Please enter the message.');$('textarea[name=support-message]').focus();return;}
if(!service.isSending){service.isSending=true;var url=App.service+'support/sms';$http({method:'POST',url:url,data:$.param({name:service.form.name,phone:service.form.phone,message:service.form.message}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){service.thanks=true;service.isSending=false;});}}
service.purify=function(){service.form.name=$.trim(service.form.name);service.form.phone=$.trim(service.form.phone);service.form.message=$.trim(service.form.message);}
return service;});;NGApp.factory('OrderService',function($http,$location,$rootScope,AccountService,CartService,LocationService,CreditService){var service={};service.location=LocationService;service.account=AccountService;service.cart=CartService;service.credit=CreditService;service.restaurant={};service.location.loadRestaurantsPage=false;service.location.init();service.form={delivery_type:'delivery',pay_type:'card',make_default:true};service.showForm=true;service.loaded=false;service.info={dollarSign:'',breakdownDescription:'',extraCharges:'',deliveryMinDiff:'',cartSummary:'',totalText:'',creditLeft:''}
service.toogleDelivery=function(type){if(type!=service.form.delivery_type){service.form.delivery_type=type;service.updateTotal();}}
service.tooglePayment=function(type){if(type!=service.form.pay_type){service.form.pay_type=type;service.updateTotal();}}
service.init=function(){if(App.config.ab&&App.config.ab.dollarSign=='show'){service.info.dollarSign='$';}
if(service.account.user&&service.account.user.last_tip){var tip=service.account.user.last_tip;}else{var tip='autotip';}
service._deliveryAddressOk=false;service._tipHasChanged=false;service._cardInfoHasChanged=false;service._crunchSoundPlayded=false;service._useRestaurantBoundingBox=false;service._useCompleteAddress=false;service._completeAddressWithZipCode=true;service.form.pay_type=(service.account.user&&service.account.user.pay_type)?service.account.user.pay_type:'card';if(service.restaurant.credit!=1&&service.form.pay_type=='card'){service.form.pay_type='cash';}
if(service.restaurant.cash!=1&&service.form.pay_type=='cash'){service.form.pay_type='card';}
service.form.delivery_type=(service.account.user&&service.account.user.delivery_type)?service.account.user.delivery_type:'delivery';if(service.restaurant.delivery!=1&&service.form.delivery_type=='delivery'){service.form.delivery_type='takeout';}
if(service.restaurant.takeout!=1&&service.form.delivery_type=='takeout'){service.form.delivery_type='delivery';}
service.form.autotip=0;service.form.tip=service._lastTipNormalize(tip);service.form.name=service.account.user.name;service.form.phone=App.phone.format(service.account.user.phone);service.form.address=service.account.user.address;service.form.notes=(service.account.user&&service.account.user.presets&&service.account.user.presets[service.restaurant.id_restaurant])?service.account.user.presets[service.restaurant.id_restaurant].notes:'';service.form.cardNumber=service.account.user.card;service.form.cardMonth=service.account.user.card_exp_month;service.form.cardYear=service.account.user.card_exp_year;service.updateTotal();if(service.account.user&&service.account.user.address){service.showForm=false;}
if(service.cart.hasItems()){service.reloadOrder();}else if(service.account.user&&service.account.user.presets&&service.account.user.presets[service.restaurant.id_restaurant]){try{service.loadOrder(service.account.user.presets[service.restaurant.id_restaurant]);}catch(e){if(service.restaurant.preset){service.loadOrder(service.restaurant.preset());}}}else{if(service.restaurant.preset){service.loadOrder(service.restaurant.preset());}}
service.loaded=true;$rootScope.$broadcast('orderLoaded',true);}
service.reloadOrder=function(){var cart=service.cart.getCart();service.resetOrder();service.loadFlatOrder(cart);}
service.loadFlatOrder=function(cart){for(var x in cart){service.cart.add(cart[x].id,{options:cart[x].options?cart[x].options:[]});}}
service.loadOrder=function(order){try{if(order){var dishes=order['_dishes'];for(var x in dishes){var options=[];for(var xx in dishes[x]['_options']){options[options.length]=dishes[x]['_options'][xx].id_option;}
if(App.cached.Dish[dishes[x].id_dish]!=undefined){service.cart.add(dishes[x].id_dish,{options:options});}}}}catch(e){console.log(e.stack);}}
service.extraChargesText=function(breakdown){var elements=[];var text='';if(breakdown.delivery){elements.push(service.info.dollarSign+breakdown.delivery.toFixed(2)+' delivery');}
if(breakdown.fee){elements.push(service.info.dollarSign+breakdown.fee.toFixed(2)+' fee');}
if(breakdown.taxes){elements.push(service.info.dollarSign+breakdown.taxes.toFixed(2)+' taxes');}
if(breakdown.tip&&breakdown.tip>0){elements.push(service.info.dollarSign+breakdown.tip+' tip');}
if(elements.length){if(elements.length>2){var lastOne=elements.pop();var elements=[elements.join(', ')];elements.push(lastOne);}
var text=elements.join(' & ');}
return text;}
service.subtotal=function(){return service.cart.subtotal();}
service._breackDownDelivery=function(){var delivery=0;if(service.restaurant.delivery_fee&&service.form.delivery_type=='delivery'){delivery=parseFloat(service.restaurant.delivery_fee);}
delivery=App.ceil(delivery);return delivery;}
service._breackDownFee=function(feeTotal){var fee=0;if(service.restaurant.fee_customer){fee=(feeTotal*(parseFloat(service.restaurant.fee_customer)/100));}
fee=App.ceil(fee);return fee;}
service._breackDownTaxes=function(feeTotal){var taxes=(feeTotal*(service.restaurant.tax/100));taxes=App.ceil(taxes);return taxes;}
service._breakdownTip=function(total){var tip=0;if(service.form.pay_type=='card'){if(service.form.tip==='autotip'){return parseFloat($('[name=pay-autotip-value]').val());}
tip=(total*(service.form.tip/100));}
tip=App.ceil(tip);return tip;}
service.total=function(){var
total=0,dish,options,feeTotal=0,totalItems=0,finalAmount=0;var breakdown=this.totalbreakdown();total=breakdown.subtotal;feeTotal=total;feeTotal+=breakdown.delivery;feeTotal+=breakdown.fee;finalAmount=feeTotal+breakdown.taxes;finalAmount+=this._breakdownTip(total);return App.ceil(finalAmount).toFixed(2);}
service.charged=function(){var finalAmount=this.total();var credit=parseFloat(service.credit.value);if(service.form.pay_type=='card'&&credit){finalAmount=finalAmount-credit;if(finalAmount<0){finalAmount=0;}}
return App.ceil(finalAmount).toFixed(2);}
service.totalbreakdown=function(){var elements={};var total=this.subtotal();var feeTotal=total;elements['subtotal']=this.subtotal();elements['delivery']=this._breackDownDelivery();feeTotal+=elements['delivery'];elements['fee']=this._breackDownFee(feeTotal);feeTotal+=elements['fee'];elements['taxes']=this._breackDownTaxes(feeTotal);elements['tip']=this._breakdownTip(total);return elements;}
service.resetOrder=function(){service.cart.items={};}
service.submit=function(){service._deliveryAddressOk=false;service.processOrder();}
service.processOrder=function(){if(App.busy.isBusy()){return;}
App.busy.makeBusy();var order={address:service.form.address,phone:service.form.phone,name:service.form.name,cart:service.cart.getCart(),pay_type:service.form.pay_type,delivery_type:service.form.delivery_type,restaurant:service.restaurant.id,make_default:service.form.make_default,notes:service.form.notes,lat:service.location.position.pos().lat(),lon:service.location.position.pos().lon()};if(order.pay_type=='card'){order.tip=service.form.tip||'3';order.autotip_value=service.form.autotip;}
if(service._cardInfoHasChanged){order.card={number:service.form.cardNumber,month:service.form.cardMonth,year:service.form.cardYear};}else{order.card={};}
var errors={};if(!order.name){errors['name']='Please enter your name.';}
if(!App.phone.validate(order.phone)){errors['phone']='Please enter a valid phone #.';}
if(order.delivery_type=='delivery'&&!order.address){errors['address']='Please enter an address.';}
if(order.pay_type=='card'&&((service._cardInfoHasChanged&&!order.card.number)||(!service.account.user.id_user&&!order.card.number))){errors['card']='Please enter a valid card #.';}
if(!service.cart.hasItems()){errors['noorder']='Please add something to your order.';}
var _total=service.restaurant.delivery_min_amt=='subtotal'?service.subtotal():service.total();if(service.restaurant.meetDeliveryMin(_total)&&service.form.delivery_type=='delivery'){errors['delivery_min']='Please meet the delivery minimum of '+service.info.dollarSign+service.restaurant.delivery_min+'.';}
if(!$.isEmptyObject(errors)){var error='';for(var x in errors){error+=errors[x]+"\n";}
$('body').scrollTop($('.payment-form').position().top-80);App.alert(error);App.busy.unBusy();App.track('OrderError',errors);App.log.order({'errors':errors},'validation error');return;}
if(App.iOS()&&!service._crunchSoundPlayded){App.playAudio('get-food-audio');service._crunchSoundPlayded=true;}
if(order.delivery_type=='delivery'){if(service.account&&service.account.user&&service.account.user.last_order){if(service.account.user.last_order.communities.indexOf(service.restaurant.id_community)>-1){var lastAddress=service.account.user.last_order.address;var currentAdress=service.form.address;if($.trim(lastAddress)!=''&&$.trim(lastAddress)==$.trim(currentAdress)){service._deliveryAddressOk=true;App.log.order({'address':lastAddress,'restaurant':service.restaurant.name},'legacy address');}}}
if(!service._deliveryAddressOk){if(service.location.bounding){var latLong=new google.maps.LatLng(service.location.bounding.lat,service.location.bounding.lon);}
if(service._useRestaurantBoundingBox){var latLong=new google.maps.LatLng(service.restaurant.loc_lat,service.restaurant.loc_long);}
if(!latLong){App.alert('Could not locate you!');App.busy.unBusy();return;}
var success=function(results){var theClosestAddress=service.location.theClosestAddress(results,latLong);var isTheAddressOk=service.location.validateAddressType(theClosestAddress.result);if(isTheAddressOk){theClosestAddress=theClosestAddress.location;var lat=theClosestAddress.lat();var lon=theClosestAddress.lon();if(service._useCompleteAddress){service.form.address=theClosestAddress.formatted();order.address=service.form.address;}
var distance=service.location.distance({from:{lat:lat,lon:lon},to:{lat:service.restaurant.loc_lat,lon:service.restaurant.loc_long}});distance=service.location.km2Miles(distance);if(!service.restaurant.deliveryHere(distance)){App.alert('Sorry, you are out of delivery range or have an invalid address. \nPlease check your address, or order takeout.');App.busy.unBusy();$rootScope.$safeApply(function(){service.showForm=true;$('[name="pay-address"]').focus();service.form.address=theClosestAddress.formatted();});App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address out of delivery range');return;}else{if(service._completeAddressWithZipCode){var zipCode=theClosestAddress.zip();var typed_address=service.form.address;if(typed_address.indexOf(zipCode)<0){var addressWithZip=typed_address+' - '+zipCode;service.form.address=addressWithZip;}}
App.busy.unBusy();service._deliveryAddressOk=true;service.processOrder();}}else{App.alert('Oops, it looks like your address is incomplete. \nPlease enter a street name, number and zip code.');App.busy.unBusy();$rootScope.$safeApply(function(){service.showForm=true;$('[name="pay-address"]').focus();});App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address not found or invalid');}}
var error=function(){App.alert('Oops, it looks like your address is incomplete. \nPlease enter a street name, number and zip code.');App.busy.unBusy();App.log.order({'address':$('[name=pay-address]').val(),'restaurant':service.restaurant.name},'address not found');};service.location.doGeocodeWithBound(order.address,latLong,success,error);return;}}
if(order.delivery_type=='takeout'){service._deliveryAddressOk=true;}
if(!service._deliveryAddressOk){return;}
if(!service._crunchSoundPlayded){App.playAudio('get-food-audio');service._crunchSoundPlayded=true;}
var url=App.service+'order';$http({method:'POST',url:url,data:$.param(order),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(json){try{var uuid=json.uuid;}catch(e){App.log.order(json,'processing error');json={status:'false',errors:['Sorry! Something went horribly wrong trying to place your order!']};}
if(json.status=='false'){var error='';for(x in json.errors){error+=json.errors[x]+"\n";}
App.track('OrderError',json.errors);App.alert(error);App.log.order({'errors':json.errors},'validation error - php');}else{if(json.token){$.totalStorage('token',json.token);}
service.account.updateInfo();App.cache('Order',json.uuid,function(){App.track('Ordered',{'total':this.final_price,'subtotal':this.price,'tip':this.tip,'restaurant':service.restaurant.name,'paytype':this.pay_type,'ordertype':this.order_type,'user':this.user,'items':service.cart.totalItems()});service.resetOrder();$rootScope.$safeApply(function(){$location.path('/order/'+uuid);});});}
setTimeout(function(){App.busy.unBusy();},400);});}
service.tipChanged=function(){service._tipHasChanged=true;service.updateTotal();}
service.cardInfoChanged=function(){service._cardInfoHasChanged=true;}
service.updateTotal=function(){if(!service.restaurant.id_restaurant){return;}
service.info.totalText=service.info.dollarSign+service.charged();var tipText='',feesText='',totalItems=0,credit=parseFloat(service.credit.value),hasFees=((service.restaurant.delivery_fee&&service.form.delivery_type=='delivery')||service.restaurant.fee_customer)?true:false;for(var x in service.items){totalItems++;}
service._autotip();var wasTipChanged=false;if(service.form.delivery_type=='takeout'&&service.form.pay_type=='card'){if(!service._tipHasChanged){service.form.tip=0;wasTipChanged=true;}}else if(service.form.delivery_type=='delivery'&&service.form.pay_type=='card'){if(!service._tipHasChanged){service.form.tip=(service.account.user.last_tip)?service.account.user.last_tip:'autotip';service.form.tip=service._lastTipNormalize(service.form.tip);wasTipChanged=true;}}
if(wasTipChanged){service.info.totalText=service.info.dollarSign+this.charged();}
var _total=service.restaurant.delivery_min_amt=='subtotal'?service.subtotal():service.total();if(service.restaurant.meetDeliveryMin(_total)&&service.form.delivery_type=='delivery'){service.info.deliveryMinDiff=service.restaurant.deliveryDiff(_total);}else{service.info.deliveryMinDiff='';}
service.info.totalItems=service.cart.totalItems();service.info.extraCharges=service.extraChargesText(service.totalbreakdown());service.info.breakdownDescription=service.info.dollarSign+this.subtotal().toFixed(2);service.info.cartSummary=service.cart.summary();if(service.form.pay_type=='card'&&credit>0){service.info.creditLeft='';if(this.total()<credit){service.info.creditLeft=App.ceil((credit-this.total())).toFixed(2);credit=this.total();}}}
service._autotip=function(){var subtotal=service.totalbreakdown().subtotal;var autotipValue
if(subtotal===0){autotipValue=0;}else{autotipValue=Math.ceil(4*(subtotal*0.107+0.85))/4;}
service.form.autotip=autotipValue;}
service._autotipText=function(){var autotipText=service.form.autotip?' ('+service.info.dollarSign+service.form.autotip+')':'';return'Autotip'+autotipText;}
service._years=function(){var years=[];years.push({value:'',label:'Year'});var date=new Date().getFullYear();for(var x=date;x<=date+20;x++){years.push({value:x.toString(),label:x.toString()});}
return years;}
service._months=function(){var months=[];months.push({value:'',label:'Month'});for(var x=1;x<=12;x++){months.push({value:x.toString(),label:x.toString()});}
return months;}
service._tips=function(){var tips=[];tips.push({value:'autotip',label:service._autotipText()});tips.push({value:0,label:'Tip with cash'});var _tips=[0,10,15,18,20,25,30];for(var x in _tips){tips.push({value:_tips[x],label:'tip '+_tips[x]+' %'});}
return tips;}
service._lastTipNormalize=function(lastTip){if(lastTip==='autotip'){return lastTip;}
if(service.account.user&&service.account.user.last_tip_type&&service.account.user.last_tip_type=='number'){return'autotip';}
lastTip=parseInt(lastTip);var tips=service._tips();for(x in tips){if(lastTip==parseInt(tips[x].value)){return lastTip;}}
return'autotip';}
service._test=function(){$rootScope.$safeApply(function(){service._useRestaurantBoundingBox=true;service.form.name='MR TEST';service.form.phone='405-279-9645';service.form.address='123 main';service.form.cardNumber='4242424242424242';service.form.cardMonth='2';service.form.cardYear='2016';service.form.tip='autotip';service.tooglePayment('card');if(!service.askedAboutFood){service.askedAboutFood=true;if(confirm('Add some food?')){var categories=service.restaurant.categories()
for(x in categories){category=categories[x];var dishes=category.dishes();for(y in dishes){var dish=dishes[y];service.cart.add(dish.id_dish);}}}}});}
return service;});NGApp.factory('OrdersService',function($http,$location){var service={list:false};service.all=function(){list=false;service.list=list;$http.get(App.service+'user/orders',{cache:false}).success(function(json){if(json){for(var x in json){json[x].timeFormat=json[x]._date_tz.replace(/^[0-9]+-([0-9]+)-([0-9]+) ([0-9]+:[0-9]+):[0-9]+$/i,'$1/$2 $3');}
list=json;}else{list=true;}
service.list=list;});}
service.restaurant=function(permalink){$location.path('/'+App.restaurants.permalink+'/'+permalink);};service.receipt=function(id_order){$location.path('/order/'+id_order);};return service;});NGApp.factory('OrderViewService',function($routeParams,$location,$rootScope,FacebookService){var service={order:false};service.facebook=FacebookService;service.load=function(){App.cache('Order',$routeParams.id,function(){service.order=this;var complete=function(){$location.path('/');};if(!service.order.uuid){$rootScope.$safeApply(function(){complete();});return;}
service.facebook._order_uuid=service.order.uuid;service.facebook.preLoadOrderStatus();App.cache('Restaurant',service.order.id_restaurant,function(){service.restaurant=this;var complete=function(){if(service.order['new']){setTimeout(function(){service.order['new']=false;},500);}};$rootScope.$safeApply(function(){complete();});});});}
return service;});;NGApp.factory('FacebookService',function($http,$location,AccountService){var service={token:false,_order_uuid:false,orderStatus:false,logged:false,doAuth:true,wait:false,running:false,error:{unknown:false,userExists:false,login:false}}
service.account=AccountService;service.preLoadOrderStatus=function(uuid){var url=App.service+'facebook/status/order/'+service._order_uuid;$http({method:'GET',url:url,}).success(function(data){if(data.success){service.orderStatus=data.success;}else{service.orderStatus=false;}});}
service.postOrder=function(){if(!service.orderStatus){service.preLoadOrderStatus();alert('Oops, please try again!');return;}
var status=service.orderStatus;FB.ui({method:'stream.publish',user_message_prompt:'CrunchButton: Publish This!',message:status.message,attachment:{name:status.name,caption:status.caption,description:status.description,href:status.link,media:[{'type':'image','src':status.picture,'href':status.link}],},action_links:[{text:status.site_name,href:status.site_url}]},function(response){if(response&&response.post_id){alert('Thank you for sharing!');}});}
service.requestLogin=function(callback){FB.login(function(response){service.processStatus(response,callback);},{scope:serviceScope});}
service.registerToken=function(token){if(!service.token){service.token=token;$.totalStorage('fbtoken',token);}}
service.requestPermission=function(callback){FB.ui({method:'permissions.request','perms':serviceScope,'display':'iframe'},function(response){callback();});}
service.auth=function(session){service.logged=true;App.log.account({'userID':session.authResponse.userID},'facebook login');if(service.doAuth){FB.api('/me',{fields:'name'},function(response){if(response.error){App.log.account({'userID':session.authResponse.userID,'error':response.error},'facebook name error');service.error.unknown=true;return;}
App.log.account({'userID':session.authResponse.userID,'response':response,'shouldAuth':service.doAuth,'running':service.running},'facebook response');if(response.id){service.doAuth=false;if(!service.running){service.running=true;App.log.account({'userID':session.authResponse.userID,'running':service.running},'facebook running');var url=App.service+'user/facebook';$http({method:'GET',url:url,}).success(function(data){App.log.account({'userID':session.authResponse.userID,'running':service.running,'data':data},'facebook ajax');if(data.error){if(data.error=='facebook id already in use'){App.log.account({'error':data.error},'facebook error');service.error.unknown=true;}}else{service.account.updateInfo();service.account.user=data;if(service.account.callback){service.account.callback();service.account.callback=false;}else{App.signin.manageLocation();$.magnificPopup.close();}}
App.log.account({'userID':session.authResponse.userID,'currentPage':App.currentPage},'facebook currentPage');});}}else{service.error.unknown=true;}});}}
service.signout=function(callback){FB.logout(callback());}
service.startAuth=function(response){service.processStatus(response,service.auth);}
service.processStatus=function(response,callback){if(response.status==='connected'&&response.authResponse){if(response.authResponse.accessToken){service.logged=true;service.registerToken(response.authResponse.accessToken);}
if(callback){callback(response);}}}
return service;});;NGApp.factory('GiftCardModalService',function(){var service={};service.open=function(){App.dialog.show('.giftcard-container');}
return service;});NGApp.factory('GiftCardService',function($http,$location,AccountModalService,GiftCardModalService,CreditService,$rootScope){var service={redeemed:false,code:false,value:'',notes_field:{content:'',giftcards:{success:[],error:[]},value:'0.00',removed:false,id_restaurant:null,hasGiftCards:false,restaurant_accepts:false},modal:{intro:true,error:false,success:false,restaurant:false,}};credit=CreditService;service.accountModal=AccountModalService;service.giftCardModal=GiftCardModalService;service.account=service.accountModal.facebook.account;service.openRestaurant=function(){$location.path('/'+App.restaurants.permalink+'/'+service.modal.restaurant.permalink);service.modal.close();}
service.parseURLCode=function(){service.code=$location.path().replace('/giftcard','');service.code=service.code.replace('/','');}
service.processModal=function(){if(!service.code||service.code==''){return;}
service.modal.reset();setTimeout(function(){service.redeemed=service.account.isLogged();service.validate(function(data){service.modal.intro=false;if(data.error){service.modal.error=true;switch(data.error){case'gift card already used':service.modal.error='used';break;case'invalid gift card':service.modal.error='invalid';break;default:service.modal.error='unknow';break;}}else if(data.success){service.modal.success=true;service.value=data.success['value'];if(data.success['id_restaurant']){service.modal.restaurant={id_restaurant:data.success['id_restaurant'],name:data.success['restaurant'],permalink:data.success['permalink']};}else{service.modal.restaurant=false;}}});},500);}
service.modal.reset=function(){service.modal.intro=true;service.modal.error=false;service.modal.success=false;service.modal.restaurant=false;}
service.modal.signIn=function(){service.account.callback=function(){service.giftCardModal.open();service.processModal();}
service.accountModal.signinOpen();}
service.modal.close=function(){$.magnificPopup.close();}
service.validate=function(callback){service.code=$.trim(service.code);if(service.code==''){callback({error:true});return;}
if(service.redeemed){var url=App.service+'giftcard/code';}else{var url=App.service+'giftcard/validate';}
$http({method:'POST',url:url,data:$.param({'code':service.code}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){callback(data);}).error(function(data,status){callback({error:true});});}
service.notes_field.start=function(){service.notes_field.hasGiftCards=false;if(service.notes_field.content&&service.notes_field.content!=''){var words=service.notes_field.content.split(' ');}else{var words=[];}
if(!service.notes_field.running){service.notes_field.running=true;service.notes_field.total=0;var giftcards={};service.notes_field.giftcards.success=[];service.notes_field.giftcards.error=[];for(var x in words){var word=$.trim(words[x]);if(word!=''){word=word.replace(/[^a-zA-Z 0-9]+/g,'');if(!giftcards[word]){service.notes_field.total++;}
giftcards[word]=word;}}
var hasGiftsToValidate=false;$.each(giftcards,function(key,value){hasGiftsToValidate=true;var url=App.service+'giftcard/validate';$http({method:'POST',url:url,data:$.param({'code':value}),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){if(data.success){service.notes_field.hasGiftCards=true;var giftcard=data.success;if(giftcard.id_restaurant&&giftcard.id_restaurant!=service.notes_field.id_restaurant){giftcard.error='other restaurant';}
service.notes_field.giftcards.success.push(data.success);}else if(data.error){service.notes_field.giftcards.error.push(data);}
service.notes_field.total--;service.notes_field.checkAllValidated();}).error(function(data,status){service.notes_field.total--;service.notes_field.checkAllValidated();});});if(!hasGiftsToValidate){service.notes_field.checkAllValidated();}}}
service.notes_field.checkAllValidated=function(){if(service.notes_field.total<=0){service.notes_field.running=false;}
if(!service.notes_field.running){service.notes_field.compareValues();}
$rootScope.$broadcast('giftCardUpdate');}
service.notes_field.compareValues=function(){service.notes_field.removed=false;var values=0;if(service.notes_field.giftcards.success.length>0){$.each(service.notes_field.giftcards.success,function(key,giftcard){if(giftcard&&!giftcard.error){values+=parseFloat(giftcard.value);}});}
if(service.notes_field.value>values){service.notes_field.removed=true;}
if(service.notes_field.restaurant_accepts){service.notes_field.value=App.ceil(values).toFixed(2);credit.setValue(App.ceil(credit.redeemed+values).toFixed(2));}
$rootScope.$broadcast('creditChanged',{value:service.value});}
return service;});NGApp.factory('CreditService',function($http,$rootScope){var service={value:'0.00',tooltip:false,redeemed:0};service.setValue=function(value){service.value=value;$rootScope.$broadcast('creditChanged',{value:service.value});}
service.getCredit=function(restaurant_id){var url=App.service+'user/credit/'+restaurant_id;$http({url:url}).success(function(data){if(data.credit){service.setValue(App.ceil(data.credit).toFixed(2));service.redeemed=data.credit;}}).error(function(){});}
return service;});;NGApp.factory('PositionsService',function(){var service={bounding:null,initied:false,locs:[]}
service.addLocation=function(loc){App.restaurants.forceLoad=true;service.locs.push(loc);$.totalStorage('locsv2',service.locs);}
service.pos=function(){return((service.locs.length)?service.locs[service.locs.length-1]:new Location);}
return service;});NGApp.factory('LocationService',function($location,RestaurantsService,PositionsService,AccountService){var service={form:{address:''},range:App.defaultRange,loaded:false,locationNotServed:false,initied:false,loadRestaurantsPage:true,_initied:false}
service.account=AccountService;service.position=PositionsService;service.restaurantsService=RestaurantsService;service.distance=function(params){try{var R=6371;var dLat=service.toRad(params.to.lat-params.from.lat);var dLon=service.toRad(params.to.lon-params.from.lon);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(service.toRad(params.from.lat))*Math.cos(service.toRad(params.to.lat))*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d;}catch(e){var pos=service.position.pos();App.track('Location Error',{lat:pos.lat,lon:pos.lon,address:pos.address()});}}
service.getClosest=function(results,latLong){var from={lat:latLong.lat(),lon:latLong.lng()};var distances=[];var closest=-1;for(i=0;i<results.length;i++){var d=service.distance({to:{lat:results[i].geometry.location.lat(),lon:results[i].geometry.location.lng()},from:from});distances[i]=d;if(closest==-1||d<distances[closest]){closest=i;}}
return results[closest];}
service.getLocationByBrowser=function(success,error){var success=success||function(){};var error=error||function(){};if(navigator.geolocation){service.timerId=setTimeout(function(){error();},5000);navigator.geolocation.getCurrentPosition(function(position){clearTimeout(service.timerId);service.position.addLocation(new Location({lat:position.coords.latitude,lon:position.coords.longitude,type:'geolocation'}));App.track('Locations Shared',{lat:position.coords.latitude,lon:position.coords.longitude});service.reverseGeocode(position.coords.latitude,position.coords.longitude,success,error);},function(){clearTimeout(service.timerId);error();},{maximumAge:60000,timeout:5000,enableHighAccuracy:true});}else{error();}}
service.init=function(){if(service.initied){return;}
service.initied=true;if(App.config.loc.lat&&App.config.loc.lon){service.bounding=App.config.loc;service.bounding.type='geoip';}
var cookieLocs=$.totalStorage('locsv2');var cookieBounding=$.totalStorage('boundingv2');if(cookieLocs){for(var x in cookieLocs){service.position.addLocation(new Location(cookieLocs[x]._properties));}}
if(cookieBounding){service.bounding=cookieBounding;service.bounding.type='cookie';}
if(service.account&&service.account.user&&service.account.user.location_lat){service.bounding={lat:service.account.user.location_lat,lon:service.account.user.location_lon,type:'user'};}
if(google&&google.load&&!google.maps){google.load('maps','3',{callback:service.googleCallback,other_params:'sensor=false'});}}
service.googleCallback=function(){console.debug('PROCESSING LOCATION DATA FROM GOOGLE API');var error=function(){if(service.bounding&&service.bounding.lat&&service.bounding.lon&&!service.bounding.city){service.reverseGeocode(service.bounding.lat,service.bounding.lon,function(loc){service.bounding.city=loc.city();service.bounding.region='';service.position.addLocation(loc);service.restaurantsService.list(function(){if(service.loadRestaurantsPage){$location.path('/'+App.restaurants.permalink);}
service.loadRestaurantsPage=true;},function(){});},function(){});}}
service.loaded=true;if(google.loader.ClientLocation){if(google.loader.ClientLocation.latitude&&google.loader.ClientLocation.longitude){service.bounding={lat:google.loader.ClientLocation.latitude,lon:google.loader.ClientLocation.longitude,city:google.loader.ClientLocation.address.city,region:google.loader.ClientLocation.address.country_code=='US'&&google.loader.ClientLocation.address.region?google.loader.ClientLocation.address.region.toUpperCase():google.loader.ClientLocation.address.country_code,type:'googleip'};}}
if(!service.position.locs.length){service.getLocationByBrowser(function(){},error);}else{error();}}
service.geocode=function(address,success,error){service.doGeocode(address,function(results){if(results.alias){var loc=new Location({address:results.alias.address(),entered:address,type:'alias',lat:results.alias.lat(),lon:results.alias.lon(),city:results.alias.city(),prep:results.alias.prep()});}else{if(service.bounding){var latLong=new google.maps.LatLng(service.bounding.lat,service.bounding.lon);var closest=service.getClosest(results,latLong);}else{var closest=results[0];}
var loc=new Location({results:results,entered:address,type:'user',lat:closest.geometry.location.lat(),lon:closest.geometry.location.lng()});}
success(loc);},function(){error();});}
service.doGeocode=function(address,success,error,ignoreRoute){address=$.trim(address);App.track('Location Entered',{address:address});var rsuccess=function(results){success(results);};var rerror=function(){var params={address:address};if(service.bounding){var latLong=new google.maps.LatLng(service.bounding.lat,service.bounding.lon);var circle=new google.maps.Circle({center:latLong,radius:App.boundingBoxMeters});var bounds=circle.getBounds();params.bounds=bounds;}
var geocoder=new google.maps.Geocoder();geocoder.geocode(params,function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});};App.routeAlias(address,rsuccess,rerror);}
service.doGeocodeWithBound=function(address,latLong,success,error){var circle=new google.maps.Circle({center:latLong,radius:App.boundingBoxMeters});var bounds=circle.getBounds();var geocoder=new google.maps.Geocoder();geocoder.geocode({address:address,bounds:bounds},function(results,status){if(status==google.maps.GeocoderStatus.OK){success(results,status);}else{error(results,status);}});}
service.reverseGeocode=function(lat,lon,success,error){App.track('Location Reverse Geocode',{lat:lat,lon:lon});var geocoder=new google.maps.Geocoder();var latlng=new google.maps.LatLng(lat,lon);geocoder.geocode({'latLng':latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(results[1]){success(new Location({results:results,lat:lat,lon:lon}));}else{error();}}else{error();}});}
service.theClosestAddress=function(results,latLong){var lat=latLong.lat();var lng=latLong.lng();var R=6371;var distances=[];var closest=-1;for(i=0;i<results.length;i++){var alat=results[i].geometry.location.lat();var alng=results[i].geometry.location.lng();var dLat=service.toRad(alat-lat);var dLong=service.toRad(alng-lng);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
Math.cos(service.toRad(lat))*Math.cos(service.toRad(lat))*Math.sin(dLong/2)*Math.sin(dLong/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;distances[i]=d;if(closest==-1||d<distances[closest]){closest=i;}}
address=results[closest];var loc=new Location({type:'closest',lat:address.geometry.location.lat(),lon:address.geometry.location.lng()});loc.setAddressFromResult(address);loc.setCityFromResult(address);loc.setZipFromResult(address);return{result:address,location:loc};}
service.validateAddressType=function(addressLocation){if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.ROOFTOP||addressLocation.geometry.location_type==google.maps.GeocoderLocationType.RANGE_INTERPOLATED)){return true;}
if(addressLocation&&addressLocation.geometry&&addressLocation.geometry.location_type&&(addressLocation.geometry.location_type==google.maps.GeocoderLocationType.APPROXIMATE)){for(var x in addressLocation.types){var addressType=addressLocation.types[x];if(addressType=='premise'||addressType=='subpremise'||addressType=='intersection'||addressType=='establishment'){return true;}}}
return false;}
service.km2Miles=function(km){return km*0.621371;}
service.Miles2Km=function(miles){return miles*1.60934;}
service.toRad=function(number){return number*Math.PI/180;}
service.addVerify=function(){if(arguments[0]&&typeof arguments[1]!='function'){var success=arguments[2];var error=arguments[3];}else{var address=arguments[0];var success=arguments[1];var error=arguments[2];for(var x in service.locs){if(service.locs[x].entered==address&&service.locs[x].verified){success(service.locs[x]);return;}}
service.geocode(address,function(loc){service.position.addLocation(loc);success();$.totalStorage('boundingv2',service.bounding);},error);}}
return service;});;NGApp.factory('CartService',function(RestaurantService){var service={uuidInc:0,items:{}}
service.uuid=function(){var id='c-'+service.uuidInc;service.uuidInc++;return id;}
service.add=function(item){var id=service.uuid(),dish=App.cache('Dish',item);dish_options=dish.options(),options=[];if(arguments[1]){options=arguments[1].options;for(var i in dish_options){if(dish_options[i].type=='select'){var hasSelectedOption=false;var defaultValue=false;for(var j in dish_options){if(dish_options[j].id_option_parent==dish_options[i].id_option){if(dish_options[j]['default']==1){defaultValue=dish_options[j]['id_option'];}
for(var k in options){if(options[k]==dish_options[j].id_option){hasSelectedOption=true;}}}}
if(defaultValue&&!hasSelectedOption){options[options.length]=defaultValue;}}}}else{for(var x in dish_options){if(dish_options[x]['default']==1){options[options.length]=dish_options[x].id_option;}}}
service.items[id]={};service.items[id].id=item;service.items[id].options=options;service.items[id].details={};service.items[id].details.id=id;service.items[id].details.name=dish.name;service.items[id].details.description=dish.description!=null?dish.description:'';service.items[id].details.customization={};service.items[id].details.customization.customizable=(dish.options().length>0);service.items[id].details.customization.expanded=(parseInt(dish.expand_view)>0);service.items[id].details.customization.options=service._parseCustomOptions(dish_options,options);service.items[id].details.customization.rawOptions=dish_options;App.track('Dish added',{id_dish:dish.id_dish,name:dish.name});}
service.clone=function(item){var
cart=service.items[item],newoptions=[];for(var x in cart.options){newoptions[newoptions.length]=cart.options[x];}
service.add(cart.id,{options:newoptions});App.track('Dish cloned');}
service.remove=function(item){App.track('Dish removed');delete service.items[item];}
service.customizeItem=function(option,item){var cartitem=service.items[item.details.id];if(option){if(option.type=='select'){var options=item.details.customization.rawOptions;for(var i in options){if(options[i].id_option_parent!=option.id_option){continue;}
for(var x in cartitem.options){if(cartitem.options[x]==options[i].id_option&&options[i].id_option_parent==option.id_option){cartitem.options.splice(x,1);break;}}}
cartitem.options[cartitem.options.length]=option.selected;}else if(option.type=='check'){if(option.checked){cartitem.options[cartitem.options.length]=option.id_option;}else{for(var x in cartitem.options){if(cartitem.options[x]==option.id_option){cartitem.options.splice(x,1);break;}}}}}
service.items[item.details.id]=cartitem;}
service.customizeItemPrice=function(price,force){if(price!='0.00'||force){return' ('+((price<0)?'minus $':'+ $')+parseFloat(Math.abs(price)).toFixed(2)+')';}
return'';}
service.getCart=function(){var cart=[];for(x in service.items){var index=cart.length;cart[index]={id:service.items[x].id,options:service.items[x].options};}
return cart;}
service.hasItems=function(){if(!$.isEmptyObject(service.items)){return true;}
return false;}
service.summary=function(){var items={};for(var x in service.items){if(items[service.items[x].details.name]){items[service.items[x].details.name]++;}else{items[service.items[x].details.name]=1;}}
var text='';for(x in items){text=',\u00A0\u00A0'+text;if(items[x]>1){text=x+'\u00A0('+items[x]+')'+text;}else{text=x+text;}}
return text.substr(0,text.length-3);}
service.subtotal=function(){var
total=0,options;for(var x in service.items){total+=parseFloat(App.cached['Dish'][service.items[x].id].price);options=service.items[x].options;for(var xx in options){var option=App.cached['Option'][options[xx]];if(option===undefined)continue;total+=parseFloat(option.optionPrice(options));}}
total=App.ceil(total);return total;}
service.totalItems=function(){var size=0;for(var x in service.items){if(service.items.hasOwnProperty(x)){size++;}}
return size;}
service._parseCustomOptions=function(options,selectedOptions){var parsedOptions=[];for(var x in options){var newOption={};var rawOption=options[x];if(rawOption.id_option_parent){continue;}
newOption.type=rawOption.type;newOption.id_option=rawOption.id_option;newOption.name=rawOption.name+(rawOption.description||'');if(rawOption.type=='check'){newOption.id_option=rawOption.id_option;newOption.price=rawOption.optionPrice(options);newOption.priceFormated=service.customizeItemPrice(newOption.price);newOption.checked=($.inArray(rawOption.id_option,selectedOptions)!==-1);}
if(rawOption.type=='select'){newOption.options=[];newOption.selected=false;for(var i in options){if(options[i].id_option_parent==rawOption.id_option){var newSubOption={};newSubOption.id_option=options[i].id_option;newSubOption.id_option_parent=options[i].id_option_parent;newSubOption.price=options[i].price;newSubOption.priceFormated=service.customizeItemPrice(newSubOption.price);newSubOption.selected=($.inArray(options[i].id_option,selectedOptions)!==-1);newSubOption.name=options[i].name+(options[i].description||'')+service.customizeItemPrice(newSubOption.price,(rawOption.price_linked=='1'));newOption.options.push(newSubOption);if(newSubOption.selected){newOption.selected=options[i].id_option;}}}}
parsedOptions.push(newOption);}
return parsedOptions;}
return service;});;addEventListener('touchstart',function(){});addEventListener('load',function(event){setTimeout(scrollTo,80,0,1);},false);